<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>ctdfjorder API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#CTD">CTD</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CTD.__init__">CTD</a>
                        </li>
                        <li>
                                <a class="class" href="#CTD.Utility">CTD.Utility</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#CTD.Utility.__init__">Utility</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#CTD.Utility.no_values_in_object">no_values_in_object</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#CTD.Utility.remove_sample_timezone_indicator">remove_sample_timezone_indicator</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#CTD.Utility.remove_rows_with_negative_depth">remove_rows_with_negative_depth</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#CTD.Utility.remove_rows_with_negative_salinity">remove_rows_with_negative_salinity</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#CTD.Utility.remove_rows_with_invalid_salinity">remove_rows_with_invalid_salinity</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#CTD.Utility.remove_rows_with_negative_pressure">remove_rows_with_negative_pressure</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#CTD.Utility.remove_rows_with_negative_salinityabs">remove_rows_with_negative_salinityabs</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#CTD.Utility.remove_rows_with_negative_density">remove_rows_with_negative_density</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#CTD.Utility.save_to_csv">save_to_csv</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#CTD.Utility.extract_utc_cast_time">extract_utc_cast_time</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#CTD.Utility.extract_lat_long_castaway">extract_lat_long_castaway</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="function" href="#CTD.find_master_sheet_file">find_master_sheet_file</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.view_table">view_table</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.get_pandas_df">get_pandas_df</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.add_filename_to_table">add_filename_to_table</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.remove_timezone_indicator">remove_timezone_indicator</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.add_location_to_table">add_location_to_table</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.remove_upcasts">remove_upcasts</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.remove_non_positive_samples">remove_non_positive_samples</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.remove_invalid_salinity_values">remove_invalid_salinity_values</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.bin_average_pressure">bin_average_pressure</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.clean">clean</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.add_absolute_salinity">add_absolute_salinity</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.add_density">add_density</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.add_overturns">add_overturns</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.add_surface_salinity_temp_meltwater">add_surface_salinity_temp_meltwater</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.add_mean_surface_density">add_mean_surface_density</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.add_mld">add_mld</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.plot_depth_salinity_density_mld_line">plot_depth_salinity_density_mld_line</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.plot_depth_density_salinity_mld_scatter">plot_depth_density_salinity_mld_scatter</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.plot_depth_temperature_scatter">plot_depth_temperature_scatter</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.get_sample_location">get_sample_location</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.clean_salinity_autoencoder">clean_salinity_autoencoder</a>
                        </li>
                        <li>
                                <a class="function" href="#CTD.save_to_csv">save_to_csv</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Calculate">Calculate</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Calculate.gsw_infunnel">gsw_infunnel</a>
                        </li>
                        <li>
                                <a class="function" href="#Calculate.calculate_and_drop_salinity_spikes">calculate_and_drop_salinity_spikes</a>
                        </li>
                        <li>
                                <a class="function" href="#Calculate.calculate_overturns">calculate_overturns</a>
                        </li>
                        <li>
                                <a class="function" href="#Calculate.calculate_surface_salinity_and_meltwater">calculate_surface_salinity_and_meltwater</a>
                        </li>
                        <li>
                                <a class="function" href="#Calculate.calculate_surface_temperature">calculate_surface_temperature</a>
                        </li>
                        <li>
                                <a class="function" href="#Calculate.calculate_absolute_density">calculate_absolute_density</a>
                        </li>
                        <li>
                                <a class="function" href="#Calculate.calculate_absolute_salinity">calculate_absolute_salinity</a>
                        </li>
                        <li>
                                <a class="function" href="#Calculate.calculate_mld">calculate_mld</a>
                        </li>
                        <li>
                                <a class="function" href="#Calculate.calculate_mld_loess">calculate_mld_loess</a>
                        </li>
                        <li>
                                <a class="function" href="#Calculate.calculate_mean_surface_density">calculate_mean_surface_density</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CTDError">CTDError</a>
                            <ul class="memberlist">
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
ctdfjorder    </h1>

                
                        <input id="mod-ctdfjorder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-ctdfjorder-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">import</span> <span class="nn">itertools</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">pandas</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span> <span class="nn">pyrsktools</span> <span class="kn">import</span> <span class="n">RSK</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">from</span> <span class="nn">pyrsktools</span> <span class="kn">import</span> <span class="n">Region</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span> <span class="nn">gsw</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">import</span> <span class="nn">statsmodels.api</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">ScalarFormatter</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">mixed_precision</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Model</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">LSTM</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">RepeatVector</span><span class="p">,</span> <span class="n">TimeDistributed</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">import</span> <span class="nn">argparse</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="c1"># Set up logging</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>                    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>                        <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s2">&quot;library.log&quot;</span><span class="p">),</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>                        <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>                    <span class="p">])</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="c1"># Disable logging for specific third-party libraries</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;tensorflow&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="c1"># Tensorflow setup</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="n">policy</span> <span class="o">=</span> <span class="n">mixed_precision</span><span class="o">.</span><span class="n">Policy</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="n">mixed_precision</span><span class="o">.</span><span class="n">set_global_policy</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="k">class</span> <span class="nc">CTD</span><span class="p">:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">    CTD</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">    ---</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">    Class representing a CTD object for processing and analyzing CTD data.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    Attributes</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">    ----------</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">    master_sheet_path : str</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">        Path to the mastersheet.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">    Usage</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">    -----</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">    To create a CTD object for custom pipelines use the following method:</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">    &gt;&gt;&gt; my_data = CTD(&quot;example.rsk&quot;)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">    You can then run a CTD command on it like removing non-postive sample rows and then viewing your table</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">    &gt;&gt;&gt; my_data.remove_non_positive_samples()</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">    &gt;&gt;&gt; my_data.view_table()</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">    Notes</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">    -----</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">    - Filenames must match a correct date, or else in instances where the mastersheet</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">    must be consulted CTDFjorder will return an error.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>    <span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>    <span class="n">_rsk</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>    <span class="n">_filename</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>    <span class="n">_calculator</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>    <span class="n">_cwd</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="n">_cached_master_sheet</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>    <span class="n">_original_profile</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>    <span class="n">master_sheet_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>    <span class="n">_NO_SAMPLES_ERROR</span> <span class="o">=</span> <span class="s2">&quot;No samples in file.&quot;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>    <span class="n">_NO_LOCATION_ERROR</span> <span class="o">=</span> <span class="s2">&quot;No location could be found.&quot;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>    <span class="n">_DENSITY_CALCULATION_ERROR</span> <span class="o">=</span> <span class="s2">&quot;Could not calculate density on this dataset.&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>    <span class="n">_SALINITYABS_CALCULATION_ERROR</span> <span class="o">=</span> <span class="s2">&quot;Could not calculate salinity on this dataset.&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>    <span class="n">_DATA_CLEANING_ERROR</span> <span class="o">=</span> <span class="s2">&quot;No data remains after data cleaning, reverting to previous CTD&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="n">_REMOVE_NEGATIVES_ERROR</span> <span class="o">=</span> <span class="s2">&quot;No data remains after removing non-positive samples.&quot;</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>    <span class="n">_MLD_ERROR</span> <span class="o">=</span> <span class="s2">&quot;No data remains after calculating MLD.&quot;</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>    <span class="n">_NO_MASTER_SHEET_ERROR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;No mastersheet provided. Cannot geolocate file, try using find_master_sheet_file &quot;</span> <span class="o">+</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>                             <span class="s2">&quot;before this step.&quot;</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>    <span class="n">_rsk_file_flag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctdfilepath</span><span class="p">,</span> <span class="n">cached_master_sheet</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="n">master_sheet_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd">        Initialize a new CTD object.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">        Parameters</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">        ----------</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="sd">        ctdfilepath : str</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="sd">            The file path to the RSK or Castaway file.</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_master_sheet</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span> <span class="o">=</span> <span class="n">cached_master_sheet</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>        <span class="k">if</span> <span class="s2">&quot;rsk&quot;</span> <span class="ow">in</span> <span class="n">ctdfilepath</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rsk_file_flag</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span> <span class="o">=</span> <span class="n">RSK</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.rsk&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>            <span class="n">num_profiles</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">profiles</span><span class="p">())</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>            <span class="n">rsk_downcast_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">casts</span><span class="p">(</span><span class="n">Region</span><span class="o">.</span><span class="n">CAST_DOWN</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>            <span class="k">if</span> <span class="n">num_profiles</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">npsamples</span><span class="p">())</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>                <span class="n">region</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rsk_downcast_times</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>                <span class="n">start_time</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">start_time</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>                <span class="n">end_time</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">end_time</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">npsamples</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">))</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>                    <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s2">&quot;No downcasts in file.&quot;</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_original_profile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rsk_file_flag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>            <span class="n">utc_cast_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">extract_utc_cast_time</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">=</span><span class="n">ctdfilepath</span><span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>            <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">extract_lat_long_castaway</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">=</span><span class="n">ctdfilepath</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>                <span class="n">latitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>                <span class="n">longitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>                <span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>                <span class="n">longitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>            <span class="c1"># Convert UTC cast time to datetime and create timestamp column</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">utc_cast_time</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>            <span class="c1"># Calculate the time increments for each row</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>            <span class="n">pd_csv_castaway</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>            <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pd_csv_castaway</span><span class="p">))]</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>            <span class="n">header_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>                <span class="s2">&quot;Pressure (Decibar)&quot;</span><span class="p">:</span> <span class="s2">&quot;seapressure_00&quot;</span><span class="p">,</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>                <span class="s2">&quot;Depth (Meter)&quot;</span><span class="p">:</span> <span class="s2">&quot;depth_00&quot;</span><span class="p">,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>                <span class="s2">&quot;Temperature (Celsius)&quot;</span><span class="p">:</span> <span class="s2">&quot;temperature_00&quot;</span><span class="p">,</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>                <span class="s2">&quot;Conductivity (MicroSiemens per Centimeter)&quot;</span><span class="p">:</span> <span class="s2">&quot;conductivity_00&quot;</span><span class="p">,</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>                <span class="s2">&quot;Specific conductance (MicroSiemens per Centimeter)&quot;</span><span class="p">:</span> <span class="s2">&quot;specificconductivity_00&quot;</span><span class="p">,</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>                <span class="s2">&quot;Salinity (Practical Salinity Scale)&quot;</span><span class="p">:</span> <span class="s2">&quot;salinity_00&quot;</span><span class="p">,</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>                <span class="s2">&quot;Sound velocity (Meters per Second)&quot;</span><span class="p">:</span> <span class="s2">&quot;speedofsound_00&quot;</span><span class="p">,</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>            <span class="p">}</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>            <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">header_mapping</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>            <span class="c1"># Insert the timestamp column as the first column</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>            <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;seapressure_00&#39;</span><span class="p">]</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>            <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">10</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>            <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;conductivity_00&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">1000</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>            <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>            <span class="n">pd_csv_castaway</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>            <span class="n">pd_csv_castaway</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>            <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Density (Kilograms per Cubic Meter)&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_original_profile</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span> <span class="o">=</span> <span class="n">_get_cwd</span><span class="p">()</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span> <span class="o">=</span> <span class="n">master_sheet_path</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span><span class="o">=</span><span class="n">cached_master_sheet</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;New CTD Object Created from : &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>    <span class="k">def</span> <span class="nf">find_master_sheet_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">        Function to find and the master sheet path. Uses the first xlsx file in the current working directory.</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="n">cwd</span> <span class="o">=</span> <span class="n">_get_cwd</span><span class="p">()</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>        <span class="n">xlsx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xlsx&quot;</span><span class="p">)]</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlsx_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">xlsx_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>    <span class="k">def</span> <span class="nf">view_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">        Print the CTD data table.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;psql&#39;</span><span class="p">))</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>    <span class="k">def</span> <span class="nf">get_pandas_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">        Exposes the dataframe of the CTD object for custom processes.</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">        Parameters</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">        ----------</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">        copy : bool, optional</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">            If True returns a copy, if False returns the actual DataFrame internal to the CTD object. Defaults to True.</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">        Returns</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">        -------</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">        DataFrame</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">            The pandas df of the CTD object.</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">copy</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>    <span class="k">def</span> <span class="nf">add_filename_to_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">        Add the filename to the CTD data table.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>    <span class="k">def</span> <span class="nf">remove_timezone_indicator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">        Removes the timezone indicator in the CTD data table &#39;timestamp&#39; column.</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_sample_timezone_indicator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>    <span class="k">def</span> <span class="nf">add_location_to_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">        Retrieves the sample location data from the RSK file and adds it to the CTD data table.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">        If no location data is found, it attempts to estimate the location using the master sheet.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>        <span class="c1"># Check if file is castaway</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsk_file_flag</span><span class="p">:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>                    <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_MASTER_SHEET_ERROR</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>                    <span class="n">location_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_master_sheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>                <span class="k">return</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="c1"># Process RSK file</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>            <span class="n">location_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sample_location</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">location_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>                                                     <span class="n">longitude</span><span class="o">=</span><span class="n">location_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_LOCATION_ERROR</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>    <span class="k">def</span> <span class="nf">remove_upcasts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">        Removes upcasts based on the rate of change of pressure over time.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">        This function calculates the vertical speed of the system through the water</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">        using the derivative of pressure with respect to time. It filters out data</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">        collected in the air or while stationary at the surface or bottom, and</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        separates the downcasts from upcasts.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>        <span class="c1"># Ensure &#39;timestamp&#39; is a datetime object for correct differentiation</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_datetime64_any_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]):</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>        <span class="c1"># Calculate the time differences in seconds</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="n">time_diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="c1"># Calculate the rate of change of pressure over time (dP/dt)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>        <span class="n">pressure_diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>        <span class="n">vertical_speed</span> <span class="o">=</span> <span class="n">pressure_diffs</span> <span class="o">/</span> <span class="n">time_diffs</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>        <span class="c1"># Add vertical speed to the DataFrame</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertical_speed</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>        <span class="c1"># Filter out data where the rate of change of pressure indicates upcasting or stationary periods</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="c1"># Assuming positive vertical speed indicates downcasting (i.e., increasing pressure)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="c1"># You might need to adjust this logic based on the actual data characteristics</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())]</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>    <span class="k">def</span> <span class="nf">remove_non_positive_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">        Iterates through the columns of the CTD data table and removes rows with non-positive values</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">        for depth, pressure, salinity, absolute salinity, or density.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>            <span class="k">match</span> <span class="n">column</span><span class="p">:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>                <span class="k">case</span> <span class="s1">&#39;depth_00&#39;</span><span class="p">:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_depth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>                <span class="k">case</span> <span class="s1">&#39;pressure_00&#39;</span><span class="p">:</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_pressure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>                <span class="k">case</span> <span class="s1">&#39;salinity_00&#39;</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_salinity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>                <span class="k">case</span> <span class="s1">&#39;salinityabs&#39;</span><span class="p">:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_salinityabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>                <span class="k">case</span> <span class="s1">&#39;density&#39;</span><span class="p">:</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_density</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_REMOVE_NEGATIVES_ERROR</span><span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>    <span class="k">def</span> <span class="nf">remove_invalid_salinity_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">        Removes rows with invalid values (&lt;10) for practical salinity.</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>            <span class="k">match</span> <span class="n">column</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>                <span class="k">case</span> <span class="s1">&#39;salinity_00&#39;</span><span class="p">:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_invalid_salinity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_REMOVE_NEGATIVES_ERROR</span><span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>    <span class="k">def</span> <span class="nf">bin_average_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">        Bins by pressure and averages numeric columns.</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">        Parameters</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">        ----------</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="sd">        bin_size: float</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">            Size of pressure bins, defaults to 0.5.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>        <span class="c1"># Check if &#39;Pressure_Bin&#39; already exists and drop it if it does</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>        <span class="k">if</span> <span class="s1">&#39;Pressure_Bin&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>        <span class="c1"># Binning data using the specified bin size</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="n">bin_size</span><span class="p">)</span> <span class="o">*</span> <span class="n">bin_size</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>        <span class="c1"># Identifying numeric and non-numeric columns</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>        <span class="n">numeric_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="n">numeric_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">)</span>  <span class="c1"># Remove the original pressure column if it&#39;s still in the list</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>        <span class="n">non_numeric_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>                            <span class="s1">&#39;longitude&#39;</span><span class="p">]</span>  <span class="c1"># specify any non-numeric column you expect to handle specially</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>        <span class="c1"># Creating aggregation dictionary</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>        <span class="n">agg_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">}</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>        <span class="n">agg_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">non_numeric_cols</span><span class="p">})</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="c1"># Aggregating data by the new pressure bins</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>        <span class="n">data_binned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="c1"># Cleaning up DataFrame, resetting the index and column names</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        <span class="n">data_binned</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">:</span> <span class="s1">&#39;pressure_00&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;autoencoder&#39;</span><span class="p">):</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">        Applies data cleaning methods to the specified feature using the selected method.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="sd">        Currently supports cleaning practical salinity using &#39;salinitydiff&#39; or &#39;autoencoder&#39; methods.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">        Parameters</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">        ----------</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">        feature : str</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">            The feature to clean (e.g., &#39;practicalsalinity&#39;).</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">            Options are &#39;practicalsalinity&#39;.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">        method : str, optional</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">            The cleaning method to apply, defaults to &#39;autoencoder&#39;.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">            Options are &#39;salinitydiff&#39;, &#39;autoencoder&#39;.</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>        <span class="n">supported_features</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>            <span class="s2">&quot;practicalsalinity&quot;</span><span class="p">:</span> <span class="s2">&quot;salinity_00&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="p">}</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="n">supported_methods</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>            <span class="s2">&quot;salinitydiff&quot;</span><span class="p">:</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_and_drop_salinity_spikes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">),</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>            <span class="s2">&quot;autoencoder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_salinity_autoencoder</span><span class="p">()</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="p">}</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="k">if</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">supported_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>            <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">supported_methods</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">supported_methods</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;clean: Invalid method </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> not in </span><span class="si">{</span><span class="n">supported_methods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;clean: Invalid feature </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> not in </span><span class="si">{</span><span class="n">supported_features</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DATA_CLEANING_ERROR</span><span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>    <span class="k">def</span> <span class="nf">add_absolute_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        Calculates the absolute salinity using the TEOS-10 equations and adds it as a new column</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">        to the CTD data table. Removes rows with negative absolute salinity values.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;salinityabs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_absolute_salinity</span><span class="p">(</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_salinityabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SALINITYABS_CALCULATION_ERROR</span><span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>    <span class="k">def</span> <span class="nf">add_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">        Calculates the density using the TEOS-10 equations and adds it as a new column to the CTD</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">        data table. If absolute salinity is not present, it is calculated first.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>        <span class="k">if</span> <span class="s1">&#39;salinityabs&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_absolute_density</span><span class="p">(</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_absolute_salinity</span><span class="p">()</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_absolute_density</span><span class="p">(</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;salinityabs&#39;</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>                <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DENSITY_CALCULATION_ERROR</span><span class="p">)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="k">def</span> <span class="nf">add_overturns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="sd">        Calculates density changes between consecutive measurements and identifies overturns where</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">        denser water lies above less dense water. Adds an &#39;overturn&#39; column to the CTD data table.</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_overturns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>    <span class="k">def</span> <span class="nf">add_surface_salinity_temp_meltwater</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">12.0</span><span class="p">):</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a><span class="sd">        Calculates the surface salinity, temperature, and meltwater fraction and adds them as a new column to the CTD</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">        data table</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">        Parameters</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">        ----------</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">        start : float, optional</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">            Minimum pressure bound, defaults to 10.0.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">        end : float, optional</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">            Maximum pressure bound, defaults to 12.0.</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>        <span class="n">surface_salinity</span><span class="p">,</span> <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_surface_salinity_and_meltwater</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>                                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_surface_temperature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">surface_salinity</span><span class="o">=</span><span class="n">surface_salinity</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">meltwater_fraction</span><span class="o">=</span><span class="n">meltwater_fraction</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">surface_temperature</span><span class="o">=</span><span class="n">surface_temperature</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>    <span class="k">def</span> <span class="nf">add_mean_surface_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">100.0</span><span class="p">):</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">        Calculates the mean surface density from the density values and adds it as a new column</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">        to the CTD data table.</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">        Parameters</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">        ----------</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">        start : float, optional</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="sd">            Depth bound, defaults to 0.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">        end : float, optional</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">            Depth bound, default to 1.</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>        <span class="n">mean_surface_density</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_mean_surface_density</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">mean_surface_density</span><span class="o">=</span><span class="n">mean_surface_density</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>    <span class="k">def</span> <span class="nf">add_mld</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">):</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="sd">        Calculates the mixed layer depth using the specified method and reference depth.</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="sd">        Adds the MLD and the actual reference depth used as new columns to the CTD data table.</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a><span class="sd">        Parameters</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="sd">        ----------</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="sd">        reference : int</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">            The reference depth for MLD calculation.</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a><span class="sd">        method : int</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">            The MLD calculation method (default: &quot;default&quot;).</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>        <span class="n">copy_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="n">supported_methods</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>            <span class="s2">&quot;default&quot;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        <span class="p">]</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>        <span class="n">unpack</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>            <span class="n">unpack</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_mld</span><span class="p">(</span><span class="n">copy_ctd_array</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="n">copy_ctd_array</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>                                             <span class="n">reference</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;add_mld: Invalid method </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> not in </span><span class="si">{</span><span class="n">supported_methods</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>            <span class="n">unpack</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>        <span class="k">if</span> <span class="n">unpack</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>            <span class="n">unpack</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s2">&quot;MLD could not be calculated.&quot;</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="n">MLD</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>        <span class="n">depth_used_as_reference</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MLD</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1"> Actual Reference Depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth_used_as_reference</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MLD_ERROR</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>    <span class="k">def</span> <span class="nf">plot_depth_salinity_density_mld_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="sd">        Generates a plot of depth vs. salinity and density, applying LOESS smoothing to the data.</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">        Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="sd">        Saves the plot as an image file.</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>            <span class="n">df_filtered</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Drop rows with NaNs</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>            <span class="k">return</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;surface_salinity&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;surface_temperature&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>        <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;meltwater_fraction&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>        <span class="c1"># Dynamically set y-axis limits based on depth data</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">max_depth</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Assuming depth increases downwards</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>        <span class="n">lowess</span> <span class="o">=</span> <span class="n">statsmodels</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">nonparametric</span><span class="o">.</span><span class="n">lowess</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="n">salinity_lowess</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>        <span class="n">salinity_depths</span><span class="p">,</span> <span class="n">salinity_smooth</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">salinity_lowess</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="n">color_salinity</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">salinity_smooth</span><span class="p">,</span> <span class="n">salinity_depths</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Practical Salinity&#39;</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Practical Salinity (PSU)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="n">density_lowess</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>        <span class="n">density_depths</span><span class="p">,</span> <span class="n">density_smooth</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">density_lowess</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="n">color_density</span> <span class="o">=</span> <span class="s1">&#39;tab:red&#39;</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">density_smooth</span><span class="p">,</span> <span class="n">density_depths</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>        <span class="n">mld_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>            <span class="k">if</span> <span class="s1">&#39;MLD&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>                <span class="n">mld_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="n">refdepth_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>            <span class="k">if</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>                <span class="n">refdepth_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mld_col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mld_cols</span><span class="p">):</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> Ref&#39;</span><span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;MLD with respect to </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>                     <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">())</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density with LOESS Transform &quot;</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> THIS IS AN UNSTABLE WATER COLUMN &quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(Higher density fluid lies above lower density fluid)&quot;</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density with LOESS Transform </span><span class="se">\n</span><span class="s2"> Surface Salinity </span><span class="si">{</span><span class="n">surface_salinity</span><span class="si">}</span><span class="se">\n</span><span class="s2">, Surface Temperature </span><span class="si">{</span><span class="n">surface_temperature</span><span class="si">}</span><span class="se">\n</span><span class="s2">, Meltwater Fraction </span><span class="si">{</span><span class="n">meltwater_fraction</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        <span class="n">lines</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>        <span class="n">ax2_legend</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">),</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>                   <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;plots/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_salinity_density_depth_plot_dual_x_axes_line.png&quot;</span><span class="p">)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="n">plot_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)):</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>    <span class="k">def</span> <span class="nf">plot_depth_density_salinity_mld_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">        Generates a scatter plot of depth vs. salinity and density.</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">        Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        Saves the plot as an image file.</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>            <span class="k">return</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_salinity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>        <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">meltwater_fraction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="c1"># Dynamically set y-axis limits based on depth data</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">max_depth</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Assuming depth increases downwards</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="n">color_salinity</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">,</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Practical Salinity&#39;</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Practical Salinity (PSU)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>        <span class="n">color_density</span> <span class="o">=</span> <span class="s1">&#39;tab:red&#39;</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="n">mld_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>            <span class="k">if</span> <span class="s1">&#39;MLD&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>                <span class="n">mld_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>        <span class="n">refdepth_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>            <span class="k">if</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                <span class="n">refdepth_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mld_col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mld_cols</span><span class="p">):</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> Ref&#39;</span><span class="p">)</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;MLD with respect to </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>                     <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">())</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density &quot;</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> THIS IS AN UNSTABLE WATER COLUMN &quot;</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(Higher density fluid lies above lower density fluid)&quot;</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density </span><span class="se">\n</span><span class="s2"> Surface Salinity </span><span class="si">{</span><span class="n">surface_salinity</span><span class="si">}</span><span class="s2">, Meltwater Fraction </span><span class="si">{</span><span class="n">meltwater_fraction</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="n">lines</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="n">ax2_legend</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">),</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>                   <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;plots/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_salinity_density_depth_plot_dual_x_axes.png&quot;</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="n">plot_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)):</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">)</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>    <span class="k">def</span> <span class="nf">plot_depth_temperature_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">        Generates a scatter plot of depth vs. temperature.</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a><span class="sd">        Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">        Saves the plot as an image file.</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>            <span class="k">return</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_salinity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>        <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">meltwater_fraction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>        <span class="c1"># Dynamically set y-axis limits based on depth data</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">max_depth</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Assuming depth increases downwards</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>        <span class="n">color_temp</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;temperature_00&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_temp</span><span class="p">,</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_temp</span><span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_temp</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="n">mld_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>            <span class="k">if</span> <span class="s2">&quot;MLD&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s2">&quot;Actual&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>                <span class="n">mld_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>        <span class="n">refdepth_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="k">if</span> <span class="s2">&quot;Reference Depth&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                <span class="n">refdepth_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mld_col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mld_cols</span><span class="p">):</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> Ref&#39;</span><span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;MLD with respect to </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                     <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">())</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Temperature </span><span class="se">\n</span><span class="s2"> &quot;</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>                <span class="sa">f</span><span class="s2">&quot;THIS IS AN UNSTABLE WATER COLUMN </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>                <span class="sa">f</span><span class="s2">&quot;(Higher density fluid lies above lower density fluid)&quot;</span><span class="p">)</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Temperature </span><span class="se">\n</span><span class="s2"> Surface Temperature </span><span class="si">{</span><span class="n">surface_temperature</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="n">lines</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;plots/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_temperature_depth_plot.png&quot;</span><span class="p">)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="n">plot_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)):</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>    <span class="k">def</span> <span class="nf">_process_master_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master_sheet_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="sd">        Extracts the date and time components from the filename and compares them with the data</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">        in the master sheet. Calculates the absolute differences between the dates and times to</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">        find the closest match. Returns the estimated latitude, longitude, and updated filename</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="sd">        based on the closest match.</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">        Parameters</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">        ----------</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">        master_sheet_path : str</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">            The path to the master sheet Excel file.</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">        filename : str</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">            The filename of the RSK file.</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">        Returns</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">        -------</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">        tuple</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">            A tuple containing the estimated latitude, longitude, and updated filename.</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>        <span class="k">def</span> <span class="nf">get_date_from_string</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>                <span class="n">year</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>                <span class="n">month</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                <span class="n">day</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">:]</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                <span class="n">hour</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                <span class="n">minute</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                <span class="n">time</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hour</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">minute</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">month</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">day</span><span class="p">),</span> <span class="n">time</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>        <span class="c1"># Function to calculate the absolute difference between two dates</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>        <span class="k">def</span> <span class="nf">date_difference</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">target_year</span><span class="p">,</span> <span class="n">target_month</span><span class="p">,</span> <span class="n">target_day</span><span class="p">):</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>            <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_month</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>                <span class="n">row</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_day</span><span class="p">)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>        <span class="c1"># Function to calculate the absolute difference between two times</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="k">def</span> <span class="nf">time_difference</span><span class="p">(</span><span class="n">target_time</span><span class="p">,</span> <span class="n">df_time</span><span class="p">):</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>            <span class="n">df_time_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">df_time</span><span class="p">)</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>                <span class="n">target_hour</span><span class="p">,</span> <span class="n">target_minute</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">target_time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>                <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;Malformed filename, could not parse time.&quot;</span><span class="p">)</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>                <span class="n">df_hour</span><span class="p">,</span> <span class="n">df_minute</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">df_time_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">df_time_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>                <span class="c1"># Invalid time</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>                <span class="k">return</span> <span class="mi">1000000</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>            <span class="k">return</span> <span class="nb">abs</span><span class="p">((</span><span class="n">target_hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">target_minute</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">df_hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">df_minute</span><span class="p">))</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="c1"># Check if the master sheet is already cached</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>            <span class="c1"># Load the master sheet and cache it</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reloading master sheet.&quot;</span><span class="p">)</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">master_sheet_path</span><span class="p">)</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="n">master_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>        <span class="c1"># Get date and time components from the filename</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>        <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">get_date_from_string</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>        <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>        <span class="c1"># Calculate absolute differences for each row in &#39;master_df&#39;</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;date_difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">master_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">date_difference</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;time_difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;time_local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">time_difference</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="c1"># Find the rows with the smallest total difference for date</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>        <span class="n">smallest_date_difference</span> <span class="o">=</span> <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;date_difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="n">closest_date_rows</span> <span class="o">=</span> <span class="n">master_df</span><span class="p">[</span><span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;date_difference&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">smallest_date_difference</span><span class="p">]</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="c1"># Check if time_difference returns None</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="k">if</span> <span class="n">closest_date_rows</span><span class="p">[</span><span class="s1">&#39;time_difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>            <span class="n">closest_time_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>            <span class="n">closest_row_overall</span> <span class="o">=</span> <span class="n">closest_date_rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>            <span class="c1"># If there are multiple rows with the smallest date difference, select the row with the smallest time difference</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">closest_date_rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>                    <span class="n">closest_time_row</span> <span class="o">=</span> <span class="n">closest_date_rows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">closest_date_rows</span><span class="p">[</span><span class="s1">&#39;time_difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>                <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>                    <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;Malformed time input.&quot;</span><span class="p">)</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                <span class="n">closest_row_overall</span> <span class="o">=</span> <span class="n">closest_time_row</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>                <span class="n">closest_time_time</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;time_local&#39;</span><span class="p">]</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>                <span class="n">closest_row_overall</span> <span class="o">=</span> <span class="n">closest_date_rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>                <span class="n">closest_time_time</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;time_local&#39;</span><span class="p">]</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="n">latitude</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="n">longitude</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>        <span class="n">unique_id</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="n">RBRfilename</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_gpscm&quot;</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="c1"># Access the closest date components</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>        <span class="n">closest_date_year</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="n">closest_date_month</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>        <span class="n">closest_date_day</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="c1"># Print the closest date and time</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;|-ESTIMATION ALERT-|&quot;</span><span class="p">)</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Had to guess location on file: &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unique ID: &quot;</span> <span class="o">+</span> <span class="n">unique_id</span><span class="p">)</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Closest Date (Year, Month, Day):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">closest_date_year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">closest_date_month</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="n">closest_date_day</span><span class="p">))</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Lat: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">latitude</span><span class="p">))</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Long: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">longitude</span><span class="p">))</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>        <span class="k">if</span> <span class="n">closest_time_time</span><span class="p">:</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Closest Time:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">closest_time_time</span><span class="p">))</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;====================&quot;</span><span class="p">)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="k">return</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">RBRfilename</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>    <span class="k">def</span> <span class="nf">get_sample_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rsk</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a><span class="sd">        Retrieves the sample location data from the RSK file. If no location data is found,</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a><span class="sd">        it attempts to estimate the location using the master sheet. Returns the latitude,</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">        longitude, and updated filename.</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">        Parameters</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">        ----------</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">        rsk : RSK</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">            Ruskin object of the RSK file.</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">        filename : str</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">            The filename of the RSK file.</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a><span class="sd">        Returns</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">        -------</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">        tuple</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">            A tuple containing the latitude associated with the sample, longitude associated with the sample,</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">            and the filename, adds _gps if the location was in the ruskin file,</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">            _gpscm if located via mastersheet, or _gpserror if unable to locate.</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>        <span class="c1"># Adding geo data, assumes no drift and uses the first lat long in the file if there is one</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="n">geo_data_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">rsk</span><span class="o">.</span><span class="n">geodata</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)))</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        <span class="k">if</span> <span class="n">geo_data_length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>            <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_master_sheet</span><span class="p">(</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>            <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>            <span class="k">for</span> <span class="n">geo</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">rsk</span><span class="o">.</span><span class="n">geodata</span><span class="p">(),</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>                <span class="c1"># Is there geo data?</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>                <span class="k">if</span> <span class="n">geo</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>                    <span class="c1"># If there is, is it from the southern ocean?</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">60</span><span class="p">):</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                            <span class="n">latitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                            <span class="n">longitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                            <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;_gps&quot;</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>                            <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>                        <span class="k">except</span><span class="p">:</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                            <span class="n">latitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">latitude</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>                            <span class="n">longitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">longitude</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>                            <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;_gps&quot;</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>                            <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>                        <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_master_sheet</span><span class="p">(</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>                        <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>                    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;gpserror&#39;</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>    <span class="k">def</span> <span class="nf">clean_salinity_autoencoder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">        Cleans salinity using an LSTM autoencoder ML model.</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">        Warning: This process will bin the data every 0.5 dbar of pressure.</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">        Returns</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">        -------</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">        DataFrame</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">            CTD data with clean salinity values.</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>        <span class="k">def</span> <span class="nf">loss_function</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">            MAE loss with additional term to penalize salinity predictions that increase with pressure.</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">            Parameters</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">            ----------</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">            y_true</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">                True salinity tensor.</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">            y_pred</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">                Predicted salinity tensor.</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">            Returns</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">            -------</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">            float</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="sd">                Loss value.</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>            <span class="c1"># Assuming salinity is at index 0</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>            <span class="n">salinity_true</span> <span class="o">=</span> <span class="n">y_true</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>            <span class="n">salinity_pred</span> <span class="o">=</span> <span class="n">y_pred</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>            <span class="c1"># Calculate differences between consecutive values</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>            <span class="n">delta_sal_true</span> <span class="o">=</span> <span class="n">salinity_true</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">salinity_true</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>            <span class="n">delta_sal_pred</span> <span class="o">=</span> <span class="n">salinity_pred</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">salinity_pred</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>            <span class="c1"># Penalize predictions where salinity decreases while pressure increases</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>            <span class="n">penalties</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta_sal_pred</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">tf</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">delta_sal_pred</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>            <span class="c1"># Calculate mean absolute error</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>            <span class="n">mae</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">))</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>            <span class="c1"># Add penalties</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>            <span class="k">return</span> <span class="n">mae</span> <span class="o">+</span> <span class="mf">6.0</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">penalties</span><span class="p">)</span>  <span class="c1"># Adjust weighting of penalty as needed</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>        <span class="k">def</span> <span class="nf">build_lstm_autoencoder</span><span class="p">(</span><span class="n">input_shape</span><span class="p">):</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">            LSTM autoencoder architecture.</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="c1"># Encoder</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>            <span class="n">encoder_inputs</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;encoder_inputs&#39;</span><span class="p">)</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>            <span class="n">encoder_lstm1</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">encoder_inputs</span><span class="p">)</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="n">encoder_lstm2</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">encoder_lstm1</span><span class="p">)</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>            <span class="n">encoder_lstm3</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">encoder_lstm2</span><span class="p">)</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="n">encoder_lstm4</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">encoder_lstm3</span><span class="p">)</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>            <span class="n">encoder_output</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)(</span><span class="n">encoder_lstm4</span><span class="p">)</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>            <span class="c1"># Decoder</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>            <span class="n">decoder_inputs</span> <span class="o">=</span> <span class="n">RepeatVector</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])(</span><span class="n">encoder_output</span><span class="p">)</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>            <span class="n">decoder_lstm1</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_inputs</span><span class="p">)</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="n">decoder_lstm2</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_lstm1</span><span class="p">)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>            <span class="n">decoder_lstm3</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_lstm2</span><span class="p">)</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>            <span class="n">decoder_lstm4</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_lstm3</span><span class="p">)</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>            <span class="n">decoder_output</span> <span class="o">=</span> <span class="n">TimeDistributed</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;decoded_output&#39;</span><span class="p">)(</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>                <span class="n">decoder_lstm4</span><span class="p">)</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>            <span class="n">autoencoder</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">encoder_inputs</span><span class="p">,</span> <span class="n">decoder_output</span><span class="p">)</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>            <span class="n">autoencoder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss_function</span><span class="p">)</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>            <span class="k">return</span> <span class="n">autoencoder</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>        <span class="k">def</span> <span class="nf">plot_original_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Salinity (PSU)&#39;</span><span class="p">)</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original Salinity vs. Depth - </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;plots&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">_original.png&#39;</span><span class="p">))</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>            <span class="n">xlim</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>            <span class="n">ylim</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>            <span class="c1"># plt.show()</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>            <span class="k">return</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="k">def</span> <span class="nf">plot_predicted_data</span><span class="p">(</span><span class="n">predicted_df</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">):</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">predicted_df</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">predicted_df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">predicted_df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Predicted Salinity vs. Depth - </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Salinity (PSU)&#39;</span><span class="p">)</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;plots&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">_predicted.png&#39;</span><span class="p">))</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>            <span class="c1"># plt.show()</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="k">def</span> <span class="nf">run_autoencoder</span><span class="p">(</span><span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="sd">            Runs the autoencoder.</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">            Returns</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">            -------</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">            DataFrame</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">                CTD data with clean salinity values.</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>            <span class="c1"># Preprocess data</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>            <span class="c1"># Binning data</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="mf">0.25</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>            <span class="c1"># Define the desired columns and their aggregation functions</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="n">column_agg_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>                <span class="s2">&quot;temperature_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>                <span class="s2">&quot;pressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                <span class="s2">&quot;chlorophyll_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                <span class="s2">&quot;seapressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                <span class="s2">&quot;depth_00&quot;</span><span class="p">:</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                <span class="s2">&quot;salinity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                <span class="s2">&quot;speedofsound_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                <span class="s2">&quot;specificconductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>                <span class="s2">&quot;conductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>                <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>                <span class="s2">&quot;salinityabs&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>                <span class="s2">&quot;MLD_Zero&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>                <span class="s2">&quot;MLD_Ten&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>                <span class="s2">&quot;stratification&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                <span class="s2">&quot;mean_surface_density&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>                <span class="s2">&quot;surface_salinity&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>                <span class="s2">&quot;surface_temperature&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>                <span class="s2">&quot;meltwater_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>                <span class="s2">&quot;overturn&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>            <span class="p">}</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>            <span class="c1"># Check which columns are present in the DataFrame</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>            <span class="n">available_columns</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">agg_func</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">agg_func</span> <span class="ow">in</span> <span class="n">column_agg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>            <span class="c1"># Group by and aggregate based on the available columns</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>            <span class="n">data_binned</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">available_columns</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>            <span class="c1"># Rename the Pressure_Bin column if it exists</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>            <span class="k">if</span> <span class="s1">&#39;Pressure_Bin&#39;</span> <span class="ow">in</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                <span class="n">data_binned</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">:</span> <span class="s1">&#39;pressure_00&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>            <span class="c1"># Scaling data</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>            <span class="n">numerical_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>            <span class="n">scaled_sequence</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data_binned</span><span class="p">[</span><span class="n">numerical_columns</span><span class="p">])</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scaled_sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>                <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s2">&quot;Not enough values to run the autoencoder on this data.&quot;</span><span class="p">)</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>            <span class="n">scaled_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">scaled_sequence</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>            <span class="n">min_pres</span> <span class="o">=</span> <span class="n">data_binned</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>            <span class="n">max_pres</span> <span class="o">=</span> <span class="n">data_binned</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>            <span class="c1"># Calculate ranges</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>            <span class="n">pres_range</span> <span class="o">=</span> <span class="n">max_pres</span> <span class="o">-</span> <span class="n">min_pres</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>            <span class="n">epochs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pres_range</span> <span class="o">*</span> <span class="mi">18</span><span class="p">)</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>            <span class="c1"># Build autoencoder and predict on CTD data</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="n">autoencoder</span> <span class="o">=</span> <span class="n">build_lstm_autoencoder</span><span class="p">(</span><span class="n">scaled_seq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>            <span class="n">autoencoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scaled_seq</span><span class="p">,</span> <span class="n">scaled_seq</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>            <span class="n">X_pred</span> <span class="o">=</span> <span class="n">autoencoder</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaled_seq</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>            <span class="c1"># Revert scaling</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>            <span class="n">predicted_seq</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">X_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>            <span class="n">data_binned</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predicted_seq</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>            <span class="k">if</span> <span class="n">show_plots</span><span class="p">:</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>                <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="n">plot_original_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>                <span class="n">plot_predicted_data</span><span class="p">(</span><span class="n">data_binned</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">)</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>            <span class="n">data_binned</span> <span class="o">=</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">data_binned</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>            <span class="k">return</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">reindex</span><span class="p">()</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>        <span class="k">return</span> <span class="n">run_autoencoder</span><span class="p">()</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>    <span class="k">def</span> <span class="nf">save_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">        Renames the columns of the CTD data table based on a predefined mapping and saves the</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="sd">        data to the specified CSV file. If the file already exists, the data is appended to it.</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="sd">        Parameters</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="sd">        ----------</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="sd">        output_file : str</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">            The output CSV file path.</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">save_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">)</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>    <span class="k">class</span> <span class="nc">Utility</span><span class="p">:</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">        Utility</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">        --------</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">        Utility class for CTD data processing.</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">        Attributes</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">        ----------</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">        filename :  str</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">            Filename of the RSK file.</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a><span class="sd">            Initialize a new Utility object.</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a><span class="sd">            Parameters</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a><span class="sd">            ----------</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a><span class="sd">            filename : str</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a><span class="sd">                The filename of the RSK file.</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="k">def</span> <span class="nf">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_to_check</span><span class="p">):</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="sd">            Checks if the given object is None, empty, or has a length greater than 0.</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a><span class="sd">            Returns True if the object has no values, False otherwise.</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="sd">            Parameters</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a><span class="sd">            ----------</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a><span class="sd">            object_to_check : object</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="sd">                The object to check for values.</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a><span class="sd">            Returns</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a><span class="sd">            --------</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a><span class="sd">            bool</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">                True if the object has no values, False otherwise.</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">object_to_check</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>            <span class="k">if</span> <span class="n">object_to_check</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_to_check</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>        <span class="k">def</span> <span class="nf">remove_sample_timezone_indicator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">            Removes the timezone indicator (e.g., &#39;+00:00&#39;) from the &#39;timestamp&#39; column of the</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">            given DataFrame. Returns the updated DataFrame.</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">            Parameters</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a><span class="sd">            ----------</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">            df : DataFrame</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">            Returns</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="sd">            -------</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="sd">            DataFrame</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">                The updated DataFrame with the timezone indicator removed.</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>            <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>                <span class="k">return</span> <span class="n">df</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>                <span class="k">return</span> <span class="n">df</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;depth_00&#39; column has negative values.</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="sd">            Parameter</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">            ---------</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="sd">            df : DataFrame</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">            Returns</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">            -------</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">            DataFrame</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">                The updated DataFrame with rows containing negative depth values removed.</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>            <span class="k">if</span> <span class="s1">&#39;depth_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;salinity_00&#39; column has negative values.</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">            Parameters</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">            ----------</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">            df: DataFrame</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">            Returns</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">            -------</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">            DataFrame</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">                The updated DataFrame with rows containing negative salinity values removed.</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>            <span class="k">if</span> <span class="s1">&#39;salinity_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_invalid_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="sd">            Removes rows from the given DataFrame where the practical salinity column has values &lt; 10.</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">            Parameters</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a><span class="sd">            ----------</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">            df: DataFrame</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">            Returns</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">            -------</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">            DataFrame</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">                The updated DataFrame with rows containing negative salinity values removed.</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>            <span class="k">if</span> <span class="s1">&#39;salinity_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;pressure_00&#39; column has negative values.</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">            Parameters</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">            ----------</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">            df: DataFrame</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">            Returns</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">            -------</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="sd">            DataFrame</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">                The updated DataFrame with rows containing negative pressure values removed.</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>            <span class="k">if</span> <span class="s1">&#39;pressure_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_salinityabs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;salinityabs&#39; column has negative values.</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="sd">            Parameters</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a><span class="sd">            ----------</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="sd">            df: DataFrame</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a><span class="sd">            Returns</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a><span class="sd">            -------</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="sd">            DataFrame</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="sd">                The updated DataFrame with rows containing negative absolute salinity values removed.</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>            <span class="k">if</span> <span class="s1">&#39;salinityabs&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinityabs&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;density&#39; column has negative values.</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">            Parameters</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="sd">            ----------</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a><span class="sd">            df: DataFrame</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a><span class="sd">            Returns</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a><span class="sd">            -------</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a><span class="sd">            DataFrame</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a><span class="sd">                The updated DataFrame with rows containing negative density values removed.</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>            <span class="k">if</span> <span class="s1">&#39;density&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>        <span class="nd">@staticmethod</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>        <span class="k">def</span> <span class="nf">save_to_csv</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a><span class="sd">            Renames the columns of the CTD data table based on a predefined mapping and saves the</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">            data to the specified CSV file. If the file already exists, the data is appended to it.</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="sd">            Parameters</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="sd">            ----------</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a><span class="sd">            input_df : DataFrame</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a><span class="sd">                The output CSV file path.</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a><span class="sd">            output_file : str</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a><span class="sd">                The output CSV file path.</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>            <span class="n">rsk_labels</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>                <span class="s2">&quot;temperature_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Temperature_(°C)&quot;</span><span class="p">,</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>                <span class="s2">&quot;pressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Pressure_(dbar)&quot;</span><span class="p">,</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>                <span class="s2">&quot;chlorophyll_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Chlorophyll_a_(µg/l)&quot;</span><span class="p">,</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>                <span class="s2">&quot;seapressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Sea Pressure_(dbar)&quot;</span><span class="p">,</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>                <span class="s2">&quot;depth_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Depth_(m)&quot;</span><span class="p">,</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>                <span class="s2">&quot;salinity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Salinity_(PSU)&quot;</span><span class="p">,</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>                <span class="s2">&quot;speedofsound_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Speed of Sound_(m/s)&quot;</span><span class="p">,</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>                <span class="s2">&quot;specificconductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Specific Conductivity_(µS/cm)&quot;</span><span class="p">,</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>                <span class="s2">&quot;conductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Conductivity_(mS/cm)&quot;</span><span class="p">,</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>                <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="s2">&quot;Density_(kg/m^3)&quot;</span><span class="p">,</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>                <span class="s2">&quot;salinityabs&quot;</span><span class="p">:</span> <span class="s2">&quot;Absolute Salinity_(g/kg)&quot;</span><span class="p">,</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>                <span class="s2">&quot;MLD_Zero&quot;</span><span class="p">:</span> <span class="s2">&quot;MLD Zero_(m)&quot;</span><span class="p">,</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>                <span class="s2">&quot;MLD_Ten&quot;</span><span class="p">:</span> <span class="s2">&quot;MLD Ten_(m)&quot;</span><span class="p">,</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>                <span class="s2">&quot;stratification&quot;</span><span class="p">:</span> <span class="s2">&quot;Stratification_(J/m^2)&quot;</span><span class="p">,</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>                <span class="s2">&quot;mean_surface_density&quot;</span><span class="p">:</span> <span class="s2">&quot;Mean_Surface_Density_(kg/m^3)&quot;</span><span class="p">,</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>                <span class="s2">&quot;surface_salinity&quot;</span><span class="p">:</span> <span class="s2">&quot;Surface_Salinity_(PSU)&quot;</span><span class="p">,</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>                <span class="s2">&quot;surface_temperature&quot;</span><span class="p">:</span> <span class="s2">&quot;Surface_Temperature_(°C)&quot;</span><span class="p">,</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>                <span class="s2">&quot;meltwater_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;Meltwater_Fraction_(%)&quot;</span><span class="p">,</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>                <span class="s2">&quot;overturn&quot;</span><span class="p">:</span> <span class="s2">&quot;Overturn_(Δρ&lt;-0.05)&quot;</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>            <span class="p">}</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">input_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rsk_labels</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>            <span class="c1"># Handle CSV file reading and merging</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>                <span class="n">csv_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>                <span class="n">csv_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2"> does not exist. A new file will be created.&quot;</span><span class="p">)</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>                <span class="n">csv_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>            <span class="c1"># Merge the existing DataFrame with the new DataFrame</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">csv_df</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>            <span class="c1"># Overwrite the original CSV file with the merged DataFrame</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>            <span class="n">merged_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>        <span class="nd">@staticmethod</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>        <span class="k">def</span> <span class="nf">extract_utc_cast_time</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">):</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a><span class="sd">            Function to extract the UTC cast time from a castaway file and convert it to ISO 8601 format.</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a><span class="sd">            Parameters</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a><span class="sd">            ----------</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a><span class="sd">            ctdfilepath : str</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a><span class="sd">                The file path of the castaway file to extract the time from.</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a><span class="sd">            Returns</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a><span class="sd">            -------</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a><span class="sd">            str</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a><span class="sd">                Cast time (UTC) of the castaway file in ISO 8601 format.</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>            <span class="c1"># Initialize variable to store UTC cast time</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>            <span class="n">cast_time_utc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>            <span class="c1"># Open the file and read line by line</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Cast time (UTC)&#39;</span><span class="p">):</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>                        <span class="c1"># Extract the UTC cast time after the comma</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>                            <span class="n">cast_time_str</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Take only the datetime part</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>                            <span class="c1"># Convert the datetime string to ISO format if possible</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>                                <span class="n">cast_time_utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">cast_time_str</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>                                <span class="c1"># Handle the case where date format does not match expected format</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Date format does not match expected &#39;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#39;&quot;</span><span class="p">)</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>                            <span class="k">break</span>  <span class="c1"># Stop reading once the timestamp is found</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>            <span class="k">return</span> <span class="n">cast_time_utc</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>        <span class="nd">@staticmethod</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>        <span class="k">def</span> <span class="nf">extract_lat_long_castaway</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">):</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a><span class="sd">            Function extract start lat/long from castaway file.</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a><span class="sd">            Parameters</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a><span class="sd">            ----------</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="sd">            ctdfilepath : str</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="sd">                Filepath to castaway ctd file.</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">            Returns</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">            -------</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a><span class="sd">            tuple</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="sd">                (latitude, longitude)</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>            <span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>            <span class="n">longitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>            <span class="c1"># Open the file and read line by line</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Start latitude&#39;</span><span class="p">):</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>                        <span class="c1"># Assume the format is &#39;% description, latitude&#39;</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>                            <span class="n">latitude</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Start longitude&#39;</span><span class="p">):</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>                        <span class="c1"># Assume the format is &#39;% description, longitude&#39;</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>                            <span class="n">longitude</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>            <span class="k">return</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a><span class="k">class</span> <span class="nc">Calculate</span><span class="p">:</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="sd">    Calculate</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a><span class="sd">    ----------</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a><span class="sd">    Class for CTD data calculations.</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>    <span class="k">def</span> <span class="nf">gsw_infunnel</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">CT</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a><span class="sd">        Check if the given Absolute Salinity (SA), Conservative Temperature (CT),</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a><span class="sd">        and pressure (p) are within the &quot;oceanographic funnel&quot; for the TEOS-10 75-term equation.</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="sd">        Parameters</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a><span class="sd">        ----------</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a><span class="sd">        SA : Series</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a><span class="sd">            Absolute Salinity in g/kg.</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="sd">        CT : Series</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="sd">            Conservative Temperature in degrees Celsius.</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">        p : Series</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a><span class="sd">            Sea pressure in dbar (absolute pressure minus 10.1325 dbar).</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a><span class="sd">        Returns</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="sd">        -------</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a><span class="sd">        Series of bool</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a><span class="sd">            A boolean array where True indicates the values are inside the &quot;oceanographic funnel&quot;.</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>        <span class="c1"># Ensure all inputs are Series and aligned</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">CT</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">p</span><span class="p">))):</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;SA, CT, and p must be pandas Series or p a scalar&quot;</span><span class="p">)</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">CT</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="ow">and</span> <span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Indices of SA, CT, and p must be aligned&quot;</span><span class="p">)</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>        <span class="c1"># Define the funnel conditions</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>        <span class="n">CT_freezing_p</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">CT_freezing</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>        <span class="n">CT_freezing_500</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">CT_freezing</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>        <span class="n">in_funnel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># Default all to True</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>                <span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">8000</span><span class="p">)</span> <span class="o">|</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>                <span class="p">(</span><span class="n">SA</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&gt;</span> <span class="mi">42</span><span class="p">)</span> <span class="o">|</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&lt;</span> <span class="n">CT_freezing_p</span><span class="p">))</span> <span class="o">|</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&lt;</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">5e-3</span> <span class="o">-</span> <span class="mf">2.5</span><span class="p">))</span> <span class="o">|</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">31.66666666666667</span> <span class="o">-</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">3.333333333333334e-3</span><span class="p">)))</span> <span class="o">|</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&lt;</span> <span class="n">CT_freezing_500</span><span class="p">))</span> <span class="o">|</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">))</span> <span class="o">|</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">))</span> <span class="o">|</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>                <span class="n">SA</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">|</span> <span class="n">CT</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>        <span class="p">)</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>        <span class="n">in_funnel</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>        <span class="k">return</span> <span class="n">in_funnel</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>    <span class="k">def</span> <span class="nf">calculate_and_drop_salinity_spikes</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="sd">        Calculates and removes salinity spikes from the CTD data based on predefined thresholds for acceptable</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">        changes in salinity with depth.</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">        Parameters</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a><span class="sd">        ----------</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">        df : DataFrame</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">            DataFrame containing depth and salinity data</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">        Returns</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">        -------</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">        DataFrame</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a><span class="sd">            DataFrame after removing salinity spikes</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">,</span> <span class="s1">&#39;salinity_00&#39;</span><span class="p">])</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>        <span class="n">min_depth</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>        <span class="k">if</span> <span class="n">min_depth</span> <span class="o">==</span> <span class="n">max_depth</span><span class="p">:</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Insufficient depth range to calculate.&quot;</span><span class="p">)</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>        <span class="n">acceptable_delta_salinity_per_depth</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>            <span class="p">(</span><span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">),</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>            <span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>            <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>            <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>        <span class="p">]</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>        <span class="k">for</span> <span class="n">acceptable_delta</span><span class="p">,</span> <span class="n">depth_range</span> <span class="ow">in</span> <span class="n">acceptable_delta_salinity_per_depth</span><span class="p">:</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>            <span class="n">num_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_depth</span> <span class="o">-</span> <span class="n">min_depth</span><span class="p">)</span> <span class="o">/</span> <span class="n">depth_range</span><span class="p">)</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_points</span><span class="p">)</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="p">)</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>            <span class="c1"># Group by indices and filter</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>            <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">acceptable_delta</span><span class="p">)</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>    <span class="k">def</span> <span class="nf">calculate_overturns</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">):</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a><span class="sd">        Calculates density overturns in the CTD data where denser water lies above lighter water with density</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a><span class="sd">        difference of at least 0.05 kg/m³, which may indicate mixing or other dynamic processes.</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a><span class="sd">        Parameters</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a><span class="sd">        ----------</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a><span class="sd">            DataFrame containing depth, density, and timestamp data</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">        Returns</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a><span class="sd">        -------</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a><span class="sd">        DataFrame</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a><span class="sd">            DataFrame with identified density overturns</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>        <span class="c1"># Sort DataFrame by depth in ascending order</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>        <span class="n">ctd_array</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;depth_00&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>        <span class="c1"># Calculate density change and identify overturns</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>        <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;density_change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>            <span class="s1">&#39;density&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>  <span class="c1"># Difference in density between consecutive measurements</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>        <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;density_change&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.05</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>        <span class="n">ctd_array</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>        <span class="k">if</span> <span class="s1">&#39;density_change&#39;</span> <span class="ow">in</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>            <span class="n">ctd_array</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;density_change&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>        <span class="k">return</span> <span class="n">ctd_array</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>    <span class="k">def</span> <span class="nf">calculate_surface_salinity_and_meltwater</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">12.0</span><span class="p">):</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a><span class="sd">        Calculates the surface salinity and meltwater fraction of a CTD profile.</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a><span class="sd">        Reports the mean salinity of the first 2 meters of the profile by finding the minimum salinity, and reports</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a><span class="sd">        meltwater fraction as given by (-0.021406 * surface_salinity + 0.740392) * 100.</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a><span class="sd">        Parameters</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a><span class="sd">        ----------</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a><span class="sd">            DataFrame containing salinity and depth data.</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a><span class="sd">        start : float</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a><span class="sd">            Minimum pressure of the surface, defaults to 10.0.</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a><span class="sd">        end : float</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a><span class="sd">            Maximum pressure of the surface, defaults to 12.0.</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a><span class="sd">        Returns</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a><span class="sd">        -------</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a><span class="sd">        tuple</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a><span class="sd">            Returns a tuple of (surface salinity, meltwater fraction).</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>        <span class="c1"># Filtering data within the specified pressure range</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>        <span class="n">surface_data</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)]</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">surface_data</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>        <span class="n">mwf</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.021406</span> <span class="o">*</span> <span class="n">surface_salinity</span> <span class="o">+</span> <span class="mf">0.740392</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>        <span class="k">return</span> <span class="n">surface_salinity</span><span class="p">,</span> <span class="n">mwf</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>    <span class="k">def</span> <span class="nf">calculate_surface_temperature</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">12.0</span><span class="p">):</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a><span class="sd">        Calculates the surface temperature of a CTD profile. Reports the mean temperature of the first 2 meters</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a><span class="sd">        of the profile.</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a><span class="sd">        Parameters</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a><span class="sd">        ----------</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a><span class="sd">            DataFrame containing temperature and depth data.</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a><span class="sd">        start : float</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a><span class="sd">            Minimum pressure of the surface, defaults to 10.0.</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a><span class="sd">        end : float</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a><span class="sd">            Maximum pressure of the surface, defaults to 12.0.</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a><span class="sd">        Returns</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a><span class="sd">        -------</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a><span class="sd">        float</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a><span class="sd">            Returns the mean surface temperature.</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>        <span class="c1"># Filtering data within the specified pressure range</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>        <span class="n">surface_data</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)]</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">surface_data</span><span class="p">[</span><span class="s1">&#39;temperature_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>        <span class="k">return</span> <span class="n">surface_temperature</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>    <span class="k">def</span> <span class="nf">calculate_absolute_density</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">):</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a><span class="sd">        Calculates absolute density from the CTD data using the TEOS-10 equations,</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a><span class="sd">        ensuring all data points are within the valid oceanographic funnel.</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a><span class="sd">        Parameters</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a><span class="sd">        ----------</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a><span class="sd">            DataFrame containing salinity, temperature, and pressure data</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a><span class="sd">        Returns</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a><span class="sd">        -------</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a><span class="sd">        Series</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a><span class="sd">            Series with calculated absolute density</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>        <span class="n">sa</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;salinityabs&#39;</span><span class="p">]</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;temperature_00&#39;</span><span class="p">]</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;seapressure_00&#39;</span><span class="p">]</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>        <span class="n">ct</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">CT_from_t</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>        <span class="k">if</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">gsw_infunnel</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>            <span class="k">return</span> <span class="n">gsw</span><span class="o">.</span><span class="n">density</span><span class="o">.</span><span class="n">rho_t_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Sample not in funnel, could not calculate density.&quot;</span><span class="p">)</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>    <span class="k">def</span> <span class="nf">calculate_absolute_salinity</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">):</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a><span class="sd">        Calculates absolute salinity from practical salinity, pressure,</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a><span class="sd">        and geographical coordinates using the TEOS-10 salinity conversion formulas.</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a><span class="sd">        Parameters</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a><span class="sd">        ----------</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a><span class="sd">            DataFrame containing practical salinity, pressure, longitude, and latitude data</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a><span class="sd">        Returns</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a><span class="sd">        -------</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a><span class="sd">        Series</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a><span class="sd">            Series with calculated absolute salinity</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>        <span class="n">sp</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;seapressure_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>        <span class="n">lon</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>        <span class="n">lat</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>        <span class="k">return</span> <span class="n">gsw</span><span class="o">.</span><span class="n">conversions</span><span class="o">.</span><span class="n">SA_from_SP</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>    <span class="k">def</span> <span class="nf">calculate_mld</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="n">reference_depth</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.15</span><span class="p">):</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a><span class="sd">        Calculates the mixed layer depth (MLD) using the density threshold method.</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a><span class="sd">        MLD is the depth at which the density exceeds the reference density</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a><span class="sd">        by a predefined amount delta, which defaults to (0.03 kg/m³).</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a><span class="sd">        Parameters</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a><span class="sd">        ----------</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a><span class="sd">        densities : Series</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a><span class="sd">            Series of densities</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a><span class="sd">        depths : Series</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a><span class="sd">            Series of depths corresponding to densities</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a><span class="sd">        reference_depth : float</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a><span class="sd">            The depth at which to anchor the reference density</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a><span class="sd">        delta : float, optional</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a><span class="sd">            The difference in density which would indicate the MLD, defaults to 0.1 kg/m³.</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a><span class="sd">        Returns</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a><span class="sd">        -------</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a><span class="sd">        tuple</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a><span class="sd">            A tuple containing the calculated MLD and the reference depth used to calculate MLD.</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>        <span class="c1"># Convert to numeric and ensure no NaNs remain</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>        <span class="n">reference_depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">reference_depth</span><span class="p">)</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">depths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>        <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">densities</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>        <span class="n">sorted_depths</span><span class="p">,</span> <span class="n">sorted_densities</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sorted_data</span><span class="p">)</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>        <span class="c1"># Determine reference density</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>        <span class="n">reference_density</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_depths</span><span class="p">):</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>            <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">reference_depth</span><span class="p">:</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>                <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="n">reference_depth</span><span class="p">:</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>                    <span class="n">reference_density</span> <span class="o">=</span> <span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>                    <span class="n">reference_depth</span> <span class="o">=</span> <span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>                    <span class="c1"># Linear interpolation</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a>                        <span class="n">reference_density</span> <span class="o">=</span> <span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>                                <span class="p">(</span><span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>                                <span class="p">(</span><span class="n">reference_depth</span> <span class="o">-</span> <span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>                                <span class="p">(</span><span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])))</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>                        <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>                                       <span class="sa">f</span><span class="s2">&quot;Insufficient depth range to calculate MLD. &quot;</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>                                       <span class="sa">f</span><span class="s2">&quot;Maximum sample depth is &quot;</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">depths</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">, minimum is </span><span class="si">{</span><span class="n">depths</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>                <span class="k">break</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>        <span class="k">if</span> <span class="n">reference_density</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>        <span class="c1"># Find the depth where density exceeds the reference density by more than 0.05 kg/m³</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>        <span class="k">for</span> <span class="n">depth</span><span class="p">,</span> <span class="n">density</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sorted_depths</span><span class="p">,</span> <span class="n">sorted_densities</span><span class="p">):</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>            <span class="k">if</span> <span class="n">density</span> <span class="o">&gt;</span> <span class="n">reference_density</span> <span class="o">+</span> <span class="n">delta</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">reference_depth</span><span class="p">:</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>                <span class="k">return</span> <span class="n">depth</span><span class="p">,</span> <span class="n">reference_depth</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># If no depth meets the criterion</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a>    <span class="k">def</span> <span class="nf">calculate_mld_loess</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="n">reference_depth</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.15</span><span class="p">):</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a><span class="sd">        Calculates the mixed layer depth (MLD) using LOESS smoothing to first smooth the density profile and</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a><span class="sd">        then determine the depth where the smoothed density exceeds the reference density</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a><span class="sd">        by a predefined amount which defaults to 0.03 kg/m³.</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a><span class="sd">        Parameters</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a><span class="sd">        ----------</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a><span class="sd">        densities : Series</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a><span class="sd">            Series of densities</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a><span class="sd">        depths : Series</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a><span class="sd">            Series of depths corresponding to densities</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a><span class="sd">        reference_depth :</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a><span class="sd">            The depth at which to anchor the reference density</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a><span class="sd">        delta : float, optional</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a><span class="sd">            The difference in density which would indicate the MLD, defaults to 0.03 kg/m.</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a><span class="sd">        Returns</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a><span class="sd">        -------</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a><span class="sd">        tuple</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="sd">            A tuple containing the calculated MLD and the reference depth used to calculate MLD.</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a>        <span class="c1"># Ensure input is pandas Series and drop NA values</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a>            <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a>            <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a>        <span class="c1"># Convert to numeric and ensure no NaNs remain</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>        <span class="k">if</span> <span class="n">densities</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">depths</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>        <span class="c1"># Convert pandas Series to numpy arrays for NumPy operations</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>        <span class="c1"># Remove duplicates by averaging densities at the same depth</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>        <span class="n">unique_depths</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>        <span class="n">average_densities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">unique_depths</span><span class="p">)</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">average_densities</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>        <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">unique_depths</span><span class="p">)</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>        <span class="n">average_densities</span> <span class="o">/=</span> <span class="n">counts</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>        <span class="c1"># Apply LOESS smoothing</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>        <span class="n">lowess</span> <span class="o">=</span> <span class="n">statsmodels</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">nonparametric</span><span class="o">.</span><span class="n">lowess</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>        <span class="n">smoothed</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">average_densities</span><span class="p">,</span> <span class="n">unique_depths</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>        <span class="n">smoothed_depths</span><span class="p">,</span> <span class="n">smoothed_densities</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">smoothed</span><span class="p">)</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>        <span class="n">reference_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">reference_depth</span><span class="p">,</span> <span class="n">smoothed_depths</span><span class="p">,</span> <span class="n">smoothed_densities</span><span class="p">)</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>        <span class="c1"># Find the depth where density exceeds the reference density by more than 0.05 kg/m³</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>        <span class="n">exceeding_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">smoothed_densities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">reference_density</span> <span class="o">+</span> <span class="n">delta</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>                                     <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">smoothed_densities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">reference_depth</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>        <span class="k">if</span> <span class="n">exceeding_indices</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>            <span class="n">mld_depth</span> <span class="o">=</span> <span class="n">smoothed_depths</span><span class="p">[</span><span class="n">exceeding_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>            <span class="k">return</span> <span class="n">mld_depth</span><span class="p">,</span> <span class="n">reference_depth</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># If no depth meets the criterion</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>    <span class="k">def</span> <span class="nf">calculate_mean_surface_density</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">range_</span><span class="p">):</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a><span class="sd">        Calculates the mean surface density from the CTD data, for a specified range or the entire dataset if the range is larger.</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a><span class="sd">        Parameters</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a><span class="sd">        ----------</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a><span class="sd">        df : DataFrame</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a><span class="sd">            DataFrame containing density data.</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a><span class="sd">        range_ : tuple or int</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a><span class="sd">            Tuple indicating the (start, end) indices for the range of rows to be included in the calculation,</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a><span class="sd">            or an integer indicating the number of rows from the start.</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a><span class="sd">        Returns</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a><span class="sd">        -------</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a><span class="sd">        float, None</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a><span class="sd">            Mean density value of the specified sample or None if unable to calculate.</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>        <span class="n">min_depth</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">range_</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>            <span class="c1"># Adjust &#39;start&#39; to ensure it is within the valid range</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">min_depth</span><span class="p">)</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>            <span class="c1"># Adjust &#39;end&#39; to ensure it does not exceed the maximum depth value</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>            <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>            <span class="c1"># Ensure start is less than end</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>            <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>                <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>            <span class="c1"># Use &#39;range_&#39; as the number of rows from the start, adjust if it exceeds the DataFrame length</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>            <span class="n">range_</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">range_</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">range_</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid range type. Must be tuple or int.&quot;</span><span class="p">)</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a><span class="k">class</span> <span class="nc">CTDError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a><span class="sd">    Exception raised for CTD related errors.</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a><span class="sd">    Parameters</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a><span class="sd">    ----------</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a><span class="sd">    filename: input dataset which caused the error</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a><span class="sd">    message: message -- explanation of the error</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot; Unknown, check to make sure your mastersheet is in your current directory.&quot;</span><span class="p">):</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a><span class="k">def</span> <span class="nf">process_ctd_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cached_master_sheet</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="n">master_sheet_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>        <span class="n">my_data</span> <span class="o">=</span> <span class="n">CTD</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">cached_master_sheet</span><span class="o">=</span><span class="n">cached_master_sheet</span><span class="p">,</span> <span class="n">master_sheet_path</span><span class="o">=</span><span class="n">master_sheet_path</span><span class="p">)</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">add_filename_to_table</span><span class="p">()</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">add_location_to_table</span><span class="p">()</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">remove_upcasts</span><span class="p">()</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">remove_non_positive_samples</span><span class="p">()</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">remove_invalid_salinity_values</span><span class="p">()</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="s2">&quot;practicalsalinity&quot;</span><span class="p">,</span> <span class="s1">&#39;autoencoder&#39;</span><span class="p">)</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">add_surface_salinity_temp_meltwater</span><span class="p">()</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">add_absolute_salinity</span><span class="p">()</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">add_density</span><span class="p">()</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">add_overturns</span><span class="p">()</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">add_mld</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>        <span class="n">my_data</span><span class="o">.</span><span class="n">add_mld</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a>            <span class="n">my_data</span><span class="o">.</span><span class="n">plot_depth_density_salinity_mld_scatter</span><span class="p">()</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a>            <span class="n">my_data</span><span class="o">.</span><span class="n">plot_depth_temperature_scatter</span><span class="p">()</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>    <span class="k">except</span> <span class="n">CTDError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>    <span class="k">return</span> <span class="n">my_data</span><span class="o">.</span><span class="n">get_pandas_df</span><span class="p">()</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a><span class="k">def</span> <span class="nf">run_default</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">master_sheet_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>    <span class="n">ctd_files_list</span> <span class="o">=</span> <span class="n">get_rsk_filenames_in_dir</span><span class="p">(</span><span class="n">_get_cwd</span><span class="p">())</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>    <span class="n">ctd_files_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_csv_filenames_in_dir</span><span class="p">(</span><span class="n">_get_cwd</span><span class="p">()))</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>    <span class="n">cached_master_sheet</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">master_sheet_path</span><span class="p">)</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ctd_files_list</span><span class="p">:</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No files to process.&quot;</span><span class="p">)</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>        <span class="k">return</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>    <span class="c1"># Process the first file</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>    <span class="n">first_file</span> <span class="o">=</span> <span class="n">ctd_files_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">process_ctd_file</span><span class="p">(</span><span class="n">first_file</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">cached_master_sheet</span><span class="o">=</span><span class="n">cached_master_sheet</span><span class="p">,</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>                          <span class="n">master_sheet_path</span><span class="o">=</span><span class="n">master_sheet_path</span><span class="p">)</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>    <span class="c1"># Process the rest of the files in parallel</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>    <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a>        <span class="n">futures</span> <span class="o">=</span> <span class="p">{</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">process_ctd_file</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">cached_master_sheet</span><span class="o">=</span><span class="n">cached_master_sheet</span><span class="p">,</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>                                   <span class="n">master_sheet_path</span><span class="o">=</span><span class="n">master_sheet_path</span><span class="p">):</span> <span class="n">file</span> <span class="k">for</span> <span class="n">file</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>                   <span class="ow">in</span> <span class="n">ctd_files_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]}</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>        <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">df</span><span class="p">,</span> <span class="n">result</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>    <span class="n">CTD</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">save_to_csv</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;outputclean.csv&quot;</span><span class="p">)</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a><span class="k">def</span> <span class="nf">merge_all_in_folder</span><span class="p">():</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>    <span class="n">ctd_files_list</span> <span class="o">=</span> <span class="n">get_rsk_filenames_in_dir</span><span class="p">(</span><span class="n">_get_cwd</span><span class="p">())</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>    <span class="n">ctd_files_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_csv_filenames_in_dir</span><span class="p">(</span><span class="n">_get_cwd</span><span class="p">()))</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>    <span class="n">error_out</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">ctd_files_list</span><span class="p">:</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>            <span class="n">my_data</span> <span class="o">=</span> <span class="n">CTD</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>            <span class="n">my_data</span><span class="o">.</span><span class="n">add_filename_to_table</span><span class="p">()</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>            <span class="n">my_data</span><span class="o">.</span><span class="n">add_location_to_table</span><span class="p">()</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>            <span class="n">my_data</span><span class="o">.</span><span class="n">remove_upcasts</span><span class="p">()</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>            <span class="n">my_data</span><span class="o">.</span><span class="n">remove_non_positive_samples</span><span class="p">()</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>            <span class="n">my_data</span><span class="o">.</span><span class="n">save_to_csv</span><span class="p">(</span><span class="s2">&quot;output.csv&quot;</span><span class="p">)</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>            <span class="k">continue</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a><span class="k">def</span> <span class="nf">get_rsk_filenames_in_dir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">):</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>    <span class="n">rsk_files_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>    <span class="n">rsk_filenames_no_path</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">):</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.rsk&#39;</span><span class="p">):</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>            <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">rsk_files_list</span><span class="p">:</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>                <span class="n">filename_no_path</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.rsk&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>                <span class="k">if</span> <span class="n">filename_no_path</span> <span class="ow">in</span> <span class="n">rsk_filenames_no_path</span><span class="p">:</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>                    <span class="k">continue</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>                <span class="n">rsk_filenames_no_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename_no_path</span><span class="p">)</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>            <span class="n">rsk_files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>    <span class="k">return</span> <span class="n">rsk_files_list</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a><span class="k">def</span> <span class="nf">get_csv_filenames_in_dir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">):</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>    <span class="n">csv_files_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>    <span class="n">rsk_filenames_no_path</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">):</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;output&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>            <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">csv_files_list</span><span class="p">:</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>                <span class="n">filename_no_path</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>                <span class="k">if</span> <span class="n">filename_no_path</span> <span class="ow">in</span> <span class="n">rsk_filenames_no_path</span><span class="p">:</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>                    <span class="k">continue</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>                <span class="n">rsk_filenames_no_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename_no_path</span><span class="p">)</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>            <span class="n">csv_files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>    <span class="k">return</span> <span class="n">csv_files_list</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a><span class="k">def</span> <span class="nf">_get_cwd</span><span class="p">():</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>    <span class="n">working_directory_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>    <span class="c1"># determine if application is a script file or frozen exe</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;frozen&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>        <span class="n">working_directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">)</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>    <span class="k">elif</span> <span class="vm">__file__</span><span class="p">:</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>        <span class="n">working_directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>        <span class="n">working_directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>    <span class="k">return</span> <span class="n">working_directory_path</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a><span class="k">def</span> <span class="nf">_get_filename</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>    <span class="k">return</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.rsk&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a><span class="k">def</span> <span class="nf">_reset_file_environment</span><span class="p">():</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>    <span class="n">output_file_csv</span> <span class="o">=</span> <span class="s2">&quot;output.csv&quot;</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>    <span class="n">output_file_csv_clean</span> <span class="o">=</span> <span class="s2">&quot;outputclean.csv&quot;</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>    <span class="n">cwd</span> <span class="o">=</span> <span class="n">_get_cwd</span><span class="p">()</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>    <span class="n">output_file_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="n">output_file_csv</span><span class="p">)</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>    <span class="n">output_file_csv_clean</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="n">output_file_csv_clean</span><span class="p">)</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>    <span class="k">if</span> <span class="n">cwd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>        <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Couldn&#39;t get working directory.&quot;</span><span class="p">)</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_file_csv</span><span class="p">):</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_file_csv</span><span class="p">)</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_file_csv_clean</span><span class="p">):</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_file_csv_clean</span><span class="p">)</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s2">&quot;./plots&quot;</span><span class="p">):</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;./plots&quot;</span><span class="p">)</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;CTD Fjorder Processing Script&quot;</span><span class="p">,</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawTextHelpFormatter</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>    <span class="p">)</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>    <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="s1">&#39;command&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>    <span class="c1"># Subparser for the &#39;merge&#39; command</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>    <span class="n">parser_merge</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;merge&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Merge all RSK files in the current folder&#39;</span><span class="p">)</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>    <span class="n">parser_merge</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;increase output verbosity&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>    <span class="c1"># Subparser for the &#39;default&#39; command</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>    <span class="n">parser_default</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Run the default processing pipeline&#39;</span><span class="p">)</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>    <span class="n">parser_default</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--plot&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>                                <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Generate plots during the default processing pipeline&#39;</span><span class="p">)</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>    <span class="n">parser_default</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Increase output verbosity&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>    <span class="n">parser_default</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="s2">&quot;--reset&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Resets file environment (DELETES FILES)&quot;</span><span class="p">,</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>                                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>    <span class="n">parser_default</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--output&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path to output file&#39;</span><span class="p">)</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>    <span class="n">parser_default</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;--mastersheet&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path to mastersheet&#39;</span><span class="p">)</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>    <span class="n">parser_default</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-w&#39;</span><span class="p">,</span> <span class="s1">&#39;--workers&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Sets max workers for parallel processing&#39;</span><span class="p">)</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;merge&#39;</span><span class="p">:</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>        <span class="n">merge_all_in_folder</span><span class="p">()</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Merging completed successfully.&quot;</span><span class="p">)</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">FATAL</span><span class="p">)</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">reset</span><span class="p">:</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>            <span class="n">_reset_file_environment</span><span class="p">()</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">mastersheet</span><span class="p">:</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>            <span class="n">run_default</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">workers</span><span class="p">)</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>            <span class="n">run_default</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="n">master_sheet_path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">mastersheet</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">workers</span><span class="p">)</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">plot</span><span class="p">:</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default processing with plotting completed successfully.&quot;</span><span class="p">)</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default processing completed successfully.&quot;</span><span class="p">)</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>    <span class="n">main</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="CTD">
                            <input id="CTD-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CTD</span>:

                <label class="view-source-button" for="CTD-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD-47"><a href="#CTD-47"><span class="linenos">  47</span></a><span class="k">class</span> <span class="nc">CTD</span><span class="p">:</span>
</span><span id="CTD-48"><a href="#CTD-48"><span class="linenos">  48</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-49"><a href="#CTD-49"><span class="linenos">  49</span></a><span class="sd">    CTD</span>
</span><span id="CTD-50"><a href="#CTD-50"><span class="linenos">  50</span></a><span class="sd">    ---</span>
</span><span id="CTD-51"><a href="#CTD-51"><span class="linenos">  51</span></a>
</span><span id="CTD-52"><a href="#CTD-52"><span class="linenos">  52</span></a><span class="sd">    Class representing a CTD object for processing and analyzing CTD data.</span>
</span><span id="CTD-53"><a href="#CTD-53"><span class="linenos">  53</span></a>
</span><span id="CTD-54"><a href="#CTD-54"><span class="linenos">  54</span></a><span class="sd">    Attributes</span>
</span><span id="CTD-55"><a href="#CTD-55"><span class="linenos">  55</span></a><span class="sd">    ----------</span>
</span><span id="CTD-56"><a href="#CTD-56"><span class="linenos">  56</span></a><span class="sd">    master_sheet_path : str</span>
</span><span id="CTD-57"><a href="#CTD-57"><span class="linenos">  57</span></a><span class="sd">        Path to the mastersheet.</span>
</span><span id="CTD-58"><a href="#CTD-58"><span class="linenos">  58</span></a>
</span><span id="CTD-59"><a href="#CTD-59"><span class="linenos">  59</span></a><span class="sd">    Usage</span>
</span><span id="CTD-60"><a href="#CTD-60"><span class="linenos">  60</span></a><span class="sd">    -----</span>
</span><span id="CTD-61"><a href="#CTD-61"><span class="linenos">  61</span></a><span class="sd">    To create a CTD object for custom pipelines use the following method:</span>
</span><span id="CTD-62"><a href="#CTD-62"><span class="linenos">  62</span></a>
</span><span id="CTD-63"><a href="#CTD-63"><span class="linenos">  63</span></a><span class="sd">    &gt;&gt;&gt; my_data = CTD(&quot;example.rsk&quot;)</span>
</span><span id="CTD-64"><a href="#CTD-64"><span class="linenos">  64</span></a>
</span><span id="CTD-65"><a href="#CTD-65"><span class="linenos">  65</span></a><span class="sd">    You can then run a CTD command on it like removing non-postive sample rows and then viewing your table</span>
</span><span id="CTD-66"><a href="#CTD-66"><span class="linenos">  66</span></a>
</span><span id="CTD-67"><a href="#CTD-67"><span class="linenos">  67</span></a><span class="sd">    &gt;&gt;&gt; my_data.remove_non_positive_samples()</span>
</span><span id="CTD-68"><a href="#CTD-68"><span class="linenos">  68</span></a><span class="sd">    &gt;&gt;&gt; my_data.view_table()</span>
</span><span id="CTD-69"><a href="#CTD-69"><span class="linenos">  69</span></a>
</span><span id="CTD-70"><a href="#CTD-70"><span class="linenos">  70</span></a><span class="sd">    Notes</span>
</span><span id="CTD-71"><a href="#CTD-71"><span class="linenos">  71</span></a><span class="sd">    -----</span>
</span><span id="CTD-72"><a href="#CTD-72"><span class="linenos">  72</span></a><span class="sd">    - Filenames must match a correct date, or else in instances where the mastersheet</span>
</span><span id="CTD-73"><a href="#CTD-73"><span class="linenos">  73</span></a><span class="sd">    must be consulted CTDFjorder will return an error.</span>
</span><span id="CTD-74"><a href="#CTD-74"><span class="linenos">  74</span></a>
</span><span id="CTD-75"><a href="#CTD-75"><span class="linenos">  75</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CTD-76"><a href="#CTD-76"><span class="linenos">  76</span></a>    <span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="CTD-77"><a href="#CTD-77"><span class="linenos">  77</span></a>    <span class="n">_rsk</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-78"><a href="#CTD-78"><span class="linenos">  78</span></a>    <span class="n">_filename</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-79"><a href="#CTD-79"><span class="linenos">  79</span></a>    <span class="n">_calculator</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-80"><a href="#CTD-80"><span class="linenos">  80</span></a>    <span class="n">_cwd</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-81"><a href="#CTD-81"><span class="linenos">  81</span></a>    <span class="n">_cached_master_sheet</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="CTD-82"><a href="#CTD-82"><span class="linenos">  82</span></a>    <span class="n">_original_profile</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-83"><a href="#CTD-83"><span class="linenos">  83</span></a>    <span class="n">master_sheet_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-84"><a href="#CTD-84"><span class="linenos">  84</span></a>    <span class="n">_NO_SAMPLES_ERROR</span> <span class="o">=</span> <span class="s2">&quot;No samples in file.&quot;</span>
</span><span id="CTD-85"><a href="#CTD-85"><span class="linenos">  85</span></a>    <span class="n">_NO_LOCATION_ERROR</span> <span class="o">=</span> <span class="s2">&quot;No location could be found.&quot;</span>
</span><span id="CTD-86"><a href="#CTD-86"><span class="linenos">  86</span></a>    <span class="n">_DENSITY_CALCULATION_ERROR</span> <span class="o">=</span> <span class="s2">&quot;Could not calculate density on this dataset.&quot;</span>
</span><span id="CTD-87"><a href="#CTD-87"><span class="linenos">  87</span></a>    <span class="n">_SALINITYABS_CALCULATION_ERROR</span> <span class="o">=</span> <span class="s2">&quot;Could not calculate salinity on this dataset.&quot;</span>
</span><span id="CTD-88"><a href="#CTD-88"><span class="linenos">  88</span></a>    <span class="n">_DATA_CLEANING_ERROR</span> <span class="o">=</span> <span class="s2">&quot;No data remains after data cleaning, reverting to previous CTD&quot;</span>
</span><span id="CTD-89"><a href="#CTD-89"><span class="linenos">  89</span></a>    <span class="n">_REMOVE_NEGATIVES_ERROR</span> <span class="o">=</span> <span class="s2">&quot;No data remains after removing non-positive samples.&quot;</span>
</span><span id="CTD-90"><a href="#CTD-90"><span class="linenos">  90</span></a>    <span class="n">_MLD_ERROR</span> <span class="o">=</span> <span class="s2">&quot;No data remains after calculating MLD.&quot;</span>
</span><span id="CTD-91"><a href="#CTD-91"><span class="linenos">  91</span></a>    <span class="n">_NO_MASTER_SHEET_ERROR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;No mastersheet provided. Cannot geolocate file, try using find_master_sheet_file &quot;</span> <span class="o">+</span>
</span><span id="CTD-92"><a href="#CTD-92"><span class="linenos">  92</span></a>                             <span class="s2">&quot;before this step.&quot;</span><span class="p">)</span>
</span><span id="CTD-93"><a href="#CTD-93"><span class="linenos">  93</span></a>    <span class="n">_rsk_file_flag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="CTD-94"><a href="#CTD-94"><span class="linenos">  94</span></a>
</span><span id="CTD-95"><a href="#CTD-95"><span class="linenos">  95</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctdfilepath</span><span class="p">,</span> <span class="n">cached_master_sheet</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="n">master_sheet_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="CTD-96"><a href="#CTD-96"><span class="linenos">  96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-97"><a href="#CTD-97"><span class="linenos">  97</span></a><span class="sd">        Initialize a new CTD object.</span>
</span><span id="CTD-98"><a href="#CTD-98"><span class="linenos">  98</span></a>
</span><span id="CTD-99"><a href="#CTD-99"><span class="linenos">  99</span></a><span class="sd">        Parameters</span>
</span><span id="CTD-100"><a href="#CTD-100"><span class="linenos"> 100</span></a><span class="sd">        ----------</span>
</span><span id="CTD-101"><a href="#CTD-101"><span class="linenos"> 101</span></a><span class="sd">        ctdfilepath : str</span>
</span><span id="CTD-102"><a href="#CTD-102"><span class="linenos"> 102</span></a><span class="sd">            The file path to the RSK or Castaway file.</span>
</span><span id="CTD-103"><a href="#CTD-103"><span class="linenos"> 103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-104"><a href="#CTD-104"><span class="linenos"> 104</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_master_sheet</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CTD-105"><a href="#CTD-105"><span class="linenos"> 105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span> <span class="o">=</span> <span class="n">cached_master_sheet</span>
</span><span id="CTD-106"><a href="#CTD-106"><span class="linenos"> 106</span></a>        <span class="k">if</span> <span class="s2">&quot;rsk&quot;</span> <span class="ow">in</span> <span class="n">ctdfilepath</span><span class="p">:</span>
</span><span id="CTD-107"><a href="#CTD-107"><span class="linenos"> 107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rsk_file_flag</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="CTD-108"><a href="#CTD-108"><span class="linenos"> 108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span> <span class="o">=</span> <span class="n">RSK</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">)</span>
</span><span id="CTD-109"><a href="#CTD-109"><span class="linenos"> 109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.rsk&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="CTD-110"><a href="#CTD-110"><span class="linenos"> 110</span></a>            <span class="n">num_profiles</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">profiles</span><span class="p">())</span>
</span><span id="CTD-111"><a href="#CTD-111"><span class="linenos"> 111</span></a>            <span class="n">rsk_downcast_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">casts</span><span class="p">(</span><span class="n">Region</span><span class="o">.</span><span class="n">CAST_DOWN</span><span class="p">)</span>
</span><span id="CTD-112"><a href="#CTD-112"><span class="linenos"> 112</span></a>            <span class="k">if</span> <span class="n">num_profiles</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD-113"><a href="#CTD-113"><span class="linenos"> 113</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">npsamples</span><span class="p">())</span>
</span><span id="CTD-114"><a href="#CTD-114"><span class="linenos"> 114</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-115"><a href="#CTD-115"><span class="linenos"> 115</span></a>                <span class="n">region</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rsk_downcast_times</span><span class="p">)</span>
</span><span id="CTD-116"><a href="#CTD-116"><span class="linenos"> 116</span></a>                <span class="n">start_time</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">start_time</span>
</span><span id="CTD-117"><a href="#CTD-117"><span class="linenos"> 117</span></a>                <span class="n">end_time</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">end_time</span>
</span><span id="CTD-118"><a href="#CTD-118"><span class="linenos"> 118</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="CTD-119"><a href="#CTD-119"><span class="linenos"> 119</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">npsamples</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">))</span>
</span><span id="CTD-120"><a href="#CTD-120"><span class="linenos"> 120</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="CTD-121"><a href="#CTD-121"><span class="linenos"> 121</span></a>                    <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s2">&quot;No downcasts in file.&quot;</span><span class="p">)</span>
</span><span id="CTD-122"><a href="#CTD-122"><span class="linenos"> 122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-123"><a href="#CTD-123"><span class="linenos"> 123</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_original_profile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-124"><a href="#CTD-124"><span class="linenos"> 124</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-125"><a href="#CTD-125"><span class="linenos"> 125</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rsk_file_flag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="CTD-126"><a href="#CTD-126"><span class="linenos"> 126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="CTD-127"><a href="#CTD-127"><span class="linenos"> 127</span></a>            <span class="n">utc_cast_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">extract_utc_cast_time</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">=</span><span class="n">ctdfilepath</span><span class="p">)</span>
</span><span id="CTD-128"><a href="#CTD-128"><span class="linenos"> 128</span></a>            <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">extract_lat_long_castaway</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">=</span><span class="n">ctdfilepath</span><span class="p">)</span>
</span><span id="CTD-129"><a href="#CTD-129"><span class="linenos"> 129</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CTD-130"><a href="#CTD-130"><span class="linenos"> 130</span></a>                <span class="n">latitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>
</span><span id="CTD-131"><a href="#CTD-131"><span class="linenos"> 131</span></a>                <span class="n">longitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span>
</span><span id="CTD-132"><a href="#CTD-132"><span class="linenos"> 132</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="CTD-133"><a href="#CTD-133"><span class="linenos"> 133</span></a>                <span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-134"><a href="#CTD-134"><span class="linenos"> 134</span></a>                <span class="n">longitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-135"><a href="#CTD-135"><span class="linenos"> 135</span></a>            <span class="c1"># Convert UTC cast time to datetime and create timestamp column</span>
</span><span id="CTD-136"><a href="#CTD-136"><span class="linenos"> 136</span></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">utc_cast_time</span><span class="p">)</span>
</span><span id="CTD-137"><a href="#CTD-137"><span class="linenos"> 137</span></a>            <span class="c1"># Calculate the time increments for each row</span>
</span><span id="CTD-138"><a href="#CTD-138"><span class="linenos"> 138</span></a>            <span class="n">pd_csv_castaway</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
</span><span id="CTD-139"><a href="#CTD-139"><span class="linenos"> 139</span></a>            <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pd_csv_castaway</span><span class="p">))]</span>
</span><span id="CTD-140"><a href="#CTD-140"><span class="linenos"> 140</span></a>            <span class="n">header_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CTD-141"><a href="#CTD-141"><span class="linenos"> 141</span></a>                <span class="s2">&quot;Pressure (Decibar)&quot;</span><span class="p">:</span> <span class="s2">&quot;seapressure_00&quot;</span><span class="p">,</span>
</span><span id="CTD-142"><a href="#CTD-142"><span class="linenos"> 142</span></a>                <span class="s2">&quot;Depth (Meter)&quot;</span><span class="p">:</span> <span class="s2">&quot;depth_00&quot;</span><span class="p">,</span>
</span><span id="CTD-143"><a href="#CTD-143"><span class="linenos"> 143</span></a>                <span class="s2">&quot;Temperature (Celsius)&quot;</span><span class="p">:</span> <span class="s2">&quot;temperature_00&quot;</span><span class="p">,</span>
</span><span id="CTD-144"><a href="#CTD-144"><span class="linenos"> 144</span></a>                <span class="s2">&quot;Conductivity (MicroSiemens per Centimeter)&quot;</span><span class="p">:</span> <span class="s2">&quot;conductivity_00&quot;</span><span class="p">,</span>
</span><span id="CTD-145"><a href="#CTD-145"><span class="linenos"> 145</span></a>                <span class="s2">&quot;Specific conductance (MicroSiemens per Centimeter)&quot;</span><span class="p">:</span> <span class="s2">&quot;specificconductivity_00&quot;</span><span class="p">,</span>
</span><span id="CTD-146"><a href="#CTD-146"><span class="linenos"> 146</span></a>                <span class="s2">&quot;Salinity (Practical Salinity Scale)&quot;</span><span class="p">:</span> <span class="s2">&quot;salinity_00&quot;</span><span class="p">,</span>
</span><span id="CTD-147"><a href="#CTD-147"><span class="linenos"> 147</span></a>                <span class="s2">&quot;Sound velocity (Meters per Second)&quot;</span><span class="p">:</span> <span class="s2">&quot;speedofsound_00&quot;</span><span class="p">,</span>
</span><span id="CTD-148"><a href="#CTD-148"><span class="linenos"> 148</span></a>                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
</span><span id="CTD-149"><a href="#CTD-149"><span class="linenos"> 149</span></a>                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span>
</span><span id="CTD-150"><a href="#CTD-150"><span class="linenos"> 150</span></a>            <span class="p">}</span>
</span><span id="CTD-151"><a href="#CTD-151"><span class="linenos"> 151</span></a>            <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">header_mapping</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-152"><a href="#CTD-152"><span class="linenos"> 152</span></a>            <span class="c1"># Insert the timestamp column as the first column</span>
</span><span id="CTD-153"><a href="#CTD-153"><span class="linenos"> 153</span></a>            <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;seapressure_00&#39;</span><span class="p">]</span>
</span><span id="CTD-154"><a href="#CTD-154"><span class="linenos"> 154</span></a>            <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">10</span>
</span><span id="CTD-155"><a href="#CTD-155"><span class="linenos"> 155</span></a>            <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;conductivity_00&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">1000</span>
</span><span id="CTD-156"><a href="#CTD-156"><span class="linenos"> 156</span></a>            <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">)</span>
</span><span id="CTD-157"><a href="#CTD-157"><span class="linenos"> 157</span></a>            <span class="n">pd_csv_castaway</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">)</span>
</span><span id="CTD-158"><a href="#CTD-158"><span class="linenos"> 158</span></a>            <span class="n">pd_csv_castaway</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span><span class="p">)</span>
</span><span id="CTD-159"><a href="#CTD-159"><span class="linenos"> 159</span></a>            <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Density (Kilograms per Cubic Meter)&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-160"><a href="#CTD-160"><span class="linenos"> 160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span>
</span><span id="CTD-161"><a href="#CTD-161"><span class="linenos"> 161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_original_profile</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-162"><a href="#CTD-162"><span class="linenos"> 162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="CTD-163"><a href="#CTD-163"><span class="linenos"> 163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span> <span class="o">=</span> <span class="n">_get_cwd</span><span class="p">()</span>
</span><span id="CTD-164"><a href="#CTD-164"><span class="linenos"> 164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span> <span class="o">=</span> <span class="n">master_sheet_path</span>
</span><span id="CTD-165"><a href="#CTD-165"><span class="linenos"> 165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span><span class="o">=</span><span class="n">cached_master_sheet</span>
</span><span id="CTD-166"><a href="#CTD-166"><span class="linenos"> 166</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;New CTD Object Created from : &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="CTD-167"><a href="#CTD-167"><span class="linenos"> 167</span></a>
</span><span id="CTD-168"><a href="#CTD-168"><span class="linenos"> 168</span></a>    <span class="k">def</span> <span class="nf">find_master_sheet_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-169"><a href="#CTD-169"><span class="linenos"> 169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-170"><a href="#CTD-170"><span class="linenos"> 170</span></a><span class="sd">        Function to find and the master sheet path. Uses the first xlsx file in the current working directory.</span>
</span><span id="CTD-171"><a href="#CTD-171"><span class="linenos"> 171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-172"><a href="#CTD-172"><span class="linenos"> 172</span></a>        <span class="n">cwd</span> <span class="o">=</span> <span class="n">_get_cwd</span><span class="p">()</span>
</span><span id="CTD-173"><a href="#CTD-173"><span class="linenos"> 173</span></a>        <span class="n">xlsx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xlsx&quot;</span><span class="p">)]</span>
</span><span id="CTD-174"><a href="#CTD-174"><span class="linenos"> 174</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlsx_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CTD-175"><a href="#CTD-175"><span class="linenos"> 175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">xlsx_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="CTD-176"><a href="#CTD-176"><span class="linenos"> 176</span></a>
</span><span id="CTD-177"><a href="#CTD-177"><span class="linenos"> 177</span></a>    <span class="k">def</span> <span class="nf">view_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-178"><a href="#CTD-178"><span class="linenos"> 178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-179"><a href="#CTD-179"><span class="linenos"> 179</span></a><span class="sd">        Print the CTD data table.</span>
</span><span id="CTD-180"><a href="#CTD-180"><span class="linenos"> 180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-181"><a href="#CTD-181"><span class="linenos"> 181</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;psql&#39;</span><span class="p">))</span>
</span><span id="CTD-182"><a href="#CTD-182"><span class="linenos"> 182</span></a>
</span><span id="CTD-183"><a href="#CTD-183"><span class="linenos"> 183</span></a>    <span class="k">def</span> <span class="nf">get_pandas_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="CTD-184"><a href="#CTD-184"><span class="linenos"> 184</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-185"><a href="#CTD-185"><span class="linenos"> 185</span></a><span class="sd">        Exposes the dataframe of the CTD object for custom processes.</span>
</span><span id="CTD-186"><a href="#CTD-186"><span class="linenos"> 186</span></a>
</span><span id="CTD-187"><a href="#CTD-187"><span class="linenos"> 187</span></a><span class="sd">        Parameters</span>
</span><span id="CTD-188"><a href="#CTD-188"><span class="linenos"> 188</span></a><span class="sd">        ----------</span>
</span><span id="CTD-189"><a href="#CTD-189"><span class="linenos"> 189</span></a><span class="sd">        copy : bool, optional</span>
</span><span id="CTD-190"><a href="#CTD-190"><span class="linenos"> 190</span></a><span class="sd">            If True returns a copy, if False returns the actual DataFrame internal to the CTD object. Defaults to True.</span>
</span><span id="CTD-191"><a href="#CTD-191"><span class="linenos"> 191</span></a>
</span><span id="CTD-192"><a href="#CTD-192"><span class="linenos"> 192</span></a><span class="sd">        Returns</span>
</span><span id="CTD-193"><a href="#CTD-193"><span class="linenos"> 193</span></a><span class="sd">        -------</span>
</span><span id="CTD-194"><a href="#CTD-194"><span class="linenos"> 194</span></a><span class="sd">        DataFrame</span>
</span><span id="CTD-195"><a href="#CTD-195"><span class="linenos"> 195</span></a><span class="sd">            The pandas df of the CTD object.</span>
</span><span id="CTD-196"><a href="#CTD-196"><span class="linenos"> 196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-197"><a href="#CTD-197"><span class="linenos"> 197</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">copy</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span>
</span><span id="CTD-198"><a href="#CTD-198"><span class="linenos"> 198</span></a>
</span><span id="CTD-199"><a href="#CTD-199"><span class="linenos"> 199</span></a>    <span class="k">def</span> <span class="nf">add_filename_to_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-200"><a href="#CTD-200"><span class="linenos"> 200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-201"><a href="#CTD-201"><span class="linenos"> 201</span></a><span class="sd">        Add the filename to the CTD data table.</span>
</span><span id="CTD-202"><a href="#CTD-202"><span class="linenos"> 202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-203"><a href="#CTD-203"><span class="linenos"> 203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="CTD-204"><a href="#CTD-204"><span class="linenos"> 204</span></a>
</span><span id="CTD-205"><a href="#CTD-205"><span class="linenos"> 205</span></a>    <span class="k">def</span> <span class="nf">remove_timezone_indicator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-206"><a href="#CTD-206"><span class="linenos"> 206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-207"><a href="#CTD-207"><span class="linenos"> 207</span></a><span class="sd">        Removes the timezone indicator in the CTD data table &#39;timestamp&#39; column.</span>
</span><span id="CTD-208"><a href="#CTD-208"><span class="linenos"> 208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-209"><a href="#CTD-209"><span class="linenos"> 209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_sample_timezone_indicator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-210"><a href="#CTD-210"><span class="linenos"> 210</span></a>
</span><span id="CTD-211"><a href="#CTD-211"><span class="linenos"> 211</span></a>    <span class="k">def</span> <span class="nf">add_location_to_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-212"><a href="#CTD-212"><span class="linenos"> 212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-213"><a href="#CTD-213"><span class="linenos"> 213</span></a><span class="sd">        Retrieves the sample location data from the RSK file and adds it to the CTD data table.</span>
</span><span id="CTD-214"><a href="#CTD-214"><span class="linenos"> 214</span></a><span class="sd">        If no location data is found, it attempts to estimate the location using the master sheet.</span>
</span><span id="CTD-215"><a href="#CTD-215"><span class="linenos"> 215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-216"><a href="#CTD-216"><span class="linenos"> 216</span></a>        <span class="c1"># Check if file is castaway</span>
</span><span id="CTD-217"><a href="#CTD-217"><span class="linenos"> 217</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-218"><a href="#CTD-218"><span class="linenos"> 218</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-219"><a href="#CTD-219"><span class="linenos"> 219</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsk_file_flag</span><span class="p">:</span>
</span><span id="CTD-220"><a href="#CTD-220"><span class="linenos"> 220</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="CTD-221"><a href="#CTD-221"><span class="linenos"> 221</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CTD-222"><a href="#CTD-222"><span class="linenos"> 222</span></a>                    <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_MASTER_SHEET_ERROR</span><span class="p">)</span>
</span><span id="CTD-223"><a href="#CTD-223"><span class="linenos"> 223</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-224"><a href="#CTD-224"><span class="linenos"> 224</span></a>                    <span class="n">location_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_master_sheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="CTD-225"><a href="#CTD-225"><span class="linenos"> 225</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-226"><a href="#CTD-226"><span class="linenos"> 226</span></a>                <span class="k">return</span>
</span><span id="CTD-227"><a href="#CTD-227"><span class="linenos"> 227</span></a>        <span class="c1"># Process RSK file</span>
</span><span id="CTD-228"><a href="#CTD-228"><span class="linenos"> 228</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-229"><a href="#CTD-229"><span class="linenos"> 229</span></a>            <span class="n">location_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sample_location</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="CTD-230"><a href="#CTD-230"><span class="linenos"> 230</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CTD-231"><a href="#CTD-231"><span class="linenos"> 231</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">location_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="CTD-232"><a href="#CTD-232"><span class="linenos"> 232</span></a>                                                     <span class="n">longitude</span><span class="o">=</span><span class="n">location_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="CTD-233"><a href="#CTD-233"><span class="linenos"> 233</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="CTD-234"><a href="#CTD-234"><span class="linenos"> 234</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-235"><a href="#CTD-235"><span class="linenos"> 235</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-236"><a href="#CTD-236"><span class="linenos"> 236</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-237"><a href="#CTD-237"><span class="linenos"> 237</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_LOCATION_ERROR</span><span class="p">)</span>
</span><span id="CTD-238"><a href="#CTD-238"><span class="linenos"> 238</span></a>
</span><span id="CTD-239"><a href="#CTD-239"><span class="linenos"> 239</span></a>    <span class="k">def</span> <span class="nf">remove_upcasts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-240"><a href="#CTD-240"><span class="linenos"> 240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-241"><a href="#CTD-241"><span class="linenos"> 241</span></a><span class="sd">        Removes upcasts based on the rate of change of pressure over time.</span>
</span><span id="CTD-242"><a href="#CTD-242"><span class="linenos"> 242</span></a><span class="sd">        This function calculates the vertical speed of the system through the water</span>
</span><span id="CTD-243"><a href="#CTD-243"><span class="linenos"> 243</span></a><span class="sd">        using the derivative of pressure with respect to time. It filters out data</span>
</span><span id="CTD-244"><a href="#CTD-244"><span class="linenos"> 244</span></a><span class="sd">        collected in the air or while stationary at the surface or bottom, and</span>
</span><span id="CTD-245"><a href="#CTD-245"><span class="linenos"> 245</span></a><span class="sd">        separates the downcasts from upcasts.</span>
</span><span id="CTD-246"><a href="#CTD-246"><span class="linenos"> 246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-247"><a href="#CTD-247"><span class="linenos"> 247</span></a>        <span class="c1"># Ensure &#39;timestamp&#39; is a datetime object for correct differentiation</span>
</span><span id="CTD-248"><a href="#CTD-248"><span class="linenos"> 248</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_datetime64_any_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]):</span>
</span><span id="CTD-249"><a href="#CTD-249"><span class="linenos"> 249</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="CTD-250"><a href="#CTD-250"><span class="linenos"> 250</span></a>
</span><span id="CTD-251"><a href="#CTD-251"><span class="linenos"> 251</span></a>        <span class="c1"># Calculate the time differences in seconds</span>
</span><span id="CTD-252"><a href="#CTD-252"><span class="linenos"> 252</span></a>        <span class="n">time_diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="CTD-253"><a href="#CTD-253"><span class="linenos"> 253</span></a>
</span><span id="CTD-254"><a href="#CTD-254"><span class="linenos"> 254</span></a>        <span class="c1"># Calculate the rate of change of pressure over time (dP/dt)</span>
</span><span id="CTD-255"><a href="#CTD-255"><span class="linenos"> 255</span></a>        <span class="n">pressure_diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</span><span id="CTD-256"><a href="#CTD-256"><span class="linenos"> 256</span></a>        <span class="n">vertical_speed</span> <span class="o">=</span> <span class="n">pressure_diffs</span> <span class="o">/</span> <span class="n">time_diffs</span>
</span><span id="CTD-257"><a href="#CTD-257"><span class="linenos"> 257</span></a>
</span><span id="CTD-258"><a href="#CTD-258"><span class="linenos"> 258</span></a>        <span class="c1"># Add vertical speed to the DataFrame</span>
</span><span id="CTD-259"><a href="#CTD-259"><span class="linenos"> 259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertical_speed</span>
</span><span id="CTD-260"><a href="#CTD-260"><span class="linenos"> 260</span></a>
</span><span id="CTD-261"><a href="#CTD-261"><span class="linenos"> 261</span></a>        <span class="c1"># Filter out data where the rate of change of pressure indicates upcasting or stationary periods</span>
</span><span id="CTD-262"><a href="#CTD-262"><span class="linenos"> 262</span></a>        <span class="c1"># Assuming positive vertical speed indicates downcasting (i.e., increasing pressure)</span>
</span><span id="CTD-263"><a href="#CTD-263"><span class="linenos"> 263</span></a>        <span class="c1"># You might need to adjust this logic based on the actual data characteristics</span>
</span><span id="CTD-264"><a href="#CTD-264"><span class="linenos"> 264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span>
</span><span id="CTD-265"><a href="#CTD-265"><span class="linenos"> 265</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())]</span>
</span><span id="CTD-266"><a href="#CTD-266"><span class="linenos"> 266</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CTD-267"><a href="#CTD-267"><span class="linenos"> 267</span></a>
</span><span id="CTD-268"><a href="#CTD-268"><span class="linenos"> 268</span></a>    <span class="k">def</span> <span class="nf">remove_non_positive_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-269"><a href="#CTD-269"><span class="linenos"> 269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-270"><a href="#CTD-270"><span class="linenos"> 270</span></a><span class="sd">        Iterates through the columns of the CTD data table and removes rows with non-positive values</span>
</span><span id="CTD-271"><a href="#CTD-271"><span class="linenos"> 271</span></a><span class="sd">        for depth, pressure, salinity, absolute salinity, or density.</span>
</span><span id="CTD-272"><a href="#CTD-272"><span class="linenos"> 272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-273"><a href="#CTD-273"><span class="linenos"> 273</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-274"><a href="#CTD-274"><span class="linenos"> 274</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-275"><a href="#CTD-275"><span class="linenos"> 275</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-276"><a href="#CTD-276"><span class="linenos"> 276</span></a>            <span class="k">match</span> <span class="n">column</span><span class="p">:</span>
</span><span id="CTD-277"><a href="#CTD-277"><span class="linenos"> 277</span></a>                <span class="k">case</span> <span class="s1">&#39;depth_00&#39;</span><span class="p">:</span>
</span><span id="CTD-278"><a href="#CTD-278"><span class="linenos"> 278</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_depth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-279"><a href="#CTD-279"><span class="linenos"> 279</span></a>                <span class="k">case</span> <span class="s1">&#39;pressure_00&#39;</span><span class="p">:</span>
</span><span id="CTD-280"><a href="#CTD-280"><span class="linenos"> 280</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_pressure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-281"><a href="#CTD-281"><span class="linenos"> 281</span></a>                <span class="k">case</span> <span class="s1">&#39;salinity_00&#39;</span><span class="p">:</span>
</span><span id="CTD-282"><a href="#CTD-282"><span class="linenos"> 282</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_salinity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-283"><a href="#CTD-283"><span class="linenos"> 283</span></a>                <span class="k">case</span> <span class="s1">&#39;salinityabs&#39;</span><span class="p">:</span>
</span><span id="CTD-284"><a href="#CTD-284"><span class="linenos"> 284</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_salinityabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-285"><a href="#CTD-285"><span class="linenos"> 285</span></a>                <span class="k">case</span> <span class="s1">&#39;density&#39;</span><span class="p">:</span>
</span><span id="CTD-286"><a href="#CTD-286"><span class="linenos"> 286</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_density</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-287"><a href="#CTD-287"><span class="linenos"> 287</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-288"><a href="#CTD-288"><span class="linenos"> 288</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_REMOVE_NEGATIVES_ERROR</span><span class="p">)</span>
</span><span id="CTD-289"><a href="#CTD-289"><span class="linenos"> 289</span></a>
</span><span id="CTD-290"><a href="#CTD-290"><span class="linenos"> 290</span></a>    <span class="k">def</span> <span class="nf">remove_invalid_salinity_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-291"><a href="#CTD-291"><span class="linenos"> 291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-292"><a href="#CTD-292"><span class="linenos"> 292</span></a><span class="sd">        Removes rows with invalid values (&lt;10) for practical salinity.</span>
</span><span id="CTD-293"><a href="#CTD-293"><span class="linenos"> 293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-294"><a href="#CTD-294"><span class="linenos"> 294</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-295"><a href="#CTD-295"><span class="linenos"> 295</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-296"><a href="#CTD-296"><span class="linenos"> 296</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-297"><a href="#CTD-297"><span class="linenos"> 297</span></a>            <span class="k">match</span> <span class="n">column</span><span class="p">:</span>
</span><span id="CTD-298"><a href="#CTD-298"><span class="linenos"> 298</span></a>                <span class="k">case</span> <span class="s1">&#39;salinity_00&#39;</span><span class="p">:</span>
</span><span id="CTD-299"><a href="#CTD-299"><span class="linenos"> 299</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_invalid_salinity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-300"><a href="#CTD-300"><span class="linenos"> 300</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-301"><a href="#CTD-301"><span class="linenos"> 301</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_REMOVE_NEGATIVES_ERROR</span><span class="p">)</span>
</span><span id="CTD-302"><a href="#CTD-302"><span class="linenos"> 302</span></a>
</span><span id="CTD-303"><a href="#CTD-303"><span class="linenos"> 303</span></a>    <span class="k">def</span> <span class="nf">bin_average_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="CTD-304"><a href="#CTD-304"><span class="linenos"> 304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-305"><a href="#CTD-305"><span class="linenos"> 305</span></a><span class="sd">        Bins by pressure and averages numeric columns.</span>
</span><span id="CTD-306"><a href="#CTD-306"><span class="linenos"> 306</span></a>
</span><span id="CTD-307"><a href="#CTD-307"><span class="linenos"> 307</span></a><span class="sd">        Parameters</span>
</span><span id="CTD-308"><a href="#CTD-308"><span class="linenos"> 308</span></a><span class="sd">        ----------</span>
</span><span id="CTD-309"><a href="#CTD-309"><span class="linenos"> 309</span></a><span class="sd">        bin_size: float</span>
</span><span id="CTD-310"><a href="#CTD-310"><span class="linenos"> 310</span></a><span class="sd">            Size of pressure bins, defaults to 0.5.</span>
</span><span id="CTD-311"><a href="#CTD-311"><span class="linenos"> 311</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-312"><a href="#CTD-312"><span class="linenos"> 312</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-313"><a href="#CTD-313"><span class="linenos"> 313</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-314"><a href="#CTD-314"><span class="linenos"> 314</span></a>        <span class="c1"># Check if &#39;Pressure_Bin&#39; already exists and drop it if it does</span>
</span><span id="CTD-315"><a href="#CTD-315"><span class="linenos"> 315</span></a>        <span class="k">if</span> <span class="s1">&#39;Pressure_Bin&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-316"><a href="#CTD-316"><span class="linenos"> 316</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-317"><a href="#CTD-317"><span class="linenos"> 317</span></a>
</span><span id="CTD-318"><a href="#CTD-318"><span class="linenos"> 318</span></a>        <span class="c1"># Binning data using the specified bin size</span>
</span><span id="CTD-319"><a href="#CTD-319"><span class="linenos"> 319</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="n">bin_size</span><span class="p">)</span> <span class="o">*</span> <span class="n">bin_size</span>
</span><span id="CTD-320"><a href="#CTD-320"><span class="linenos"> 320</span></a>
</span><span id="CTD-321"><a href="#CTD-321"><span class="linenos"> 321</span></a>        <span class="c1"># Identifying numeric and non-numeric columns</span>
</span><span id="CTD-322"><a href="#CTD-322"><span class="linenos"> 322</span></a>        <span class="n">numeric_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="CTD-323"><a href="#CTD-323"><span class="linenos"> 323</span></a>        <span class="n">numeric_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">)</span>  <span class="c1"># Remove the original pressure column if it&#39;s still in the list</span>
</span><span id="CTD-324"><a href="#CTD-324"><span class="linenos"> 324</span></a>        <span class="n">non_numeric_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
</span><span id="CTD-325"><a href="#CTD-325"><span class="linenos"> 325</span></a>                            <span class="s1">&#39;longitude&#39;</span><span class="p">]</span>  <span class="c1"># specify any non-numeric column you expect to handle specially</span>
</span><span id="CTD-326"><a href="#CTD-326"><span class="linenos"> 326</span></a>        <span class="c1"># Creating aggregation dictionary</span>
</span><span id="CTD-327"><a href="#CTD-327"><span class="linenos"> 327</span></a>        <span class="n">agg_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">}</span>
</span><span id="CTD-328"><a href="#CTD-328"><span class="linenos"> 328</span></a>        <span class="n">agg_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">non_numeric_cols</span><span class="p">})</span>
</span><span id="CTD-329"><a href="#CTD-329"><span class="linenos"> 329</span></a>        <span class="c1"># Aggregating data by the new pressure bins</span>
</span><span id="CTD-330"><a href="#CTD-330"><span class="linenos"> 330</span></a>        <span class="n">data_binned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-331"><a href="#CTD-331"><span class="linenos"> 331</span></a>
</span><span id="CTD-332"><a href="#CTD-332"><span class="linenos"> 332</span></a>        <span class="c1"># Cleaning up DataFrame, resetting the index and column names</span>
</span><span id="CTD-333"><a href="#CTD-333"><span class="linenos"> 333</span></a>        <span class="n">data_binned</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">:</span> <span class="s1">&#39;pressure_00&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-334"><a href="#CTD-334"><span class="linenos"> 334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-335"><a href="#CTD-335"><span class="linenos"> 335</span></a>
</span><span id="CTD-336"><a href="#CTD-336"><span class="linenos"> 336</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-337"><a href="#CTD-337"><span class="linenos"> 337</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-338"><a href="#CTD-338"><span class="linenos"> 338</span></a>
</span><span id="CTD-339"><a href="#CTD-339"><span class="linenos"> 339</span></a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;autoencoder&#39;</span><span class="p">):</span>
</span><span id="CTD-340"><a href="#CTD-340"><span class="linenos"> 340</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-341"><a href="#CTD-341"><span class="linenos"> 341</span></a><span class="sd">        Applies data cleaning methods to the specified feature using the selected method.</span>
</span><span id="CTD-342"><a href="#CTD-342"><span class="linenos"> 342</span></a><span class="sd">        Currently supports cleaning practical salinity using &#39;salinitydiff&#39; or &#39;autoencoder&#39; methods.</span>
</span><span id="CTD-343"><a href="#CTD-343"><span class="linenos"> 343</span></a>
</span><span id="CTD-344"><a href="#CTD-344"><span class="linenos"> 344</span></a><span class="sd">        Parameters</span>
</span><span id="CTD-345"><a href="#CTD-345"><span class="linenos"> 345</span></a><span class="sd">        ----------</span>
</span><span id="CTD-346"><a href="#CTD-346"><span class="linenos"> 346</span></a><span class="sd">        feature : str</span>
</span><span id="CTD-347"><a href="#CTD-347"><span class="linenos"> 347</span></a><span class="sd">            The feature to clean (e.g., &#39;practicalsalinity&#39;).</span>
</span><span id="CTD-348"><a href="#CTD-348"><span class="linenos"> 348</span></a><span class="sd">            Options are &#39;practicalsalinity&#39;.</span>
</span><span id="CTD-349"><a href="#CTD-349"><span class="linenos"> 349</span></a><span class="sd">        method : str, optional</span>
</span><span id="CTD-350"><a href="#CTD-350"><span class="linenos"> 350</span></a><span class="sd">            The cleaning method to apply, defaults to &#39;autoencoder&#39;.</span>
</span><span id="CTD-351"><a href="#CTD-351"><span class="linenos"> 351</span></a><span class="sd">            Options are &#39;salinitydiff&#39;, &#39;autoencoder&#39;.</span>
</span><span id="CTD-352"><a href="#CTD-352"><span class="linenos"> 352</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-353"><a href="#CTD-353"><span class="linenos"> 353</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-354"><a href="#CTD-354"><span class="linenos"> 354</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-355"><a href="#CTD-355"><span class="linenos"> 355</span></a>        <span class="n">supported_features</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CTD-356"><a href="#CTD-356"><span class="linenos"> 356</span></a>            <span class="s2">&quot;practicalsalinity&quot;</span><span class="p">:</span> <span class="s2">&quot;salinity_00&quot;</span>
</span><span id="CTD-357"><a href="#CTD-357"><span class="linenos"> 357</span></a>        <span class="p">}</span>
</span><span id="CTD-358"><a href="#CTD-358"><span class="linenos"> 358</span></a>        <span class="n">supported_methods</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CTD-359"><a href="#CTD-359"><span class="linenos"> 359</span></a>            <span class="s2">&quot;salinitydiff&quot;</span><span class="p">:</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_and_drop_salinity_spikes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">),</span>
</span><span id="CTD-360"><a href="#CTD-360"><span class="linenos"> 360</span></a>            <span class="s2">&quot;autoencoder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_salinity_autoencoder</span><span class="p">()</span>
</span><span id="CTD-361"><a href="#CTD-361"><span class="linenos"> 361</span></a>        <span class="p">}</span>
</span><span id="CTD-362"><a href="#CTD-362"><span class="linenos"> 362</span></a>        <span class="k">if</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">supported_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CTD-363"><a href="#CTD-363"><span class="linenos"> 363</span></a>            <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">supported_methods</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CTD-364"><a href="#CTD-364"><span class="linenos"> 364</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">supported_methods</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
</span><span id="CTD-365"><a href="#CTD-365"><span class="linenos"> 365</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-366"><a href="#CTD-366"><span class="linenos"> 366</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;clean: Invalid method </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> not in </span><span class="si">{</span><span class="n">supported_methods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-367"><a href="#CTD-367"><span class="linenos"> 367</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-368"><a href="#CTD-368"><span class="linenos"> 368</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;clean: Invalid feature </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> not in </span><span class="si">{</span><span class="n">supported_features</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-369"><a href="#CTD-369"><span class="linenos"> 369</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-370"><a href="#CTD-370"><span class="linenos"> 370</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DATA_CLEANING_ERROR</span><span class="p">)</span>
</span><span id="CTD-371"><a href="#CTD-371"><span class="linenos"> 371</span></a>
</span><span id="CTD-372"><a href="#CTD-372"><span class="linenos"> 372</span></a>    <span class="k">def</span> <span class="nf">add_absolute_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-373"><a href="#CTD-373"><span class="linenos"> 373</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-374"><a href="#CTD-374"><span class="linenos"> 374</span></a><span class="sd">        Calculates the absolute salinity using the TEOS-10 equations and adds it as a new column</span>
</span><span id="CTD-375"><a href="#CTD-375"><span class="linenos"> 375</span></a><span class="sd">        to the CTD data table. Removes rows with negative absolute salinity values.</span>
</span><span id="CTD-376"><a href="#CTD-376"><span class="linenos"> 376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-377"><a href="#CTD-377"><span class="linenos"> 377</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-378"><a href="#CTD-378"><span class="linenos"> 378</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-379"><a href="#CTD-379"><span class="linenos"> 379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;salinityabs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_absolute_salinity</span><span class="p">(</span>
</span><span id="CTD-380"><a href="#CTD-380"><span class="linenos"> 380</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-381"><a href="#CTD-381"><span class="linenos"> 381</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_salinityabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-382"><a href="#CTD-382"><span class="linenos"> 382</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-383"><a href="#CTD-383"><span class="linenos"> 383</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SALINITYABS_CALCULATION_ERROR</span><span class="p">)</span>
</span><span id="CTD-384"><a href="#CTD-384"><span class="linenos"> 384</span></a>
</span><span id="CTD-385"><a href="#CTD-385"><span class="linenos"> 385</span></a>    <span class="k">def</span> <span class="nf">add_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-386"><a href="#CTD-386"><span class="linenos"> 386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-387"><a href="#CTD-387"><span class="linenos"> 387</span></a><span class="sd">        Calculates the density using the TEOS-10 equations and adds it as a new column to the CTD</span>
</span><span id="CTD-388"><a href="#CTD-388"><span class="linenos"> 388</span></a><span class="sd">        data table. If absolute salinity is not present, it is calculated first.</span>
</span><span id="CTD-389"><a href="#CTD-389"><span class="linenos"> 389</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-390"><a href="#CTD-390"><span class="linenos"> 390</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-391"><a href="#CTD-391"><span class="linenos"> 391</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-392"><a href="#CTD-392"><span class="linenos"> 392</span></a>        <span class="k">if</span> <span class="s1">&#39;salinityabs&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-393"><a href="#CTD-393"><span class="linenos"> 393</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_absolute_density</span><span class="p">(</span>
</span><span id="CTD-394"><a href="#CTD-394"><span class="linenos"> 394</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-395"><a href="#CTD-395"><span class="linenos"> 395</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-396"><a href="#CTD-396"><span class="linenos"> 396</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_absolute_salinity</span><span class="p">()</span>
</span><span id="CTD-397"><a href="#CTD-397"><span class="linenos"> 397</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_absolute_density</span><span class="p">(</span>
</span><span id="CTD-398"><a href="#CTD-398"><span class="linenos"> 398</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-399"><a href="#CTD-399"><span class="linenos"> 399</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;salinityabs&#39;</span><span class="p">)</span>
</span><span id="CTD-400"><a href="#CTD-400"><span class="linenos"> 400</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-401"><a href="#CTD-401"><span class="linenos"> 401</span></a>                <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DENSITY_CALCULATION_ERROR</span><span class="p">)</span>
</span><span id="CTD-402"><a href="#CTD-402"><span class="linenos"> 402</span></a>
</span><span id="CTD-403"><a href="#CTD-403"><span class="linenos"> 403</span></a>    <span class="k">def</span> <span class="nf">add_overturns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-404"><a href="#CTD-404"><span class="linenos"> 404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-405"><a href="#CTD-405"><span class="linenos"> 405</span></a><span class="sd">        Calculates density changes between consecutive measurements and identifies overturns where</span>
</span><span id="CTD-406"><a href="#CTD-406"><span class="linenos"> 406</span></a><span class="sd">        denser water lies above less dense water. Adds an &#39;overturn&#39; column to the CTD data table.</span>
</span><span id="CTD-407"><a href="#CTD-407"><span class="linenos"> 407</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-408"><a href="#CTD-408"><span class="linenos"> 408</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-409"><a href="#CTD-409"><span class="linenos"> 409</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-410"><a href="#CTD-410"><span class="linenos"> 410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_overturns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="CTD-411"><a href="#CTD-411"><span class="linenos"> 411</span></a>
</span><span id="CTD-412"><a href="#CTD-412"><span class="linenos"> 412</span></a>    <span class="k">def</span> <span class="nf">add_surface_salinity_temp_meltwater</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">12.0</span><span class="p">):</span>
</span><span id="CTD-413"><a href="#CTD-413"><span class="linenos"> 413</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-414"><a href="#CTD-414"><span class="linenos"> 414</span></a><span class="sd">        Calculates the surface salinity, temperature, and meltwater fraction and adds them as a new column to the CTD</span>
</span><span id="CTD-415"><a href="#CTD-415"><span class="linenos"> 415</span></a><span class="sd">        data table</span>
</span><span id="CTD-416"><a href="#CTD-416"><span class="linenos"> 416</span></a>
</span><span id="CTD-417"><a href="#CTD-417"><span class="linenos"> 417</span></a><span class="sd">        Parameters</span>
</span><span id="CTD-418"><a href="#CTD-418"><span class="linenos"> 418</span></a><span class="sd">        ----------</span>
</span><span id="CTD-419"><a href="#CTD-419"><span class="linenos"> 419</span></a><span class="sd">        start : float, optional</span>
</span><span id="CTD-420"><a href="#CTD-420"><span class="linenos"> 420</span></a><span class="sd">            Minimum pressure bound, defaults to 10.0.</span>
</span><span id="CTD-421"><a href="#CTD-421"><span class="linenos"> 421</span></a><span class="sd">        end : float, optional</span>
</span><span id="CTD-422"><a href="#CTD-422"><span class="linenos"> 422</span></a><span class="sd">            Maximum pressure bound, defaults to 12.0.</span>
</span><span id="CTD-423"><a href="#CTD-423"><span class="linenos"> 423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-424"><a href="#CTD-424"><span class="linenos"> 424</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-425"><a href="#CTD-425"><span class="linenos"> 425</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-426"><a href="#CTD-426"><span class="linenos"> 426</span></a>        <span class="n">surface_salinity</span><span class="p">,</span> <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_surface_salinity_and_meltwater</span>
</span><span id="CTD-427"><a href="#CTD-427"><span class="linenos"> 427</span></a>                                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</span><span id="CTD-428"><a href="#CTD-428"><span class="linenos"> 428</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_surface_temperature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</span><span id="CTD-429"><a href="#CTD-429"><span class="linenos"> 429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">surface_salinity</span><span class="o">=</span><span class="n">surface_salinity</span><span class="p">)</span>
</span><span id="CTD-430"><a href="#CTD-430"><span class="linenos"> 430</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">meltwater_fraction</span><span class="o">=</span><span class="n">meltwater_fraction</span><span class="p">)</span>
</span><span id="CTD-431"><a href="#CTD-431"><span class="linenos"> 431</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">surface_temperature</span><span class="o">=</span><span class="n">surface_temperature</span><span class="p">)</span>
</span><span id="CTD-432"><a href="#CTD-432"><span class="linenos"> 432</span></a>
</span><span id="CTD-433"><a href="#CTD-433"><span class="linenos"> 433</span></a>    <span class="k">def</span> <span class="nf">add_mean_surface_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">100.0</span><span class="p">):</span>
</span><span id="CTD-434"><a href="#CTD-434"><span class="linenos"> 434</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-435"><a href="#CTD-435"><span class="linenos"> 435</span></a><span class="sd">        Calculates the mean surface density from the density values and adds it as a new column</span>
</span><span id="CTD-436"><a href="#CTD-436"><span class="linenos"> 436</span></a><span class="sd">        to the CTD data table.</span>
</span><span id="CTD-437"><a href="#CTD-437"><span class="linenos"> 437</span></a>
</span><span id="CTD-438"><a href="#CTD-438"><span class="linenos"> 438</span></a><span class="sd">        Parameters</span>
</span><span id="CTD-439"><a href="#CTD-439"><span class="linenos"> 439</span></a><span class="sd">        ----------</span>
</span><span id="CTD-440"><a href="#CTD-440"><span class="linenos"> 440</span></a><span class="sd">        start : float, optional</span>
</span><span id="CTD-441"><a href="#CTD-441"><span class="linenos"> 441</span></a><span class="sd">            Depth bound, defaults to 0.</span>
</span><span id="CTD-442"><a href="#CTD-442"><span class="linenos"> 442</span></a><span class="sd">        end : float, optional</span>
</span><span id="CTD-443"><a href="#CTD-443"><span class="linenos"> 443</span></a><span class="sd">            Depth bound, default to 1.</span>
</span><span id="CTD-444"><a href="#CTD-444"><span class="linenos"> 444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-445"><a href="#CTD-445"><span class="linenos"> 445</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-446"><a href="#CTD-446"><span class="linenos"> 446</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-447"><a href="#CTD-447"><span class="linenos"> 447</span></a>        <span class="n">mean_surface_density</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_mean_surface_density</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</span><span id="CTD-448"><a href="#CTD-448"><span class="linenos"> 448</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">mean_surface_density</span><span class="o">=</span><span class="n">mean_surface_density</span><span class="p">)</span>
</span><span id="CTD-449"><a href="#CTD-449"><span class="linenos"> 449</span></a>
</span><span id="CTD-450"><a href="#CTD-450"><span class="linenos"> 450</span></a>    <span class="k">def</span> <span class="nf">add_mld</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">):</span>
</span><span id="CTD-451"><a href="#CTD-451"><span class="linenos"> 451</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-452"><a href="#CTD-452"><span class="linenos"> 452</span></a><span class="sd">        Calculates the mixed layer depth using the specified method and reference depth.</span>
</span><span id="CTD-453"><a href="#CTD-453"><span class="linenos"> 453</span></a><span class="sd">        Adds the MLD and the actual reference depth used as new columns to the CTD data table.</span>
</span><span id="CTD-454"><a href="#CTD-454"><span class="linenos"> 454</span></a>
</span><span id="CTD-455"><a href="#CTD-455"><span class="linenos"> 455</span></a><span class="sd">        Parameters</span>
</span><span id="CTD-456"><a href="#CTD-456"><span class="linenos"> 456</span></a><span class="sd">        ----------</span>
</span><span id="CTD-457"><a href="#CTD-457"><span class="linenos"> 457</span></a><span class="sd">        reference : int</span>
</span><span id="CTD-458"><a href="#CTD-458"><span class="linenos"> 458</span></a><span class="sd">            The reference depth for MLD calculation.</span>
</span><span id="CTD-459"><a href="#CTD-459"><span class="linenos"> 459</span></a><span class="sd">        method : int</span>
</span><span id="CTD-460"><a href="#CTD-460"><span class="linenos"> 460</span></a><span class="sd">            The MLD calculation method (default: &quot;default&quot;).</span>
</span><span id="CTD-461"><a href="#CTD-461"><span class="linenos"> 461</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-462"><a href="#CTD-462"><span class="linenos"> 462</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-463"><a href="#CTD-463"><span class="linenos"> 463</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD-464"><a href="#CTD-464"><span class="linenos"> 464</span></a>        <span class="n">copy_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-465"><a href="#CTD-465"><span class="linenos"> 465</span></a>        <span class="n">supported_methods</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="CTD-466"><a href="#CTD-466"><span class="linenos"> 466</span></a>            <span class="s2">&quot;default&quot;</span>
</span><span id="CTD-467"><a href="#CTD-467"><span class="linenos"> 467</span></a>        <span class="p">]</span>
</span><span id="CTD-468"><a href="#CTD-468"><span class="linenos"> 468</span></a>        <span class="n">unpack</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-469"><a href="#CTD-469"><span class="linenos"> 469</span></a>
</span><span id="CTD-470"><a href="#CTD-470"><span class="linenos"> 470</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
</span><span id="CTD-471"><a href="#CTD-471"><span class="linenos"> 471</span></a>            <span class="n">unpack</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_mld</span><span class="p">(</span><span class="n">copy_ctd_array</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="n">copy_ctd_array</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span>
</span><span id="CTD-472"><a href="#CTD-472"><span class="linenos"> 472</span></a>                                             <span class="n">reference</span><span class="p">)</span>
</span><span id="CTD-473"><a href="#CTD-473"><span class="linenos"> 473</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-474"><a href="#CTD-474"><span class="linenos"> 474</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;add_mld: Invalid method </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> not in </span><span class="si">{</span><span class="n">supported_methods</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-475"><a href="#CTD-475"><span class="linenos"> 475</span></a>            <span class="n">unpack</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="CTD-476"><a href="#CTD-476"><span class="linenos"> 476</span></a>        <span class="k">if</span> <span class="n">unpack</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CTD-477"><a href="#CTD-477"><span class="linenos"> 477</span></a>            <span class="n">unpack</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="CTD-478"><a href="#CTD-478"><span class="linenos"> 478</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s2">&quot;MLD could not be calculated.&quot;</span><span class="p">)</span>
</span><span id="CTD-479"><a href="#CTD-479"><span class="linenos"> 479</span></a>        <span class="n">MLD</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-480"><a href="#CTD-480"><span class="linenos"> 480</span></a>        <span class="n">depth_used_as_reference</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CTD-481"><a href="#CTD-481"><span class="linenos"> 481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MLD</span>
</span><span id="CTD-482"><a href="#CTD-482"><span class="linenos"> 482</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="CTD-483"><a href="#CTD-483"><span class="linenos"> 483</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1"> Actual Reference Depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth_used_as_reference</span>
</span><span id="CTD-484"><a href="#CTD-484"><span class="linenos"> 484</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD-485"><a href="#CTD-485"><span class="linenos"> 485</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MLD_ERROR</span><span class="p">)</span>
</span><span id="CTD-486"><a href="#CTD-486"><span class="linenos"> 486</span></a>
</span><span id="CTD-487"><a href="#CTD-487"><span class="linenos"> 487</span></a>    <span class="k">def</span> <span class="nf">plot_depth_salinity_density_mld_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-488"><a href="#CTD-488"><span class="linenos"> 488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-489"><a href="#CTD-489"><span class="linenos"> 489</span></a><span class="sd">        Generates a plot of depth vs. salinity and density, applying LOESS smoothing to the data.</span>
</span><span id="CTD-490"><a href="#CTD-490"><span class="linenos"> 490</span></a><span class="sd">        Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.</span>
</span><span id="CTD-491"><a href="#CTD-491"><span class="linenos"> 491</span></a><span class="sd">        Saves the plot as an image file.</span>
</span><span id="CTD-492"><a href="#CTD-492"><span class="linenos"> 492</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-493"><a href="#CTD-493"><span class="linenos"> 493</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-494"><a href="#CTD-494"><span class="linenos"> 494</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
</span><span id="CTD-495"><a href="#CTD-495"><span class="linenos"> 495</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
</span><span id="CTD-496"><a href="#CTD-496"><span class="linenos"> 496</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="CTD-497"><a href="#CTD-497"><span class="linenos"> 497</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CTD-498"><a href="#CTD-498"><span class="linenos"> 498</span></a>            <span class="n">df_filtered</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Drop rows with NaNs</span>
</span><span id="CTD-499"><a href="#CTD-499"><span class="linenos"> 499</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-500"><a href="#CTD-500"><span class="linenos"> 500</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD-501"><a href="#CTD-501"><span class="linenos"> 501</span></a>            <span class="k">return</span>
</span><span id="CTD-502"><a href="#CTD-502"><span class="linenos"> 502</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;surface_salinity&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-503"><a href="#CTD-503"><span class="linenos"> 503</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;surface_temperature&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-504"><a href="#CTD-504"><span class="linenos"> 504</span></a>        <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;meltwater_fraction&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-505"><a href="#CTD-505"><span class="linenos"> 505</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
</span><span id="CTD-506"><a href="#CTD-506"><span class="linenos"> 506</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="CTD-507"><a href="#CTD-507"><span class="linenos"> 507</span></a>        <span class="c1"># Dynamically set y-axis limits based on depth data</span>
</span><span id="CTD-508"><a href="#CTD-508"><span class="linenos"> 508</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CTD-509"><a href="#CTD-509"><span class="linenos"> 509</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">max_depth</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Assuming depth increases downwards</span>
</span><span id="CTD-510"><a href="#CTD-510"><span class="linenos"> 510</span></a>        <span class="n">lowess</span> <span class="o">=</span> <span class="n">statsmodels</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">nonparametric</span><span class="o">.</span><span class="n">lowess</span>
</span><span id="CTD-511"><a href="#CTD-511"><span class="linenos"> 511</span></a>        <span class="n">salinity_lowess</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="CTD-512"><a href="#CTD-512"><span class="linenos"> 512</span></a>        <span class="n">salinity_depths</span><span class="p">,</span> <span class="n">salinity_smooth</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">salinity_lowess</span><span class="p">)</span>
</span><span id="CTD-513"><a href="#CTD-513"><span class="linenos"> 513</span></a>        <span class="n">color_salinity</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
</span><span id="CTD-514"><a href="#CTD-514"><span class="linenos"> 514</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">salinity_smooth</span><span class="p">,</span> <span class="n">salinity_depths</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Practical Salinity&#39;</span><span class="p">)</span>
</span><span id="CTD-515"><a href="#CTD-515"><span class="linenos"> 515</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Practical Salinity (PSU)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="CTD-516"><a href="#CTD-516"><span class="linenos"> 516</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="CTD-517"><a href="#CTD-517"><span class="linenos"> 517</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="CTD-518"><a href="#CTD-518"><span class="linenos"> 518</span></a>        <span class="n">density_lowess</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="CTD-519"><a href="#CTD-519"><span class="linenos"> 519</span></a>        <span class="n">density_depths</span><span class="p">,</span> <span class="n">density_smooth</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">density_lowess</span><span class="p">)</span>
</span><span id="CTD-520"><a href="#CTD-520"><span class="linenos"> 520</span></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
</span><span id="CTD-521"><a href="#CTD-521"><span class="linenos"> 521</span></a>        <span class="n">color_density</span> <span class="o">=</span> <span class="s1">&#39;tab:red&#39;</span>
</span><span id="CTD-522"><a href="#CTD-522"><span class="linenos"> 522</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">density_smooth</span><span class="p">,</span> <span class="n">density_depths</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">)</span>
</span><span id="CTD-523"><a href="#CTD-523"><span class="linenos"> 523</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="CTD-524"><a href="#CTD-524"><span class="linenos"> 524</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="CTD-525"><a href="#CTD-525"><span class="linenos"> 525</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="CTD-526"><a href="#CTD-526"><span class="linenos"> 526</span></a>        <span class="n">mld_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD-527"><a href="#CTD-527"><span class="linenos"> 527</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-528"><a href="#CTD-528"><span class="linenos"> 528</span></a>            <span class="k">if</span> <span class="s1">&#39;MLD&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD-529"><a href="#CTD-529"><span class="linenos"> 529</span></a>                <span class="n">mld_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD-530"><a href="#CTD-530"><span class="linenos"> 530</span></a>        <span class="n">refdepth_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD-531"><a href="#CTD-531"><span class="linenos"> 531</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-532"><a href="#CTD-532"><span class="linenos"> 532</span></a>            <span class="k">if</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD-533"><a href="#CTD-533"><span class="linenos"> 533</span></a>                <span class="n">refdepth_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD-534"><a href="#CTD-534"><span class="linenos"> 534</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mld_col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mld_cols</span><span class="p">):</span>
</span><span id="CTD-535"><a href="#CTD-535"><span class="linenos"> 535</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
</span><span id="CTD-536"><a href="#CTD-536"><span class="linenos"> 536</span></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> Ref&#39;</span><span class="p">)</span>
</span><span id="CTD-537"><a href="#CTD-537"><span class="linenos"> 537</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;MLD with respect to </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
</span><span id="CTD-538"><a href="#CTD-538"><span class="linenos"> 538</span></a>                     <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">())</span>
</span><span id="CTD-539"><a href="#CTD-539"><span class="linenos"> 539</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CTD-540"><a href="#CTD-540"><span class="linenos"> 540</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD-541"><a href="#CTD-541"><span class="linenos"> 541</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density with LOESS Transform &quot;</span>
</span><span id="CTD-542"><a href="#CTD-542"><span class="linenos"> 542</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> THIS IS AN UNSTABLE WATER COLUMN &quot;</span>
</span><span id="CTD-543"><a href="#CTD-543"><span class="linenos"> 543</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(Higher density fluid lies above lower density fluid)&quot;</span><span class="p">)</span>
</span><span id="CTD-544"><a href="#CTD-544"><span class="linenos"> 544</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-545"><a href="#CTD-545"><span class="linenos"> 545</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD-546"><a href="#CTD-546"><span class="linenos"> 546</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density with LOESS Transform </span><span class="se">\n</span><span class="s2"> Surface Salinity </span><span class="si">{</span><span class="n">surface_salinity</span><span class="si">}</span><span class="se">\n</span><span class="s2">, Surface Temperature </span><span class="si">{</span><span class="n">surface_temperature</span><span class="si">}</span><span class="se">\n</span><span class="s2">, Meltwater Fraction </span><span class="si">{</span><span class="n">meltwater_fraction</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CTD-547"><a href="#CTD-547"><span class="linenos"> 547</span></a>
</span><span id="CTD-548"><a href="#CTD-548"><span class="linenos"> 548</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-549"><a href="#CTD-549"><span class="linenos"> 549</span></a>        <span class="n">lines</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="CTD-550"><a href="#CTD-550"><span class="linenos"> 550</span></a>        <span class="n">ax2_legend</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="CTD-551"><a href="#CTD-551"><span class="linenos"> 551</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">),</span>
</span><span id="CTD-552"><a href="#CTD-552"><span class="linenos"> 552</span></a>                   <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="CTD-553"><a href="#CTD-553"><span class="linenos"> 553</span></a>        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;plots/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_salinity_density_depth_plot_dual_x_axes_line.png&quot;</span><span class="p">)</span>
</span><span id="CTD-554"><a href="#CTD-554"><span class="linenos"> 554</span></a>        <span class="n">plot_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="CTD-555"><a href="#CTD-555"><span class="linenos"> 555</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)):</span>
</span><span id="CTD-556"><a href="#CTD-556"><span class="linenos"> 556</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)</span>
</span><span id="CTD-557"><a href="#CTD-557"><span class="linenos"> 557</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">)</span>
</span><span id="CTD-558"><a href="#CTD-558"><span class="linenos"> 558</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="CTD-559"><a href="#CTD-559"><span class="linenos"> 559</span></a>
</span><span id="CTD-560"><a href="#CTD-560"><span class="linenos"> 560</span></a>    <span class="k">def</span> <span class="nf">plot_depth_density_salinity_mld_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-561"><a href="#CTD-561"><span class="linenos"> 561</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-562"><a href="#CTD-562"><span class="linenos"> 562</span></a><span class="sd">        Generates a scatter plot of depth vs. salinity and density.</span>
</span><span id="CTD-563"><a href="#CTD-563"><span class="linenos"> 563</span></a><span class="sd">        Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.</span>
</span><span id="CTD-564"><a href="#CTD-564"><span class="linenos"> 564</span></a><span class="sd">        Saves the plot as an image file.</span>
</span><span id="CTD-565"><a href="#CTD-565"><span class="linenos"> 565</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-566"><a href="#CTD-566"><span class="linenos"> 566</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-567"><a href="#CTD-567"><span class="linenos"> 567</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
</span><span id="CTD-568"><a href="#CTD-568"><span class="linenos"> 568</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
</span><span id="CTD-569"><a href="#CTD-569"><span class="linenos"> 569</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="CTD-570"><a href="#CTD-570"><span class="linenos"> 570</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CTD-571"><a href="#CTD-571"><span class="linenos"> 571</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="CTD-572"><a href="#CTD-572"><span class="linenos"> 572</span></a>            <span class="k">return</span>
</span><span id="CTD-573"><a href="#CTD-573"><span class="linenos"> 573</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-574"><a href="#CTD-574"><span class="linenos"> 574</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_salinity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-575"><a href="#CTD-575"><span class="linenos"> 575</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-576"><a href="#CTD-576"><span class="linenos"> 576</span></a>        <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">meltwater_fraction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-577"><a href="#CTD-577"><span class="linenos"> 577</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
</span><span id="CTD-578"><a href="#CTD-578"><span class="linenos"> 578</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="CTD-579"><a href="#CTD-579"><span class="linenos"> 579</span></a>        <span class="c1"># Dynamically set y-axis limits based on depth data</span>
</span><span id="CTD-580"><a href="#CTD-580"><span class="linenos"> 580</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CTD-581"><a href="#CTD-581"><span class="linenos"> 581</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">max_depth</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Assuming depth increases downwards</span>
</span><span id="CTD-582"><a href="#CTD-582"><span class="linenos"> 582</span></a>        <span class="n">color_salinity</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
</span><span id="CTD-583"><a href="#CTD-583"><span class="linenos"> 583</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">,</span>
</span><span id="CTD-584"><a href="#CTD-584"><span class="linenos"> 584</span></a>                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Practical Salinity&#39;</span><span class="p">)</span>
</span><span id="CTD-585"><a href="#CTD-585"><span class="linenos"> 585</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Practical Salinity (PSU)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="CTD-586"><a href="#CTD-586"><span class="linenos"> 586</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="CTD-587"><a href="#CTD-587"><span class="linenos"> 587</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="CTD-588"><a href="#CTD-588"><span class="linenos"> 588</span></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
</span><span id="CTD-589"><a href="#CTD-589"><span class="linenos"> 589</span></a>        <span class="n">color_density</span> <span class="o">=</span> <span class="s1">&#39;tab:red&#39;</span>
</span><span id="CTD-590"><a href="#CTD-590"><span class="linenos"> 590</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">)</span>
</span><span id="CTD-591"><a href="#CTD-591"><span class="linenos"> 591</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="CTD-592"><a href="#CTD-592"><span class="linenos"> 592</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="CTD-593"><a href="#CTD-593"><span class="linenos"> 593</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="CTD-594"><a href="#CTD-594"><span class="linenos"> 594</span></a>        <span class="n">mld_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD-595"><a href="#CTD-595"><span class="linenos"> 595</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-596"><a href="#CTD-596"><span class="linenos"> 596</span></a>            <span class="k">if</span> <span class="s1">&#39;MLD&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD-597"><a href="#CTD-597"><span class="linenos"> 597</span></a>                <span class="n">mld_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD-598"><a href="#CTD-598"><span class="linenos"> 598</span></a>        <span class="n">refdepth_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD-599"><a href="#CTD-599"><span class="linenos"> 599</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-600"><a href="#CTD-600"><span class="linenos"> 600</span></a>            <span class="k">if</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD-601"><a href="#CTD-601"><span class="linenos"> 601</span></a>                <span class="n">refdepth_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD-602"><a href="#CTD-602"><span class="linenos"> 602</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mld_col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mld_cols</span><span class="p">):</span>
</span><span id="CTD-603"><a href="#CTD-603"><span class="linenos"> 603</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
</span><span id="CTD-604"><a href="#CTD-604"><span class="linenos"> 604</span></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> Ref&#39;</span><span class="p">)</span>
</span><span id="CTD-605"><a href="#CTD-605"><span class="linenos"> 605</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;MLD with respect to </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
</span><span id="CTD-606"><a href="#CTD-606"><span class="linenos"> 606</span></a>                     <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">())</span>
</span><span id="CTD-607"><a href="#CTD-607"><span class="linenos"> 607</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CTD-608"><a href="#CTD-608"><span class="linenos"> 608</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD-609"><a href="#CTD-609"><span class="linenos"> 609</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density &quot;</span>
</span><span id="CTD-610"><a href="#CTD-610"><span class="linenos"> 610</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> THIS IS AN UNSTABLE WATER COLUMN &quot;</span>
</span><span id="CTD-611"><a href="#CTD-611"><span class="linenos"> 611</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(Higher density fluid lies above lower density fluid)&quot;</span><span class="p">)</span>
</span><span id="CTD-612"><a href="#CTD-612"><span class="linenos"> 612</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-613"><a href="#CTD-613"><span class="linenos"> 613</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD-614"><a href="#CTD-614"><span class="linenos"> 614</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density </span><span class="se">\n</span><span class="s2"> Surface Salinity </span><span class="si">{</span><span class="n">surface_salinity</span><span class="si">}</span><span class="s2">, Meltwater Fraction </span><span class="si">{</span><span class="n">meltwater_fraction</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CTD-615"><a href="#CTD-615"><span class="linenos"> 615</span></a>
</span><span id="CTD-616"><a href="#CTD-616"><span class="linenos"> 616</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-617"><a href="#CTD-617"><span class="linenos"> 617</span></a>        <span class="n">lines</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="CTD-618"><a href="#CTD-618"><span class="linenos"> 618</span></a>        <span class="n">ax2_legend</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="CTD-619"><a href="#CTD-619"><span class="linenos"> 619</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">),</span>
</span><span id="CTD-620"><a href="#CTD-620"><span class="linenos"> 620</span></a>                   <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="CTD-621"><a href="#CTD-621"><span class="linenos"> 621</span></a>        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;plots/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_salinity_density_depth_plot_dual_x_axes.png&quot;</span><span class="p">)</span>
</span><span id="CTD-622"><a href="#CTD-622"><span class="linenos"> 622</span></a>        <span class="n">plot_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="CTD-623"><a href="#CTD-623"><span class="linenos"> 623</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)):</span>
</span><span id="CTD-624"><a href="#CTD-624"><span class="linenos"> 624</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)</span>
</span><span id="CTD-625"><a href="#CTD-625"><span class="linenos"> 625</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">)</span>
</span><span id="CTD-626"><a href="#CTD-626"><span class="linenos"> 626</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="CTD-627"><a href="#CTD-627"><span class="linenos"> 627</span></a>
</span><span id="CTD-628"><a href="#CTD-628"><span class="linenos"> 628</span></a>    <span class="k">def</span> <span class="nf">plot_depth_temperature_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-629"><a href="#CTD-629"><span class="linenos"> 629</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-630"><a href="#CTD-630"><span class="linenos"> 630</span></a><span class="sd">        Generates a scatter plot of depth vs. temperature.</span>
</span><span id="CTD-631"><a href="#CTD-631"><span class="linenos"> 631</span></a><span class="sd">        Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.</span>
</span><span id="CTD-632"><a href="#CTD-632"><span class="linenos"> 632</span></a><span class="sd">        Saves the plot as an image file.</span>
</span><span id="CTD-633"><a href="#CTD-633"><span class="linenos"> 633</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-634"><a href="#CTD-634"><span class="linenos"> 634</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-635"><a href="#CTD-635"><span class="linenos"> 635</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
</span><span id="CTD-636"><a href="#CTD-636"><span class="linenos"> 636</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
</span><span id="CTD-637"><a href="#CTD-637"><span class="linenos"> 637</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="CTD-638"><a href="#CTD-638"><span class="linenos"> 638</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CTD-639"><a href="#CTD-639"><span class="linenos"> 639</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="CTD-640"><a href="#CTD-640"><span class="linenos"> 640</span></a>            <span class="k">return</span>
</span><span id="CTD-641"><a href="#CTD-641"><span class="linenos"> 641</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-642"><a href="#CTD-642"><span class="linenos"> 642</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_salinity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-643"><a href="#CTD-643"><span class="linenos"> 643</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-644"><a href="#CTD-644"><span class="linenos"> 644</span></a>        <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">meltwater_fraction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-645"><a href="#CTD-645"><span class="linenos"> 645</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
</span><span id="CTD-646"><a href="#CTD-646"><span class="linenos"> 646</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="CTD-647"><a href="#CTD-647"><span class="linenos"> 647</span></a>        <span class="c1"># Dynamically set y-axis limits based on depth data</span>
</span><span id="CTD-648"><a href="#CTD-648"><span class="linenos"> 648</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CTD-649"><a href="#CTD-649"><span class="linenos"> 649</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">max_depth</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Assuming depth increases downwards</span>
</span><span id="CTD-650"><a href="#CTD-650"><span class="linenos"> 650</span></a>
</span><span id="CTD-651"><a href="#CTD-651"><span class="linenos"> 651</span></a>        <span class="n">color_temp</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
</span><span id="CTD-652"><a href="#CTD-652"><span class="linenos"> 652</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;temperature_00&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_temp</span><span class="p">,</span>
</span><span id="CTD-653"><a href="#CTD-653"><span class="linenos"> 653</span></a>                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
</span><span id="CTD-654"><a href="#CTD-654"><span class="linenos"> 654</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_temp</span><span class="p">)</span>
</span><span id="CTD-655"><a href="#CTD-655"><span class="linenos"> 655</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="CTD-656"><a href="#CTD-656"><span class="linenos"> 656</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_temp</span><span class="p">)</span>
</span><span id="CTD-657"><a href="#CTD-657"><span class="linenos"> 657</span></a>        <span class="n">mld_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD-658"><a href="#CTD-658"><span class="linenos"> 658</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-659"><a href="#CTD-659"><span class="linenos"> 659</span></a>            <span class="k">if</span> <span class="s2">&quot;MLD&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s2">&quot;Actual&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD-660"><a href="#CTD-660"><span class="linenos"> 660</span></a>                <span class="n">mld_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD-661"><a href="#CTD-661"><span class="linenos"> 661</span></a>        <span class="n">refdepth_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD-662"><a href="#CTD-662"><span class="linenos"> 662</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-663"><a href="#CTD-663"><span class="linenos"> 663</span></a>            <span class="k">if</span> <span class="s2">&quot;Reference Depth&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD-664"><a href="#CTD-664"><span class="linenos"> 664</span></a>                <span class="n">refdepth_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD-665"><a href="#CTD-665"><span class="linenos"> 665</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mld_col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mld_cols</span><span class="p">):</span>
</span><span id="CTD-666"><a href="#CTD-666"><span class="linenos"> 666</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
</span><span id="CTD-667"><a href="#CTD-667"><span class="linenos"> 667</span></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> Ref&#39;</span><span class="p">)</span>
</span><span id="CTD-668"><a href="#CTD-668"><span class="linenos"> 668</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;MLD with respect to </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
</span><span id="CTD-669"><a href="#CTD-669"><span class="linenos"> 669</span></a>                     <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">())</span>
</span><span id="CTD-670"><a href="#CTD-670"><span class="linenos"> 670</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CTD-671"><a href="#CTD-671"><span class="linenos"> 671</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD-672"><a href="#CTD-672"><span class="linenos"> 672</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Temperature </span><span class="se">\n</span><span class="s2"> &quot;</span>
</span><span id="CTD-673"><a href="#CTD-673"><span class="linenos"> 673</span></a>                <span class="sa">f</span><span class="s2">&quot;THIS IS AN UNSTABLE WATER COLUMN </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="CTD-674"><a href="#CTD-674"><span class="linenos"> 674</span></a>                <span class="sa">f</span><span class="s2">&quot;(Higher density fluid lies above lower density fluid)&quot;</span><span class="p">)</span>
</span><span id="CTD-675"><a href="#CTD-675"><span class="linenos"> 675</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-676"><a href="#CTD-676"><span class="linenos"> 676</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD-677"><a href="#CTD-677"><span class="linenos"> 677</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Temperature </span><span class="se">\n</span><span class="s2"> Surface Temperature </span><span class="si">{</span><span class="n">surface_temperature</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CTD-678"><a href="#CTD-678"><span class="linenos"> 678</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-679"><a href="#CTD-679"><span class="linenos"> 679</span></a>        <span class="n">lines</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="CTD-680"><a href="#CTD-680"><span class="linenos"> 680</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="CTD-681"><a href="#CTD-681"><span class="linenos"> 681</span></a>        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;plots/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_temperature_depth_plot.png&quot;</span><span class="p">)</span>
</span><span id="CTD-682"><a href="#CTD-682"><span class="linenos"> 682</span></a>        <span class="n">plot_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="CTD-683"><a href="#CTD-683"><span class="linenos"> 683</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)):</span>
</span><span id="CTD-684"><a href="#CTD-684"><span class="linenos"> 684</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)</span>
</span><span id="CTD-685"><a href="#CTD-685"><span class="linenos"> 685</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">)</span>
</span><span id="CTD-686"><a href="#CTD-686"><span class="linenos"> 686</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="CTD-687"><a href="#CTD-687"><span class="linenos"> 687</span></a>
</span><span id="CTD-688"><a href="#CTD-688"><span class="linenos"> 688</span></a>    <span class="k">def</span> <span class="nf">_process_master_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master_sheet_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="CTD-689"><a href="#CTD-689"><span class="linenos"> 689</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-690"><a href="#CTD-690"><span class="linenos"> 690</span></a><span class="sd">        Extracts the date and time components from the filename and compares them with the data</span>
</span><span id="CTD-691"><a href="#CTD-691"><span class="linenos"> 691</span></a><span class="sd">        in the master sheet. Calculates the absolute differences between the dates and times to</span>
</span><span id="CTD-692"><a href="#CTD-692"><span class="linenos"> 692</span></a><span class="sd">        find the closest match. Returns the estimated latitude, longitude, and updated filename</span>
</span><span id="CTD-693"><a href="#CTD-693"><span class="linenos"> 693</span></a><span class="sd">        based on the closest match.</span>
</span><span id="CTD-694"><a href="#CTD-694"><span class="linenos"> 694</span></a>
</span><span id="CTD-695"><a href="#CTD-695"><span class="linenos"> 695</span></a><span class="sd">        Parameters</span>
</span><span id="CTD-696"><a href="#CTD-696"><span class="linenos"> 696</span></a><span class="sd">        ----------</span>
</span><span id="CTD-697"><a href="#CTD-697"><span class="linenos"> 697</span></a><span class="sd">        master_sheet_path : str</span>
</span><span id="CTD-698"><a href="#CTD-698"><span class="linenos"> 698</span></a><span class="sd">            The path to the master sheet Excel file.</span>
</span><span id="CTD-699"><a href="#CTD-699"><span class="linenos"> 699</span></a>
</span><span id="CTD-700"><a href="#CTD-700"><span class="linenos"> 700</span></a><span class="sd">        filename : str</span>
</span><span id="CTD-701"><a href="#CTD-701"><span class="linenos"> 701</span></a><span class="sd">            The filename of the RSK file.</span>
</span><span id="CTD-702"><a href="#CTD-702"><span class="linenos"> 702</span></a>
</span><span id="CTD-703"><a href="#CTD-703"><span class="linenos"> 703</span></a><span class="sd">        Returns</span>
</span><span id="CTD-704"><a href="#CTD-704"><span class="linenos"> 704</span></a><span class="sd">        -------</span>
</span><span id="CTD-705"><a href="#CTD-705"><span class="linenos"> 705</span></a><span class="sd">        tuple</span>
</span><span id="CTD-706"><a href="#CTD-706"><span class="linenos"> 706</span></a><span class="sd">            A tuple containing the estimated latitude, longitude, and updated filename.</span>
</span><span id="CTD-707"><a href="#CTD-707"><span class="linenos"> 707</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-708"><a href="#CTD-708"><span class="linenos"> 708</span></a>
</span><span id="CTD-709"><a href="#CTD-709"><span class="linenos"> 709</span></a>        <span class="k">def</span> <span class="nf">get_date_from_string</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="CTD-710"><a href="#CTD-710"><span class="linenos"> 710</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CTD-711"><a href="#CTD-711"><span class="linenos"> 711</span></a>                <span class="n">year</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span>
</span><span id="CTD-712"><a href="#CTD-712"><span class="linenos"> 712</span></a>                <span class="n">month</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
</span><span id="CTD-713"><a href="#CTD-713"><span class="linenos"> 713</span></a>                <span class="n">day</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">:]</span>
</span><span id="CTD-714"><a href="#CTD-714"><span class="linenos"> 714</span></a>                <span class="n">hour</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="CTD-715"><a href="#CTD-715"><span class="linenos"> 715</span></a>                <span class="n">minute</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</span><span id="CTD-716"><a href="#CTD-716"><span class="linenos"> 716</span></a>                <span class="n">time</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hour</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">minute</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="CTD-717"><a href="#CTD-717"><span class="linenos"> 717</span></a>                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">month</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">day</span><span class="p">),</span> <span class="n">time</span>
</span><span id="CTD-718"><a href="#CTD-718"><span class="linenos"> 718</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="CTD-719"><a href="#CTD-719"><span class="linenos"> 719</span></a>                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="CTD-720"><a href="#CTD-720"><span class="linenos"> 720</span></a>
</span><span id="CTD-721"><a href="#CTD-721"><span class="linenos"> 721</span></a>        <span class="c1"># Function to calculate the absolute difference between two dates</span>
</span><span id="CTD-722"><a href="#CTD-722"><span class="linenos"> 722</span></a>        <span class="k">def</span> <span class="nf">date_difference</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">target_year</span><span class="p">,</span> <span class="n">target_month</span><span class="p">,</span> <span class="n">target_day</span><span class="p">):</span>
</span><span id="CTD-723"><a href="#CTD-723"><span class="linenos"> 723</span></a>            <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_month</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span>
</span><span id="CTD-724"><a href="#CTD-724"><span class="linenos"> 724</span></a>                <span class="n">row</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_day</span><span class="p">)</span>
</span><span id="CTD-725"><a href="#CTD-725"><span class="linenos"> 725</span></a>
</span><span id="CTD-726"><a href="#CTD-726"><span class="linenos"> 726</span></a>        <span class="c1"># Function to calculate the absolute difference between two times</span>
</span><span id="CTD-727"><a href="#CTD-727"><span class="linenos"> 727</span></a>        <span class="k">def</span> <span class="nf">time_difference</span><span class="p">(</span><span class="n">target_time</span><span class="p">,</span> <span class="n">df_time</span><span class="p">):</span>
</span><span id="CTD-728"><a href="#CTD-728"><span class="linenos"> 728</span></a>            <span class="n">df_time_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">df_time</span><span class="p">)</span>
</span><span id="CTD-729"><a href="#CTD-729"><span class="linenos"> 729</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CTD-730"><a href="#CTD-730"><span class="linenos"> 730</span></a>                <span class="n">target_hour</span><span class="p">,</span> <span class="n">target_minute</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">target_time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="CTD-731"><a href="#CTD-731"><span class="linenos"> 731</span></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="CTD-732"><a href="#CTD-732"><span class="linenos"> 732</span></a>                <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;Malformed filename, could not parse time.&quot;</span><span class="p">)</span>
</span><span id="CTD-733"><a href="#CTD-733"><span class="linenos"> 733</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CTD-734"><a href="#CTD-734"><span class="linenos"> 734</span></a>                <span class="n">df_hour</span><span class="p">,</span> <span class="n">df_minute</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">df_time_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">df_time_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="CTD-735"><a href="#CTD-735"><span class="linenos"> 735</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="CTD-736"><a href="#CTD-736"><span class="linenos"> 736</span></a>                <span class="c1"># Invalid time</span>
</span><span id="CTD-737"><a href="#CTD-737"><span class="linenos"> 737</span></a>                <span class="k">return</span> <span class="mi">1000000</span>
</span><span id="CTD-738"><a href="#CTD-738"><span class="linenos"> 738</span></a>            <span class="k">return</span> <span class="nb">abs</span><span class="p">((</span><span class="n">target_hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">target_minute</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">df_hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">df_minute</span><span class="p">))</span>
</span><span id="CTD-739"><a href="#CTD-739"><span class="linenos"> 739</span></a>
</span><span id="CTD-740"><a href="#CTD-740"><span class="linenos"> 740</span></a>        <span class="c1"># Check if the master sheet is already cached</span>
</span><span id="CTD-741"><a href="#CTD-741"><span class="linenos"> 741</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CTD-742"><a href="#CTD-742"><span class="linenos"> 742</span></a>            <span class="c1"># Load the master sheet and cache it</span>
</span><span id="CTD-743"><a href="#CTD-743"><span class="linenos"> 743</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reloading master sheet.&quot;</span><span class="p">)</span>
</span><span id="CTD-744"><a href="#CTD-744"><span class="linenos"> 744</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">master_sheet_path</span><span class="p">)</span>
</span><span id="CTD-745"><a href="#CTD-745"><span class="linenos"> 745</span></a>        <span class="n">master_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span>
</span><span id="CTD-746"><a href="#CTD-746"><span class="linenos"> 746</span></a>        <span class="c1"># Get date and time components from the filename</span>
</span><span id="CTD-747"><a href="#CTD-747"><span class="linenos"> 747</span></a>        <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">get_date_from_string</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="CTD-748"><a href="#CTD-748"><span class="linenos"> 748</span></a>        <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CTD-749"><a href="#CTD-749"><span class="linenos"> 749</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="CTD-750"><a href="#CTD-750"><span class="linenos"> 750</span></a>        <span class="c1"># Calculate absolute differences for each row in &#39;master_df&#39;</span>
</span><span id="CTD-751"><a href="#CTD-751"><span class="linenos"> 751</span></a>        <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;date_difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">master_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">date_difference</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CTD-752"><a href="#CTD-752"><span class="linenos"> 752</span></a>        <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;time_difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;time_local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">time_difference</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
</span><span id="CTD-753"><a href="#CTD-753"><span class="linenos"> 753</span></a>        <span class="c1"># Find the rows with the smallest total difference for date</span>
</span><span id="CTD-754"><a href="#CTD-754"><span class="linenos"> 754</span></a>        <span class="n">smallest_date_difference</span> <span class="o">=</span> <span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;date_difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="CTD-755"><a href="#CTD-755"><span class="linenos"> 755</span></a>        <span class="n">closest_date_rows</span> <span class="o">=</span> <span class="n">master_df</span><span class="p">[</span><span class="n">master_df</span><span class="p">[</span><span class="s1">&#39;date_difference&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">smallest_date_difference</span><span class="p">]</span>
</span><span id="CTD-756"><a href="#CTD-756"><span class="linenos"> 756</span></a>        <span class="c1"># Check if time_difference returns None</span>
</span><span id="CTD-757"><a href="#CTD-757"><span class="linenos"> 757</span></a>        <span class="k">if</span> <span class="n">closest_date_rows</span><span class="p">[</span><span class="s1">&#39;time_difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CTD-758"><a href="#CTD-758"><span class="linenos"> 758</span></a>            <span class="n">closest_time_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-759"><a href="#CTD-759"><span class="linenos"> 759</span></a>            <span class="n">closest_row_overall</span> <span class="o">=</span> <span class="n">closest_date_rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-760"><a href="#CTD-760"><span class="linenos"> 760</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-761"><a href="#CTD-761"><span class="linenos"> 761</span></a>            <span class="c1"># If there are multiple rows with the smallest date difference, select the row with the smallest time difference</span>
</span><span id="CTD-762"><a href="#CTD-762"><span class="linenos"> 762</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">closest_date_rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD-763"><a href="#CTD-763"><span class="linenos"> 763</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="CTD-764"><a href="#CTD-764"><span class="linenos"> 764</span></a>                    <span class="n">closest_time_row</span> <span class="o">=</span> <span class="n">closest_date_rows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">closest_date_rows</span><span class="p">[</span><span class="s1">&#39;time_difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span>
</span><span id="CTD-765"><a href="#CTD-765"><span class="linenos"> 765</span></a>                <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="CTD-766"><a href="#CTD-766"><span class="linenos"> 766</span></a>                    <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;Malformed time input.&quot;</span><span class="p">)</span>
</span><span id="CTD-767"><a href="#CTD-767"><span class="linenos"> 767</span></a>                <span class="n">closest_row_overall</span> <span class="o">=</span> <span class="n">closest_time_row</span>
</span><span id="CTD-768"><a href="#CTD-768"><span class="linenos"> 768</span></a>                <span class="n">closest_time_time</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;time_local&#39;</span><span class="p">]</span>
</span><span id="CTD-769"><a href="#CTD-769"><span class="linenos"> 769</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-770"><a href="#CTD-770"><span class="linenos"> 770</span></a>                <span class="n">closest_row_overall</span> <span class="o">=</span> <span class="n">closest_date_rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-771"><a href="#CTD-771"><span class="linenos"> 771</span></a>                <span class="n">closest_time_time</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;time_local&#39;</span><span class="p">]</span>
</span><span id="CTD-772"><a href="#CTD-772"><span class="linenos"> 772</span></a>        <span class="n">latitude</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="CTD-773"><a href="#CTD-773"><span class="linenos"> 773</span></a>        <span class="n">longitude</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="CTD-774"><a href="#CTD-774"><span class="linenos"> 774</span></a>        <span class="n">unique_id</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-775"><a href="#CTD-775"><span class="linenos"> 775</span></a>        <span class="n">RBRfilename</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_gpscm&quot;</span>
</span><span id="CTD-776"><a href="#CTD-776"><span class="linenos"> 776</span></a>        <span class="c1"># Access the closest date components</span>
</span><span id="CTD-777"><a href="#CTD-777"><span class="linenos"> 777</span></a>        <span class="n">closest_date_year</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
</span><span id="CTD-778"><a href="#CTD-778"><span class="linenos"> 778</span></a>        <span class="n">closest_date_month</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span>
</span><span id="CTD-779"><a href="#CTD-779"><span class="linenos"> 779</span></a>        <span class="n">closest_date_day</span> <span class="o">=</span> <span class="n">closest_row_overall</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span>
</span><span id="CTD-780"><a href="#CTD-780"><span class="linenos"> 780</span></a>        <span class="c1"># Print the closest date and time</span>
</span><span id="CTD-781"><a href="#CTD-781"><span class="linenos"> 781</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;|-ESTIMATION ALERT-|&quot;</span><span class="p">)</span>
</span><span id="CTD-782"><a href="#CTD-782"><span class="linenos"> 782</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Had to guess location on file: &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="CTD-783"><a href="#CTD-783"><span class="linenos"> 783</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unique ID: &quot;</span> <span class="o">+</span> <span class="n">unique_id</span><span class="p">)</span>
</span><span id="CTD-784"><a href="#CTD-784"><span class="linenos"> 784</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Closest Date (Year, Month, Day):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">closest_date_year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">closest_date_month</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="CTD-785"><a href="#CTD-785"><span class="linenos"> 785</span></a>            <span class="n">closest_date_day</span><span class="p">))</span>
</span><span id="CTD-786"><a href="#CTD-786"><span class="linenos"> 786</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Lat: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">latitude</span><span class="p">))</span>
</span><span id="CTD-787"><a href="#CTD-787"><span class="linenos"> 787</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Long: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">longitude</span><span class="p">))</span>
</span><span id="CTD-788"><a href="#CTD-788"><span class="linenos"> 788</span></a>        <span class="k">if</span> <span class="n">closest_time_time</span><span class="p">:</span>
</span><span id="CTD-789"><a href="#CTD-789"><span class="linenos"> 789</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Closest Time:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">closest_time_time</span><span class="p">))</span>
</span><span id="CTD-790"><a href="#CTD-790"><span class="linenos"> 790</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;====================&quot;</span><span class="p">)</span>
</span><span id="CTD-791"><a href="#CTD-791"><span class="linenos"> 791</span></a>        <span class="k">return</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">RBRfilename</span>
</span><span id="CTD-792"><a href="#CTD-792"><span class="linenos"> 792</span></a>
</span><span id="CTD-793"><a href="#CTD-793"><span class="linenos"> 793</span></a>    <span class="k">def</span> <span class="nf">get_sample_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rsk</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="CTD-794"><a href="#CTD-794"><span class="linenos"> 794</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-795"><a href="#CTD-795"><span class="linenos"> 795</span></a><span class="sd">        Retrieves the sample location data from the RSK file. If no location data is found,</span>
</span><span id="CTD-796"><a href="#CTD-796"><span class="linenos"> 796</span></a><span class="sd">        it attempts to estimate the location using the master sheet. Returns the latitude,</span>
</span><span id="CTD-797"><a href="#CTD-797"><span class="linenos"> 797</span></a><span class="sd">        longitude, and updated filename.</span>
</span><span id="CTD-798"><a href="#CTD-798"><span class="linenos"> 798</span></a>
</span><span id="CTD-799"><a href="#CTD-799"><span class="linenos"> 799</span></a><span class="sd">        Parameters</span>
</span><span id="CTD-800"><a href="#CTD-800"><span class="linenos"> 800</span></a><span class="sd">        ----------</span>
</span><span id="CTD-801"><a href="#CTD-801"><span class="linenos"> 801</span></a><span class="sd">        rsk : RSK</span>
</span><span id="CTD-802"><a href="#CTD-802"><span class="linenos"> 802</span></a><span class="sd">            Ruskin object of the RSK file.</span>
</span><span id="CTD-803"><a href="#CTD-803"><span class="linenos"> 803</span></a><span class="sd">        filename : str</span>
</span><span id="CTD-804"><a href="#CTD-804"><span class="linenos"> 804</span></a><span class="sd">            The filename of the RSK file.</span>
</span><span id="CTD-805"><a href="#CTD-805"><span class="linenos"> 805</span></a>
</span><span id="CTD-806"><a href="#CTD-806"><span class="linenos"> 806</span></a><span class="sd">        Returns</span>
</span><span id="CTD-807"><a href="#CTD-807"><span class="linenos"> 807</span></a><span class="sd">        -------</span>
</span><span id="CTD-808"><a href="#CTD-808"><span class="linenos"> 808</span></a><span class="sd">        tuple</span>
</span><span id="CTD-809"><a href="#CTD-809"><span class="linenos"> 809</span></a><span class="sd">            A tuple containing the latitude associated with the sample, longitude associated with the sample,</span>
</span><span id="CTD-810"><a href="#CTD-810"><span class="linenos"> 810</span></a><span class="sd">            and the filename, adds _gps if the location was in the ruskin file,</span>
</span><span id="CTD-811"><a href="#CTD-811"><span class="linenos"> 811</span></a><span class="sd">            _gpscm if located via mastersheet, or _gpserror if unable to locate.</span>
</span><span id="CTD-812"><a href="#CTD-812"><span class="linenos"> 812</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-813"><a href="#CTD-813"><span class="linenos"> 813</span></a>        <span class="c1"># Adding geo data, assumes no drift and uses the first lat long in the file if there is one</span>
</span><span id="CTD-814"><a href="#CTD-814"><span class="linenos"> 814</span></a>        <span class="n">geo_data_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">rsk</span><span class="o">.</span><span class="n">geodata</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)))</span>
</span><span id="CTD-815"><a href="#CTD-815"><span class="linenos"> 815</span></a>        <span class="k">if</span> <span class="n">geo_data_length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD-816"><a href="#CTD-816"><span class="linenos"> 816</span></a>            <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_master_sheet</span><span class="p">(</span>
</span><span id="CTD-817"><a href="#CTD-817"><span class="linenos"> 817</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="CTD-818"><a href="#CTD-818"><span class="linenos"> 818</span></a>            <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="CTD-819"><a href="#CTD-819"><span class="linenos"> 819</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-820"><a href="#CTD-820"><span class="linenos"> 820</span></a>            <span class="k">for</span> <span class="n">geo</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">rsk</span><span class="o">.</span><span class="n">geodata</span><span class="p">(),</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="CTD-821"><a href="#CTD-821"><span class="linenos"> 821</span></a>                <span class="c1"># Is there geo data?</span>
</span><span id="CTD-822"><a href="#CTD-822"><span class="linenos"> 822</span></a>                <span class="k">if</span> <span class="n">geo</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CTD-823"><a href="#CTD-823"><span class="linenos"> 823</span></a>                    <span class="c1"># If there is, is it from the southern ocean?</span>
</span><span id="CTD-824"><a href="#CTD-824"><span class="linenos"> 824</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">60</span><span class="p">):</span>
</span><span id="CTD-825"><a href="#CTD-825"><span class="linenos"> 825</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="CTD-826"><a href="#CTD-826"><span class="linenos"> 826</span></a>                            <span class="n">latitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-827"><a href="#CTD-827"><span class="linenos"> 827</span></a>                            <span class="n">longitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-828"><a href="#CTD-828"><span class="linenos"> 828</span></a>                            <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;_gps&quot;</span>
</span><span id="CTD-829"><a href="#CTD-829"><span class="linenos"> 829</span></a>                            <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="CTD-830"><a href="#CTD-830"><span class="linenos"> 830</span></a>                        <span class="k">except</span><span class="p">:</span>
</span><span id="CTD-831"><a href="#CTD-831"><span class="linenos"> 831</span></a>                            <span class="n">latitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">latitude</span>
</span><span id="CTD-832"><a href="#CTD-832"><span class="linenos"> 832</span></a>                            <span class="n">longitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">longitude</span>
</span><span id="CTD-833"><a href="#CTD-833"><span class="linenos"> 833</span></a>                            <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;_gps&quot;</span>
</span><span id="CTD-834"><a href="#CTD-834"><span class="linenos"> 834</span></a>                            <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="CTD-835"><a href="#CTD-835"><span class="linenos"> 835</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-836"><a href="#CTD-836"><span class="linenos"> 836</span></a>                        <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_master_sheet</span><span class="p">(</span>
</span><span id="CTD-837"><a href="#CTD-837"><span class="linenos"> 837</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="CTD-838"><a href="#CTD-838"><span class="linenos"> 838</span></a>                        <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="CTD-839"><a href="#CTD-839"><span class="linenos"> 839</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-840"><a href="#CTD-840"><span class="linenos"> 840</span></a>                    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;gpserror&#39;</span>
</span><span id="CTD-841"><a href="#CTD-841"><span class="linenos"> 841</span></a>
</span><span id="CTD-842"><a href="#CTD-842"><span class="linenos"> 842</span></a>    <span class="k">def</span> <span class="nf">clean_salinity_autoencoder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD-843"><a href="#CTD-843"><span class="linenos"> 843</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-844"><a href="#CTD-844"><span class="linenos"> 844</span></a><span class="sd">        Cleans salinity using an LSTM autoencoder ML model.</span>
</span><span id="CTD-845"><a href="#CTD-845"><span class="linenos"> 845</span></a><span class="sd">        Warning: This process will bin the data every 0.5 dbar of pressure.</span>
</span><span id="CTD-846"><a href="#CTD-846"><span class="linenos"> 846</span></a>
</span><span id="CTD-847"><a href="#CTD-847"><span class="linenos"> 847</span></a><span class="sd">        Returns</span>
</span><span id="CTD-848"><a href="#CTD-848"><span class="linenos"> 848</span></a><span class="sd">        -------</span>
</span><span id="CTD-849"><a href="#CTD-849"><span class="linenos"> 849</span></a><span class="sd">        DataFrame</span>
</span><span id="CTD-850"><a href="#CTD-850"><span class="linenos"> 850</span></a><span class="sd">            CTD data with clean salinity values.</span>
</span><span id="CTD-851"><a href="#CTD-851"><span class="linenos"> 851</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-852"><a href="#CTD-852"><span class="linenos"> 852</span></a>
</span><span id="CTD-853"><a href="#CTD-853"><span class="linenos"> 853</span></a>        <span class="k">def</span> <span class="nf">loss_function</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
</span><span id="CTD-854"><a href="#CTD-854"><span class="linenos"> 854</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-855"><a href="#CTD-855"><span class="linenos"> 855</span></a><span class="sd">            MAE loss with additional term to penalize salinity predictions that increase with pressure.</span>
</span><span id="CTD-856"><a href="#CTD-856"><span class="linenos"> 856</span></a>
</span><span id="CTD-857"><a href="#CTD-857"><span class="linenos"> 857</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-858"><a href="#CTD-858"><span class="linenos"> 858</span></a><span class="sd">            ----------</span>
</span><span id="CTD-859"><a href="#CTD-859"><span class="linenos"> 859</span></a><span class="sd">            y_true</span>
</span><span id="CTD-860"><a href="#CTD-860"><span class="linenos"> 860</span></a><span class="sd">                True salinity tensor.</span>
</span><span id="CTD-861"><a href="#CTD-861"><span class="linenos"> 861</span></a><span class="sd">            y_pred</span>
</span><span id="CTD-862"><a href="#CTD-862"><span class="linenos"> 862</span></a><span class="sd">                Predicted salinity tensor.</span>
</span><span id="CTD-863"><a href="#CTD-863"><span class="linenos"> 863</span></a><span class="sd">            Returns</span>
</span><span id="CTD-864"><a href="#CTD-864"><span class="linenos"> 864</span></a><span class="sd">            -------</span>
</span><span id="CTD-865"><a href="#CTD-865"><span class="linenos"> 865</span></a><span class="sd">            float</span>
</span><span id="CTD-866"><a href="#CTD-866"><span class="linenos"> 866</span></a><span class="sd">                Loss value.</span>
</span><span id="CTD-867"><a href="#CTD-867"><span class="linenos"> 867</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-868"><a href="#CTD-868"><span class="linenos"> 868</span></a>            <span class="c1"># Assuming salinity is at index 0</span>
</span><span id="CTD-869"><a href="#CTD-869"><span class="linenos"> 869</span></a>            <span class="n">salinity_true</span> <span class="o">=</span> <span class="n">y_true</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-870"><a href="#CTD-870"><span class="linenos"> 870</span></a>            <span class="n">salinity_pred</span> <span class="o">=</span> <span class="n">y_pred</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-871"><a href="#CTD-871"><span class="linenos"> 871</span></a>
</span><span id="CTD-872"><a href="#CTD-872"><span class="linenos"> 872</span></a>            <span class="c1"># Calculate differences between consecutive values</span>
</span><span id="CTD-873"><a href="#CTD-873"><span class="linenos"> 873</span></a>            <span class="n">delta_sal_true</span> <span class="o">=</span> <span class="n">salinity_true</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">salinity_true</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CTD-874"><a href="#CTD-874"><span class="linenos"> 874</span></a>            <span class="n">delta_sal_pred</span> <span class="o">=</span> <span class="n">salinity_pred</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">salinity_pred</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CTD-875"><a href="#CTD-875"><span class="linenos"> 875</span></a>
</span><span id="CTD-876"><a href="#CTD-876"><span class="linenos"> 876</span></a>            <span class="c1"># Penalize predictions where salinity decreases while pressure increases</span>
</span><span id="CTD-877"><a href="#CTD-877"><span class="linenos"> 877</span></a>            <span class="n">penalties</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta_sal_pred</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">tf</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">delta_sal_pred</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="CTD-878"><a href="#CTD-878"><span class="linenos"> 878</span></a>
</span><span id="CTD-879"><a href="#CTD-879"><span class="linenos"> 879</span></a>            <span class="c1"># Calculate mean absolute error</span>
</span><span id="CTD-880"><a href="#CTD-880"><span class="linenos"> 880</span></a>            <span class="n">mae</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">))</span>
</span><span id="CTD-881"><a href="#CTD-881"><span class="linenos"> 881</span></a>
</span><span id="CTD-882"><a href="#CTD-882"><span class="linenos"> 882</span></a>            <span class="c1"># Add penalties</span>
</span><span id="CTD-883"><a href="#CTD-883"><span class="linenos"> 883</span></a>            <span class="k">return</span> <span class="n">mae</span> <span class="o">+</span> <span class="mf">6.0</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">penalties</span><span class="p">)</span>  <span class="c1"># Adjust weighting of penalty as needed</span>
</span><span id="CTD-884"><a href="#CTD-884"><span class="linenos"> 884</span></a>
</span><span id="CTD-885"><a href="#CTD-885"><span class="linenos"> 885</span></a>        <span class="k">def</span> <span class="nf">build_lstm_autoencoder</span><span class="p">(</span><span class="n">input_shape</span><span class="p">):</span>
</span><span id="CTD-886"><a href="#CTD-886"><span class="linenos"> 886</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-887"><a href="#CTD-887"><span class="linenos"> 887</span></a><span class="sd">            LSTM autoencoder architecture.</span>
</span><span id="CTD-888"><a href="#CTD-888"><span class="linenos"> 888</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-889"><a href="#CTD-889"><span class="linenos"> 889</span></a>            <span class="c1"># Encoder</span>
</span><span id="CTD-890"><a href="#CTD-890"><span class="linenos"> 890</span></a>            <span class="n">encoder_inputs</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;encoder_inputs&#39;</span><span class="p">)</span>
</span><span id="CTD-891"><a href="#CTD-891"><span class="linenos"> 891</span></a>            <span class="n">encoder_lstm1</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD-892"><a href="#CTD-892"><span class="linenos"> 892</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">encoder_inputs</span><span class="p">)</span>
</span><span id="CTD-893"><a href="#CTD-893"><span class="linenos"> 893</span></a>            <span class="n">encoder_lstm2</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD-894"><a href="#CTD-894"><span class="linenos"> 894</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">encoder_lstm1</span><span class="p">)</span>
</span><span id="CTD-895"><a href="#CTD-895"><span class="linenos"> 895</span></a>            <span class="n">encoder_lstm3</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD-896"><a href="#CTD-896"><span class="linenos"> 896</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">encoder_lstm2</span><span class="p">)</span>
</span><span id="CTD-897"><a href="#CTD-897"><span class="linenos"> 897</span></a>            <span class="n">encoder_lstm4</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD-898"><a href="#CTD-898"><span class="linenos"> 898</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">encoder_lstm3</span><span class="p">)</span>
</span><span id="CTD-899"><a href="#CTD-899"><span class="linenos"> 899</span></a>            <span class="n">encoder_output</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)(</span><span class="n">encoder_lstm4</span><span class="p">)</span>
</span><span id="CTD-900"><a href="#CTD-900"><span class="linenos"> 900</span></a>
</span><span id="CTD-901"><a href="#CTD-901"><span class="linenos"> 901</span></a>            <span class="c1"># Decoder</span>
</span><span id="CTD-902"><a href="#CTD-902"><span class="linenos"> 902</span></a>            <span class="n">decoder_inputs</span> <span class="o">=</span> <span class="n">RepeatVector</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])(</span><span class="n">encoder_output</span><span class="p">)</span>
</span><span id="CTD-903"><a href="#CTD-903"><span class="linenos"> 903</span></a>            <span class="n">decoder_lstm1</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD-904"><a href="#CTD-904"><span class="linenos"> 904</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_inputs</span><span class="p">)</span>
</span><span id="CTD-905"><a href="#CTD-905"><span class="linenos"> 905</span></a>            <span class="n">decoder_lstm2</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD-906"><a href="#CTD-906"><span class="linenos"> 906</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_lstm1</span><span class="p">)</span>
</span><span id="CTD-907"><a href="#CTD-907"><span class="linenos"> 907</span></a>            <span class="n">decoder_lstm3</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD-908"><a href="#CTD-908"><span class="linenos"> 908</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_lstm2</span><span class="p">)</span>
</span><span id="CTD-909"><a href="#CTD-909"><span class="linenos"> 909</span></a>            <span class="n">decoder_lstm4</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD-910"><a href="#CTD-910"><span class="linenos"> 910</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_lstm3</span><span class="p">)</span>
</span><span id="CTD-911"><a href="#CTD-911"><span class="linenos"> 911</span></a>            <span class="n">decoder_output</span> <span class="o">=</span> <span class="n">TimeDistributed</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;decoded_output&#39;</span><span class="p">)(</span>
</span><span id="CTD-912"><a href="#CTD-912"><span class="linenos"> 912</span></a>                <span class="n">decoder_lstm4</span><span class="p">)</span>
</span><span id="CTD-913"><a href="#CTD-913"><span class="linenos"> 913</span></a>
</span><span id="CTD-914"><a href="#CTD-914"><span class="linenos"> 914</span></a>            <span class="n">autoencoder</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">encoder_inputs</span><span class="p">,</span> <span class="n">decoder_output</span><span class="p">)</span>
</span><span id="CTD-915"><a href="#CTD-915"><span class="linenos"> 915</span></a>            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
</span><span id="CTD-916"><a href="#CTD-916"><span class="linenos"> 916</span></a>            <span class="n">autoencoder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss_function</span><span class="p">)</span>
</span><span id="CTD-917"><a href="#CTD-917"><span class="linenos"> 917</span></a>            <span class="k">return</span> <span class="n">autoencoder</span>
</span><span id="CTD-918"><a href="#CTD-918"><span class="linenos"> 918</span></a>
</span><span id="CTD-919"><a href="#CTD-919"><span class="linenos"> 919</span></a>        <span class="k">def</span> <span class="nf">plot_original_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="CTD-920"><a href="#CTD-920"><span class="linenos"> 920</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-921"><a href="#CTD-921"><span class="linenos"> 921</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="CTD-922"><a href="#CTD-922"><span class="linenos"> 922</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="CTD-923"><a href="#CTD-923"><span class="linenos"> 923</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Salinity (PSU)&#39;</span><span class="p">)</span>
</span><span id="CTD-924"><a href="#CTD-924"><span class="linenos"> 924</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="CTD-925"><a href="#CTD-925"><span class="linenos"> 925</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original Salinity vs. Depth - </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="CTD-926"><a href="#CTD-926"><span class="linenos"> 926</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-927"><a href="#CTD-927"><span class="linenos"> 927</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;plots&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">_original.png&#39;</span><span class="p">))</span>
</span><span id="CTD-928"><a href="#CTD-928"><span class="linenos"> 928</span></a>            <span class="n">xlim</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()</span>
</span><span id="CTD-929"><a href="#CTD-929"><span class="linenos"> 929</span></a>            <span class="n">ylim</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
</span><span id="CTD-930"><a href="#CTD-930"><span class="linenos"> 930</span></a>            <span class="c1"># plt.show()</span>
</span><span id="CTD-931"><a href="#CTD-931"><span class="linenos"> 931</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="CTD-932"><a href="#CTD-932"><span class="linenos"> 932</span></a>            <span class="k">return</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span>
</span><span id="CTD-933"><a href="#CTD-933"><span class="linenos"> 933</span></a>
</span><span id="CTD-934"><a href="#CTD-934"><span class="linenos"> 934</span></a>        <span class="k">def</span> <span class="nf">plot_predicted_data</span><span class="p">(</span><span class="n">predicted_df</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">):</span>
</span><span id="CTD-935"><a href="#CTD-935"><span class="linenos"> 935</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">predicted_df</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-936"><a href="#CTD-936"><span class="linenos"> 936</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="CTD-937"><a href="#CTD-937"><span class="linenos"> 937</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">predicted_df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">predicted_df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="CTD-938"><a href="#CTD-938"><span class="linenos"> 938</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Predicted Salinity vs. Depth - </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="CTD-939"><a href="#CTD-939"><span class="linenos"> 939</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="CTD-940"><a href="#CTD-940"><span class="linenos"> 940</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Salinity (PSU)&#39;</span><span class="p">)</span>
</span><span id="CTD-941"><a href="#CTD-941"><span class="linenos"> 941</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="CTD-942"><a href="#CTD-942"><span class="linenos"> 942</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-943"><a href="#CTD-943"><span class="linenos"> 943</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
</span><span id="CTD-944"><a href="#CTD-944"><span class="linenos"> 944</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
</span><span id="CTD-945"><a href="#CTD-945"><span class="linenos"> 945</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;plots&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">_predicted.png&#39;</span><span class="p">))</span>
</span><span id="CTD-946"><a href="#CTD-946"><span class="linenos"> 946</span></a>            <span class="c1"># plt.show()</span>
</span><span id="CTD-947"><a href="#CTD-947"><span class="linenos"> 947</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="CTD-948"><a href="#CTD-948"><span class="linenos"> 948</span></a>
</span><span id="CTD-949"><a href="#CTD-949"><span class="linenos"> 949</span></a>        <span class="k">def</span> <span class="nf">run_autoencoder</span><span class="p">(</span><span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="CTD-950"><a href="#CTD-950"><span class="linenos"> 950</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-951"><a href="#CTD-951"><span class="linenos"> 951</span></a><span class="sd">            Runs the autoencoder.</span>
</span><span id="CTD-952"><a href="#CTD-952"><span class="linenos"> 952</span></a>
</span><span id="CTD-953"><a href="#CTD-953"><span class="linenos"> 953</span></a><span class="sd">            Returns</span>
</span><span id="CTD-954"><a href="#CTD-954"><span class="linenos"> 954</span></a><span class="sd">            -------</span>
</span><span id="CTD-955"><a href="#CTD-955"><span class="linenos"> 955</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD-956"><a href="#CTD-956"><span class="linenos"> 956</span></a><span class="sd">                CTD data with clean salinity values.</span>
</span><span id="CTD-957"><a href="#CTD-957"><span class="linenos"> 957</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-958"><a href="#CTD-958"><span class="linenos"> 958</span></a>            <span class="c1"># Preprocess data</span>
</span><span id="CTD-959"><a href="#CTD-959"><span class="linenos"> 959</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-960"><a href="#CTD-960"><span class="linenos"> 960</span></a>            <span class="c1"># Binning data</span>
</span><span id="CTD-961"><a href="#CTD-961"><span class="linenos"> 961</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="mf">0.25</span>
</span><span id="CTD-962"><a href="#CTD-962"><span class="linenos"> 962</span></a>            <span class="c1"># Define the desired columns and their aggregation functions</span>
</span><span id="CTD-963"><a href="#CTD-963"><span class="linenos"> 963</span></a>            <span class="n">column_agg_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CTD-964"><a href="#CTD-964"><span class="linenos"> 964</span></a>                <span class="s2">&quot;temperature_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD-965"><a href="#CTD-965"><span class="linenos"> 965</span></a>                <span class="s2">&quot;pressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span>
</span><span id="CTD-966"><a href="#CTD-966"><span class="linenos"> 966</span></a>                <span class="s2">&quot;chlorophyll_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD-967"><a href="#CTD-967"><span class="linenos"> 967</span></a>                <span class="s2">&quot;seapressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span>
</span><span id="CTD-968"><a href="#CTD-968"><span class="linenos"> 968</span></a>                <span class="s2">&quot;depth_00&quot;</span><span class="p">:</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span>
</span><span id="CTD-969"><a href="#CTD-969"><span class="linenos"> 969</span></a>                <span class="s2">&quot;salinity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD-970"><a href="#CTD-970"><span class="linenos"> 970</span></a>                <span class="s2">&quot;speedofsound_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD-971"><a href="#CTD-971"><span class="linenos"> 971</span></a>                <span class="s2">&quot;specificconductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD-972"><a href="#CTD-972"><span class="linenos"> 972</span></a>                <span class="s2">&quot;conductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD-973"><a href="#CTD-973"><span class="linenos"> 973</span></a>                <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD-974"><a href="#CTD-974"><span class="linenos"> 974</span></a>                <span class="s2">&quot;salinityabs&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD-975"><a href="#CTD-975"><span class="linenos"> 975</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD-976"><a href="#CTD-976"><span class="linenos"> 976</span></a>                <span class="s2">&quot;MLD_Zero&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD-977"><a href="#CTD-977"><span class="linenos"> 977</span></a>                <span class="s2">&quot;MLD_Ten&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD-978"><a href="#CTD-978"><span class="linenos"> 978</span></a>                <span class="s2">&quot;stratification&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD-979"><a href="#CTD-979"><span class="linenos"> 979</span></a>                <span class="s2">&quot;mean_surface_density&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD-980"><a href="#CTD-980"><span class="linenos"> 980</span></a>                <span class="s2">&quot;surface_salinity&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD-981"><a href="#CTD-981"><span class="linenos"> 981</span></a>                <span class="s2">&quot;surface_temperature&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD-982"><a href="#CTD-982"><span class="linenos"> 982</span></a>                <span class="s2">&quot;meltwater_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD-983"><a href="#CTD-983"><span class="linenos"> 983</span></a>                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD-984"><a href="#CTD-984"><span class="linenos"> 984</span></a>                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD-985"><a href="#CTD-985"><span class="linenos"> 985</span></a>                <span class="s2">&quot;overturn&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span>
</span><span id="CTD-986"><a href="#CTD-986"><span class="linenos"> 986</span></a>            <span class="p">}</span>
</span><span id="CTD-987"><a href="#CTD-987"><span class="linenos"> 987</span></a>            <span class="c1"># Check which columns are present in the DataFrame</span>
</span><span id="CTD-988"><a href="#CTD-988"><span class="linenos"> 988</span></a>            <span class="n">available_columns</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">agg_func</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">agg_func</span> <span class="ow">in</span> <span class="n">column_agg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</span><span id="CTD-989"><a href="#CTD-989"><span class="linenos"> 989</span></a>            <span class="c1"># Group by and aggregate based on the available columns</span>
</span><span id="CTD-990"><a href="#CTD-990"><span class="linenos"> 990</span></a>            <span class="n">data_binned</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">available_columns</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="CTD-991"><a href="#CTD-991"><span class="linenos"> 991</span></a>            <span class="c1"># Rename the Pressure_Bin column if it exists</span>
</span><span id="CTD-992"><a href="#CTD-992"><span class="linenos"> 992</span></a>            <span class="k">if</span> <span class="s1">&#39;Pressure_Bin&#39;</span> <span class="ow">in</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-993"><a href="#CTD-993"><span class="linenos"> 993</span></a>                <span class="n">data_binned</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">:</span> <span class="s1">&#39;pressure_00&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-994"><a href="#CTD-994"><span class="linenos"> 994</span></a>            <span class="c1"># Scaling data</span>
</span><span id="CTD-995"><a href="#CTD-995"><span class="linenos"> 995</span></a>            <span class="n">numerical_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span>
</span><span id="CTD-996"><a href="#CTD-996"><span class="linenos"> 996</span></a>            <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="CTD-997"><a href="#CTD-997"><span class="linenos"> 997</span></a>            <span class="n">scaled_sequence</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data_binned</span><span class="p">[</span><span class="n">numerical_columns</span><span class="p">])</span>
</span><span id="CTD-998"><a href="#CTD-998"><span class="linenos"> 998</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scaled_sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="CTD-999"><a href="#CTD-999"><span class="linenos"> 999</span></a>                <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s2">&quot;Not enough values to run the autoencoder on this data.&quot;</span><span class="p">)</span>
</span><span id="CTD-1000"><a href="#CTD-1000"><span class="linenos">1000</span></a>            <span class="n">scaled_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">scaled_sequence</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="CTD-1001"><a href="#CTD-1001"><span class="linenos">1001</span></a>            <span class="n">min_pres</span> <span class="o">=</span> <span class="n">data_binned</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="CTD-1002"><a href="#CTD-1002"><span class="linenos">1002</span></a>            <span class="n">max_pres</span> <span class="o">=</span> <span class="n">data_binned</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CTD-1003"><a href="#CTD-1003"><span class="linenos">1003</span></a>            <span class="c1"># Calculate ranges</span>
</span><span id="CTD-1004"><a href="#CTD-1004"><span class="linenos">1004</span></a>            <span class="n">pres_range</span> <span class="o">=</span> <span class="n">max_pres</span> <span class="o">-</span> <span class="n">min_pres</span>
</span><span id="CTD-1005"><a href="#CTD-1005"><span class="linenos">1005</span></a>            <span class="n">epochs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pres_range</span> <span class="o">*</span> <span class="mi">18</span><span class="p">)</span>
</span><span id="CTD-1006"><a href="#CTD-1006"><span class="linenos">1006</span></a>            <span class="c1"># Build autoencoder and predict on CTD data</span>
</span><span id="CTD-1007"><a href="#CTD-1007"><span class="linenos">1007</span></a>            <span class="n">autoencoder</span> <span class="o">=</span> <span class="n">build_lstm_autoencoder</span><span class="p">(</span><span class="n">scaled_seq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="CTD-1008"><a href="#CTD-1008"><span class="linenos">1008</span></a>            <span class="n">autoencoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scaled_seq</span><span class="p">,</span> <span class="n">scaled_seq</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="CTD-1009"><a href="#CTD-1009"><span class="linenos">1009</span></a>            <span class="n">X_pred</span> <span class="o">=</span> <span class="n">autoencoder</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaled_seq</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="CTD-1010"><a href="#CTD-1010"><span class="linenos">1010</span></a>            <span class="c1"># Revert scaling</span>
</span><span id="CTD-1011"><a href="#CTD-1011"><span class="linenos">1011</span></a>            <span class="n">predicted_seq</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">X_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="CTD-1012"><a href="#CTD-1012"><span class="linenos">1012</span></a>            <span class="n">data_binned</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predicted_seq</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-1013"><a href="#CTD-1013"><span class="linenos">1013</span></a>            <span class="k">if</span> <span class="n">show_plots</span><span class="p">:</span>
</span><span id="CTD-1014"><a href="#CTD-1014"><span class="linenos">1014</span></a>                <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="n">plot_original_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD-1015"><a href="#CTD-1015"><span class="linenos">1015</span></a>                <span class="n">plot_predicted_data</span><span class="p">(</span><span class="n">data_binned</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">)</span>
</span><span id="CTD-1016"><a href="#CTD-1016"><span class="linenos">1016</span></a>            <span class="n">data_binned</span> <span class="o">=</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">data_binned</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-1017"><a href="#CTD-1017"><span class="linenos">1017</span></a>            <span class="k">return</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">reindex</span><span class="p">()</span>
</span><span id="CTD-1018"><a href="#CTD-1018"><span class="linenos">1018</span></a>
</span><span id="CTD-1019"><a href="#CTD-1019"><span class="linenos">1019</span></a>        <span class="k">return</span> <span class="n">run_autoencoder</span><span class="p">()</span>
</span><span id="CTD-1020"><a href="#CTD-1020"><span class="linenos">1020</span></a>
</span><span id="CTD-1021"><a href="#CTD-1021"><span class="linenos">1021</span></a>    <span class="k">def</span> <span class="nf">save_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
</span><span id="CTD-1022"><a href="#CTD-1022"><span class="linenos">1022</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1023"><a href="#CTD-1023"><span class="linenos">1023</span></a><span class="sd">        Renames the columns of the CTD data table based on a predefined mapping and saves the</span>
</span><span id="CTD-1024"><a href="#CTD-1024"><span class="linenos">1024</span></a><span class="sd">        data to the specified CSV file. If the file already exists, the data is appended to it.</span>
</span><span id="CTD-1025"><a href="#CTD-1025"><span class="linenos">1025</span></a>
</span><span id="CTD-1026"><a href="#CTD-1026"><span class="linenos">1026</span></a><span class="sd">        Parameters</span>
</span><span id="CTD-1027"><a href="#CTD-1027"><span class="linenos">1027</span></a><span class="sd">        ----------</span>
</span><span id="CTD-1028"><a href="#CTD-1028"><span class="linenos">1028</span></a><span class="sd">        output_file : str</span>
</span><span id="CTD-1029"><a href="#CTD-1029"><span class="linenos">1029</span></a><span class="sd">            The output CSV file path.</span>
</span><span id="CTD-1030"><a href="#CTD-1030"><span class="linenos">1030</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-1031"><a href="#CTD-1031"><span class="linenos">1031</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">save_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">)</span>
</span><span id="CTD-1032"><a href="#CTD-1032"><span class="linenos">1032</span></a>
</span><span id="CTD-1033"><a href="#CTD-1033"><span class="linenos">1033</span></a>    <span class="k">class</span> <span class="nc">Utility</span><span class="p">:</span>
</span><span id="CTD-1034"><a href="#CTD-1034"><span class="linenos">1034</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1035"><a href="#CTD-1035"><span class="linenos">1035</span></a><span class="sd">        Utility</span>
</span><span id="CTD-1036"><a href="#CTD-1036"><span class="linenos">1036</span></a><span class="sd">        --------</span>
</span><span id="CTD-1037"><a href="#CTD-1037"><span class="linenos">1037</span></a><span class="sd">        Utility class for CTD data processing.</span>
</span><span id="CTD-1038"><a href="#CTD-1038"><span class="linenos">1038</span></a>
</span><span id="CTD-1039"><a href="#CTD-1039"><span class="linenos">1039</span></a><span class="sd">        Attributes</span>
</span><span id="CTD-1040"><a href="#CTD-1040"><span class="linenos">1040</span></a><span class="sd">        ----------</span>
</span><span id="CTD-1041"><a href="#CTD-1041"><span class="linenos">1041</span></a><span class="sd">        filename :  str</span>
</span><span id="CTD-1042"><a href="#CTD-1042"><span class="linenos">1042</span></a><span class="sd">            Filename of the RSK file.</span>
</span><span id="CTD-1043"><a href="#CTD-1043"><span class="linenos">1043</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD-1044"><a href="#CTD-1044"><span class="linenos">1044</span></a>
</span><span id="CTD-1045"><a href="#CTD-1045"><span class="linenos">1045</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="CTD-1046"><a href="#CTD-1046"><span class="linenos">1046</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1047"><a href="#CTD-1047"><span class="linenos">1047</span></a><span class="sd">            Initialize a new Utility object.</span>
</span><span id="CTD-1048"><a href="#CTD-1048"><span class="linenos">1048</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-1049"><a href="#CTD-1049"><span class="linenos">1049</span></a><span class="sd">            ----------</span>
</span><span id="CTD-1050"><a href="#CTD-1050"><span class="linenos">1050</span></a><span class="sd">            filename : str</span>
</span><span id="CTD-1051"><a href="#CTD-1051"><span class="linenos">1051</span></a><span class="sd">                The filename of the RSK file.</span>
</span><span id="CTD-1052"><a href="#CTD-1052"><span class="linenos">1052</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1053"><a href="#CTD-1053"><span class="linenos">1053</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="CTD-1054"><a href="#CTD-1054"><span class="linenos">1054</span></a>
</span><span id="CTD-1055"><a href="#CTD-1055"><span class="linenos">1055</span></a>        <span class="k">def</span> <span class="nf">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_to_check</span><span class="p">):</span>
</span><span id="CTD-1056"><a href="#CTD-1056"><span class="linenos">1056</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1057"><a href="#CTD-1057"><span class="linenos">1057</span></a><span class="sd">            Checks if the given object is None, empty, or has a length greater than 0.</span>
</span><span id="CTD-1058"><a href="#CTD-1058"><span class="linenos">1058</span></a><span class="sd">            Returns True if the object has no values, False otherwise.</span>
</span><span id="CTD-1059"><a href="#CTD-1059"><span class="linenos">1059</span></a>
</span><span id="CTD-1060"><a href="#CTD-1060"><span class="linenos">1060</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-1061"><a href="#CTD-1061"><span class="linenos">1061</span></a><span class="sd">            ----------</span>
</span><span id="CTD-1062"><a href="#CTD-1062"><span class="linenos">1062</span></a><span class="sd">            object_to_check : object</span>
</span><span id="CTD-1063"><a href="#CTD-1063"><span class="linenos">1063</span></a><span class="sd">                The object to check for values.</span>
</span><span id="CTD-1064"><a href="#CTD-1064"><span class="linenos">1064</span></a><span class="sd">            Returns</span>
</span><span id="CTD-1065"><a href="#CTD-1065"><span class="linenos">1065</span></a><span class="sd">            --------</span>
</span><span id="CTD-1066"><a href="#CTD-1066"><span class="linenos">1066</span></a><span class="sd">            bool</span>
</span><span id="CTD-1067"><a href="#CTD-1067"><span class="linenos">1067</span></a><span class="sd">                True if the object has no values, False otherwise.</span>
</span><span id="CTD-1068"><a href="#CTD-1068"><span class="linenos">1068</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1069"><a href="#CTD-1069"><span class="linenos">1069</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">object_to_check</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span id="CTD-1070"><a href="#CTD-1070"><span class="linenos">1070</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="CTD-1071"><a href="#CTD-1071"><span class="linenos">1071</span></a>            <span class="k">if</span> <span class="n">object_to_check</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CTD-1072"><a href="#CTD-1072"><span class="linenos">1072</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="CTD-1073"><a href="#CTD-1073"><span class="linenos">1073</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_to_check</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CTD-1074"><a href="#CTD-1074"><span class="linenos">1074</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="CTD-1075"><a href="#CTD-1075"><span class="linenos">1075</span></a>
</span><span id="CTD-1076"><a href="#CTD-1076"><span class="linenos">1076</span></a>        <span class="k">def</span> <span class="nf">remove_sample_timezone_indicator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1077"><a href="#CTD-1077"><span class="linenos">1077</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1078"><a href="#CTD-1078"><span class="linenos">1078</span></a><span class="sd">            Removes the timezone indicator (e.g., &#39;+00:00&#39;) from the &#39;timestamp&#39; column of the</span>
</span><span id="CTD-1079"><a href="#CTD-1079"><span class="linenos">1079</span></a><span class="sd">            given DataFrame. Returns the updated DataFrame.</span>
</span><span id="CTD-1080"><a href="#CTD-1080"><span class="linenos">1080</span></a>
</span><span id="CTD-1081"><a href="#CTD-1081"><span class="linenos">1081</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-1082"><a href="#CTD-1082"><span class="linenos">1082</span></a><span class="sd">            ----------</span>
</span><span id="CTD-1083"><a href="#CTD-1083"><span class="linenos">1083</span></a><span class="sd">            df : DataFrame</span>
</span><span id="CTD-1084"><a href="#CTD-1084"><span class="linenos">1084</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD-1085"><a href="#CTD-1085"><span class="linenos">1085</span></a>
</span><span id="CTD-1086"><a href="#CTD-1086"><span class="linenos">1086</span></a><span class="sd">            Returns</span>
</span><span id="CTD-1087"><a href="#CTD-1087"><span class="linenos">1087</span></a><span class="sd">            -------</span>
</span><span id="CTD-1088"><a href="#CTD-1088"><span class="linenos">1088</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD-1089"><a href="#CTD-1089"><span class="linenos">1089</span></a><span class="sd">                The updated DataFrame with the timezone indicator removed.</span>
</span><span id="CTD-1090"><a href="#CTD-1090"><span class="linenos">1090</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1091"><a href="#CTD-1091"><span class="linenos">1091</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1092"><a href="#CTD-1092"><span class="linenos">1092</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1093"><a href="#CTD-1093"><span class="linenos">1093</span></a>            <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-1094"><a href="#CTD-1094"><span class="linenos">1094</span></a>                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD-1095"><a href="#CTD-1095"><span class="linenos">1095</span></a>                <span class="k">return</span> <span class="n">df</span>
</span><span id="CTD-1096"><a href="#CTD-1096"><span class="linenos">1096</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-1097"><a href="#CTD-1097"><span class="linenos">1097</span></a>                <span class="k">return</span> <span class="n">df</span>
</span><span id="CTD-1098"><a href="#CTD-1098"><span class="linenos">1098</span></a>
</span><span id="CTD-1099"><a href="#CTD-1099"><span class="linenos">1099</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1100"><a href="#CTD-1100"><span class="linenos">1100</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1101"><a href="#CTD-1101"><span class="linenos">1101</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;depth_00&#39; column has negative values.</span>
</span><span id="CTD-1102"><a href="#CTD-1102"><span class="linenos">1102</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD-1103"><a href="#CTD-1103"><span class="linenos">1103</span></a>
</span><span id="CTD-1104"><a href="#CTD-1104"><span class="linenos">1104</span></a><span class="sd">            Parameter</span>
</span><span id="CTD-1105"><a href="#CTD-1105"><span class="linenos">1105</span></a><span class="sd">            ---------</span>
</span><span id="CTD-1106"><a href="#CTD-1106"><span class="linenos">1106</span></a><span class="sd">            df : DataFrame</span>
</span><span id="CTD-1107"><a href="#CTD-1107"><span class="linenos">1107</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD-1108"><a href="#CTD-1108"><span class="linenos">1108</span></a>
</span><span id="CTD-1109"><a href="#CTD-1109"><span class="linenos">1109</span></a><span class="sd">            Returns</span>
</span><span id="CTD-1110"><a href="#CTD-1110"><span class="linenos">1110</span></a><span class="sd">            -------</span>
</span><span id="CTD-1111"><a href="#CTD-1111"><span class="linenos">1111</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD-1112"><a href="#CTD-1112"><span class="linenos">1112</span></a><span class="sd">                The updated DataFrame with rows containing negative depth values removed.</span>
</span><span id="CTD-1113"><a href="#CTD-1113"><span class="linenos">1113</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1114"><a href="#CTD-1114"><span class="linenos">1114</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1115"><a href="#CTD-1115"><span class="linenos">1115</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1116"><a href="#CTD-1116"><span class="linenos">1116</span></a>            <span class="k">if</span> <span class="s1">&#39;depth_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-1117"><a href="#CTD-1117"><span class="linenos">1117</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-1118"><a href="#CTD-1118"><span class="linenos">1118</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-1119"><a href="#CTD-1119"><span class="linenos">1119</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1120"><a href="#CTD-1120"><span class="linenos">1120</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1121"><a href="#CTD-1121"><span class="linenos">1121</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1122"><a href="#CTD-1122"><span class="linenos">1122</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-1123"><a href="#CTD-1123"><span class="linenos">1123</span></a>
</span><span id="CTD-1124"><a href="#CTD-1124"><span class="linenos">1124</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1125"><a href="#CTD-1125"><span class="linenos">1125</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1126"><a href="#CTD-1126"><span class="linenos">1126</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;salinity_00&#39; column has negative values.</span>
</span><span id="CTD-1127"><a href="#CTD-1127"><span class="linenos">1127</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD-1128"><a href="#CTD-1128"><span class="linenos">1128</span></a>
</span><span id="CTD-1129"><a href="#CTD-1129"><span class="linenos">1129</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-1130"><a href="#CTD-1130"><span class="linenos">1130</span></a><span class="sd">            ----------</span>
</span><span id="CTD-1131"><a href="#CTD-1131"><span class="linenos">1131</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD-1132"><a href="#CTD-1132"><span class="linenos">1132</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD-1133"><a href="#CTD-1133"><span class="linenos">1133</span></a>
</span><span id="CTD-1134"><a href="#CTD-1134"><span class="linenos">1134</span></a><span class="sd">            Returns</span>
</span><span id="CTD-1135"><a href="#CTD-1135"><span class="linenos">1135</span></a><span class="sd">            -------</span>
</span><span id="CTD-1136"><a href="#CTD-1136"><span class="linenos">1136</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD-1137"><a href="#CTD-1137"><span class="linenos">1137</span></a><span class="sd">                The updated DataFrame with rows containing negative salinity values removed.</span>
</span><span id="CTD-1138"><a href="#CTD-1138"><span class="linenos">1138</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1139"><a href="#CTD-1139"><span class="linenos">1139</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1140"><a href="#CTD-1140"><span class="linenos">1140</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1141"><a href="#CTD-1141"><span class="linenos">1141</span></a>            <span class="k">if</span> <span class="s1">&#39;salinity_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-1142"><a href="#CTD-1142"><span class="linenos">1142</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-1143"><a href="#CTD-1143"><span class="linenos">1143</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-1144"><a href="#CTD-1144"><span class="linenos">1144</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1145"><a href="#CTD-1145"><span class="linenos">1145</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1146"><a href="#CTD-1146"><span class="linenos">1146</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1147"><a href="#CTD-1147"><span class="linenos">1147</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-1148"><a href="#CTD-1148"><span class="linenos">1148</span></a>
</span><span id="CTD-1149"><a href="#CTD-1149"><span class="linenos">1149</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_invalid_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1150"><a href="#CTD-1150"><span class="linenos">1150</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1151"><a href="#CTD-1151"><span class="linenos">1151</span></a><span class="sd">            Removes rows from the given DataFrame where the practical salinity column has values &lt; 10.</span>
</span><span id="CTD-1152"><a href="#CTD-1152"><span class="linenos">1152</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD-1153"><a href="#CTD-1153"><span class="linenos">1153</span></a>
</span><span id="CTD-1154"><a href="#CTD-1154"><span class="linenos">1154</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-1155"><a href="#CTD-1155"><span class="linenos">1155</span></a><span class="sd">            ----------</span>
</span><span id="CTD-1156"><a href="#CTD-1156"><span class="linenos">1156</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD-1157"><a href="#CTD-1157"><span class="linenos">1157</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD-1158"><a href="#CTD-1158"><span class="linenos">1158</span></a>
</span><span id="CTD-1159"><a href="#CTD-1159"><span class="linenos">1159</span></a><span class="sd">            Returns</span>
</span><span id="CTD-1160"><a href="#CTD-1160"><span class="linenos">1160</span></a><span class="sd">            -------</span>
</span><span id="CTD-1161"><a href="#CTD-1161"><span class="linenos">1161</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD-1162"><a href="#CTD-1162"><span class="linenos">1162</span></a><span class="sd">                The updated DataFrame with rows containing negative salinity values removed.</span>
</span><span id="CTD-1163"><a href="#CTD-1163"><span class="linenos">1163</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1164"><a href="#CTD-1164"><span class="linenos">1164</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1165"><a href="#CTD-1165"><span class="linenos">1165</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1166"><a href="#CTD-1166"><span class="linenos">1166</span></a>            <span class="k">if</span> <span class="s1">&#39;salinity_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-1167"><a href="#CTD-1167"><span class="linenos">1167</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-1168"><a href="#CTD-1168"><span class="linenos">1168</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-1169"><a href="#CTD-1169"><span class="linenos">1169</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1170"><a href="#CTD-1170"><span class="linenos">1170</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1171"><a href="#CTD-1171"><span class="linenos">1171</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1172"><a href="#CTD-1172"><span class="linenos">1172</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-1173"><a href="#CTD-1173"><span class="linenos">1173</span></a>
</span><span id="CTD-1174"><a href="#CTD-1174"><span class="linenos">1174</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1175"><a href="#CTD-1175"><span class="linenos">1175</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1176"><a href="#CTD-1176"><span class="linenos">1176</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;pressure_00&#39; column has negative values.</span>
</span><span id="CTD-1177"><a href="#CTD-1177"><span class="linenos">1177</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD-1178"><a href="#CTD-1178"><span class="linenos">1178</span></a>
</span><span id="CTD-1179"><a href="#CTD-1179"><span class="linenos">1179</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-1180"><a href="#CTD-1180"><span class="linenos">1180</span></a><span class="sd">            ----------</span>
</span><span id="CTD-1181"><a href="#CTD-1181"><span class="linenos">1181</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD-1182"><a href="#CTD-1182"><span class="linenos">1182</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD-1183"><a href="#CTD-1183"><span class="linenos">1183</span></a>
</span><span id="CTD-1184"><a href="#CTD-1184"><span class="linenos">1184</span></a><span class="sd">            Returns</span>
</span><span id="CTD-1185"><a href="#CTD-1185"><span class="linenos">1185</span></a><span class="sd">            -------</span>
</span><span id="CTD-1186"><a href="#CTD-1186"><span class="linenos">1186</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD-1187"><a href="#CTD-1187"><span class="linenos">1187</span></a><span class="sd">                The updated DataFrame with rows containing negative pressure values removed.</span>
</span><span id="CTD-1188"><a href="#CTD-1188"><span class="linenos">1188</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1189"><a href="#CTD-1189"><span class="linenos">1189</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1190"><a href="#CTD-1190"><span class="linenos">1190</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1191"><a href="#CTD-1191"><span class="linenos">1191</span></a>            <span class="k">if</span> <span class="s1">&#39;pressure_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-1192"><a href="#CTD-1192"><span class="linenos">1192</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-1193"><a href="#CTD-1193"><span class="linenos">1193</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-1194"><a href="#CTD-1194"><span class="linenos">1194</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1195"><a href="#CTD-1195"><span class="linenos">1195</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1196"><a href="#CTD-1196"><span class="linenos">1196</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1197"><a href="#CTD-1197"><span class="linenos">1197</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-1198"><a href="#CTD-1198"><span class="linenos">1198</span></a>
</span><span id="CTD-1199"><a href="#CTD-1199"><span class="linenos">1199</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_salinityabs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1200"><a href="#CTD-1200"><span class="linenos">1200</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1201"><a href="#CTD-1201"><span class="linenos">1201</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;salinityabs&#39; column has negative values.</span>
</span><span id="CTD-1202"><a href="#CTD-1202"><span class="linenos">1202</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD-1203"><a href="#CTD-1203"><span class="linenos">1203</span></a>
</span><span id="CTD-1204"><a href="#CTD-1204"><span class="linenos">1204</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-1205"><a href="#CTD-1205"><span class="linenos">1205</span></a><span class="sd">            ----------</span>
</span><span id="CTD-1206"><a href="#CTD-1206"><span class="linenos">1206</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD-1207"><a href="#CTD-1207"><span class="linenos">1207</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD-1208"><a href="#CTD-1208"><span class="linenos">1208</span></a>
</span><span id="CTD-1209"><a href="#CTD-1209"><span class="linenos">1209</span></a><span class="sd">            Returns</span>
</span><span id="CTD-1210"><a href="#CTD-1210"><span class="linenos">1210</span></a><span class="sd">            -------</span>
</span><span id="CTD-1211"><a href="#CTD-1211"><span class="linenos">1211</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD-1212"><a href="#CTD-1212"><span class="linenos">1212</span></a><span class="sd">                The updated DataFrame with rows containing negative absolute salinity values removed.</span>
</span><span id="CTD-1213"><a href="#CTD-1213"><span class="linenos">1213</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1214"><a href="#CTD-1214"><span class="linenos">1214</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1215"><a href="#CTD-1215"><span class="linenos">1215</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1216"><a href="#CTD-1216"><span class="linenos">1216</span></a>            <span class="k">if</span> <span class="s1">&#39;salinityabs&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-1217"><a href="#CTD-1217"><span class="linenos">1217</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinityabs&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-1218"><a href="#CTD-1218"><span class="linenos">1218</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-1219"><a href="#CTD-1219"><span class="linenos">1219</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1220"><a href="#CTD-1220"><span class="linenos">1220</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1221"><a href="#CTD-1221"><span class="linenos">1221</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1222"><a href="#CTD-1222"><span class="linenos">1222</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-1223"><a href="#CTD-1223"><span class="linenos">1223</span></a>
</span><span id="CTD-1224"><a href="#CTD-1224"><span class="linenos">1224</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1225"><a href="#CTD-1225"><span class="linenos">1225</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1226"><a href="#CTD-1226"><span class="linenos">1226</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;density&#39; column has negative values.</span>
</span><span id="CTD-1227"><a href="#CTD-1227"><span class="linenos">1227</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD-1228"><a href="#CTD-1228"><span class="linenos">1228</span></a>
</span><span id="CTD-1229"><a href="#CTD-1229"><span class="linenos">1229</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-1230"><a href="#CTD-1230"><span class="linenos">1230</span></a><span class="sd">            ----------</span>
</span><span id="CTD-1231"><a href="#CTD-1231"><span class="linenos">1231</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD-1232"><a href="#CTD-1232"><span class="linenos">1232</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD-1233"><a href="#CTD-1233"><span class="linenos">1233</span></a>
</span><span id="CTD-1234"><a href="#CTD-1234"><span class="linenos">1234</span></a><span class="sd">            Returns</span>
</span><span id="CTD-1235"><a href="#CTD-1235"><span class="linenos">1235</span></a><span class="sd">            -------</span>
</span><span id="CTD-1236"><a href="#CTD-1236"><span class="linenos">1236</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD-1237"><a href="#CTD-1237"><span class="linenos">1237</span></a><span class="sd">                The updated DataFrame with rows containing negative density values removed.</span>
</span><span id="CTD-1238"><a href="#CTD-1238"><span class="linenos">1238</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1239"><a href="#CTD-1239"><span class="linenos">1239</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1240"><a href="#CTD-1240"><span class="linenos">1240</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1241"><a href="#CTD-1241"><span class="linenos">1241</span></a>            <span class="k">if</span> <span class="s1">&#39;density&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD-1242"><a href="#CTD-1242"><span class="linenos">1242</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-1243"><a href="#CTD-1243"><span class="linenos">1243</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD-1244"><a href="#CTD-1244"><span class="linenos">1244</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1245"><a href="#CTD-1245"><span class="linenos">1245</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD-1246"><a href="#CTD-1246"><span class="linenos">1246</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD-1247"><a href="#CTD-1247"><span class="linenos">1247</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-1248"><a href="#CTD-1248"><span class="linenos">1248</span></a>
</span><span id="CTD-1249"><a href="#CTD-1249"><span class="linenos">1249</span></a>        <span class="nd">@staticmethod</span>
</span><span id="CTD-1250"><a href="#CTD-1250"><span class="linenos">1250</span></a>        <span class="k">def</span> <span class="nf">save_to_csv</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
</span><span id="CTD-1251"><a href="#CTD-1251"><span class="linenos">1251</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1252"><a href="#CTD-1252"><span class="linenos">1252</span></a><span class="sd">            Renames the columns of the CTD data table based on a predefined mapping and saves the</span>
</span><span id="CTD-1253"><a href="#CTD-1253"><span class="linenos">1253</span></a><span class="sd">            data to the specified CSV file. If the file already exists, the data is appended to it.</span>
</span><span id="CTD-1254"><a href="#CTD-1254"><span class="linenos">1254</span></a>
</span><span id="CTD-1255"><a href="#CTD-1255"><span class="linenos">1255</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-1256"><a href="#CTD-1256"><span class="linenos">1256</span></a><span class="sd">            ----------</span>
</span><span id="CTD-1257"><a href="#CTD-1257"><span class="linenos">1257</span></a><span class="sd">            input_df : DataFrame</span>
</span><span id="CTD-1258"><a href="#CTD-1258"><span class="linenos">1258</span></a><span class="sd">                The output CSV file path.</span>
</span><span id="CTD-1259"><a href="#CTD-1259"><span class="linenos">1259</span></a><span class="sd">            output_file : str</span>
</span><span id="CTD-1260"><a href="#CTD-1260"><span class="linenos">1260</span></a><span class="sd">                The output CSV file path.</span>
</span><span id="CTD-1261"><a href="#CTD-1261"><span class="linenos">1261</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1262"><a href="#CTD-1262"><span class="linenos">1262</span></a>            <span class="n">rsk_labels</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CTD-1263"><a href="#CTD-1263"><span class="linenos">1263</span></a>                <span class="s2">&quot;temperature_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Temperature_(°C)&quot;</span><span class="p">,</span>
</span><span id="CTD-1264"><a href="#CTD-1264"><span class="linenos">1264</span></a>                <span class="s2">&quot;pressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Pressure_(dbar)&quot;</span><span class="p">,</span>
</span><span id="CTD-1265"><a href="#CTD-1265"><span class="linenos">1265</span></a>                <span class="s2">&quot;chlorophyll_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Chlorophyll_a_(µg/l)&quot;</span><span class="p">,</span>
</span><span id="CTD-1266"><a href="#CTD-1266"><span class="linenos">1266</span></a>                <span class="s2">&quot;seapressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Sea Pressure_(dbar)&quot;</span><span class="p">,</span>
</span><span id="CTD-1267"><a href="#CTD-1267"><span class="linenos">1267</span></a>                <span class="s2">&quot;depth_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Depth_(m)&quot;</span><span class="p">,</span>
</span><span id="CTD-1268"><a href="#CTD-1268"><span class="linenos">1268</span></a>                <span class="s2">&quot;salinity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Salinity_(PSU)&quot;</span><span class="p">,</span>
</span><span id="CTD-1269"><a href="#CTD-1269"><span class="linenos">1269</span></a>                <span class="s2">&quot;speedofsound_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Speed of Sound_(m/s)&quot;</span><span class="p">,</span>
</span><span id="CTD-1270"><a href="#CTD-1270"><span class="linenos">1270</span></a>                <span class="s2">&quot;specificconductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Specific Conductivity_(µS/cm)&quot;</span><span class="p">,</span>
</span><span id="CTD-1271"><a href="#CTD-1271"><span class="linenos">1271</span></a>                <span class="s2">&quot;conductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Conductivity_(mS/cm)&quot;</span><span class="p">,</span>
</span><span id="CTD-1272"><a href="#CTD-1272"><span class="linenos">1272</span></a>                <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="s2">&quot;Density_(kg/m^3)&quot;</span><span class="p">,</span>
</span><span id="CTD-1273"><a href="#CTD-1273"><span class="linenos">1273</span></a>                <span class="s2">&quot;salinityabs&quot;</span><span class="p">:</span> <span class="s2">&quot;Absolute Salinity_(g/kg)&quot;</span><span class="p">,</span>
</span><span id="CTD-1274"><a href="#CTD-1274"><span class="linenos">1274</span></a>                <span class="s2">&quot;MLD_Zero&quot;</span><span class="p">:</span> <span class="s2">&quot;MLD Zero_(m)&quot;</span><span class="p">,</span>
</span><span id="CTD-1275"><a href="#CTD-1275"><span class="linenos">1275</span></a>                <span class="s2">&quot;MLD_Ten&quot;</span><span class="p">:</span> <span class="s2">&quot;MLD Ten_(m)&quot;</span><span class="p">,</span>
</span><span id="CTD-1276"><a href="#CTD-1276"><span class="linenos">1276</span></a>                <span class="s2">&quot;stratification&quot;</span><span class="p">:</span> <span class="s2">&quot;Stratification_(J/m^2)&quot;</span><span class="p">,</span>
</span><span id="CTD-1277"><a href="#CTD-1277"><span class="linenos">1277</span></a>                <span class="s2">&quot;mean_surface_density&quot;</span><span class="p">:</span> <span class="s2">&quot;Mean_Surface_Density_(kg/m^3)&quot;</span><span class="p">,</span>
</span><span id="CTD-1278"><a href="#CTD-1278"><span class="linenos">1278</span></a>                <span class="s2">&quot;surface_salinity&quot;</span><span class="p">:</span> <span class="s2">&quot;Surface_Salinity_(PSU)&quot;</span><span class="p">,</span>
</span><span id="CTD-1279"><a href="#CTD-1279"><span class="linenos">1279</span></a>                <span class="s2">&quot;surface_temperature&quot;</span><span class="p">:</span> <span class="s2">&quot;Surface_Temperature_(°C)&quot;</span><span class="p">,</span>
</span><span id="CTD-1280"><a href="#CTD-1280"><span class="linenos">1280</span></a>                <span class="s2">&quot;meltwater_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;Meltwater_Fraction_(%)&quot;</span><span class="p">,</span>
</span><span id="CTD-1281"><a href="#CTD-1281"><span class="linenos">1281</span></a>                <span class="s2">&quot;overturn&quot;</span><span class="p">:</span> <span class="s2">&quot;Overturn_(Δρ&lt;-0.05)&quot;</span>
</span><span id="CTD-1282"><a href="#CTD-1282"><span class="linenos">1282</span></a>            <span class="p">}</span>
</span><span id="CTD-1283"><a href="#CTD-1283"><span class="linenos">1283</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">input_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD-1284"><a href="#CTD-1284"><span class="linenos">1284</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rsk_labels</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-1285"><a href="#CTD-1285"><span class="linenos">1285</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-1286"><a href="#CTD-1286"><span class="linenos">1286</span></a>            <span class="c1"># Handle CSV file reading and merging</span>
</span><span id="CTD-1287"><a href="#CTD-1287"><span class="linenos">1287</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CTD-1288"><a href="#CTD-1288"><span class="linenos">1288</span></a>                <span class="n">csv_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</span><span id="CTD-1289"><a href="#CTD-1289"><span class="linenos">1289</span></a>                <span class="n">csv_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-1290"><a href="#CTD-1290"><span class="linenos">1290</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="CTD-1291"><a href="#CTD-1291"><span class="linenos">1291</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2"> does not exist. A new file will be created.&quot;</span><span class="p">)</span>
</span><span id="CTD-1292"><a href="#CTD-1292"><span class="linenos">1292</span></a>                <span class="n">csv_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="CTD-1293"><a href="#CTD-1293"><span class="linenos">1293</span></a>
</span><span id="CTD-1294"><a href="#CTD-1294"><span class="linenos">1294</span></a>            <span class="c1"># Merge the existing DataFrame with the new DataFrame</span>
</span><span id="CTD-1295"><a href="#CTD-1295"><span class="linenos">1295</span></a>            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">csv_df</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD-1296"><a href="#CTD-1296"><span class="linenos">1296</span></a>            <span class="c1"># Overwrite the original CSV file with the merged DataFrame</span>
</span><span id="CTD-1297"><a href="#CTD-1297"><span class="linenos">1297</span></a>            <span class="n">merged_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CTD-1298"><a href="#CTD-1298"><span class="linenos">1298</span></a>
</span><span id="CTD-1299"><a href="#CTD-1299"><span class="linenos">1299</span></a>        <span class="nd">@staticmethod</span>
</span><span id="CTD-1300"><a href="#CTD-1300"><span class="linenos">1300</span></a>        <span class="k">def</span> <span class="nf">extract_utc_cast_time</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">):</span>
</span><span id="CTD-1301"><a href="#CTD-1301"><span class="linenos">1301</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1302"><a href="#CTD-1302"><span class="linenos">1302</span></a><span class="sd">            Function to extract the UTC cast time from a castaway file and convert it to ISO 8601 format.</span>
</span><span id="CTD-1303"><a href="#CTD-1303"><span class="linenos">1303</span></a>
</span><span id="CTD-1304"><a href="#CTD-1304"><span class="linenos">1304</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-1305"><a href="#CTD-1305"><span class="linenos">1305</span></a><span class="sd">            ----------</span>
</span><span id="CTD-1306"><a href="#CTD-1306"><span class="linenos">1306</span></a><span class="sd">            ctdfilepath : str</span>
</span><span id="CTD-1307"><a href="#CTD-1307"><span class="linenos">1307</span></a><span class="sd">                The file path of the castaway file to extract the time from.</span>
</span><span id="CTD-1308"><a href="#CTD-1308"><span class="linenos">1308</span></a>
</span><span id="CTD-1309"><a href="#CTD-1309"><span class="linenos">1309</span></a><span class="sd">            Returns</span>
</span><span id="CTD-1310"><a href="#CTD-1310"><span class="linenos">1310</span></a><span class="sd">            -------</span>
</span><span id="CTD-1311"><a href="#CTD-1311"><span class="linenos">1311</span></a><span class="sd">            str</span>
</span><span id="CTD-1312"><a href="#CTD-1312"><span class="linenos">1312</span></a><span class="sd">                Cast time (UTC) of the castaway file in ISO 8601 format.</span>
</span><span id="CTD-1313"><a href="#CTD-1313"><span class="linenos">1313</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1314"><a href="#CTD-1314"><span class="linenos">1314</span></a>            <span class="c1"># Initialize variable to store UTC cast time</span>
</span><span id="CTD-1315"><a href="#CTD-1315"><span class="linenos">1315</span></a>            <span class="n">cast_time_utc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-1316"><a href="#CTD-1316"><span class="linenos">1316</span></a>            <span class="c1"># Open the file and read line by line</span>
</span><span id="CTD-1317"><a href="#CTD-1317"><span class="linenos">1317</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD-1318"><a href="#CTD-1318"><span class="linenos">1318</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD-1319"><a href="#CTD-1319"><span class="linenos">1319</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Cast time (UTC)&#39;</span><span class="p">):</span>
</span><span id="CTD-1320"><a href="#CTD-1320"><span class="linenos">1320</span></a>                        <span class="c1"># Extract the UTC cast time after the comma</span>
</span><span id="CTD-1321"><a href="#CTD-1321"><span class="linenos">1321</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="CTD-1322"><a href="#CTD-1322"><span class="linenos">1322</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD-1323"><a href="#CTD-1323"><span class="linenos">1323</span></a>                            <span class="n">cast_time_str</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Take only the datetime part</span>
</span><span id="CTD-1324"><a href="#CTD-1324"><span class="linenos">1324</span></a>                            <span class="c1"># Convert the datetime string to ISO format if possible</span>
</span><span id="CTD-1325"><a href="#CTD-1325"><span class="linenos">1325</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="CTD-1326"><a href="#CTD-1326"><span class="linenos">1326</span></a>                                <span class="n">cast_time_utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">cast_time_str</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="CTD-1327"><a href="#CTD-1327"><span class="linenos">1327</span></a>                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="CTD-1328"><a href="#CTD-1328"><span class="linenos">1328</span></a>                                <span class="c1"># Handle the case where date format does not match expected format</span>
</span><span id="CTD-1329"><a href="#CTD-1329"><span class="linenos">1329</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Date format does not match expected &#39;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#39;&quot;</span><span class="p">)</span>
</span><span id="CTD-1330"><a href="#CTD-1330"><span class="linenos">1330</span></a>                            <span class="k">break</span>  <span class="c1"># Stop reading once the timestamp is found</span>
</span><span id="CTD-1331"><a href="#CTD-1331"><span class="linenos">1331</span></a>
</span><span id="CTD-1332"><a href="#CTD-1332"><span class="linenos">1332</span></a>            <span class="k">return</span> <span class="n">cast_time_utc</span>
</span><span id="CTD-1333"><a href="#CTD-1333"><span class="linenos">1333</span></a>
</span><span id="CTD-1334"><a href="#CTD-1334"><span class="linenos">1334</span></a>        <span class="nd">@staticmethod</span>
</span><span id="CTD-1335"><a href="#CTD-1335"><span class="linenos">1335</span></a>        <span class="k">def</span> <span class="nf">extract_lat_long_castaway</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">):</span>
</span><span id="CTD-1336"><a href="#CTD-1336"><span class="linenos">1336</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD-1337"><a href="#CTD-1337"><span class="linenos">1337</span></a><span class="sd">            Function extract start lat/long from castaway file.</span>
</span><span id="CTD-1338"><a href="#CTD-1338"><span class="linenos">1338</span></a>
</span><span id="CTD-1339"><a href="#CTD-1339"><span class="linenos">1339</span></a><span class="sd">            Parameters</span>
</span><span id="CTD-1340"><a href="#CTD-1340"><span class="linenos">1340</span></a><span class="sd">            ----------</span>
</span><span id="CTD-1341"><a href="#CTD-1341"><span class="linenos">1341</span></a><span class="sd">            ctdfilepath : str</span>
</span><span id="CTD-1342"><a href="#CTD-1342"><span class="linenos">1342</span></a><span class="sd">                Filepath to castaway ctd file.</span>
</span><span id="CTD-1343"><a href="#CTD-1343"><span class="linenos">1343</span></a>
</span><span id="CTD-1344"><a href="#CTD-1344"><span class="linenos">1344</span></a><span class="sd">            Returns</span>
</span><span id="CTD-1345"><a href="#CTD-1345"><span class="linenos">1345</span></a><span class="sd">            -------</span>
</span><span id="CTD-1346"><a href="#CTD-1346"><span class="linenos">1346</span></a><span class="sd">            tuple</span>
</span><span id="CTD-1347"><a href="#CTD-1347"><span class="linenos">1347</span></a><span class="sd">                (latitude, longitude)</span>
</span><span id="CTD-1348"><a href="#CTD-1348"><span class="linenos">1348</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD-1349"><a href="#CTD-1349"><span class="linenos">1349</span></a>            <span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-1350"><a href="#CTD-1350"><span class="linenos">1350</span></a>            <span class="n">longitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD-1351"><a href="#CTD-1351"><span class="linenos">1351</span></a>            <span class="c1"># Open the file and read line by line</span>
</span><span id="CTD-1352"><a href="#CTD-1352"><span class="linenos">1352</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD-1353"><a href="#CTD-1353"><span class="linenos">1353</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD-1354"><a href="#CTD-1354"><span class="linenos">1354</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Start latitude&#39;</span><span class="p">):</span>
</span><span id="CTD-1355"><a href="#CTD-1355"><span class="linenos">1355</span></a>                        <span class="c1"># Assume the format is &#39;% description, latitude&#39;</span>
</span><span id="CTD-1356"><a href="#CTD-1356"><span class="linenos">1356</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="CTD-1357"><a href="#CTD-1357"><span class="linenos">1357</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD-1358"><a href="#CTD-1358"><span class="linenos">1358</span></a>                            <span class="n">latitude</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="CTD-1359"><a href="#CTD-1359"><span class="linenos">1359</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Start longitude&#39;</span><span class="p">):</span>
</span><span id="CTD-1360"><a href="#CTD-1360"><span class="linenos">1360</span></a>                        <span class="c1"># Assume the format is &#39;% description, longitude&#39;</span>
</span><span id="CTD-1361"><a href="#CTD-1361"><span class="linenos">1361</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="CTD-1362"><a href="#CTD-1362"><span class="linenos">1362</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD-1363"><a href="#CTD-1363"><span class="linenos">1363</span></a>                            <span class="n">longitude</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="CTD-1364"><a href="#CTD-1364"><span class="linenos">1364</span></a>
</span><span id="CTD-1365"><a href="#CTD-1365"><span class="linenos">1365</span></a>            <span class="k">return</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span>
</span></pre></div>


            <div class="docstring"><h6 id="ctd">CTD</h6>

<p>Class representing a CTD object for processing and analyzing CTD data.</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>master_sheet_path</strong> (str):
Path to the mastersheet.</li>
</ul>

<h6 id="usage">Usage</h6>

<p>To create a CTD object for custom pipelines use the following method:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span> <span class="o">=</span> <span class="n">CTD</span><span class="p">(</span><span class="s2">&quot;example.rsk&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>You can then run a CTD command on it like removing non-postive sample rows and then viewing your table</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span><span class="o">.</span><span class="n">remove_non_positive_samples</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span><span class="o">.</span><span class="n">view_table</span><span class="p">()</span>
</code></pre>
</div>

<h6 id="notes">Notes</h6>

<ul>
<li>Filenames must match a correct date, or else in instances where the mastersheet
must be consulted CTDFjorder will return an error.</li>
</ul>
</div>


                            <div id="CTD.__init__" class="classattr">
                                        <input id="CTD.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CTD</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">ctdfilepath</span>,</span><span class="param">	<span class="n">cached_master_sheet</span><span class="o">=</span><span class="n">Empty</span> <span class="n">DataFrame</span>
<span class="n">Columns</span><span class="p">:</span> <span class="p">[]</span>
<span class="n">Index</span><span class="p">:</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">master_sheet_path</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="CTD.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.__init__-95"><a href="#CTD.__init__-95"><span class="linenos"> 95</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctdfilepath</span><span class="p">,</span> <span class="n">cached_master_sheet</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="n">master_sheet_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="CTD.__init__-96"><a href="#CTD.__init__-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.__init__-97"><a href="#CTD.__init__-97"><span class="linenos"> 97</span></a><span class="sd">        Initialize a new CTD object.</span>
</span><span id="CTD.__init__-98"><a href="#CTD.__init__-98"><span class="linenos"> 98</span></a>
</span><span id="CTD.__init__-99"><a href="#CTD.__init__-99"><span class="linenos"> 99</span></a><span class="sd">        Parameters</span>
</span><span id="CTD.__init__-100"><a href="#CTD.__init__-100"><span class="linenos">100</span></a><span class="sd">        ----------</span>
</span><span id="CTD.__init__-101"><a href="#CTD.__init__-101"><span class="linenos">101</span></a><span class="sd">        ctdfilepath : str</span>
</span><span id="CTD.__init__-102"><a href="#CTD.__init__-102"><span class="linenos">102</span></a><span class="sd">            The file path to the RSK or Castaway file.</span>
</span><span id="CTD.__init__-103"><a href="#CTD.__init__-103"><span class="linenos">103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.__init__-104"><a href="#CTD.__init__-104"><span class="linenos">104</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_master_sheet</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CTD.__init__-105"><a href="#CTD.__init__-105"><span class="linenos">105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span> <span class="o">=</span> <span class="n">cached_master_sheet</span>
</span><span id="CTD.__init__-106"><a href="#CTD.__init__-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="s2">&quot;rsk&quot;</span> <span class="ow">in</span> <span class="n">ctdfilepath</span><span class="p">:</span>
</span><span id="CTD.__init__-107"><a href="#CTD.__init__-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rsk_file_flag</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="CTD.__init__-108"><a href="#CTD.__init__-108"><span class="linenos">108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span> <span class="o">=</span> <span class="n">RSK</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">)</span>
</span><span id="CTD.__init__-109"><a href="#CTD.__init__-109"><span class="linenos">109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.rsk&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="CTD.__init__-110"><a href="#CTD.__init__-110"><span class="linenos">110</span></a>            <span class="n">num_profiles</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">profiles</span><span class="p">())</span>
</span><span id="CTD.__init__-111"><a href="#CTD.__init__-111"><span class="linenos">111</span></a>            <span class="n">rsk_downcast_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">casts</span><span class="p">(</span><span class="n">Region</span><span class="o">.</span><span class="n">CAST_DOWN</span><span class="p">)</span>
</span><span id="CTD.__init__-112"><a href="#CTD.__init__-112"><span class="linenos">112</span></a>            <span class="k">if</span> <span class="n">num_profiles</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD.__init__-113"><a href="#CTD.__init__-113"><span class="linenos">113</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">npsamples</span><span class="p">())</span>
</span><span id="CTD.__init__-114"><a href="#CTD.__init__-114"><span class="linenos">114</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.__init__-115"><a href="#CTD.__init__-115"><span class="linenos">115</span></a>                <span class="n">region</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rsk_downcast_times</span><span class="p">)</span>
</span><span id="CTD.__init__-116"><a href="#CTD.__init__-116"><span class="linenos">116</span></a>                <span class="n">start_time</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">start_time</span>
</span><span id="CTD.__init__-117"><a href="#CTD.__init__-117"><span class="linenos">117</span></a>                <span class="n">end_time</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">end_time</span>
</span><span id="CTD.__init__-118"><a href="#CTD.__init__-118"><span class="linenos">118</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="CTD.__init__-119"><a href="#CTD.__init__-119"><span class="linenos">119</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="o">.</span><span class="n">npsamples</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">))</span>
</span><span id="CTD.__init__-120"><a href="#CTD.__init__-120"><span class="linenos">120</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="CTD.__init__-121"><a href="#CTD.__init__-121"><span class="linenos">121</span></a>                    <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s2">&quot;No downcasts in file.&quot;</span><span class="p">)</span>
</span><span id="CTD.__init__-122"><a href="#CTD.__init__-122"><span class="linenos">122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.__init__-123"><a href="#CTD.__init__-123"><span class="linenos">123</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_original_profile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.__init__-124"><a href="#CTD.__init__-124"><span class="linenos">124</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.__init__-125"><a href="#CTD.__init__-125"><span class="linenos">125</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_rsk_file_flag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="CTD.__init__-126"><a href="#CTD.__init__-126"><span class="linenos">126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="CTD.__init__-127"><a href="#CTD.__init__-127"><span class="linenos">127</span></a>            <span class="n">utc_cast_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">extract_utc_cast_time</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">=</span><span class="n">ctdfilepath</span><span class="p">)</span>
</span><span id="CTD.__init__-128"><a href="#CTD.__init__-128"><span class="linenos">128</span></a>            <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">extract_lat_long_castaway</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="o">=</span><span class="n">ctdfilepath</span><span class="p">)</span>
</span><span id="CTD.__init__-129"><a href="#CTD.__init__-129"><span class="linenos">129</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CTD.__init__-130"><a href="#CTD.__init__-130"><span class="linenos">130</span></a>                <span class="n">latitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>
</span><span id="CTD.__init__-131"><a href="#CTD.__init__-131"><span class="linenos">131</span></a>                <span class="n">longitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span>
</span><span id="CTD.__init__-132"><a href="#CTD.__init__-132"><span class="linenos">132</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="CTD.__init__-133"><a href="#CTD.__init__-133"><span class="linenos">133</span></a>                <span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.__init__-134"><a href="#CTD.__init__-134"><span class="linenos">134</span></a>                <span class="n">longitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.__init__-135"><a href="#CTD.__init__-135"><span class="linenos">135</span></a>            <span class="c1"># Convert UTC cast time to datetime and create timestamp column</span>
</span><span id="CTD.__init__-136"><a href="#CTD.__init__-136"><span class="linenos">136</span></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">utc_cast_time</span><span class="p">)</span>
</span><span id="CTD.__init__-137"><a href="#CTD.__init__-137"><span class="linenos">137</span></a>            <span class="c1"># Calculate the time increments for each row</span>
</span><span id="CTD.__init__-138"><a href="#CTD.__init__-138"><span class="linenos">138</span></a>            <span class="n">pd_csv_castaway</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
</span><span id="CTD.__init__-139"><a href="#CTD.__init__-139"><span class="linenos">139</span></a>            <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pd_csv_castaway</span><span class="p">))]</span>
</span><span id="CTD.__init__-140"><a href="#CTD.__init__-140"><span class="linenos">140</span></a>            <span class="n">header_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CTD.__init__-141"><a href="#CTD.__init__-141"><span class="linenos">141</span></a>                <span class="s2">&quot;Pressure (Decibar)&quot;</span><span class="p">:</span> <span class="s2">&quot;seapressure_00&quot;</span><span class="p">,</span>
</span><span id="CTD.__init__-142"><a href="#CTD.__init__-142"><span class="linenos">142</span></a>                <span class="s2">&quot;Depth (Meter)&quot;</span><span class="p">:</span> <span class="s2">&quot;depth_00&quot;</span><span class="p">,</span>
</span><span id="CTD.__init__-143"><a href="#CTD.__init__-143"><span class="linenos">143</span></a>                <span class="s2">&quot;Temperature (Celsius)&quot;</span><span class="p">:</span> <span class="s2">&quot;temperature_00&quot;</span><span class="p">,</span>
</span><span id="CTD.__init__-144"><a href="#CTD.__init__-144"><span class="linenos">144</span></a>                <span class="s2">&quot;Conductivity (MicroSiemens per Centimeter)&quot;</span><span class="p">:</span> <span class="s2">&quot;conductivity_00&quot;</span><span class="p">,</span>
</span><span id="CTD.__init__-145"><a href="#CTD.__init__-145"><span class="linenos">145</span></a>                <span class="s2">&quot;Specific conductance (MicroSiemens per Centimeter)&quot;</span><span class="p">:</span> <span class="s2">&quot;specificconductivity_00&quot;</span><span class="p">,</span>
</span><span id="CTD.__init__-146"><a href="#CTD.__init__-146"><span class="linenos">146</span></a>                <span class="s2">&quot;Salinity (Practical Salinity Scale)&quot;</span><span class="p">:</span> <span class="s2">&quot;salinity_00&quot;</span><span class="p">,</span>
</span><span id="CTD.__init__-147"><a href="#CTD.__init__-147"><span class="linenos">147</span></a>                <span class="s2">&quot;Sound velocity (Meters per Second)&quot;</span><span class="p">:</span> <span class="s2">&quot;speedofsound_00&quot;</span><span class="p">,</span>
</span><span id="CTD.__init__-148"><a href="#CTD.__init__-148"><span class="linenos">148</span></a>                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
</span><span id="CTD.__init__-149"><a href="#CTD.__init__-149"><span class="linenos">149</span></a>                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span>
</span><span id="CTD.__init__-150"><a href="#CTD.__init__-150"><span class="linenos">150</span></a>            <span class="p">}</span>
</span><span id="CTD.__init__-151"><a href="#CTD.__init__-151"><span class="linenos">151</span></a>            <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">header_mapping</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.__init__-152"><a href="#CTD.__init__-152"><span class="linenos">152</span></a>            <span class="c1"># Insert the timestamp column as the first column</span>
</span><span id="CTD.__init__-153"><a href="#CTD.__init__-153"><span class="linenos">153</span></a>            <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;seapressure_00&#39;</span><span class="p">]</span>
</span><span id="CTD.__init__-154"><a href="#CTD.__init__-154"><span class="linenos">154</span></a>            <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">10</span>
</span><span id="CTD.__init__-155"><a href="#CTD.__init__-155"><span class="linenos">155</span></a>            <span class="n">pd_csv_castaway</span><span class="p">[</span><span class="s1">&#39;conductivity_00&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">1000</span>
</span><span id="CTD.__init__-156"><a href="#CTD.__init__-156"><span class="linenos">156</span></a>            <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">)</span>
</span><span id="CTD.__init__-157"><a href="#CTD.__init__-157"><span class="linenos">157</span></a>            <span class="n">pd_csv_castaway</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">)</span>
</span><span id="CTD.__init__-158"><a href="#CTD.__init__-158"><span class="linenos">158</span></a>            <span class="n">pd_csv_castaway</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span><span class="p">)</span>
</span><span id="CTD.__init__-159"><a href="#CTD.__init__-159"><span class="linenos">159</span></a>            <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Density (Kilograms per Cubic Meter)&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.__init__-160"><a href="#CTD.__init__-160"><span class="linenos">160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span>
</span><span id="CTD.__init__-161"><a href="#CTD.__init__-161"><span class="linenos">161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_original_profile</span> <span class="o">=</span> <span class="n">pd_csv_castaway</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.__init__-162"><a href="#CTD.__init__-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="CTD.__init__-163"><a href="#CTD.__init__-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span> <span class="o">=</span> <span class="n">_get_cwd</span><span class="p">()</span>
</span><span id="CTD.__init__-164"><a href="#CTD.__init__-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span> <span class="o">=</span> <span class="n">master_sheet_path</span>
</span><span id="CTD.__init__-165"><a href="#CTD.__init__-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_master_sheet</span><span class="o">=</span><span class="n">cached_master_sheet</span>
</span><span id="CTD.__init__-166"><a href="#CTD.__init__-166"><span class="linenos">166</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;New CTD Object Created from : &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a new CTD object.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ctdfilepath</strong> (str):
The file path to the RSK or Castaway file.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.find_master_sheet_file" class="classattr">
                                        <input id="CTD.find_master_sheet_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_master_sheet_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.find_master_sheet_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.find_master_sheet_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.find_master_sheet_file-168"><a href="#CTD.find_master_sheet_file-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">find_master_sheet_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.find_master_sheet_file-169"><a href="#CTD.find_master_sheet_file-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.find_master_sheet_file-170"><a href="#CTD.find_master_sheet_file-170"><span class="linenos">170</span></a><span class="sd">        Function to find and the master sheet path. Uses the first xlsx file in the current working directory.</span>
</span><span id="CTD.find_master_sheet_file-171"><a href="#CTD.find_master_sheet_file-171"><span class="linenos">171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.find_master_sheet_file-172"><a href="#CTD.find_master_sheet_file-172"><span class="linenos">172</span></a>        <span class="n">cwd</span> <span class="o">=</span> <span class="n">_get_cwd</span><span class="p">()</span>
</span><span id="CTD.find_master_sheet_file-173"><a href="#CTD.find_master_sheet_file-173"><span class="linenos">173</span></a>        <span class="n">xlsx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xlsx&quot;</span><span class="p">)]</span>
</span><span id="CTD.find_master_sheet_file-174"><a href="#CTD.find_master_sheet_file-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlsx_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CTD.find_master_sheet_file-175"><a href="#CTD.find_master_sheet_file-175"><span class="linenos">175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">xlsx_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Function to find and the master sheet path. Uses the first xlsx file in the current working directory.</p>
</div>


                            </div>
                            <div id="CTD.view_table" class="classattr">
                                        <input id="CTD.view_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">view_table</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.view_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.view_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.view_table-177"><a href="#CTD.view_table-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="nf">view_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.view_table-178"><a href="#CTD.view_table-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.view_table-179"><a href="#CTD.view_table-179"><span class="linenos">179</span></a><span class="sd">        Print the CTD data table.</span>
</span><span id="CTD.view_table-180"><a href="#CTD.view_table-180"><span class="linenos">180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.view_table-181"><a href="#CTD.view_table-181"><span class="linenos">181</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;psql&#39;</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Print the CTD data table.</p>
</div>


                            </div>
                            <div id="CTD.get_pandas_df" class="classattr">
                                        <input id="CTD.get_pandas_df-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_pandas_df</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">copy</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.get_pandas_df-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.get_pandas_df"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.get_pandas_df-183"><a href="#CTD.get_pandas_df-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">get_pandas_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="CTD.get_pandas_df-184"><a href="#CTD.get_pandas_df-184"><span class="linenos">184</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.get_pandas_df-185"><a href="#CTD.get_pandas_df-185"><span class="linenos">185</span></a><span class="sd">        Exposes the dataframe of the CTD object for custom processes.</span>
</span><span id="CTD.get_pandas_df-186"><a href="#CTD.get_pandas_df-186"><span class="linenos">186</span></a>
</span><span id="CTD.get_pandas_df-187"><a href="#CTD.get_pandas_df-187"><span class="linenos">187</span></a><span class="sd">        Parameters</span>
</span><span id="CTD.get_pandas_df-188"><a href="#CTD.get_pandas_df-188"><span class="linenos">188</span></a><span class="sd">        ----------</span>
</span><span id="CTD.get_pandas_df-189"><a href="#CTD.get_pandas_df-189"><span class="linenos">189</span></a><span class="sd">        copy : bool, optional</span>
</span><span id="CTD.get_pandas_df-190"><a href="#CTD.get_pandas_df-190"><span class="linenos">190</span></a><span class="sd">            If True returns a copy, if False returns the actual DataFrame internal to the CTD object. Defaults to True.</span>
</span><span id="CTD.get_pandas_df-191"><a href="#CTD.get_pandas_df-191"><span class="linenos">191</span></a>
</span><span id="CTD.get_pandas_df-192"><a href="#CTD.get_pandas_df-192"><span class="linenos">192</span></a><span class="sd">        Returns</span>
</span><span id="CTD.get_pandas_df-193"><a href="#CTD.get_pandas_df-193"><span class="linenos">193</span></a><span class="sd">        -------</span>
</span><span id="CTD.get_pandas_df-194"><a href="#CTD.get_pandas_df-194"><span class="linenos">194</span></a><span class="sd">        DataFrame</span>
</span><span id="CTD.get_pandas_df-195"><a href="#CTD.get_pandas_df-195"><span class="linenos">195</span></a><span class="sd">            The pandas df of the CTD object.</span>
</span><span id="CTD.get_pandas_df-196"><a href="#CTD.get_pandas_df-196"><span class="linenos">196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.get_pandas_df-197"><a href="#CTD.get_pandas_df-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">copy</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span>
</span></pre></div>


            <div class="docstring"><p>Exposes the dataframe of the CTD object for custom processes.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>copy</strong> (bool, optional):
If True returns a copy, if False returns the actual DataFrame internal to the CTD object. Defaults to True.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame</strong>: The pandas df of the CTD object.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.add_filename_to_table" class="classattr">
                                        <input id="CTD.add_filename_to_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_filename_to_table</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.add_filename_to_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.add_filename_to_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.add_filename_to_table-199"><a href="#CTD.add_filename_to_table-199"><span class="linenos">199</span></a>    <span class="k">def</span> <span class="nf">add_filename_to_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.add_filename_to_table-200"><a href="#CTD.add_filename_to_table-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.add_filename_to_table-201"><a href="#CTD.add_filename_to_table-201"><span class="linenos">201</span></a><span class="sd">        Add the filename to the CTD data table.</span>
</span><span id="CTD.add_filename_to_table-202"><a href="#CTD.add_filename_to_table-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.add_filename_to_table-203"><a href="#CTD.add_filename_to_table-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add the filename to the CTD data table.</p>
</div>


                            </div>
                            <div id="CTD.remove_timezone_indicator" class="classattr">
                                        <input id="CTD.remove_timezone_indicator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_timezone_indicator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.remove_timezone_indicator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.remove_timezone_indicator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.remove_timezone_indicator-205"><a href="#CTD.remove_timezone_indicator-205"><span class="linenos">205</span></a>    <span class="k">def</span> <span class="nf">remove_timezone_indicator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.remove_timezone_indicator-206"><a href="#CTD.remove_timezone_indicator-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.remove_timezone_indicator-207"><a href="#CTD.remove_timezone_indicator-207"><span class="linenos">207</span></a><span class="sd">        Removes the timezone indicator in the CTD data table &#39;timestamp&#39; column.</span>
</span><span id="CTD.remove_timezone_indicator-208"><a href="#CTD.remove_timezone_indicator-208"><span class="linenos">208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.remove_timezone_indicator-209"><a href="#CTD.remove_timezone_indicator-209"><span class="linenos">209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_sample_timezone_indicator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Removes the timezone indicator in the CTD data table 'timestamp' column.</p>
</div>


                            </div>
                            <div id="CTD.add_location_to_table" class="classattr">
                                        <input id="CTD.add_location_to_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_location_to_table</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.add_location_to_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.add_location_to_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.add_location_to_table-211"><a href="#CTD.add_location_to_table-211"><span class="linenos">211</span></a>    <span class="k">def</span> <span class="nf">add_location_to_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.add_location_to_table-212"><a href="#CTD.add_location_to_table-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.add_location_to_table-213"><a href="#CTD.add_location_to_table-213"><span class="linenos">213</span></a><span class="sd">        Retrieves the sample location data from the RSK file and adds it to the CTD data table.</span>
</span><span id="CTD.add_location_to_table-214"><a href="#CTD.add_location_to_table-214"><span class="linenos">214</span></a><span class="sd">        If no location data is found, it attempts to estimate the location using the master sheet.</span>
</span><span id="CTD.add_location_to_table-215"><a href="#CTD.add_location_to_table-215"><span class="linenos">215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.add_location_to_table-216"><a href="#CTD.add_location_to_table-216"><span class="linenos">216</span></a>        <span class="c1"># Check if file is castaway</span>
</span><span id="CTD.add_location_to_table-217"><a href="#CTD.add_location_to_table-217"><span class="linenos">217</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.add_location_to_table-218"><a href="#CTD.add_location_to_table-218"><span class="linenos">218</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD.add_location_to_table-219"><a href="#CTD.add_location_to_table-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rsk_file_flag</span><span class="p">:</span>
</span><span id="CTD.add_location_to_table-220"><a href="#CTD.add_location_to_table-220"><span class="linenos">220</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="CTD.add_location_to_table-221"><a href="#CTD.add_location_to_table-221"><span class="linenos">221</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CTD.add_location_to_table-222"><a href="#CTD.add_location_to_table-222"><span class="linenos">222</span></a>                    <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_MASTER_SHEET_ERROR</span><span class="p">)</span>
</span><span id="CTD.add_location_to_table-223"><a href="#CTD.add_location_to_table-223"><span class="linenos">223</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.add_location_to_table-224"><a href="#CTD.add_location_to_table-224"><span class="linenos">224</span></a>                    <span class="n">location_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_master_sheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="CTD.add_location_to_table-225"><a href="#CTD.add_location_to_table-225"><span class="linenos">225</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.add_location_to_table-226"><a href="#CTD.add_location_to_table-226"><span class="linenos">226</span></a>                <span class="k">return</span>
</span><span id="CTD.add_location_to_table-227"><a href="#CTD.add_location_to_table-227"><span class="linenos">227</span></a>        <span class="c1"># Process RSK file</span>
</span><span id="CTD.add_location_to_table-228"><a href="#CTD.add_location_to_table-228"><span class="linenos">228</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.add_location_to_table-229"><a href="#CTD.add_location_to_table-229"><span class="linenos">229</span></a>            <span class="n">location_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sample_location</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rsk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
</span><span id="CTD.add_location_to_table-230"><a href="#CTD.add_location_to_table-230"><span class="linenos">230</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CTD.add_location_to_table-231"><a href="#CTD.add_location_to_table-231"><span class="linenos">231</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">location_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="CTD.add_location_to_table-232"><a href="#CTD.add_location_to_table-232"><span class="linenos">232</span></a>                                                     <span class="n">longitude</span><span class="o">=</span><span class="n">location_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="CTD.add_location_to_table-233"><a href="#CTD.add_location_to_table-233"><span class="linenos">233</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="CTD.add_location_to_table-234"><a href="#CTD.add_location_to_table-234"><span class="linenos">234</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.add_location_to_table-235"><a href="#CTD.add_location_to_table-235"><span class="linenos">235</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.add_location_to_table-236"><a href="#CTD.add_location_to_table-236"><span class="linenos">236</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.add_location_to_table-237"><a href="#CTD.add_location_to_table-237"><span class="linenos">237</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_LOCATION_ERROR</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves the sample location data from the RSK file and adds it to the CTD data table.
If no location data is found, it attempts to estimate the location using the master sheet.</p>
</div>


                            </div>
                            <div id="CTD.remove_upcasts" class="classattr">
                                        <input id="CTD.remove_upcasts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_upcasts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.remove_upcasts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.remove_upcasts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.remove_upcasts-239"><a href="#CTD.remove_upcasts-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">remove_upcasts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.remove_upcasts-240"><a href="#CTD.remove_upcasts-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.remove_upcasts-241"><a href="#CTD.remove_upcasts-241"><span class="linenos">241</span></a><span class="sd">        Removes upcasts based on the rate of change of pressure over time.</span>
</span><span id="CTD.remove_upcasts-242"><a href="#CTD.remove_upcasts-242"><span class="linenos">242</span></a><span class="sd">        This function calculates the vertical speed of the system through the water</span>
</span><span id="CTD.remove_upcasts-243"><a href="#CTD.remove_upcasts-243"><span class="linenos">243</span></a><span class="sd">        using the derivative of pressure with respect to time. It filters out data</span>
</span><span id="CTD.remove_upcasts-244"><a href="#CTD.remove_upcasts-244"><span class="linenos">244</span></a><span class="sd">        collected in the air or while stationary at the surface or bottom, and</span>
</span><span id="CTD.remove_upcasts-245"><a href="#CTD.remove_upcasts-245"><span class="linenos">245</span></a><span class="sd">        separates the downcasts from upcasts.</span>
</span><span id="CTD.remove_upcasts-246"><a href="#CTD.remove_upcasts-246"><span class="linenos">246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.remove_upcasts-247"><a href="#CTD.remove_upcasts-247"><span class="linenos">247</span></a>        <span class="c1"># Ensure &#39;timestamp&#39; is a datetime object for correct differentiation</span>
</span><span id="CTD.remove_upcasts-248"><a href="#CTD.remove_upcasts-248"><span class="linenos">248</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_datetime64_any_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]):</span>
</span><span id="CTD.remove_upcasts-249"><a href="#CTD.remove_upcasts-249"><span class="linenos">249</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="CTD.remove_upcasts-250"><a href="#CTD.remove_upcasts-250"><span class="linenos">250</span></a>
</span><span id="CTD.remove_upcasts-251"><a href="#CTD.remove_upcasts-251"><span class="linenos">251</span></a>        <span class="c1"># Calculate the time differences in seconds</span>
</span><span id="CTD.remove_upcasts-252"><a href="#CTD.remove_upcasts-252"><span class="linenos">252</span></a>        <span class="n">time_diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="CTD.remove_upcasts-253"><a href="#CTD.remove_upcasts-253"><span class="linenos">253</span></a>
</span><span id="CTD.remove_upcasts-254"><a href="#CTD.remove_upcasts-254"><span class="linenos">254</span></a>        <span class="c1"># Calculate the rate of change of pressure over time (dP/dt)</span>
</span><span id="CTD.remove_upcasts-255"><a href="#CTD.remove_upcasts-255"><span class="linenos">255</span></a>        <span class="n">pressure_diffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</span><span id="CTD.remove_upcasts-256"><a href="#CTD.remove_upcasts-256"><span class="linenos">256</span></a>        <span class="n">vertical_speed</span> <span class="o">=</span> <span class="n">pressure_diffs</span> <span class="o">/</span> <span class="n">time_diffs</span>
</span><span id="CTD.remove_upcasts-257"><a href="#CTD.remove_upcasts-257"><span class="linenos">257</span></a>
</span><span id="CTD.remove_upcasts-258"><a href="#CTD.remove_upcasts-258"><span class="linenos">258</span></a>        <span class="c1"># Add vertical speed to the DataFrame</span>
</span><span id="CTD.remove_upcasts-259"><a href="#CTD.remove_upcasts-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertical_speed</span>
</span><span id="CTD.remove_upcasts-260"><a href="#CTD.remove_upcasts-260"><span class="linenos">260</span></a>
</span><span id="CTD.remove_upcasts-261"><a href="#CTD.remove_upcasts-261"><span class="linenos">261</span></a>        <span class="c1"># Filter out data where the rate of change of pressure indicates upcasting or stationary periods</span>
</span><span id="CTD.remove_upcasts-262"><a href="#CTD.remove_upcasts-262"><span class="linenos">262</span></a>        <span class="c1"># Assuming positive vertical speed indicates downcasting (i.e., increasing pressure)</span>
</span><span id="CTD.remove_upcasts-263"><a href="#CTD.remove_upcasts-263"><span class="linenos">263</span></a>        <span class="c1"># You might need to adjust this logic based on the actual data characteristics</span>
</span><span id="CTD.remove_upcasts-264"><a href="#CTD.remove_upcasts-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span>
</span><span id="CTD.remove_upcasts-265"><a href="#CTD.remove_upcasts-265"><span class="linenos">265</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())]</span>
</span><span id="CTD.remove_upcasts-266"><a href="#CTD.remove_upcasts-266"><span class="linenos">266</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;vertical_speed&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Removes upcasts based on the rate of change of pressure over time.
This function calculates the vertical speed of the system through the water
using the derivative of pressure with respect to time. It filters out data
collected in the air or while stationary at the surface or bottom, and
separates the downcasts from upcasts.</p>
</div>


                            </div>
                            <div id="CTD.remove_non_positive_samples" class="classattr">
                                        <input id="CTD.remove_non_positive_samples-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_non_positive_samples</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.remove_non_positive_samples-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.remove_non_positive_samples"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.remove_non_positive_samples-268"><a href="#CTD.remove_non_positive_samples-268"><span class="linenos">268</span></a>    <span class="k">def</span> <span class="nf">remove_non_positive_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.remove_non_positive_samples-269"><a href="#CTD.remove_non_positive_samples-269"><span class="linenos">269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.remove_non_positive_samples-270"><a href="#CTD.remove_non_positive_samples-270"><span class="linenos">270</span></a><span class="sd">        Iterates through the columns of the CTD data table and removes rows with non-positive values</span>
</span><span id="CTD.remove_non_positive_samples-271"><a href="#CTD.remove_non_positive_samples-271"><span class="linenos">271</span></a><span class="sd">        for depth, pressure, salinity, absolute salinity, or density.</span>
</span><span id="CTD.remove_non_positive_samples-272"><a href="#CTD.remove_non_positive_samples-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.remove_non_positive_samples-273"><a href="#CTD.remove_non_positive_samples-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.remove_non_positive_samples-274"><a href="#CTD.remove_non_positive_samples-274"><span class="linenos">274</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD.remove_non_positive_samples-275"><a href="#CTD.remove_non_positive_samples-275"><span class="linenos">275</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.remove_non_positive_samples-276"><a href="#CTD.remove_non_positive_samples-276"><span class="linenos">276</span></a>            <span class="k">match</span> <span class="n">column</span><span class="p">:</span>
</span><span id="CTD.remove_non_positive_samples-277"><a href="#CTD.remove_non_positive_samples-277"><span class="linenos">277</span></a>                <span class="k">case</span> <span class="s1">&#39;depth_00&#39;</span><span class="p">:</span>
</span><span id="CTD.remove_non_positive_samples-278"><a href="#CTD.remove_non_positive_samples-278"><span class="linenos">278</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_depth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.remove_non_positive_samples-279"><a href="#CTD.remove_non_positive_samples-279"><span class="linenos">279</span></a>                <span class="k">case</span> <span class="s1">&#39;pressure_00&#39;</span><span class="p">:</span>
</span><span id="CTD.remove_non_positive_samples-280"><a href="#CTD.remove_non_positive_samples-280"><span class="linenos">280</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_pressure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.remove_non_positive_samples-281"><a href="#CTD.remove_non_positive_samples-281"><span class="linenos">281</span></a>                <span class="k">case</span> <span class="s1">&#39;salinity_00&#39;</span><span class="p">:</span>
</span><span id="CTD.remove_non_positive_samples-282"><a href="#CTD.remove_non_positive_samples-282"><span class="linenos">282</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_salinity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.remove_non_positive_samples-283"><a href="#CTD.remove_non_positive_samples-283"><span class="linenos">283</span></a>                <span class="k">case</span> <span class="s1">&#39;salinityabs&#39;</span><span class="p">:</span>
</span><span id="CTD.remove_non_positive_samples-284"><a href="#CTD.remove_non_positive_samples-284"><span class="linenos">284</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_salinityabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.remove_non_positive_samples-285"><a href="#CTD.remove_non_positive_samples-285"><span class="linenos">285</span></a>                <span class="k">case</span> <span class="s1">&#39;density&#39;</span><span class="p">:</span>
</span><span id="CTD.remove_non_positive_samples-286"><a href="#CTD.remove_non_positive_samples-286"><span class="linenos">286</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_density</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.remove_non_positive_samples-287"><a href="#CTD.remove_non_positive_samples-287"><span class="linenos">287</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.remove_non_positive_samples-288"><a href="#CTD.remove_non_positive_samples-288"><span class="linenos">288</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_REMOVE_NEGATIVES_ERROR</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Iterates through the columns of the CTD data table and removes rows with non-positive values
for depth, pressure, salinity, absolute salinity, or density.</p>
</div>


                            </div>
                            <div id="CTD.remove_invalid_salinity_values" class="classattr">
                                        <input id="CTD.remove_invalid_salinity_values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_invalid_salinity_values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.remove_invalid_salinity_values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.remove_invalid_salinity_values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.remove_invalid_salinity_values-290"><a href="#CTD.remove_invalid_salinity_values-290"><span class="linenos">290</span></a>    <span class="k">def</span> <span class="nf">remove_invalid_salinity_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.remove_invalid_salinity_values-291"><a href="#CTD.remove_invalid_salinity_values-291"><span class="linenos">291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.remove_invalid_salinity_values-292"><a href="#CTD.remove_invalid_salinity_values-292"><span class="linenos">292</span></a><span class="sd">        Removes rows with invalid values (&lt;10) for practical salinity.</span>
</span><span id="CTD.remove_invalid_salinity_values-293"><a href="#CTD.remove_invalid_salinity_values-293"><span class="linenos">293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.remove_invalid_salinity_values-294"><a href="#CTD.remove_invalid_salinity_values-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.remove_invalid_salinity_values-295"><a href="#CTD.remove_invalid_salinity_values-295"><span class="linenos">295</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD.remove_invalid_salinity_values-296"><a href="#CTD.remove_invalid_salinity_values-296"><span class="linenos">296</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.remove_invalid_salinity_values-297"><a href="#CTD.remove_invalid_salinity_values-297"><span class="linenos">297</span></a>            <span class="k">match</span> <span class="n">column</span><span class="p">:</span>
</span><span id="CTD.remove_invalid_salinity_values-298"><a href="#CTD.remove_invalid_salinity_values-298"><span class="linenos">298</span></a>                <span class="k">case</span> <span class="s1">&#39;salinity_00&#39;</span><span class="p">:</span>
</span><span id="CTD.remove_invalid_salinity_values-299"><a href="#CTD.remove_invalid_salinity_values-299"><span class="linenos">299</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_invalid_salinity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.remove_invalid_salinity_values-300"><a href="#CTD.remove_invalid_salinity_values-300"><span class="linenos">300</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.remove_invalid_salinity_values-301"><a href="#CTD.remove_invalid_salinity_values-301"><span class="linenos">301</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_REMOVE_NEGATIVES_ERROR</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Removes rows with invalid values (&lt;10) for practical salinity.</p>
</div>


                            </div>
                            <div id="CTD.bin_average_pressure" class="classattr">
                                        <input id="CTD.bin_average_pressure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bin_average_pressure</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">bin_size</span><span class="o">=</span><span class="mf">0.5</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.bin_average_pressure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.bin_average_pressure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.bin_average_pressure-303"><a href="#CTD.bin_average_pressure-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="nf">bin_average_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="CTD.bin_average_pressure-304"><a href="#CTD.bin_average_pressure-304"><span class="linenos">304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.bin_average_pressure-305"><a href="#CTD.bin_average_pressure-305"><span class="linenos">305</span></a><span class="sd">        Bins by pressure and averages numeric columns.</span>
</span><span id="CTD.bin_average_pressure-306"><a href="#CTD.bin_average_pressure-306"><span class="linenos">306</span></a>
</span><span id="CTD.bin_average_pressure-307"><a href="#CTD.bin_average_pressure-307"><span class="linenos">307</span></a><span class="sd">        Parameters</span>
</span><span id="CTD.bin_average_pressure-308"><a href="#CTD.bin_average_pressure-308"><span class="linenos">308</span></a><span class="sd">        ----------</span>
</span><span id="CTD.bin_average_pressure-309"><a href="#CTD.bin_average_pressure-309"><span class="linenos">309</span></a><span class="sd">        bin_size: float</span>
</span><span id="CTD.bin_average_pressure-310"><a href="#CTD.bin_average_pressure-310"><span class="linenos">310</span></a><span class="sd">            Size of pressure bins, defaults to 0.5.</span>
</span><span id="CTD.bin_average_pressure-311"><a href="#CTD.bin_average_pressure-311"><span class="linenos">311</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.bin_average_pressure-312"><a href="#CTD.bin_average_pressure-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.bin_average_pressure-313"><a href="#CTD.bin_average_pressure-313"><span class="linenos">313</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD.bin_average_pressure-314"><a href="#CTD.bin_average_pressure-314"><span class="linenos">314</span></a>        <span class="c1"># Check if &#39;Pressure_Bin&#39; already exists and drop it if it does</span>
</span><span id="CTD.bin_average_pressure-315"><a href="#CTD.bin_average_pressure-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="s1">&#39;Pressure_Bin&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.bin_average_pressure-316"><a href="#CTD.bin_average_pressure-316"><span class="linenos">316</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.bin_average_pressure-317"><a href="#CTD.bin_average_pressure-317"><span class="linenos">317</span></a>
</span><span id="CTD.bin_average_pressure-318"><a href="#CTD.bin_average_pressure-318"><span class="linenos">318</span></a>        <span class="c1"># Binning data using the specified bin size</span>
</span><span id="CTD.bin_average_pressure-319"><a href="#CTD.bin_average_pressure-319"><span class="linenos">319</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="n">bin_size</span><span class="p">)</span> <span class="o">*</span> <span class="n">bin_size</span>
</span><span id="CTD.bin_average_pressure-320"><a href="#CTD.bin_average_pressure-320"><span class="linenos">320</span></a>
</span><span id="CTD.bin_average_pressure-321"><a href="#CTD.bin_average_pressure-321"><span class="linenos">321</span></a>        <span class="c1"># Identifying numeric and non-numeric columns</span>
</span><span id="CTD.bin_average_pressure-322"><a href="#CTD.bin_average_pressure-322"><span class="linenos">322</span></a>        <span class="n">numeric_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="CTD.bin_average_pressure-323"><a href="#CTD.bin_average_pressure-323"><span class="linenos">323</span></a>        <span class="n">numeric_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">)</span>  <span class="c1"># Remove the original pressure column if it&#39;s still in the list</span>
</span><span id="CTD.bin_average_pressure-324"><a href="#CTD.bin_average_pressure-324"><span class="linenos">324</span></a>        <span class="n">non_numeric_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
</span><span id="CTD.bin_average_pressure-325"><a href="#CTD.bin_average_pressure-325"><span class="linenos">325</span></a>                            <span class="s1">&#39;longitude&#39;</span><span class="p">]</span>  <span class="c1"># specify any non-numeric column you expect to handle specially</span>
</span><span id="CTD.bin_average_pressure-326"><a href="#CTD.bin_average_pressure-326"><span class="linenos">326</span></a>        <span class="c1"># Creating aggregation dictionary</span>
</span><span id="CTD.bin_average_pressure-327"><a href="#CTD.bin_average_pressure-327"><span class="linenos">327</span></a>        <span class="n">agg_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">}</span>
</span><span id="CTD.bin_average_pressure-328"><a href="#CTD.bin_average_pressure-328"><span class="linenos">328</span></a>        <span class="n">agg_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">non_numeric_cols</span><span class="p">})</span>
</span><span id="CTD.bin_average_pressure-329"><a href="#CTD.bin_average_pressure-329"><span class="linenos">329</span></a>        <span class="c1"># Aggregating data by the new pressure bins</span>
</span><span id="CTD.bin_average_pressure-330"><a href="#CTD.bin_average_pressure-330"><span class="linenos">330</span></a>        <span class="n">data_binned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.bin_average_pressure-331"><a href="#CTD.bin_average_pressure-331"><span class="linenos">331</span></a>
</span><span id="CTD.bin_average_pressure-332"><a href="#CTD.bin_average_pressure-332"><span class="linenos">332</span></a>        <span class="c1"># Cleaning up DataFrame, resetting the index and column names</span>
</span><span id="CTD.bin_average_pressure-333"><a href="#CTD.bin_average_pressure-333"><span class="linenos">333</span></a>        <span class="n">data_binned</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">:</span> <span class="s1">&#39;pressure_00&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.bin_average_pressure-334"><a href="#CTD.bin_average_pressure-334"><span class="linenos">334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.bin_average_pressure-335"><a href="#CTD.bin_average_pressure-335"><span class="linenos">335</span></a>
</span><span id="CTD.bin_average_pressure-336"><a href="#CTD.bin_average_pressure-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.bin_average_pressure-337"><a href="#CTD.bin_average_pressure-337"><span class="linenos">337</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Bins by pressure and averages numeric columns.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>bin_size</strong> (float):
Size of pressure bins, defaults to 0.5.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.clean" class="classattr">
                                        <input id="CTD.clean-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clean</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">feature</span>, </span><span class="param"><span class="n">method</span><span class="o">=</span><span class="s1">&#39;autoencoder&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.clean-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.clean"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.clean-339"><a href="#CTD.clean-339"><span class="linenos">339</span></a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;autoencoder&#39;</span><span class="p">):</span>
</span><span id="CTD.clean-340"><a href="#CTD.clean-340"><span class="linenos">340</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.clean-341"><a href="#CTD.clean-341"><span class="linenos">341</span></a><span class="sd">        Applies data cleaning methods to the specified feature using the selected method.</span>
</span><span id="CTD.clean-342"><a href="#CTD.clean-342"><span class="linenos">342</span></a><span class="sd">        Currently supports cleaning practical salinity using &#39;salinitydiff&#39; or &#39;autoencoder&#39; methods.</span>
</span><span id="CTD.clean-343"><a href="#CTD.clean-343"><span class="linenos">343</span></a>
</span><span id="CTD.clean-344"><a href="#CTD.clean-344"><span class="linenos">344</span></a><span class="sd">        Parameters</span>
</span><span id="CTD.clean-345"><a href="#CTD.clean-345"><span class="linenos">345</span></a><span class="sd">        ----------</span>
</span><span id="CTD.clean-346"><a href="#CTD.clean-346"><span class="linenos">346</span></a><span class="sd">        feature : str</span>
</span><span id="CTD.clean-347"><a href="#CTD.clean-347"><span class="linenos">347</span></a><span class="sd">            The feature to clean (e.g., &#39;practicalsalinity&#39;).</span>
</span><span id="CTD.clean-348"><a href="#CTD.clean-348"><span class="linenos">348</span></a><span class="sd">            Options are &#39;practicalsalinity&#39;.</span>
</span><span id="CTD.clean-349"><a href="#CTD.clean-349"><span class="linenos">349</span></a><span class="sd">        method : str, optional</span>
</span><span id="CTD.clean-350"><a href="#CTD.clean-350"><span class="linenos">350</span></a><span class="sd">            The cleaning method to apply, defaults to &#39;autoencoder&#39;.</span>
</span><span id="CTD.clean-351"><a href="#CTD.clean-351"><span class="linenos">351</span></a><span class="sd">            Options are &#39;salinitydiff&#39;, &#39;autoencoder&#39;.</span>
</span><span id="CTD.clean-352"><a href="#CTD.clean-352"><span class="linenos">352</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.clean-353"><a href="#CTD.clean-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.clean-354"><a href="#CTD.clean-354"><span class="linenos">354</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD.clean-355"><a href="#CTD.clean-355"><span class="linenos">355</span></a>        <span class="n">supported_features</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CTD.clean-356"><a href="#CTD.clean-356"><span class="linenos">356</span></a>            <span class="s2">&quot;practicalsalinity&quot;</span><span class="p">:</span> <span class="s2">&quot;salinity_00&quot;</span>
</span><span id="CTD.clean-357"><a href="#CTD.clean-357"><span class="linenos">357</span></a>        <span class="p">}</span>
</span><span id="CTD.clean-358"><a href="#CTD.clean-358"><span class="linenos">358</span></a>        <span class="n">supported_methods</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CTD.clean-359"><a href="#CTD.clean-359"><span class="linenos">359</span></a>            <span class="s2">&quot;salinitydiff&quot;</span><span class="p">:</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_and_drop_salinity_spikes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">),</span>
</span><span id="CTD.clean-360"><a href="#CTD.clean-360"><span class="linenos">360</span></a>            <span class="s2">&quot;autoencoder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_salinity_autoencoder</span><span class="p">()</span>
</span><span id="CTD.clean-361"><a href="#CTD.clean-361"><span class="linenos">361</span></a>        <span class="p">}</span>
</span><span id="CTD.clean-362"><a href="#CTD.clean-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">supported_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CTD.clean-363"><a href="#CTD.clean-363"><span class="linenos">363</span></a>            <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">supported_methods</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CTD.clean-364"><a href="#CTD.clean-364"><span class="linenos">364</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">supported_methods</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
</span><span id="CTD.clean-365"><a href="#CTD.clean-365"><span class="linenos">365</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.clean-366"><a href="#CTD.clean-366"><span class="linenos">366</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;clean: Invalid method </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> not in </span><span class="si">{</span><span class="n">supported_methods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.clean-367"><a href="#CTD.clean-367"><span class="linenos">367</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.clean-368"><a href="#CTD.clean-368"><span class="linenos">368</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;clean: Invalid feature </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> not in </span><span class="si">{</span><span class="n">supported_features</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.clean-369"><a href="#CTD.clean-369"><span class="linenos">369</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.clean-370"><a href="#CTD.clean-370"><span class="linenos">370</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DATA_CLEANING_ERROR</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Applies data cleaning methods to the specified feature using the selected method.
Currently supports cleaning practical salinity using 'salinitydiff' or 'autoencoder' methods.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>feature</strong> (str):
The feature to clean (e.g., 'practicalsalinity').
Options are 'practicalsalinity'.</li>
<li><strong>method</strong> (str, optional):
The cleaning method to apply, defaults to 'autoencoder'.
Options are 'salinitydiff', 'autoencoder'.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.add_absolute_salinity" class="classattr">
                                        <input id="CTD.add_absolute_salinity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_absolute_salinity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.add_absolute_salinity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.add_absolute_salinity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.add_absolute_salinity-372"><a href="#CTD.add_absolute_salinity-372"><span class="linenos">372</span></a>    <span class="k">def</span> <span class="nf">add_absolute_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.add_absolute_salinity-373"><a href="#CTD.add_absolute_salinity-373"><span class="linenos">373</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.add_absolute_salinity-374"><a href="#CTD.add_absolute_salinity-374"><span class="linenos">374</span></a><span class="sd">        Calculates the absolute salinity using the TEOS-10 equations and adds it as a new column</span>
</span><span id="CTD.add_absolute_salinity-375"><a href="#CTD.add_absolute_salinity-375"><span class="linenos">375</span></a><span class="sd">        to the CTD data table. Removes rows with negative absolute salinity values.</span>
</span><span id="CTD.add_absolute_salinity-376"><a href="#CTD.add_absolute_salinity-376"><span class="linenos">376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.add_absolute_salinity-377"><a href="#CTD.add_absolute_salinity-377"><span class="linenos">377</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.add_absolute_salinity-378"><a href="#CTD.add_absolute_salinity-378"><span class="linenos">378</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD.add_absolute_salinity-379"><a href="#CTD.add_absolute_salinity-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;salinityabs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_absolute_salinity</span><span class="p">(</span>
</span><span id="CTD.add_absolute_salinity-380"><a href="#CTD.add_absolute_salinity-380"><span class="linenos">380</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.add_absolute_salinity-381"><a href="#CTD.add_absolute_salinity-381"><span class="linenos">381</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">remove_rows_with_negative_salinityabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.add_absolute_salinity-382"><a href="#CTD.add_absolute_salinity-382"><span class="linenos">382</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.add_absolute_salinity-383"><a href="#CTD.add_absolute_salinity-383"><span class="linenos">383</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SALINITYABS_CALCULATION_ERROR</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the absolute salinity using the TEOS-10 equations and adds it as a new column
to the CTD data table. Removes rows with negative absolute salinity values.</p>
</div>


                            </div>
                            <div id="CTD.add_density" class="classattr">
                                        <input id="CTD.add_density-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_density</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.add_density-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.add_density"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.add_density-385"><a href="#CTD.add_density-385"><span class="linenos">385</span></a>    <span class="k">def</span> <span class="nf">add_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.add_density-386"><a href="#CTD.add_density-386"><span class="linenos">386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.add_density-387"><a href="#CTD.add_density-387"><span class="linenos">387</span></a><span class="sd">        Calculates the density using the TEOS-10 equations and adds it as a new column to the CTD</span>
</span><span id="CTD.add_density-388"><a href="#CTD.add_density-388"><span class="linenos">388</span></a><span class="sd">        data table. If absolute salinity is not present, it is calculated first.</span>
</span><span id="CTD.add_density-389"><a href="#CTD.add_density-389"><span class="linenos">389</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.add_density-390"><a href="#CTD.add_density-390"><span class="linenos">390</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.add_density-391"><a href="#CTD.add_density-391"><span class="linenos">391</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD.add_density-392"><a href="#CTD.add_density-392"><span class="linenos">392</span></a>        <span class="k">if</span> <span class="s1">&#39;salinityabs&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.add_density-393"><a href="#CTD.add_density-393"><span class="linenos">393</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_absolute_density</span><span class="p">(</span>
</span><span id="CTD.add_density-394"><a href="#CTD.add_density-394"><span class="linenos">394</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.add_density-395"><a href="#CTD.add_density-395"><span class="linenos">395</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.add_density-396"><a href="#CTD.add_density-396"><span class="linenos">396</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_absolute_salinity</span><span class="p">()</span>
</span><span id="CTD.add_density-397"><a href="#CTD.add_density-397"><span class="linenos">397</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_absolute_density</span><span class="p">(</span>
</span><span id="CTD.add_density-398"><a href="#CTD.add_density-398"><span class="linenos">398</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.add_density-399"><a href="#CTD.add_density-399"><span class="linenos">399</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;salinityabs&#39;</span><span class="p">)</span>
</span><span id="CTD.add_density-400"><a href="#CTD.add_density-400"><span class="linenos">400</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.add_density-401"><a href="#CTD.add_density-401"><span class="linenos">401</span></a>                <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DENSITY_CALCULATION_ERROR</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the density using the TEOS-10 equations and adds it as a new column to the CTD
data table. If absolute salinity is not present, it is calculated first.</p>
</div>


                            </div>
                            <div id="CTD.add_overturns" class="classattr">
                                        <input id="CTD.add_overturns-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_overturns</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.add_overturns-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.add_overturns"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.add_overturns-403"><a href="#CTD.add_overturns-403"><span class="linenos">403</span></a>    <span class="k">def</span> <span class="nf">add_overturns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.add_overturns-404"><a href="#CTD.add_overturns-404"><span class="linenos">404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.add_overturns-405"><a href="#CTD.add_overturns-405"><span class="linenos">405</span></a><span class="sd">        Calculates density changes between consecutive measurements and identifies overturns where</span>
</span><span id="CTD.add_overturns-406"><a href="#CTD.add_overturns-406"><span class="linenos">406</span></a><span class="sd">        denser water lies above less dense water. Adds an &#39;overturn&#39; column to the CTD data table.</span>
</span><span id="CTD.add_overturns-407"><a href="#CTD.add_overturns-407"><span class="linenos">407</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.add_overturns-408"><a href="#CTD.add_overturns-408"><span class="linenos">408</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.add_overturns-409"><a href="#CTD.add_overturns-409"><span class="linenos">409</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD.add_overturns-410"><a href="#CTD.add_overturns-410"><span class="linenos">410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_overturns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Calculates density changes between consecutive measurements and identifies overturns where
denser water lies above less dense water. Adds an 'overturn' column to the CTD data table.</p>
</div>


                            </div>
                            <div id="CTD.add_surface_salinity_temp_meltwater" class="classattr">
                                        <input id="CTD.add_surface_salinity_temp_meltwater-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_surface_salinity_temp_meltwater</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mf">10.0</span>, </span><span class="param"><span class="n">end</span><span class="o">=</span><span class="mf">12.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.add_surface_salinity_temp_meltwater-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.add_surface_salinity_temp_meltwater"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.add_surface_salinity_temp_meltwater-412"><a href="#CTD.add_surface_salinity_temp_meltwater-412"><span class="linenos">412</span></a>    <span class="k">def</span> <span class="nf">add_surface_salinity_temp_meltwater</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">12.0</span><span class="p">):</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-413"><a href="#CTD.add_surface_salinity_temp_meltwater-413"><span class="linenos">413</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-414"><a href="#CTD.add_surface_salinity_temp_meltwater-414"><span class="linenos">414</span></a><span class="sd">        Calculates the surface salinity, temperature, and meltwater fraction and adds them as a new column to the CTD</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-415"><a href="#CTD.add_surface_salinity_temp_meltwater-415"><span class="linenos">415</span></a><span class="sd">        data table</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-416"><a href="#CTD.add_surface_salinity_temp_meltwater-416"><span class="linenos">416</span></a>
</span><span id="CTD.add_surface_salinity_temp_meltwater-417"><a href="#CTD.add_surface_salinity_temp_meltwater-417"><span class="linenos">417</span></a><span class="sd">        Parameters</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-418"><a href="#CTD.add_surface_salinity_temp_meltwater-418"><span class="linenos">418</span></a><span class="sd">        ----------</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-419"><a href="#CTD.add_surface_salinity_temp_meltwater-419"><span class="linenos">419</span></a><span class="sd">        start : float, optional</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-420"><a href="#CTD.add_surface_salinity_temp_meltwater-420"><span class="linenos">420</span></a><span class="sd">            Minimum pressure bound, defaults to 10.0.</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-421"><a href="#CTD.add_surface_salinity_temp_meltwater-421"><span class="linenos">421</span></a><span class="sd">        end : float, optional</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-422"><a href="#CTD.add_surface_salinity_temp_meltwater-422"><span class="linenos">422</span></a><span class="sd">            Maximum pressure bound, defaults to 12.0.</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-423"><a href="#CTD.add_surface_salinity_temp_meltwater-423"><span class="linenos">423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-424"><a href="#CTD.add_surface_salinity_temp_meltwater-424"><span class="linenos">424</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-425"><a href="#CTD.add_surface_salinity_temp_meltwater-425"><span class="linenos">425</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-426"><a href="#CTD.add_surface_salinity_temp_meltwater-426"><span class="linenos">426</span></a>        <span class="n">surface_salinity</span><span class="p">,</span> <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_surface_salinity_and_meltwater</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-427"><a href="#CTD.add_surface_salinity_temp_meltwater-427"><span class="linenos">427</span></a>                                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-428"><a href="#CTD.add_surface_salinity_temp_meltwater-428"><span class="linenos">428</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_surface_temperature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-429"><a href="#CTD.add_surface_salinity_temp_meltwater-429"><span class="linenos">429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">surface_salinity</span><span class="o">=</span><span class="n">surface_salinity</span><span class="p">)</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-430"><a href="#CTD.add_surface_salinity_temp_meltwater-430"><span class="linenos">430</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">meltwater_fraction</span><span class="o">=</span><span class="n">meltwater_fraction</span><span class="p">)</span>
</span><span id="CTD.add_surface_salinity_temp_meltwater-431"><a href="#CTD.add_surface_salinity_temp_meltwater-431"><span class="linenos">431</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">surface_temperature</span><span class="o">=</span><span class="n">surface_temperature</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the surface salinity, temperature, and meltwater fraction and adds them as a new column to the CTD
data table</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>start</strong> (float, optional):
Minimum pressure bound, defaults to 10.0.</li>
<li><strong>end</strong> (float, optional):
Maximum pressure bound, defaults to 12.0.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.add_mean_surface_density" class="classattr">
                                        <input id="CTD.add_mean_surface_density-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_mean_surface_density</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mf">0.0</span>, </span><span class="param"><span class="n">end</span><span class="o">=</span><span class="mf">100.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.add_mean_surface_density-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.add_mean_surface_density"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.add_mean_surface_density-433"><a href="#CTD.add_mean_surface_density-433"><span class="linenos">433</span></a>    <span class="k">def</span> <span class="nf">add_mean_surface_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">100.0</span><span class="p">):</span>
</span><span id="CTD.add_mean_surface_density-434"><a href="#CTD.add_mean_surface_density-434"><span class="linenos">434</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.add_mean_surface_density-435"><a href="#CTD.add_mean_surface_density-435"><span class="linenos">435</span></a><span class="sd">        Calculates the mean surface density from the density values and adds it as a new column</span>
</span><span id="CTD.add_mean_surface_density-436"><a href="#CTD.add_mean_surface_density-436"><span class="linenos">436</span></a><span class="sd">        to the CTD data table.</span>
</span><span id="CTD.add_mean_surface_density-437"><a href="#CTD.add_mean_surface_density-437"><span class="linenos">437</span></a>
</span><span id="CTD.add_mean_surface_density-438"><a href="#CTD.add_mean_surface_density-438"><span class="linenos">438</span></a><span class="sd">        Parameters</span>
</span><span id="CTD.add_mean_surface_density-439"><a href="#CTD.add_mean_surface_density-439"><span class="linenos">439</span></a><span class="sd">        ----------</span>
</span><span id="CTD.add_mean_surface_density-440"><a href="#CTD.add_mean_surface_density-440"><span class="linenos">440</span></a><span class="sd">        start : float, optional</span>
</span><span id="CTD.add_mean_surface_density-441"><a href="#CTD.add_mean_surface_density-441"><span class="linenos">441</span></a><span class="sd">            Depth bound, defaults to 0.</span>
</span><span id="CTD.add_mean_surface_density-442"><a href="#CTD.add_mean_surface_density-442"><span class="linenos">442</span></a><span class="sd">        end : float, optional</span>
</span><span id="CTD.add_mean_surface_density-443"><a href="#CTD.add_mean_surface_density-443"><span class="linenos">443</span></a><span class="sd">            Depth bound, default to 1.</span>
</span><span id="CTD.add_mean_surface_density-444"><a href="#CTD.add_mean_surface_density-444"><span class="linenos">444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.add_mean_surface_density-445"><a href="#CTD.add_mean_surface_density-445"><span class="linenos">445</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.add_mean_surface_density-446"><a href="#CTD.add_mean_surface_density-446"><span class="linenos">446</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD.add_mean_surface_density-447"><a href="#CTD.add_mean_surface_density-447"><span class="linenos">447</span></a>        <span class="n">mean_surface_density</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_mean_surface_density</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</span><span id="CTD.add_mean_surface_density-448"><a href="#CTD.add_mean_surface_density-448"><span class="linenos">448</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">mean_surface_density</span><span class="o">=</span><span class="n">mean_surface_density</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the mean surface density from the density values and adds it as a new column
to the CTD data table.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>start</strong> (float, optional):
Depth bound, defaults to 0.</li>
<li><strong>end</strong> (float, optional):
Depth bound, default to 1.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.add_mld" class="classattr">
                                        <input id="CTD.add_mld-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_mld</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reference</span>, </span><span class="param"><span class="n">method</span><span class="o">=</span><span class="s1">&#39;default&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.add_mld-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.add_mld"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.add_mld-450"><a href="#CTD.add_mld-450"><span class="linenos">450</span></a>    <span class="k">def</span> <span class="nf">add_mld</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">):</span>
</span><span id="CTD.add_mld-451"><a href="#CTD.add_mld-451"><span class="linenos">451</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.add_mld-452"><a href="#CTD.add_mld-452"><span class="linenos">452</span></a><span class="sd">        Calculates the mixed layer depth using the specified method and reference depth.</span>
</span><span id="CTD.add_mld-453"><a href="#CTD.add_mld-453"><span class="linenos">453</span></a><span class="sd">        Adds the MLD and the actual reference depth used as new columns to the CTD data table.</span>
</span><span id="CTD.add_mld-454"><a href="#CTD.add_mld-454"><span class="linenos">454</span></a>
</span><span id="CTD.add_mld-455"><a href="#CTD.add_mld-455"><span class="linenos">455</span></a><span class="sd">        Parameters</span>
</span><span id="CTD.add_mld-456"><a href="#CTD.add_mld-456"><span class="linenos">456</span></a><span class="sd">        ----------</span>
</span><span id="CTD.add_mld-457"><a href="#CTD.add_mld-457"><span class="linenos">457</span></a><span class="sd">        reference : int</span>
</span><span id="CTD.add_mld-458"><a href="#CTD.add_mld-458"><span class="linenos">458</span></a><span class="sd">            The reference depth for MLD calculation.</span>
</span><span id="CTD.add_mld-459"><a href="#CTD.add_mld-459"><span class="linenos">459</span></a><span class="sd">        method : int</span>
</span><span id="CTD.add_mld-460"><a href="#CTD.add_mld-460"><span class="linenos">460</span></a><span class="sd">            The MLD calculation method (default: &quot;default&quot;).</span>
</span><span id="CTD.add_mld-461"><a href="#CTD.add_mld-461"><span class="linenos">461</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.add_mld-462"><a href="#CTD.add_mld-462"><span class="linenos">462</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.add_mld-463"><a href="#CTD.add_mld-463"><span class="linenos">463</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NO_SAMPLES_ERROR</span><span class="p">)</span>
</span><span id="CTD.add_mld-464"><a href="#CTD.add_mld-464"><span class="linenos">464</span></a>        <span class="n">copy_ctd_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.add_mld-465"><a href="#CTD.add_mld-465"><span class="linenos">465</span></a>        <span class="n">supported_methods</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="CTD.add_mld-466"><a href="#CTD.add_mld-466"><span class="linenos">466</span></a>            <span class="s2">&quot;default&quot;</span>
</span><span id="CTD.add_mld-467"><a href="#CTD.add_mld-467"><span class="linenos">467</span></a>        <span class="p">]</span>
</span><span id="CTD.add_mld-468"><a href="#CTD.add_mld-468"><span class="linenos">468</span></a>        <span class="n">unpack</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.add_mld-469"><a href="#CTD.add_mld-469"><span class="linenos">469</span></a>
</span><span id="CTD.add_mld-470"><a href="#CTD.add_mld-470"><span class="linenos">470</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
</span><span id="CTD.add_mld-471"><a href="#CTD.add_mld-471"><span class="linenos">471</span></a>            <span class="n">unpack</span> <span class="o">=</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">calculate_mld</span><span class="p">(</span><span class="n">copy_ctd_array</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="n">copy_ctd_array</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span>
</span><span id="CTD.add_mld-472"><a href="#CTD.add_mld-472"><span class="linenos">472</span></a>                                             <span class="n">reference</span><span class="p">)</span>
</span><span id="CTD.add_mld-473"><a href="#CTD.add_mld-473"><span class="linenos">473</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.add_mld-474"><a href="#CTD.add_mld-474"><span class="linenos">474</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;add_mld: Invalid method </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> not in </span><span class="si">{</span><span class="n">supported_methods</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.add_mld-475"><a href="#CTD.add_mld-475"><span class="linenos">475</span></a>            <span class="n">unpack</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="CTD.add_mld-476"><a href="#CTD.add_mld-476"><span class="linenos">476</span></a>        <span class="k">if</span> <span class="n">unpack</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CTD.add_mld-477"><a href="#CTD.add_mld-477"><span class="linenos">477</span></a>            <span class="n">unpack</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="CTD.add_mld-478"><a href="#CTD.add_mld-478"><span class="linenos">478</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s2">&quot;MLD could not be calculated.&quot;</span><span class="p">)</span>
</span><span id="CTD.add_mld-479"><a href="#CTD.add_mld-479"><span class="linenos">479</span></a>        <span class="n">MLD</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.add_mld-480"><a href="#CTD.add_mld-480"><span class="linenos">480</span></a>        <span class="n">depth_used_as_reference</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CTD.add_mld-481"><a href="#CTD.add_mld-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MLD</span>
</span><span id="CTD.add_mld-482"><a href="#CTD.add_mld-482"><span class="linenos">482</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="CTD.add_mld-483"><a href="#CTD.add_mld-483"><span class="linenos">483</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1"> Actual Reference Depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth_used_as_reference</span>
</span><span id="CTD.add_mld-484"><a href="#CTD.add_mld-484"><span class="linenos">484</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">):</span>
</span><span id="CTD.add_mld-485"><a href="#CTD.add_mld-485"><span class="linenos">485</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MLD_ERROR</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the mixed layer depth using the specified method and reference depth.
Adds the MLD and the actual reference depth used as new columns to the CTD data table.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>reference</strong> (int):
The reference depth for MLD calculation.</li>
<li><strong>method</strong> (int):
The MLD calculation method (default: "default").</li>
</ul>
</div>


                            </div>
                            <div id="CTD.plot_depth_salinity_density_mld_line" class="classattr">
                                        <input id="CTD.plot_depth_salinity_density_mld_line-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_depth_salinity_density_mld_line</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.plot_depth_salinity_density_mld_line-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.plot_depth_salinity_density_mld_line"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.plot_depth_salinity_density_mld_line-487"><a href="#CTD.plot_depth_salinity_density_mld_line-487"><span class="linenos">487</span></a>    <span class="k">def</span> <span class="nf">plot_depth_salinity_density_mld_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-488"><a href="#CTD.plot_depth_salinity_density_mld_line-488"><span class="linenos">488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-489"><a href="#CTD.plot_depth_salinity_density_mld_line-489"><span class="linenos">489</span></a><span class="sd">        Generates a plot of depth vs. salinity and density, applying LOESS smoothing to the data.</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-490"><a href="#CTD.plot_depth_salinity_density_mld_line-490"><span class="linenos">490</span></a><span class="sd">        Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-491"><a href="#CTD.plot_depth_salinity_density_mld_line-491"><span class="linenos">491</span></a><span class="sd">        Saves the plot as an image file.</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-492"><a href="#CTD.plot_depth_salinity_density_mld_line-492"><span class="linenos">492</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-493"><a href="#CTD.plot_depth_salinity_density_mld_line-493"><span class="linenos">493</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-494"><a href="#CTD.plot_depth_salinity_density_mld_line-494"><span class="linenos">494</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-495"><a href="#CTD.plot_depth_salinity_density_mld_line-495"><span class="linenos">495</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-496"><a href="#CTD.plot_depth_salinity_density_mld_line-496"><span class="linenos">496</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-497"><a href="#CTD.plot_depth_salinity_density_mld_line-497"><span class="linenos">497</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-498"><a href="#CTD.plot_depth_salinity_density_mld_line-498"><span class="linenos">498</span></a>            <span class="n">df_filtered</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Drop rows with NaNs</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-499"><a href="#CTD.plot_depth_salinity_density_mld_line-499"><span class="linenos">499</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-500"><a href="#CTD.plot_depth_salinity_density_mld_line-500"><span class="linenos">500</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-501"><a href="#CTD.plot_depth_salinity_density_mld_line-501"><span class="linenos">501</span></a>            <span class="k">return</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-502"><a href="#CTD.plot_depth_salinity_density_mld_line-502"><span class="linenos">502</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;surface_salinity&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-503"><a href="#CTD.plot_depth_salinity_density_mld_line-503"><span class="linenos">503</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;surface_temperature&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-504"><a href="#CTD.plot_depth_salinity_density_mld_line-504"><span class="linenos">504</span></a>        <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;meltwater_fraction&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-505"><a href="#CTD.plot_depth_salinity_density_mld_line-505"><span class="linenos">505</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-506"><a href="#CTD.plot_depth_salinity_density_mld_line-506"><span class="linenos">506</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-507"><a href="#CTD.plot_depth_salinity_density_mld_line-507"><span class="linenos">507</span></a>        <span class="c1"># Dynamically set y-axis limits based on depth data</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-508"><a href="#CTD.plot_depth_salinity_density_mld_line-508"><span class="linenos">508</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-509"><a href="#CTD.plot_depth_salinity_density_mld_line-509"><span class="linenos">509</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">max_depth</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Assuming depth increases downwards</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-510"><a href="#CTD.plot_depth_salinity_density_mld_line-510"><span class="linenos">510</span></a>        <span class="n">lowess</span> <span class="o">=</span> <span class="n">statsmodels</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">nonparametric</span><span class="o">.</span><span class="n">lowess</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-511"><a href="#CTD.plot_depth_salinity_density_mld_line-511"><span class="linenos">511</span></a>        <span class="n">salinity_lowess</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-512"><a href="#CTD.plot_depth_salinity_density_mld_line-512"><span class="linenos">512</span></a>        <span class="n">salinity_depths</span><span class="p">,</span> <span class="n">salinity_smooth</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">salinity_lowess</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-513"><a href="#CTD.plot_depth_salinity_density_mld_line-513"><span class="linenos">513</span></a>        <span class="n">color_salinity</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-514"><a href="#CTD.plot_depth_salinity_density_mld_line-514"><span class="linenos">514</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">salinity_smooth</span><span class="p">,</span> <span class="n">salinity_depths</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Practical Salinity&#39;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-515"><a href="#CTD.plot_depth_salinity_density_mld_line-515"><span class="linenos">515</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Practical Salinity (PSU)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-516"><a href="#CTD.plot_depth_salinity_density_mld_line-516"><span class="linenos">516</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-517"><a href="#CTD.plot_depth_salinity_density_mld_line-517"><span class="linenos">517</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-518"><a href="#CTD.plot_depth_salinity_density_mld_line-518"><span class="linenos">518</span></a>        <span class="n">density_lowess</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-519"><a href="#CTD.plot_depth_salinity_density_mld_line-519"><span class="linenos">519</span></a>        <span class="n">density_depths</span><span class="p">,</span> <span class="n">density_smooth</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">density_lowess</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-520"><a href="#CTD.plot_depth_salinity_density_mld_line-520"><span class="linenos">520</span></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-521"><a href="#CTD.plot_depth_salinity_density_mld_line-521"><span class="linenos">521</span></a>        <span class="n">color_density</span> <span class="o">=</span> <span class="s1">&#39;tab:red&#39;</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-522"><a href="#CTD.plot_depth_salinity_density_mld_line-522"><span class="linenos">522</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">density_smooth</span><span class="p">,</span> <span class="n">density_depths</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-523"><a href="#CTD.plot_depth_salinity_density_mld_line-523"><span class="linenos">523</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-524"><a href="#CTD.plot_depth_salinity_density_mld_line-524"><span class="linenos">524</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-525"><a href="#CTD.plot_depth_salinity_density_mld_line-525"><span class="linenos">525</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-526"><a href="#CTD.plot_depth_salinity_density_mld_line-526"><span class="linenos">526</span></a>        <span class="n">mld_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-527"><a href="#CTD.plot_depth_salinity_density_mld_line-527"><span class="linenos">527</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-528"><a href="#CTD.plot_depth_salinity_density_mld_line-528"><span class="linenos">528</span></a>            <span class="k">if</span> <span class="s1">&#39;MLD&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-529"><a href="#CTD.plot_depth_salinity_density_mld_line-529"><span class="linenos">529</span></a>                <span class="n">mld_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-530"><a href="#CTD.plot_depth_salinity_density_mld_line-530"><span class="linenos">530</span></a>        <span class="n">refdepth_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-531"><a href="#CTD.plot_depth_salinity_density_mld_line-531"><span class="linenos">531</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-532"><a href="#CTD.plot_depth_salinity_density_mld_line-532"><span class="linenos">532</span></a>            <span class="k">if</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-533"><a href="#CTD.plot_depth_salinity_density_mld_line-533"><span class="linenos">533</span></a>                <span class="n">refdepth_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-534"><a href="#CTD.plot_depth_salinity_density_mld_line-534"><span class="linenos">534</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mld_col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mld_cols</span><span class="p">):</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-535"><a href="#CTD.plot_depth_salinity_density_mld_line-535"><span class="linenos">535</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-536"><a href="#CTD.plot_depth_salinity_density_mld_line-536"><span class="linenos">536</span></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> Ref&#39;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-537"><a href="#CTD.plot_depth_salinity_density_mld_line-537"><span class="linenos">537</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;MLD with respect to </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-538"><a href="#CTD.plot_depth_salinity_density_mld_line-538"><span class="linenos">538</span></a>                     <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">())</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-539"><a href="#CTD.plot_depth_salinity_density_mld_line-539"><span class="linenos">539</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-540"><a href="#CTD.plot_depth_salinity_density_mld_line-540"><span class="linenos">540</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-541"><a href="#CTD.plot_depth_salinity_density_mld_line-541"><span class="linenos">541</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density with LOESS Transform &quot;</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-542"><a href="#CTD.plot_depth_salinity_density_mld_line-542"><span class="linenos">542</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> THIS IS AN UNSTABLE WATER COLUMN &quot;</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-543"><a href="#CTD.plot_depth_salinity_density_mld_line-543"><span class="linenos">543</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(Higher density fluid lies above lower density fluid)&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-544"><a href="#CTD.plot_depth_salinity_density_mld_line-544"><span class="linenos">544</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-545"><a href="#CTD.plot_depth_salinity_density_mld_line-545"><span class="linenos">545</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-546"><a href="#CTD.plot_depth_salinity_density_mld_line-546"><span class="linenos">546</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density with LOESS Transform </span><span class="se">\n</span><span class="s2"> Surface Salinity </span><span class="si">{</span><span class="n">surface_salinity</span><span class="si">}</span><span class="se">\n</span><span class="s2">, Surface Temperature </span><span class="si">{</span><span class="n">surface_temperature</span><span class="si">}</span><span class="se">\n</span><span class="s2">, Meltwater Fraction </span><span class="si">{</span><span class="n">meltwater_fraction</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-547"><a href="#CTD.plot_depth_salinity_density_mld_line-547"><span class="linenos">547</span></a>
</span><span id="CTD.plot_depth_salinity_density_mld_line-548"><a href="#CTD.plot_depth_salinity_density_mld_line-548"><span class="linenos">548</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-549"><a href="#CTD.plot_depth_salinity_density_mld_line-549"><span class="linenos">549</span></a>        <span class="n">lines</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-550"><a href="#CTD.plot_depth_salinity_density_mld_line-550"><span class="linenos">550</span></a>        <span class="n">ax2_legend</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-551"><a href="#CTD.plot_depth_salinity_density_mld_line-551"><span class="linenos">551</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">),</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-552"><a href="#CTD.plot_depth_salinity_density_mld_line-552"><span class="linenos">552</span></a>                   <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-553"><a href="#CTD.plot_depth_salinity_density_mld_line-553"><span class="linenos">553</span></a>        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;plots/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_salinity_density_depth_plot_dual_x_axes_line.png&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-554"><a href="#CTD.plot_depth_salinity_density_mld_line-554"><span class="linenos">554</span></a>        <span class="n">plot_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-555"><a href="#CTD.plot_depth_salinity_density_mld_line-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)):</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-556"><a href="#CTD.plot_depth_salinity_density_mld_line-556"><span class="linenos">556</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-557"><a href="#CTD.plot_depth_salinity_density_mld_line-557"><span class="linenos">557</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">)</span>
</span><span id="CTD.plot_depth_salinity_density_mld_line-558"><a href="#CTD.plot_depth_salinity_density_mld_line-558"><span class="linenos">558</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generates a plot of depth vs. salinity and density, applying LOESS smoothing to the data.
Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.
Saves the plot as an image file.</p>
</div>


                            </div>
                            <div id="CTD.plot_depth_density_salinity_mld_scatter" class="classattr">
                                        <input id="CTD.plot_depth_density_salinity_mld_scatter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_depth_density_salinity_mld_scatter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.plot_depth_density_salinity_mld_scatter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.plot_depth_density_salinity_mld_scatter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.plot_depth_density_salinity_mld_scatter-560"><a href="#CTD.plot_depth_density_salinity_mld_scatter-560"><span class="linenos">560</span></a>    <span class="k">def</span> <span class="nf">plot_depth_density_salinity_mld_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-561"><a href="#CTD.plot_depth_density_salinity_mld_scatter-561"><span class="linenos">561</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-562"><a href="#CTD.plot_depth_density_salinity_mld_scatter-562"><span class="linenos">562</span></a><span class="sd">        Generates a scatter plot of depth vs. salinity and density.</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-563"><a href="#CTD.plot_depth_density_salinity_mld_scatter-563"><span class="linenos">563</span></a><span class="sd">        Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-564"><a href="#CTD.plot_depth_density_salinity_mld_scatter-564"><span class="linenos">564</span></a><span class="sd">        Saves the plot as an image file.</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-565"><a href="#CTD.plot_depth_density_salinity_mld_scatter-565"><span class="linenos">565</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-566"><a href="#CTD.plot_depth_density_salinity_mld_scatter-566"><span class="linenos">566</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-567"><a href="#CTD.plot_depth_density_salinity_mld_scatter-567"><span class="linenos">567</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-568"><a href="#CTD.plot_depth_density_salinity_mld_scatter-568"><span class="linenos">568</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-569"><a href="#CTD.plot_depth_density_salinity_mld_scatter-569"><span class="linenos">569</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-570"><a href="#CTD.plot_depth_density_salinity_mld_scatter-570"><span class="linenos">570</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-571"><a href="#CTD.plot_depth_density_salinity_mld_scatter-571"><span class="linenos">571</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-572"><a href="#CTD.plot_depth_density_salinity_mld_scatter-572"><span class="linenos">572</span></a>            <span class="k">return</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-573"><a href="#CTD.plot_depth_density_salinity_mld_scatter-573"><span class="linenos">573</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-574"><a href="#CTD.plot_depth_density_salinity_mld_scatter-574"><span class="linenos">574</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_salinity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-575"><a href="#CTD.plot_depth_density_salinity_mld_scatter-575"><span class="linenos">575</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-576"><a href="#CTD.plot_depth_density_salinity_mld_scatter-576"><span class="linenos">576</span></a>        <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">meltwater_fraction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-577"><a href="#CTD.plot_depth_density_salinity_mld_scatter-577"><span class="linenos">577</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-578"><a href="#CTD.plot_depth_density_salinity_mld_scatter-578"><span class="linenos">578</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-579"><a href="#CTD.plot_depth_density_salinity_mld_scatter-579"><span class="linenos">579</span></a>        <span class="c1"># Dynamically set y-axis limits based on depth data</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-580"><a href="#CTD.plot_depth_density_salinity_mld_scatter-580"><span class="linenos">580</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-581"><a href="#CTD.plot_depth_density_salinity_mld_scatter-581"><span class="linenos">581</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">max_depth</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Assuming depth increases downwards</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-582"><a href="#CTD.plot_depth_density_salinity_mld_scatter-582"><span class="linenos">582</span></a>        <span class="n">color_salinity</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-583"><a href="#CTD.plot_depth_density_salinity_mld_scatter-583"><span class="linenos">583</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">,</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-584"><a href="#CTD.plot_depth_density_salinity_mld_scatter-584"><span class="linenos">584</span></a>                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Practical Salinity&#39;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-585"><a href="#CTD.plot_depth_density_salinity_mld_scatter-585"><span class="linenos">585</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Practical Salinity (PSU)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-586"><a href="#CTD.plot_depth_density_salinity_mld_scatter-586"><span class="linenos">586</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-587"><a href="#CTD.plot_depth_density_salinity_mld_scatter-587"><span class="linenos">587</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_salinity</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-588"><a href="#CTD.plot_depth_density_salinity_mld_scatter-588"><span class="linenos">588</span></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-589"><a href="#CTD.plot_depth_density_salinity_mld_scatter-589"><span class="linenos">589</span></a>        <span class="n">color_density</span> <span class="o">=</span> <span class="s1">&#39;tab:red&#39;</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-590"><a href="#CTD.plot_depth_density_salinity_mld_scatter-590"><span class="linenos">590</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-591"><a href="#CTD.plot_depth_density_salinity_mld_scatter-591"><span class="linenos">591</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Density (kg/m^3)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-592"><a href="#CTD.plot_depth_density_salinity_mld_scatter-592"><span class="linenos">592</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_density</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-593"><a href="#CTD.plot_depth_density_salinity_mld_scatter-593"><span class="linenos">593</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-594"><a href="#CTD.plot_depth_density_salinity_mld_scatter-594"><span class="linenos">594</span></a>        <span class="n">mld_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-595"><a href="#CTD.plot_depth_density_salinity_mld_scatter-595"><span class="linenos">595</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-596"><a href="#CTD.plot_depth_density_salinity_mld_scatter-596"><span class="linenos">596</span></a>            <span class="k">if</span> <span class="s1">&#39;MLD&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-597"><a href="#CTD.plot_depth_density_salinity_mld_scatter-597"><span class="linenos">597</span></a>                <span class="n">mld_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-598"><a href="#CTD.plot_depth_density_salinity_mld_scatter-598"><span class="linenos">598</span></a>        <span class="n">refdepth_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-599"><a href="#CTD.plot_depth_density_salinity_mld_scatter-599"><span class="linenos">599</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-600"><a href="#CTD.plot_depth_density_salinity_mld_scatter-600"><span class="linenos">600</span></a>            <span class="k">if</span> <span class="s1">&#39;Actual&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-601"><a href="#CTD.plot_depth_density_salinity_mld_scatter-601"><span class="linenos">601</span></a>                <span class="n">refdepth_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-602"><a href="#CTD.plot_depth_density_salinity_mld_scatter-602"><span class="linenos">602</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mld_col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mld_cols</span><span class="p">):</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-603"><a href="#CTD.plot_depth_density_salinity_mld_scatter-603"><span class="linenos">603</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-604"><a href="#CTD.plot_depth_density_salinity_mld_scatter-604"><span class="linenos">604</span></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> Ref&#39;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-605"><a href="#CTD.plot_depth_density_salinity_mld_scatter-605"><span class="linenos">605</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;MLD with respect to </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-606"><a href="#CTD.plot_depth_density_salinity_mld_scatter-606"><span class="linenos">606</span></a>                     <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">())</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-607"><a href="#CTD.plot_depth_density_salinity_mld_scatter-607"><span class="linenos">607</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-608"><a href="#CTD.plot_depth_density_salinity_mld_scatter-608"><span class="linenos">608</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-609"><a href="#CTD.plot_depth_density_salinity_mld_scatter-609"><span class="linenos">609</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density &quot;</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-610"><a href="#CTD.plot_depth_density_salinity_mld_scatter-610"><span class="linenos">610</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> THIS IS AN UNSTABLE WATER COLUMN &quot;</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-611"><a href="#CTD.plot_depth_density_salinity_mld_scatter-611"><span class="linenos">611</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(Higher density fluid lies above lower density fluid)&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-612"><a href="#CTD.plot_depth_density_salinity_mld_scatter-612"><span class="linenos">612</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-613"><a href="#CTD.plot_depth_density_salinity_mld_scatter-613"><span class="linenos">613</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-614"><a href="#CTD.plot_depth_density_salinity_mld_scatter-614"><span class="linenos">614</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Salinity and Density </span><span class="se">\n</span><span class="s2"> Surface Salinity </span><span class="si">{</span><span class="n">surface_salinity</span><span class="si">}</span><span class="s2">, Meltwater Fraction </span><span class="si">{</span><span class="n">meltwater_fraction</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-615"><a href="#CTD.plot_depth_density_salinity_mld_scatter-615"><span class="linenos">615</span></a>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-616"><a href="#CTD.plot_depth_density_salinity_mld_scatter-616"><span class="linenos">616</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-617"><a href="#CTD.plot_depth_density_salinity_mld_scatter-617"><span class="linenos">617</span></a>        <span class="n">lines</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-618"><a href="#CTD.plot_depth_density_salinity_mld_scatter-618"><span class="linenos">618</span></a>        <span class="n">ax2_legend</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-619"><a href="#CTD.plot_depth_density_salinity_mld_scatter-619"><span class="linenos">619</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span> <span class="o">+</span> <span class="n">ax2_legend</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">),</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-620"><a href="#CTD.plot_depth_density_salinity_mld_scatter-620"><span class="linenos">620</span></a>                   <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-621"><a href="#CTD.plot_depth_density_salinity_mld_scatter-621"><span class="linenos">621</span></a>        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;plots/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_salinity_density_depth_plot_dual_x_axes.png&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-622"><a href="#CTD.plot_depth_density_salinity_mld_scatter-622"><span class="linenos">622</span></a>        <span class="n">plot_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-623"><a href="#CTD.plot_depth_density_salinity_mld_scatter-623"><span class="linenos">623</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)):</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-624"><a href="#CTD.plot_depth_density_salinity_mld_scatter-624"><span class="linenos">624</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-625"><a href="#CTD.plot_depth_density_salinity_mld_scatter-625"><span class="linenos">625</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">)</span>
</span><span id="CTD.plot_depth_density_salinity_mld_scatter-626"><a href="#CTD.plot_depth_density_salinity_mld_scatter-626"><span class="linenos">626</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generates a scatter plot of depth vs. salinity and density.
Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.
Saves the plot as an image file.</p>
</div>


                            </div>
                            <div id="CTD.plot_depth_temperature_scatter" class="classattr">
                                        <input id="CTD.plot_depth_temperature_scatter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_depth_temperature_scatter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.plot_depth_temperature_scatter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.plot_depth_temperature_scatter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.plot_depth_temperature_scatter-628"><a href="#CTD.plot_depth_temperature_scatter-628"><span class="linenos">628</span></a>    <span class="k">def</span> <span class="nf">plot_depth_temperature_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.plot_depth_temperature_scatter-629"><a href="#CTD.plot_depth_temperature_scatter-629"><span class="linenos">629</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.plot_depth_temperature_scatter-630"><a href="#CTD.plot_depth_temperature_scatter-630"><span class="linenos">630</span></a><span class="sd">        Generates a scatter plot of depth vs. temperature.</span>
</span><span id="CTD.plot_depth_temperature_scatter-631"><a href="#CTD.plot_depth_temperature_scatter-631"><span class="linenos">631</span></a><span class="sd">        Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.</span>
</span><span id="CTD.plot_depth_temperature_scatter-632"><a href="#CTD.plot_depth_temperature_scatter-632"><span class="linenos">632</span></a><span class="sd">        Saves the plot as an image file.</span>
</span><span id="CTD.plot_depth_temperature_scatter-633"><a href="#CTD.plot_depth_temperature_scatter-633"><span class="linenos">633</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.plot_depth_temperature_scatter-634"><a href="#CTD.plot_depth_temperature_scatter-634"><span class="linenos">634</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.plot_depth_temperature_scatter-635"><a href="#CTD.plot_depth_temperature_scatter-635"><span class="linenos">635</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
</span><span id="CTD.plot_depth_temperature_scatter-636"><a href="#CTD.plot_depth_temperature_scatter-636"><span class="linenos">636</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
</span><span id="CTD.plot_depth_temperature_scatter-637"><a href="#CTD.plot_depth_temperature_scatter-637"><span class="linenos">637</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="CTD.plot_depth_temperature_scatter-638"><a href="#CTD.plot_depth_temperature_scatter-638"><span class="linenos">638</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CTD.plot_depth_temperature_scatter-639"><a href="#CTD.plot_depth_temperature_scatter-639"><span class="linenos">639</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="CTD.plot_depth_temperature_scatter-640"><a href="#CTD.plot_depth_temperature_scatter-640"><span class="linenos">640</span></a>            <span class="k">return</span>
</span><span id="CTD.plot_depth_temperature_scatter-641"><a href="#CTD.plot_depth_temperature_scatter-641"><span class="linenos">641</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-642"><a href="#CTD.plot_depth_temperature_scatter-642"><span class="linenos">642</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_salinity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.plot_depth_temperature_scatter-643"><a href="#CTD.plot_depth_temperature_scatter-643"><span class="linenos">643</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">surface_temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.plot_depth_temperature_scatter-644"><a href="#CTD.plot_depth_temperature_scatter-644"><span class="linenos">644</span></a>        <span class="n">meltwater_fraction</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">meltwater_fraction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.plot_depth_temperature_scatter-645"><a href="#CTD.plot_depth_temperature_scatter-645"><span class="linenos">645</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
</span><span id="CTD.plot_depth_temperature_scatter-646"><a href="#CTD.plot_depth_temperature_scatter-646"><span class="linenos">646</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="CTD.plot_depth_temperature_scatter-647"><a href="#CTD.plot_depth_temperature_scatter-647"><span class="linenos">647</span></a>        <span class="c1"># Dynamically set y-axis limits based on depth data</span>
</span><span id="CTD.plot_depth_temperature_scatter-648"><a href="#CTD.plot_depth_temperature_scatter-648"><span class="linenos">648</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CTD.plot_depth_temperature_scatter-649"><a href="#CTD.plot_depth_temperature_scatter-649"><span class="linenos">649</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">max_depth</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Assuming depth increases downwards</span>
</span><span id="CTD.plot_depth_temperature_scatter-650"><a href="#CTD.plot_depth_temperature_scatter-650"><span class="linenos">650</span></a>
</span><span id="CTD.plot_depth_temperature_scatter-651"><a href="#CTD.plot_depth_temperature_scatter-651"><span class="linenos">651</span></a>        <span class="n">color_temp</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
</span><span id="CTD.plot_depth_temperature_scatter-652"><a href="#CTD.plot_depth_temperature_scatter-652"><span class="linenos">652</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;temperature_00&#39;</span><span class="p">],</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_temp</span><span class="p">,</span>
</span><span id="CTD.plot_depth_temperature_scatter-653"><a href="#CTD.plot_depth_temperature_scatter-653"><span class="linenos">653</span></a>                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-654"><a href="#CTD.plot_depth_temperature_scatter-654"><span class="linenos">654</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (°C)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_temp</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-655"><a href="#CTD.plot_depth_temperature_scatter-655"><span class="linenos">655</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-656"><a href="#CTD.plot_depth_temperature_scatter-656"><span class="linenos">656</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color_temp</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-657"><a href="#CTD.plot_depth_temperature_scatter-657"><span class="linenos">657</span></a>        <span class="n">mld_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD.plot_depth_temperature_scatter-658"><a href="#CTD.plot_depth_temperature_scatter-658"><span class="linenos">658</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.plot_depth_temperature_scatter-659"><a href="#CTD.plot_depth_temperature_scatter-659"><span class="linenos">659</span></a>            <span class="k">if</span> <span class="s2">&quot;MLD&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s2">&quot;Actual&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD.plot_depth_temperature_scatter-660"><a href="#CTD.plot_depth_temperature_scatter-660"><span class="linenos">660</span></a>                <span class="n">mld_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD.plot_depth_temperature_scatter-661"><a href="#CTD.plot_depth_temperature_scatter-661"><span class="linenos">661</span></a>        <span class="n">refdepth_cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CTD.plot_depth_temperature_scatter-662"><a href="#CTD.plot_depth_temperature_scatter-662"><span class="linenos">662</span></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.plot_depth_temperature_scatter-663"><a href="#CTD.plot_depth_temperature_scatter-663"><span class="linenos">663</span></a>            <span class="k">if</span> <span class="s2">&quot;Reference Depth&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="CTD.plot_depth_temperature_scatter-664"><a href="#CTD.plot_depth_temperature_scatter-664"><span class="linenos">664</span></a>                <span class="n">refdepth_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="CTD.plot_depth_temperature_scatter-665"><a href="#CTD.plot_depth_temperature_scatter-665"><span class="linenos">665</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mld_col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mld_cols</span><span class="p">):</span>
</span><span id="CTD.plot_depth_temperature_scatter-666"><a href="#CTD.plot_depth_temperature_scatter-666"><span class="linenos">666</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
</span><span id="CTD.plot_depth_temperature_scatter-667"><a href="#CTD.plot_depth_temperature_scatter-667"><span class="linenos">667</span></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;MLD </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> Ref&#39;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-668"><a href="#CTD.plot_depth_temperature_scatter-668"><span class="linenos">668</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mld_col</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;MLD with respect to </span><span class="si">{</span><span class="n">refdepth_cols</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">m&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
</span><span id="CTD.plot_depth_temperature_scatter-669"><a href="#CTD.plot_depth_temperature_scatter-669"><span class="linenos">669</span></a>                     <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">())</span>
</span><span id="CTD.plot_depth_temperature_scatter-670"><a href="#CTD.plot_depth_temperature_scatter-670"><span class="linenos">670</span></a>        <span class="k">if</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CTD.plot_depth_temperature_scatter-671"><a href="#CTD.plot_depth_temperature_scatter-671"><span class="linenos">671</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD.plot_depth_temperature_scatter-672"><a href="#CTD.plot_depth_temperature_scatter-672"><span class="linenos">672</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Temperature </span><span class="se">\n</span><span class="s2"> &quot;</span>
</span><span id="CTD.plot_depth_temperature_scatter-673"><a href="#CTD.plot_depth_temperature_scatter-673"><span class="linenos">673</span></a>                <span class="sa">f</span><span class="s2">&quot;THIS IS AN UNSTABLE WATER COLUMN </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="CTD.plot_depth_temperature_scatter-674"><a href="#CTD.plot_depth_temperature_scatter-674"><span class="linenos">674</span></a>                <span class="sa">f</span><span class="s2">&quot;(Higher density fluid lies above lower density fluid)&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-675"><a href="#CTD.plot_depth_temperature_scatter-675"><span class="linenos">675</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.plot_depth_temperature_scatter-676"><a href="#CTD.plot_depth_temperature_scatter-676"><span class="linenos">676</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="CTD.plot_depth_temperature_scatter-677"><a href="#CTD.plot_depth_temperature_scatter-677"><span class="linenos">677</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Depth vs. Temperature </span><span class="se">\n</span><span class="s2"> Surface Temperature </span><span class="si">{</span><span class="n">surface_temperature</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-678"><a href="#CTD.plot_depth_temperature_scatter-678"><span class="linenos">678</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-679"><a href="#CTD.plot_depth_temperature_scatter-679"><span class="linenos">679</span></a>        <span class="n">lines</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="CTD.plot_depth_temperature_scatter-680"><a href="#CTD.plot_depth_temperature_scatter-680"><span class="linenos">680</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-681"><a href="#CTD.plot_depth_temperature_scatter-681"><span class="linenos">681</span></a>        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;plots/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">_temperature_depth_plot.png&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-682"><a href="#CTD.plot_depth_temperature_scatter-682"><span class="linenos">682</span></a>        <span class="n">plot_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">,</span> <span class="s2">&quot;plots&quot;</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-683"><a href="#CTD.plot_depth_temperature_scatter-683"><span class="linenos">683</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)):</span>
</span><span id="CTD.plot_depth_temperature_scatter-684"><a href="#CTD.plot_depth_temperature_scatter-684"><span class="linenos">684</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">plot_folder</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-685"><a href="#CTD.plot_depth_temperature_scatter-685"><span class="linenos">685</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">)</span>
</span><span id="CTD.plot_depth_temperature_scatter-686"><a href="#CTD.plot_depth_temperature_scatter-686"><span class="linenos">686</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generates a scatter plot of depth vs. temperature.
Adds horizontal lines indicating the mixed layer depth (MLD) at different reference depths.
Saves the plot as an image file.</p>
</div>


                            </div>
                            <div id="CTD.get_sample_location" class="classattr">
                                        <input id="CTD.get_sample_location-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_sample_location</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rsk</span>, </span><span class="param"><span class="n">filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.get_sample_location-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.get_sample_location"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.get_sample_location-793"><a href="#CTD.get_sample_location-793"><span class="linenos">793</span></a>    <span class="k">def</span> <span class="nf">get_sample_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rsk</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="CTD.get_sample_location-794"><a href="#CTD.get_sample_location-794"><span class="linenos">794</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.get_sample_location-795"><a href="#CTD.get_sample_location-795"><span class="linenos">795</span></a><span class="sd">        Retrieves the sample location data from the RSK file. If no location data is found,</span>
</span><span id="CTD.get_sample_location-796"><a href="#CTD.get_sample_location-796"><span class="linenos">796</span></a><span class="sd">        it attempts to estimate the location using the master sheet. Returns the latitude,</span>
</span><span id="CTD.get_sample_location-797"><a href="#CTD.get_sample_location-797"><span class="linenos">797</span></a><span class="sd">        longitude, and updated filename.</span>
</span><span id="CTD.get_sample_location-798"><a href="#CTD.get_sample_location-798"><span class="linenos">798</span></a>
</span><span id="CTD.get_sample_location-799"><a href="#CTD.get_sample_location-799"><span class="linenos">799</span></a><span class="sd">        Parameters</span>
</span><span id="CTD.get_sample_location-800"><a href="#CTD.get_sample_location-800"><span class="linenos">800</span></a><span class="sd">        ----------</span>
</span><span id="CTD.get_sample_location-801"><a href="#CTD.get_sample_location-801"><span class="linenos">801</span></a><span class="sd">        rsk : RSK</span>
</span><span id="CTD.get_sample_location-802"><a href="#CTD.get_sample_location-802"><span class="linenos">802</span></a><span class="sd">            Ruskin object of the RSK file.</span>
</span><span id="CTD.get_sample_location-803"><a href="#CTD.get_sample_location-803"><span class="linenos">803</span></a><span class="sd">        filename : str</span>
</span><span id="CTD.get_sample_location-804"><a href="#CTD.get_sample_location-804"><span class="linenos">804</span></a><span class="sd">            The filename of the RSK file.</span>
</span><span id="CTD.get_sample_location-805"><a href="#CTD.get_sample_location-805"><span class="linenos">805</span></a>
</span><span id="CTD.get_sample_location-806"><a href="#CTD.get_sample_location-806"><span class="linenos">806</span></a><span class="sd">        Returns</span>
</span><span id="CTD.get_sample_location-807"><a href="#CTD.get_sample_location-807"><span class="linenos">807</span></a><span class="sd">        -------</span>
</span><span id="CTD.get_sample_location-808"><a href="#CTD.get_sample_location-808"><span class="linenos">808</span></a><span class="sd">        tuple</span>
</span><span id="CTD.get_sample_location-809"><a href="#CTD.get_sample_location-809"><span class="linenos">809</span></a><span class="sd">            A tuple containing the latitude associated with the sample, longitude associated with the sample,</span>
</span><span id="CTD.get_sample_location-810"><a href="#CTD.get_sample_location-810"><span class="linenos">810</span></a><span class="sd">            and the filename, adds _gps if the location was in the ruskin file,</span>
</span><span id="CTD.get_sample_location-811"><a href="#CTD.get_sample_location-811"><span class="linenos">811</span></a><span class="sd">            _gpscm if located via mastersheet, or _gpserror if unable to locate.</span>
</span><span id="CTD.get_sample_location-812"><a href="#CTD.get_sample_location-812"><span class="linenos">812</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.get_sample_location-813"><a href="#CTD.get_sample_location-813"><span class="linenos">813</span></a>        <span class="c1"># Adding geo data, assumes no drift and uses the first lat long in the file if there is one</span>
</span><span id="CTD.get_sample_location-814"><a href="#CTD.get_sample_location-814"><span class="linenos">814</span></a>        <span class="n">geo_data_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">rsk</span><span class="o">.</span><span class="n">geodata</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)))</span>
</span><span id="CTD.get_sample_location-815"><a href="#CTD.get_sample_location-815"><span class="linenos">815</span></a>        <span class="k">if</span> <span class="n">geo_data_length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD.get_sample_location-816"><a href="#CTD.get_sample_location-816"><span class="linenos">816</span></a>            <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_master_sheet</span><span class="p">(</span>
</span><span id="CTD.get_sample_location-817"><a href="#CTD.get_sample_location-817"><span class="linenos">817</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="CTD.get_sample_location-818"><a href="#CTD.get_sample_location-818"><span class="linenos">818</span></a>            <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="CTD.get_sample_location-819"><a href="#CTD.get_sample_location-819"><span class="linenos">819</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.get_sample_location-820"><a href="#CTD.get_sample_location-820"><span class="linenos">820</span></a>            <span class="k">for</span> <span class="n">geo</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">rsk</span><span class="o">.</span><span class="n">geodata</span><span class="p">(),</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="CTD.get_sample_location-821"><a href="#CTD.get_sample_location-821"><span class="linenos">821</span></a>                <span class="c1"># Is there geo data?</span>
</span><span id="CTD.get_sample_location-822"><a href="#CTD.get_sample_location-822"><span class="linenos">822</span></a>                <span class="k">if</span> <span class="n">geo</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CTD.get_sample_location-823"><a href="#CTD.get_sample_location-823"><span class="linenos">823</span></a>                    <span class="c1"># If there is, is it from the southern ocean?</span>
</span><span id="CTD.get_sample_location-824"><a href="#CTD.get_sample_location-824"><span class="linenos">824</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">60</span><span class="p">):</span>
</span><span id="CTD.get_sample_location-825"><a href="#CTD.get_sample_location-825"><span class="linenos">825</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="CTD.get_sample_location-826"><a href="#CTD.get_sample_location-826"><span class="linenos">826</span></a>                            <span class="n">latitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.get_sample_location-827"><a href="#CTD.get_sample_location-827"><span class="linenos">827</span></a>                            <span class="n">longitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.get_sample_location-828"><a href="#CTD.get_sample_location-828"><span class="linenos">828</span></a>                            <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;_gps&quot;</span>
</span><span id="CTD.get_sample_location-829"><a href="#CTD.get_sample_location-829"><span class="linenos">829</span></a>                            <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="CTD.get_sample_location-830"><a href="#CTD.get_sample_location-830"><span class="linenos">830</span></a>                        <span class="k">except</span><span class="p">:</span>
</span><span id="CTD.get_sample_location-831"><a href="#CTD.get_sample_location-831"><span class="linenos">831</span></a>                            <span class="n">latitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">latitude</span>
</span><span id="CTD.get_sample_location-832"><a href="#CTD.get_sample_location-832"><span class="linenos">832</span></a>                            <span class="n">longitude_intermediate</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">longitude</span>
</span><span id="CTD.get_sample_location-833"><a href="#CTD.get_sample_location-833"><span class="linenos">833</span></a>                            <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;_gps&quot;</span>
</span><span id="CTD.get_sample_location-834"><a href="#CTD.get_sample_location-834"><span class="linenos">834</span></a>                            <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="CTD.get_sample_location-835"><a href="#CTD.get_sample_location-835"><span class="linenos">835</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.get_sample_location-836"><a href="#CTD.get_sample_location-836"><span class="linenos">836</span></a>                        <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_master_sheet</span><span class="p">(</span>
</span><span id="CTD.get_sample_location-837"><a href="#CTD.get_sample_location-837"><span class="linenos">837</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">master_sheet_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="CTD.get_sample_location-838"><a href="#CTD.get_sample_location-838"><span class="linenos">838</span></a>                        <span class="k">return</span> <span class="n">latitude_intermediate</span><span class="p">,</span> <span class="n">longitude_intermediate</span><span class="p">,</span> <span class="n">filename</span>
</span><span id="CTD.get_sample_location-839"><a href="#CTD.get_sample_location-839"><span class="linenos">839</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.get_sample_location-840"><a href="#CTD.get_sample_location-840"><span class="linenos">840</span></a>                    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;gpserror&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves the sample location data from the RSK file. If no location data is found,
it attempts to estimate the location using the master sheet. Returns the latitude,
longitude, and updated filename.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>rsk</strong> (RSK):
Ruskin object of the RSK file.</li>
<li><strong>filename</strong> (str):
The filename of the RSK file.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: A tuple containing the latitude associated with the sample, longitude associated with the sample,
and the filename, adds _gps if the location was in the ruskin file,
_gpscm if located via mastersheet, or _gpserror if unable to locate.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.clean_salinity_autoencoder" class="classattr">
                                        <input id="CTD.clean_salinity_autoencoder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clean_salinity_autoencoder</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.clean_salinity_autoencoder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.clean_salinity_autoencoder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.clean_salinity_autoencoder-842"><a href="#CTD.clean_salinity_autoencoder-842"><span class="linenos"> 842</span></a>    <span class="k">def</span> <span class="nf">clean_salinity_autoencoder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CTD.clean_salinity_autoencoder-843"><a href="#CTD.clean_salinity_autoencoder-843"><span class="linenos"> 843</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.clean_salinity_autoencoder-844"><a href="#CTD.clean_salinity_autoencoder-844"><span class="linenos"> 844</span></a><span class="sd">        Cleans salinity using an LSTM autoencoder ML model.</span>
</span><span id="CTD.clean_salinity_autoencoder-845"><a href="#CTD.clean_salinity_autoencoder-845"><span class="linenos"> 845</span></a><span class="sd">        Warning: This process will bin the data every 0.5 dbar of pressure.</span>
</span><span id="CTD.clean_salinity_autoencoder-846"><a href="#CTD.clean_salinity_autoencoder-846"><span class="linenos"> 846</span></a>
</span><span id="CTD.clean_salinity_autoencoder-847"><a href="#CTD.clean_salinity_autoencoder-847"><span class="linenos"> 847</span></a><span class="sd">        Returns</span>
</span><span id="CTD.clean_salinity_autoencoder-848"><a href="#CTD.clean_salinity_autoencoder-848"><span class="linenos"> 848</span></a><span class="sd">        -------</span>
</span><span id="CTD.clean_salinity_autoencoder-849"><a href="#CTD.clean_salinity_autoencoder-849"><span class="linenos"> 849</span></a><span class="sd">        DataFrame</span>
</span><span id="CTD.clean_salinity_autoencoder-850"><a href="#CTD.clean_salinity_autoencoder-850"><span class="linenos"> 850</span></a><span class="sd">            CTD data with clean salinity values.</span>
</span><span id="CTD.clean_salinity_autoencoder-851"><a href="#CTD.clean_salinity_autoencoder-851"><span class="linenos"> 851</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.clean_salinity_autoencoder-852"><a href="#CTD.clean_salinity_autoencoder-852"><span class="linenos"> 852</span></a>
</span><span id="CTD.clean_salinity_autoencoder-853"><a href="#CTD.clean_salinity_autoencoder-853"><span class="linenos"> 853</span></a>        <span class="k">def</span> <span class="nf">loss_function</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
</span><span id="CTD.clean_salinity_autoencoder-854"><a href="#CTD.clean_salinity_autoencoder-854"><span class="linenos"> 854</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.clean_salinity_autoencoder-855"><a href="#CTD.clean_salinity_autoencoder-855"><span class="linenos"> 855</span></a><span class="sd">            MAE loss with additional term to penalize salinity predictions that increase with pressure.</span>
</span><span id="CTD.clean_salinity_autoencoder-856"><a href="#CTD.clean_salinity_autoencoder-856"><span class="linenos"> 856</span></a>
</span><span id="CTD.clean_salinity_autoencoder-857"><a href="#CTD.clean_salinity_autoencoder-857"><span class="linenos"> 857</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.clean_salinity_autoencoder-858"><a href="#CTD.clean_salinity_autoencoder-858"><span class="linenos"> 858</span></a><span class="sd">            ----------</span>
</span><span id="CTD.clean_salinity_autoencoder-859"><a href="#CTD.clean_salinity_autoencoder-859"><span class="linenos"> 859</span></a><span class="sd">            y_true</span>
</span><span id="CTD.clean_salinity_autoencoder-860"><a href="#CTD.clean_salinity_autoencoder-860"><span class="linenos"> 860</span></a><span class="sd">                True salinity tensor.</span>
</span><span id="CTD.clean_salinity_autoencoder-861"><a href="#CTD.clean_salinity_autoencoder-861"><span class="linenos"> 861</span></a><span class="sd">            y_pred</span>
</span><span id="CTD.clean_salinity_autoencoder-862"><a href="#CTD.clean_salinity_autoencoder-862"><span class="linenos"> 862</span></a><span class="sd">                Predicted salinity tensor.</span>
</span><span id="CTD.clean_salinity_autoencoder-863"><a href="#CTD.clean_salinity_autoencoder-863"><span class="linenos"> 863</span></a><span class="sd">            Returns</span>
</span><span id="CTD.clean_salinity_autoencoder-864"><a href="#CTD.clean_salinity_autoencoder-864"><span class="linenos"> 864</span></a><span class="sd">            -------</span>
</span><span id="CTD.clean_salinity_autoencoder-865"><a href="#CTD.clean_salinity_autoencoder-865"><span class="linenos"> 865</span></a><span class="sd">            float</span>
</span><span id="CTD.clean_salinity_autoencoder-866"><a href="#CTD.clean_salinity_autoencoder-866"><span class="linenos"> 866</span></a><span class="sd">                Loss value.</span>
</span><span id="CTD.clean_salinity_autoencoder-867"><a href="#CTD.clean_salinity_autoencoder-867"><span class="linenos"> 867</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.clean_salinity_autoencoder-868"><a href="#CTD.clean_salinity_autoencoder-868"><span class="linenos"> 868</span></a>            <span class="c1"># Assuming salinity is at index 0</span>
</span><span id="CTD.clean_salinity_autoencoder-869"><a href="#CTD.clean_salinity_autoencoder-869"><span class="linenos"> 869</span></a>            <span class="n">salinity_true</span> <span class="o">=</span> <span class="n">y_true</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.clean_salinity_autoencoder-870"><a href="#CTD.clean_salinity_autoencoder-870"><span class="linenos"> 870</span></a>            <span class="n">salinity_pred</span> <span class="o">=</span> <span class="n">y_pred</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.clean_salinity_autoencoder-871"><a href="#CTD.clean_salinity_autoencoder-871"><span class="linenos"> 871</span></a>
</span><span id="CTD.clean_salinity_autoencoder-872"><a href="#CTD.clean_salinity_autoencoder-872"><span class="linenos"> 872</span></a>            <span class="c1"># Calculate differences between consecutive values</span>
</span><span id="CTD.clean_salinity_autoencoder-873"><a href="#CTD.clean_salinity_autoencoder-873"><span class="linenos"> 873</span></a>            <span class="n">delta_sal_true</span> <span class="o">=</span> <span class="n">salinity_true</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">salinity_true</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CTD.clean_salinity_autoencoder-874"><a href="#CTD.clean_salinity_autoencoder-874"><span class="linenos"> 874</span></a>            <span class="n">delta_sal_pred</span> <span class="o">=</span> <span class="n">salinity_pred</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">salinity_pred</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CTD.clean_salinity_autoencoder-875"><a href="#CTD.clean_salinity_autoencoder-875"><span class="linenos"> 875</span></a>
</span><span id="CTD.clean_salinity_autoencoder-876"><a href="#CTD.clean_salinity_autoencoder-876"><span class="linenos"> 876</span></a>            <span class="c1"># Penalize predictions where salinity decreases while pressure increases</span>
</span><span id="CTD.clean_salinity_autoencoder-877"><a href="#CTD.clean_salinity_autoencoder-877"><span class="linenos"> 877</span></a>            <span class="n">penalties</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta_sal_pred</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">tf</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">delta_sal_pred</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-878"><a href="#CTD.clean_salinity_autoencoder-878"><span class="linenos"> 878</span></a>
</span><span id="CTD.clean_salinity_autoencoder-879"><a href="#CTD.clean_salinity_autoencoder-879"><span class="linenos"> 879</span></a>            <span class="c1"># Calculate mean absolute error</span>
</span><span id="CTD.clean_salinity_autoencoder-880"><a href="#CTD.clean_salinity_autoencoder-880"><span class="linenos"> 880</span></a>            <span class="n">mae</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">))</span>
</span><span id="CTD.clean_salinity_autoencoder-881"><a href="#CTD.clean_salinity_autoencoder-881"><span class="linenos"> 881</span></a>
</span><span id="CTD.clean_salinity_autoencoder-882"><a href="#CTD.clean_salinity_autoencoder-882"><span class="linenos"> 882</span></a>            <span class="c1"># Add penalties</span>
</span><span id="CTD.clean_salinity_autoencoder-883"><a href="#CTD.clean_salinity_autoencoder-883"><span class="linenos"> 883</span></a>            <span class="k">return</span> <span class="n">mae</span> <span class="o">+</span> <span class="mf">6.0</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">penalties</span><span class="p">)</span>  <span class="c1"># Adjust weighting of penalty as needed</span>
</span><span id="CTD.clean_salinity_autoencoder-884"><a href="#CTD.clean_salinity_autoencoder-884"><span class="linenos"> 884</span></a>
</span><span id="CTD.clean_salinity_autoencoder-885"><a href="#CTD.clean_salinity_autoencoder-885"><span class="linenos"> 885</span></a>        <span class="k">def</span> <span class="nf">build_lstm_autoencoder</span><span class="p">(</span><span class="n">input_shape</span><span class="p">):</span>
</span><span id="CTD.clean_salinity_autoencoder-886"><a href="#CTD.clean_salinity_autoencoder-886"><span class="linenos"> 886</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.clean_salinity_autoencoder-887"><a href="#CTD.clean_salinity_autoencoder-887"><span class="linenos"> 887</span></a><span class="sd">            LSTM autoencoder architecture.</span>
</span><span id="CTD.clean_salinity_autoencoder-888"><a href="#CTD.clean_salinity_autoencoder-888"><span class="linenos"> 888</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.clean_salinity_autoencoder-889"><a href="#CTD.clean_salinity_autoencoder-889"><span class="linenos"> 889</span></a>            <span class="c1"># Encoder</span>
</span><span id="CTD.clean_salinity_autoencoder-890"><a href="#CTD.clean_salinity_autoencoder-890"><span class="linenos"> 890</span></a>            <span class="n">encoder_inputs</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;encoder_inputs&#39;</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-891"><a href="#CTD.clean_salinity_autoencoder-891"><span class="linenos"> 891</span></a>            <span class="n">encoder_lstm1</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-892"><a href="#CTD.clean_salinity_autoencoder-892"><span class="linenos"> 892</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">encoder_inputs</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-893"><a href="#CTD.clean_salinity_autoencoder-893"><span class="linenos"> 893</span></a>            <span class="n">encoder_lstm2</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-894"><a href="#CTD.clean_salinity_autoencoder-894"><span class="linenos"> 894</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">encoder_lstm1</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-895"><a href="#CTD.clean_salinity_autoencoder-895"><span class="linenos"> 895</span></a>            <span class="n">encoder_lstm3</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-896"><a href="#CTD.clean_salinity_autoencoder-896"><span class="linenos"> 896</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">encoder_lstm2</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-897"><a href="#CTD.clean_salinity_autoencoder-897"><span class="linenos"> 897</span></a>            <span class="n">encoder_lstm4</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-898"><a href="#CTD.clean_salinity_autoencoder-898"><span class="linenos"> 898</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">encoder_lstm3</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-899"><a href="#CTD.clean_salinity_autoencoder-899"><span class="linenos"> 899</span></a>            <span class="n">encoder_output</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)(</span><span class="n">encoder_lstm4</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-900"><a href="#CTD.clean_salinity_autoencoder-900"><span class="linenos"> 900</span></a>
</span><span id="CTD.clean_salinity_autoencoder-901"><a href="#CTD.clean_salinity_autoencoder-901"><span class="linenos"> 901</span></a>            <span class="c1"># Decoder</span>
</span><span id="CTD.clean_salinity_autoencoder-902"><a href="#CTD.clean_salinity_autoencoder-902"><span class="linenos"> 902</span></a>            <span class="n">decoder_inputs</span> <span class="o">=</span> <span class="n">RepeatVector</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])(</span><span class="n">encoder_output</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-903"><a href="#CTD.clean_salinity_autoencoder-903"><span class="linenos"> 903</span></a>            <span class="n">decoder_lstm1</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-904"><a href="#CTD.clean_salinity_autoencoder-904"><span class="linenos"> 904</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_inputs</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-905"><a href="#CTD.clean_salinity_autoencoder-905"><span class="linenos"> 905</span></a>            <span class="n">decoder_lstm2</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-906"><a href="#CTD.clean_salinity_autoencoder-906"><span class="linenos"> 906</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_lstm1</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-907"><a href="#CTD.clean_salinity_autoencoder-907"><span class="linenos"> 907</span></a>            <span class="n">decoder_lstm3</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-908"><a href="#CTD.clean_salinity_autoencoder-908"><span class="linenos"> 908</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_lstm2</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-909"><a href="#CTD.clean_salinity_autoencoder-909"><span class="linenos"> 909</span></a>            <span class="n">decoder_lstm4</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-910"><a href="#CTD.clean_salinity_autoencoder-910"><span class="linenos"> 910</span></a>                                 <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">decoder_lstm3</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-911"><a href="#CTD.clean_salinity_autoencoder-911"><span class="linenos"> 911</span></a>            <span class="n">decoder_output</span> <span class="o">=</span> <span class="n">TimeDistributed</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;decoded_output&#39;</span><span class="p">)(</span>
</span><span id="CTD.clean_salinity_autoencoder-912"><a href="#CTD.clean_salinity_autoencoder-912"><span class="linenos"> 912</span></a>                <span class="n">decoder_lstm4</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-913"><a href="#CTD.clean_salinity_autoencoder-913"><span class="linenos"> 913</span></a>
</span><span id="CTD.clean_salinity_autoencoder-914"><a href="#CTD.clean_salinity_autoencoder-914"><span class="linenos"> 914</span></a>            <span class="n">autoencoder</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">encoder_inputs</span><span class="p">,</span> <span class="n">decoder_output</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-915"><a href="#CTD.clean_salinity_autoencoder-915"><span class="linenos"> 915</span></a>            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-916"><a href="#CTD.clean_salinity_autoencoder-916"><span class="linenos"> 916</span></a>            <span class="n">autoencoder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss_function</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-917"><a href="#CTD.clean_salinity_autoencoder-917"><span class="linenos"> 917</span></a>            <span class="k">return</span> <span class="n">autoencoder</span>
</span><span id="CTD.clean_salinity_autoencoder-918"><a href="#CTD.clean_salinity_autoencoder-918"><span class="linenos"> 918</span></a>
</span><span id="CTD.clean_salinity_autoencoder-919"><a href="#CTD.clean_salinity_autoencoder-919"><span class="linenos"> 919</span></a>        <span class="k">def</span> <span class="nf">plot_original_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="CTD.clean_salinity_autoencoder-920"><a href="#CTD.clean_salinity_autoencoder-920"><span class="linenos"> 920</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.clean_salinity_autoencoder-921"><a href="#CTD.clean_salinity_autoencoder-921"><span class="linenos"> 921</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="CTD.clean_salinity_autoencoder-922"><a href="#CTD.clean_salinity_autoencoder-922"><span class="linenos"> 922</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-923"><a href="#CTD.clean_salinity_autoencoder-923"><span class="linenos"> 923</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Salinity (PSU)&#39;</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-924"><a href="#CTD.clean_salinity_autoencoder-924"><span class="linenos"> 924</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-925"><a href="#CTD.clean_salinity_autoencoder-925"><span class="linenos"> 925</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original Salinity vs. Depth - </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-926"><a href="#CTD.clean_salinity_autoencoder-926"><span class="linenos"> 926</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-927"><a href="#CTD.clean_salinity_autoencoder-927"><span class="linenos"> 927</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;plots&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">_original.png&#39;</span><span class="p">))</span>
</span><span id="CTD.clean_salinity_autoencoder-928"><a href="#CTD.clean_salinity_autoencoder-928"><span class="linenos"> 928</span></a>            <span class="n">xlim</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()</span>
</span><span id="CTD.clean_salinity_autoencoder-929"><a href="#CTD.clean_salinity_autoencoder-929"><span class="linenos"> 929</span></a>            <span class="n">ylim</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
</span><span id="CTD.clean_salinity_autoencoder-930"><a href="#CTD.clean_salinity_autoencoder-930"><span class="linenos"> 930</span></a>            <span class="c1"># plt.show()</span>
</span><span id="CTD.clean_salinity_autoencoder-931"><a href="#CTD.clean_salinity_autoencoder-931"><span class="linenos"> 931</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="CTD.clean_salinity_autoencoder-932"><a href="#CTD.clean_salinity_autoencoder-932"><span class="linenos"> 932</span></a>            <span class="k">return</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span>
</span><span id="CTD.clean_salinity_autoencoder-933"><a href="#CTD.clean_salinity_autoencoder-933"><span class="linenos"> 933</span></a>
</span><span id="CTD.clean_salinity_autoencoder-934"><a href="#CTD.clean_salinity_autoencoder-934"><span class="linenos"> 934</span></a>        <span class="k">def</span> <span class="nf">plot_predicted_data</span><span class="p">(</span><span class="n">predicted_df</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">):</span>
</span><span id="CTD.clean_salinity_autoencoder-935"><a href="#CTD.clean_salinity_autoencoder-935"><span class="linenos"> 935</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">predicted_df</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.clean_salinity_autoencoder-936"><a href="#CTD.clean_salinity_autoencoder-936"><span class="linenos"> 936</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="CTD.clean_salinity_autoencoder-937"><a href="#CTD.clean_salinity_autoencoder-937"><span class="linenos"> 937</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">predicted_df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">predicted_df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-938"><a href="#CTD.clean_salinity_autoencoder-938"><span class="linenos"> 938</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Predicted Salinity vs. Depth - </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="CTD.clean_salinity_autoencoder-939"><a href="#CTD.clean_salinity_autoencoder-939"><span class="linenos"> 939</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-940"><a href="#CTD.clean_salinity_autoencoder-940"><span class="linenos"> 940</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Salinity (PSU)&#39;</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-941"><a href="#CTD.clean_salinity_autoencoder-941"><span class="linenos"> 941</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-942"><a href="#CTD.clean_salinity_autoencoder-942"><span class="linenos"> 942</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-943"><a href="#CTD.clean_salinity_autoencoder-943"><span class="linenos"> 943</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-944"><a href="#CTD.clean_salinity_autoencoder-944"><span class="linenos"> 944</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-945"><a href="#CTD.clean_salinity_autoencoder-945"><span class="linenos"> 945</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;plots&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">_predicted.png&#39;</span><span class="p">))</span>
</span><span id="CTD.clean_salinity_autoencoder-946"><a href="#CTD.clean_salinity_autoencoder-946"><span class="linenos"> 946</span></a>            <span class="c1"># plt.show()</span>
</span><span id="CTD.clean_salinity_autoencoder-947"><a href="#CTD.clean_salinity_autoencoder-947"><span class="linenos"> 947</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="CTD.clean_salinity_autoencoder-948"><a href="#CTD.clean_salinity_autoencoder-948"><span class="linenos"> 948</span></a>
</span><span id="CTD.clean_salinity_autoencoder-949"><a href="#CTD.clean_salinity_autoencoder-949"><span class="linenos"> 949</span></a>        <span class="k">def</span> <span class="nf">run_autoencoder</span><span class="p">(</span><span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="CTD.clean_salinity_autoencoder-950"><a href="#CTD.clean_salinity_autoencoder-950"><span class="linenos"> 950</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.clean_salinity_autoencoder-951"><a href="#CTD.clean_salinity_autoencoder-951"><span class="linenos"> 951</span></a><span class="sd">            Runs the autoencoder.</span>
</span><span id="CTD.clean_salinity_autoencoder-952"><a href="#CTD.clean_salinity_autoencoder-952"><span class="linenos"> 952</span></a>
</span><span id="CTD.clean_salinity_autoencoder-953"><a href="#CTD.clean_salinity_autoencoder-953"><span class="linenos"> 953</span></a><span class="sd">            Returns</span>
</span><span id="CTD.clean_salinity_autoencoder-954"><a href="#CTD.clean_salinity_autoencoder-954"><span class="linenos"> 954</span></a><span class="sd">            -------</span>
</span><span id="CTD.clean_salinity_autoencoder-955"><a href="#CTD.clean_salinity_autoencoder-955"><span class="linenos"> 955</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.clean_salinity_autoencoder-956"><a href="#CTD.clean_salinity_autoencoder-956"><span class="linenos"> 956</span></a><span class="sd">                CTD data with clean salinity values.</span>
</span><span id="CTD.clean_salinity_autoencoder-957"><a href="#CTD.clean_salinity_autoencoder-957"><span class="linenos"> 957</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.clean_salinity_autoencoder-958"><a href="#CTD.clean_salinity_autoencoder-958"><span class="linenos"> 958</span></a>            <span class="c1"># Preprocess data</span>
</span><span id="CTD.clean_salinity_autoencoder-959"><a href="#CTD.clean_salinity_autoencoder-959"><span class="linenos"> 959</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.clean_salinity_autoencoder-960"><a href="#CTD.clean_salinity_autoencoder-960"><span class="linenos"> 960</span></a>            <span class="c1"># Binning data</span>
</span><span id="CTD.clean_salinity_autoencoder-961"><a href="#CTD.clean_salinity_autoencoder-961"><span class="linenos"> 961</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="mf">0.25</span>
</span><span id="CTD.clean_salinity_autoencoder-962"><a href="#CTD.clean_salinity_autoencoder-962"><span class="linenos"> 962</span></a>            <span class="c1"># Define the desired columns and their aggregation functions</span>
</span><span id="CTD.clean_salinity_autoencoder-963"><a href="#CTD.clean_salinity_autoencoder-963"><span class="linenos"> 963</span></a>            <span class="n">column_agg_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CTD.clean_salinity_autoencoder-964"><a href="#CTD.clean_salinity_autoencoder-964"><span class="linenos"> 964</span></a>                <span class="s2">&quot;temperature_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-965"><a href="#CTD.clean_salinity_autoencoder-965"><span class="linenos"> 965</span></a>                <span class="s2">&quot;pressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-966"><a href="#CTD.clean_salinity_autoencoder-966"><span class="linenos"> 966</span></a>                <span class="s2">&quot;chlorophyll_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-967"><a href="#CTD.clean_salinity_autoencoder-967"><span class="linenos"> 967</span></a>                <span class="s2">&quot;seapressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-968"><a href="#CTD.clean_salinity_autoencoder-968"><span class="linenos"> 968</span></a>                <span class="s2">&quot;depth_00&quot;</span><span class="p">:</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-969"><a href="#CTD.clean_salinity_autoencoder-969"><span class="linenos"> 969</span></a>                <span class="s2">&quot;salinity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-970"><a href="#CTD.clean_salinity_autoencoder-970"><span class="linenos"> 970</span></a>                <span class="s2">&quot;speedofsound_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-971"><a href="#CTD.clean_salinity_autoencoder-971"><span class="linenos"> 971</span></a>                <span class="s2">&quot;specificconductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-972"><a href="#CTD.clean_salinity_autoencoder-972"><span class="linenos"> 972</span></a>                <span class="s2">&quot;conductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-973"><a href="#CTD.clean_salinity_autoencoder-973"><span class="linenos"> 973</span></a>                <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-974"><a href="#CTD.clean_salinity_autoencoder-974"><span class="linenos"> 974</span></a>                <span class="s2">&quot;salinityabs&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-975"><a href="#CTD.clean_salinity_autoencoder-975"><span class="linenos"> 975</span></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-976"><a href="#CTD.clean_salinity_autoencoder-976"><span class="linenos"> 976</span></a>                <span class="s2">&quot;MLD_Zero&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-977"><a href="#CTD.clean_salinity_autoencoder-977"><span class="linenos"> 977</span></a>                <span class="s2">&quot;MLD_Ten&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-978"><a href="#CTD.clean_salinity_autoencoder-978"><span class="linenos"> 978</span></a>                <span class="s2">&quot;stratification&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-979"><a href="#CTD.clean_salinity_autoencoder-979"><span class="linenos"> 979</span></a>                <span class="s2">&quot;mean_surface_density&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-980"><a href="#CTD.clean_salinity_autoencoder-980"><span class="linenos"> 980</span></a>                <span class="s2">&quot;surface_salinity&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-981"><a href="#CTD.clean_salinity_autoencoder-981"><span class="linenos"> 981</span></a>                <span class="s2">&quot;surface_temperature&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-982"><a href="#CTD.clean_salinity_autoencoder-982"><span class="linenos"> 982</span></a>                <span class="s2">&quot;meltwater_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-983"><a href="#CTD.clean_salinity_autoencoder-983"><span class="linenos"> 983</span></a>                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-984"><a href="#CTD.clean_salinity_autoencoder-984"><span class="linenos"> 984</span></a>                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
</span><span id="CTD.clean_salinity_autoencoder-985"><a href="#CTD.clean_salinity_autoencoder-985"><span class="linenos"> 985</span></a>                <span class="s2">&quot;overturn&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span>
</span><span id="CTD.clean_salinity_autoencoder-986"><a href="#CTD.clean_salinity_autoencoder-986"><span class="linenos"> 986</span></a>            <span class="p">}</span>
</span><span id="CTD.clean_salinity_autoencoder-987"><a href="#CTD.clean_salinity_autoencoder-987"><span class="linenos"> 987</span></a>            <span class="c1"># Check which columns are present in the DataFrame</span>
</span><span id="CTD.clean_salinity_autoencoder-988"><a href="#CTD.clean_salinity_autoencoder-988"><span class="linenos"> 988</span></a>            <span class="n">available_columns</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">agg_func</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">agg_func</span> <span class="ow">in</span> <span class="n">column_agg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</span><span id="CTD.clean_salinity_autoencoder-989"><a href="#CTD.clean_salinity_autoencoder-989"><span class="linenos"> 989</span></a>            <span class="c1"># Group by and aggregate based on the available columns</span>
</span><span id="CTD.clean_salinity_autoencoder-990"><a href="#CTD.clean_salinity_autoencoder-990"><span class="linenos"> 990</span></a>            <span class="n">data_binned</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">available_columns</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="CTD.clean_salinity_autoencoder-991"><a href="#CTD.clean_salinity_autoencoder-991"><span class="linenos"> 991</span></a>            <span class="c1"># Rename the Pressure_Bin column if it exists</span>
</span><span id="CTD.clean_salinity_autoencoder-992"><a href="#CTD.clean_salinity_autoencoder-992"><span class="linenos"> 992</span></a>            <span class="k">if</span> <span class="s1">&#39;Pressure_Bin&#39;</span> <span class="ow">in</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.clean_salinity_autoencoder-993"><a href="#CTD.clean_salinity_autoencoder-993"><span class="linenos"> 993</span></a>                <span class="n">data_binned</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Pressure_Bin&#39;</span><span class="p">:</span> <span class="s1">&#39;pressure_00&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-994"><a href="#CTD.clean_salinity_autoencoder-994"><span class="linenos"> 994</span></a>            <span class="c1"># Scaling data</span>
</span><span id="CTD.clean_salinity_autoencoder-995"><a href="#CTD.clean_salinity_autoencoder-995"><span class="linenos"> 995</span></a>            <span class="n">numerical_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span>
</span><span id="CTD.clean_salinity_autoencoder-996"><a href="#CTD.clean_salinity_autoencoder-996"><span class="linenos"> 996</span></a>            <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="CTD.clean_salinity_autoencoder-997"><a href="#CTD.clean_salinity_autoencoder-997"><span class="linenos"> 997</span></a>            <span class="n">scaled_sequence</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data_binned</span><span class="p">[</span><span class="n">numerical_columns</span><span class="p">])</span>
</span><span id="CTD.clean_salinity_autoencoder-998"><a href="#CTD.clean_salinity_autoencoder-998"><span class="linenos"> 998</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scaled_sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="CTD.clean_salinity_autoencoder-999"><a href="#CTD.clean_salinity_autoencoder-999"><span class="linenos"> 999</span></a>                <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s2">&quot;Not enough values to run the autoencoder on this data.&quot;</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-1000"><a href="#CTD.clean_salinity_autoencoder-1000"><span class="linenos">1000</span></a>            <span class="n">scaled_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">scaled_sequence</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-1001"><a href="#CTD.clean_salinity_autoencoder-1001"><span class="linenos">1001</span></a>            <span class="n">min_pres</span> <span class="o">=</span> <span class="n">data_binned</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="CTD.clean_salinity_autoencoder-1002"><a href="#CTD.clean_salinity_autoencoder-1002"><span class="linenos">1002</span></a>            <span class="n">max_pres</span> <span class="o">=</span> <span class="n">data_binned</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CTD.clean_salinity_autoencoder-1003"><a href="#CTD.clean_salinity_autoencoder-1003"><span class="linenos">1003</span></a>            <span class="c1"># Calculate ranges</span>
</span><span id="CTD.clean_salinity_autoencoder-1004"><a href="#CTD.clean_salinity_autoencoder-1004"><span class="linenos">1004</span></a>            <span class="n">pres_range</span> <span class="o">=</span> <span class="n">max_pres</span> <span class="o">-</span> <span class="n">min_pres</span>
</span><span id="CTD.clean_salinity_autoencoder-1005"><a href="#CTD.clean_salinity_autoencoder-1005"><span class="linenos">1005</span></a>            <span class="n">epochs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pres_range</span> <span class="o">*</span> <span class="mi">18</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-1006"><a href="#CTD.clean_salinity_autoencoder-1006"><span class="linenos">1006</span></a>            <span class="c1"># Build autoencoder and predict on CTD data</span>
</span><span id="CTD.clean_salinity_autoencoder-1007"><a href="#CTD.clean_salinity_autoencoder-1007"><span class="linenos">1007</span></a>            <span class="n">autoencoder</span> <span class="o">=</span> <span class="n">build_lstm_autoencoder</span><span class="p">(</span><span class="n">scaled_seq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="CTD.clean_salinity_autoencoder-1008"><a href="#CTD.clean_salinity_autoencoder-1008"><span class="linenos">1008</span></a>            <span class="n">autoencoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scaled_seq</span><span class="p">,</span> <span class="n">scaled_seq</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-1009"><a href="#CTD.clean_salinity_autoencoder-1009"><span class="linenos">1009</span></a>            <span class="n">X_pred</span> <span class="o">=</span> <span class="n">autoencoder</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaled_seq</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-1010"><a href="#CTD.clean_salinity_autoencoder-1010"><span class="linenos">1010</span></a>            <span class="c1"># Revert scaling</span>
</span><span id="CTD.clean_salinity_autoencoder-1011"><a href="#CTD.clean_salinity_autoencoder-1011"><span class="linenos">1011</span></a>            <span class="n">predicted_seq</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">X_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="CTD.clean_salinity_autoencoder-1012"><a href="#CTD.clean_salinity_autoencoder-1012"><span class="linenos">1012</span></a>            <span class="n">data_binned</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predicted_seq</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.clean_salinity_autoencoder-1013"><a href="#CTD.clean_salinity_autoencoder-1013"><span class="linenos">1013</span></a>            <span class="k">if</span> <span class="n">show_plots</span><span class="p">:</span>
</span><span id="CTD.clean_salinity_autoencoder-1014"><a href="#CTD.clean_salinity_autoencoder-1014"><span class="linenos">1014</span></a>                <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="n">plot_original_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-1015"><a href="#CTD.clean_salinity_autoencoder-1015"><span class="linenos">1015</span></a>                <span class="n">plot_predicted_data</span><span class="p">(</span><span class="n">data_binned</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">)</span>
</span><span id="CTD.clean_salinity_autoencoder-1016"><a href="#CTD.clean_salinity_autoencoder-1016"><span class="linenos">1016</span></a>            <span class="n">data_binned</span> <span class="o">=</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">data_binned</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.clean_salinity_autoencoder-1017"><a href="#CTD.clean_salinity_autoencoder-1017"><span class="linenos">1017</span></a>            <span class="k">return</span> <span class="n">data_binned</span><span class="o">.</span><span class="n">reindex</span><span class="p">()</span>
</span><span id="CTD.clean_salinity_autoencoder-1018"><a href="#CTD.clean_salinity_autoencoder-1018"><span class="linenos">1018</span></a>
</span><span id="CTD.clean_salinity_autoencoder-1019"><a href="#CTD.clean_salinity_autoencoder-1019"><span class="linenos">1019</span></a>        <span class="k">return</span> <span class="n">run_autoencoder</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Cleans salinity using an LSTM autoencoder ML model.
Warning: This process will bin the data every 0.5 dbar of pressure.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame</strong>: CTD data with clean salinity values.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.save_to_csv" class="classattr">
                                        <input id="CTD.save_to_csv-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_to_csv</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">output_file</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.save_to_csv-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.save_to_csv"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.save_to_csv-1021"><a href="#CTD.save_to_csv-1021"><span class="linenos">1021</span></a>    <span class="k">def</span> <span class="nf">save_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
</span><span id="CTD.save_to_csv-1022"><a href="#CTD.save_to_csv-1022"><span class="linenos">1022</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.save_to_csv-1023"><a href="#CTD.save_to_csv-1023"><span class="linenos">1023</span></a><span class="sd">        Renames the columns of the CTD data table based on a predefined mapping and saves the</span>
</span><span id="CTD.save_to_csv-1024"><a href="#CTD.save_to_csv-1024"><span class="linenos">1024</span></a><span class="sd">        data to the specified CSV file. If the file already exists, the data is appended to it.</span>
</span><span id="CTD.save_to_csv-1025"><a href="#CTD.save_to_csv-1025"><span class="linenos">1025</span></a>
</span><span id="CTD.save_to_csv-1026"><a href="#CTD.save_to_csv-1026"><span class="linenos">1026</span></a><span class="sd">        Parameters</span>
</span><span id="CTD.save_to_csv-1027"><a href="#CTD.save_to_csv-1027"><span class="linenos">1027</span></a><span class="sd">        ----------</span>
</span><span id="CTD.save_to_csv-1028"><a href="#CTD.save_to_csv-1028"><span class="linenos">1028</span></a><span class="sd">        output_file : str</span>
</span><span id="CTD.save_to_csv-1029"><a href="#CTD.save_to_csv-1029"><span class="linenos">1029</span></a><span class="sd">            The output CSV file path.</span>
</span><span id="CTD.save_to_csv-1030"><a href="#CTD.save_to_csv-1030"><span class="linenos">1030</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.save_to_csv-1031"><a href="#CTD.save_to_csv-1031"><span class="linenos">1031</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Utility</span><span class="o">.</span><span class="n">save_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctd_array</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Renames the columns of the CTD data table based on a predefined mapping and saves the
data to the specified CSV file. If the file already exists, the data is appended to it.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>output_file</strong> (str):
The output CSV file path.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="CTD.Utility">
                            <input id="CTD.Utility-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CTD.Utility</span>:

                <label class="view-source-button" for="CTD.Utility-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility-1033"><a href="#CTD.Utility-1033"><span class="linenos">1033</span></a>    <span class="k">class</span> <span class="nc">Utility</span><span class="p">:</span>
</span><span id="CTD.Utility-1034"><a href="#CTD.Utility-1034"><span class="linenos">1034</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1035"><a href="#CTD.Utility-1035"><span class="linenos">1035</span></a><span class="sd">        Utility</span>
</span><span id="CTD.Utility-1036"><a href="#CTD.Utility-1036"><span class="linenos">1036</span></a><span class="sd">        --------</span>
</span><span id="CTD.Utility-1037"><a href="#CTD.Utility-1037"><span class="linenos">1037</span></a><span class="sd">        Utility class for CTD data processing.</span>
</span><span id="CTD.Utility-1038"><a href="#CTD.Utility-1038"><span class="linenos">1038</span></a>
</span><span id="CTD.Utility-1039"><a href="#CTD.Utility-1039"><span class="linenos">1039</span></a><span class="sd">        Attributes</span>
</span><span id="CTD.Utility-1040"><a href="#CTD.Utility-1040"><span class="linenos">1040</span></a><span class="sd">        ----------</span>
</span><span id="CTD.Utility-1041"><a href="#CTD.Utility-1041"><span class="linenos">1041</span></a><span class="sd">        filename :  str</span>
</span><span id="CTD.Utility-1042"><a href="#CTD.Utility-1042"><span class="linenos">1042</span></a><span class="sd">            Filename of the RSK file.</span>
</span><span id="CTD.Utility-1043"><a href="#CTD.Utility-1043"><span class="linenos">1043</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1044"><a href="#CTD.Utility-1044"><span class="linenos">1044</span></a>
</span><span id="CTD.Utility-1045"><a href="#CTD.Utility-1045"><span class="linenos">1045</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="CTD.Utility-1046"><a href="#CTD.Utility-1046"><span class="linenos">1046</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1047"><a href="#CTD.Utility-1047"><span class="linenos">1047</span></a><span class="sd">            Initialize a new Utility object.</span>
</span><span id="CTD.Utility-1048"><a href="#CTD.Utility-1048"><span class="linenos">1048</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility-1049"><a href="#CTD.Utility-1049"><span class="linenos">1049</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility-1050"><a href="#CTD.Utility-1050"><span class="linenos">1050</span></a><span class="sd">            filename : str</span>
</span><span id="CTD.Utility-1051"><a href="#CTD.Utility-1051"><span class="linenos">1051</span></a><span class="sd">                The filename of the RSK file.</span>
</span><span id="CTD.Utility-1052"><a href="#CTD.Utility-1052"><span class="linenos">1052</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1053"><a href="#CTD.Utility-1053"><span class="linenos">1053</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="CTD.Utility-1054"><a href="#CTD.Utility-1054"><span class="linenos">1054</span></a>
</span><span id="CTD.Utility-1055"><a href="#CTD.Utility-1055"><span class="linenos">1055</span></a>        <span class="k">def</span> <span class="nf">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_to_check</span><span class="p">):</span>
</span><span id="CTD.Utility-1056"><a href="#CTD.Utility-1056"><span class="linenos">1056</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1057"><a href="#CTD.Utility-1057"><span class="linenos">1057</span></a><span class="sd">            Checks if the given object is None, empty, or has a length greater than 0.</span>
</span><span id="CTD.Utility-1058"><a href="#CTD.Utility-1058"><span class="linenos">1058</span></a><span class="sd">            Returns True if the object has no values, False otherwise.</span>
</span><span id="CTD.Utility-1059"><a href="#CTD.Utility-1059"><span class="linenos">1059</span></a>
</span><span id="CTD.Utility-1060"><a href="#CTD.Utility-1060"><span class="linenos">1060</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility-1061"><a href="#CTD.Utility-1061"><span class="linenos">1061</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility-1062"><a href="#CTD.Utility-1062"><span class="linenos">1062</span></a><span class="sd">            object_to_check : object</span>
</span><span id="CTD.Utility-1063"><a href="#CTD.Utility-1063"><span class="linenos">1063</span></a><span class="sd">                The object to check for values.</span>
</span><span id="CTD.Utility-1064"><a href="#CTD.Utility-1064"><span class="linenos">1064</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility-1065"><a href="#CTD.Utility-1065"><span class="linenos">1065</span></a><span class="sd">            --------</span>
</span><span id="CTD.Utility-1066"><a href="#CTD.Utility-1066"><span class="linenos">1066</span></a><span class="sd">            bool</span>
</span><span id="CTD.Utility-1067"><a href="#CTD.Utility-1067"><span class="linenos">1067</span></a><span class="sd">                True if the object has no values, False otherwise.</span>
</span><span id="CTD.Utility-1068"><a href="#CTD.Utility-1068"><span class="linenos">1068</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1069"><a href="#CTD.Utility-1069"><span class="linenos">1069</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">object_to_check</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span id="CTD.Utility-1070"><a href="#CTD.Utility-1070"><span class="linenos">1070</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="CTD.Utility-1071"><a href="#CTD.Utility-1071"><span class="linenos">1071</span></a>            <span class="k">if</span> <span class="n">object_to_check</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CTD.Utility-1072"><a href="#CTD.Utility-1072"><span class="linenos">1072</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="CTD.Utility-1073"><a href="#CTD.Utility-1073"><span class="linenos">1073</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_to_check</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CTD.Utility-1074"><a href="#CTD.Utility-1074"><span class="linenos">1074</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="CTD.Utility-1075"><a href="#CTD.Utility-1075"><span class="linenos">1075</span></a>
</span><span id="CTD.Utility-1076"><a href="#CTD.Utility-1076"><span class="linenos">1076</span></a>        <span class="k">def</span> <span class="nf">remove_sample_timezone_indicator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1077"><a href="#CTD.Utility-1077"><span class="linenos">1077</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1078"><a href="#CTD.Utility-1078"><span class="linenos">1078</span></a><span class="sd">            Removes the timezone indicator (e.g., &#39;+00:00&#39;) from the &#39;timestamp&#39; column of the</span>
</span><span id="CTD.Utility-1079"><a href="#CTD.Utility-1079"><span class="linenos">1079</span></a><span class="sd">            given DataFrame. Returns the updated DataFrame.</span>
</span><span id="CTD.Utility-1080"><a href="#CTD.Utility-1080"><span class="linenos">1080</span></a>
</span><span id="CTD.Utility-1081"><a href="#CTD.Utility-1081"><span class="linenos">1081</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility-1082"><a href="#CTD.Utility-1082"><span class="linenos">1082</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility-1083"><a href="#CTD.Utility-1083"><span class="linenos">1083</span></a><span class="sd">            df : DataFrame</span>
</span><span id="CTD.Utility-1084"><a href="#CTD.Utility-1084"><span class="linenos">1084</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility-1085"><a href="#CTD.Utility-1085"><span class="linenos">1085</span></a>
</span><span id="CTD.Utility-1086"><a href="#CTD.Utility-1086"><span class="linenos">1086</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility-1087"><a href="#CTD.Utility-1087"><span class="linenos">1087</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility-1088"><a href="#CTD.Utility-1088"><span class="linenos">1088</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility-1089"><a href="#CTD.Utility-1089"><span class="linenos">1089</span></a><span class="sd">                The updated DataFrame with the timezone indicator removed.</span>
</span><span id="CTD.Utility-1090"><a href="#CTD.Utility-1090"><span class="linenos">1090</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1091"><a href="#CTD.Utility-1091"><span class="linenos">1091</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1092"><a href="#CTD.Utility-1092"><span class="linenos">1092</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1093"><a href="#CTD.Utility-1093"><span class="linenos">1093</span></a>            <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility-1094"><a href="#CTD.Utility-1094"><span class="linenos">1094</span></a>                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.Utility-1095"><a href="#CTD.Utility-1095"><span class="linenos">1095</span></a>                <span class="k">return</span> <span class="n">df</span>
</span><span id="CTD.Utility-1096"><a href="#CTD.Utility-1096"><span class="linenos">1096</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility-1097"><a href="#CTD.Utility-1097"><span class="linenos">1097</span></a>                <span class="k">return</span> <span class="n">df</span>
</span><span id="CTD.Utility-1098"><a href="#CTD.Utility-1098"><span class="linenos">1098</span></a>
</span><span id="CTD.Utility-1099"><a href="#CTD.Utility-1099"><span class="linenos">1099</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1100"><a href="#CTD.Utility-1100"><span class="linenos">1100</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1101"><a href="#CTD.Utility-1101"><span class="linenos">1101</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;depth_00&#39; column has negative values.</span>
</span><span id="CTD.Utility-1102"><a href="#CTD.Utility-1102"><span class="linenos">1102</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility-1103"><a href="#CTD.Utility-1103"><span class="linenos">1103</span></a>
</span><span id="CTD.Utility-1104"><a href="#CTD.Utility-1104"><span class="linenos">1104</span></a><span class="sd">            Parameter</span>
</span><span id="CTD.Utility-1105"><a href="#CTD.Utility-1105"><span class="linenos">1105</span></a><span class="sd">            ---------</span>
</span><span id="CTD.Utility-1106"><a href="#CTD.Utility-1106"><span class="linenos">1106</span></a><span class="sd">            df : DataFrame</span>
</span><span id="CTD.Utility-1107"><a href="#CTD.Utility-1107"><span class="linenos">1107</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility-1108"><a href="#CTD.Utility-1108"><span class="linenos">1108</span></a>
</span><span id="CTD.Utility-1109"><a href="#CTD.Utility-1109"><span class="linenos">1109</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility-1110"><a href="#CTD.Utility-1110"><span class="linenos">1110</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility-1111"><a href="#CTD.Utility-1111"><span class="linenos">1111</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility-1112"><a href="#CTD.Utility-1112"><span class="linenos">1112</span></a><span class="sd">                The updated DataFrame with rows containing negative depth values removed.</span>
</span><span id="CTD.Utility-1113"><a href="#CTD.Utility-1113"><span class="linenos">1113</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1114"><a href="#CTD.Utility-1114"><span class="linenos">1114</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1115"><a href="#CTD.Utility-1115"><span class="linenos">1115</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1116"><a href="#CTD.Utility-1116"><span class="linenos">1116</span></a>            <span class="k">if</span> <span class="s1">&#39;depth_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility-1117"><a href="#CTD.Utility-1117"><span class="linenos">1117</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility-1118"><a href="#CTD.Utility-1118"><span class="linenos">1118</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility-1119"><a href="#CTD.Utility-1119"><span class="linenos">1119</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1120"><a href="#CTD.Utility-1120"><span class="linenos">1120</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1121"><a href="#CTD.Utility-1121"><span class="linenos">1121</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1122"><a href="#CTD.Utility-1122"><span class="linenos">1122</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.Utility-1123"><a href="#CTD.Utility-1123"><span class="linenos">1123</span></a>
</span><span id="CTD.Utility-1124"><a href="#CTD.Utility-1124"><span class="linenos">1124</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1125"><a href="#CTD.Utility-1125"><span class="linenos">1125</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1126"><a href="#CTD.Utility-1126"><span class="linenos">1126</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;salinity_00&#39; column has negative values.</span>
</span><span id="CTD.Utility-1127"><a href="#CTD.Utility-1127"><span class="linenos">1127</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility-1128"><a href="#CTD.Utility-1128"><span class="linenos">1128</span></a>
</span><span id="CTD.Utility-1129"><a href="#CTD.Utility-1129"><span class="linenos">1129</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility-1130"><a href="#CTD.Utility-1130"><span class="linenos">1130</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility-1131"><a href="#CTD.Utility-1131"><span class="linenos">1131</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD.Utility-1132"><a href="#CTD.Utility-1132"><span class="linenos">1132</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility-1133"><a href="#CTD.Utility-1133"><span class="linenos">1133</span></a>
</span><span id="CTD.Utility-1134"><a href="#CTD.Utility-1134"><span class="linenos">1134</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility-1135"><a href="#CTD.Utility-1135"><span class="linenos">1135</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility-1136"><a href="#CTD.Utility-1136"><span class="linenos">1136</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility-1137"><a href="#CTD.Utility-1137"><span class="linenos">1137</span></a><span class="sd">                The updated DataFrame with rows containing negative salinity values removed.</span>
</span><span id="CTD.Utility-1138"><a href="#CTD.Utility-1138"><span class="linenos">1138</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1139"><a href="#CTD.Utility-1139"><span class="linenos">1139</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1140"><a href="#CTD.Utility-1140"><span class="linenos">1140</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1141"><a href="#CTD.Utility-1141"><span class="linenos">1141</span></a>            <span class="k">if</span> <span class="s1">&#39;salinity_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility-1142"><a href="#CTD.Utility-1142"><span class="linenos">1142</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility-1143"><a href="#CTD.Utility-1143"><span class="linenos">1143</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility-1144"><a href="#CTD.Utility-1144"><span class="linenos">1144</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1145"><a href="#CTD.Utility-1145"><span class="linenos">1145</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1146"><a href="#CTD.Utility-1146"><span class="linenos">1146</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1147"><a href="#CTD.Utility-1147"><span class="linenos">1147</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.Utility-1148"><a href="#CTD.Utility-1148"><span class="linenos">1148</span></a>
</span><span id="CTD.Utility-1149"><a href="#CTD.Utility-1149"><span class="linenos">1149</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_invalid_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1150"><a href="#CTD.Utility-1150"><span class="linenos">1150</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1151"><a href="#CTD.Utility-1151"><span class="linenos">1151</span></a><span class="sd">            Removes rows from the given DataFrame where the practical salinity column has values &lt; 10.</span>
</span><span id="CTD.Utility-1152"><a href="#CTD.Utility-1152"><span class="linenos">1152</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility-1153"><a href="#CTD.Utility-1153"><span class="linenos">1153</span></a>
</span><span id="CTD.Utility-1154"><a href="#CTD.Utility-1154"><span class="linenos">1154</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility-1155"><a href="#CTD.Utility-1155"><span class="linenos">1155</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility-1156"><a href="#CTD.Utility-1156"><span class="linenos">1156</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD.Utility-1157"><a href="#CTD.Utility-1157"><span class="linenos">1157</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility-1158"><a href="#CTD.Utility-1158"><span class="linenos">1158</span></a>
</span><span id="CTD.Utility-1159"><a href="#CTD.Utility-1159"><span class="linenos">1159</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility-1160"><a href="#CTD.Utility-1160"><span class="linenos">1160</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility-1161"><a href="#CTD.Utility-1161"><span class="linenos">1161</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility-1162"><a href="#CTD.Utility-1162"><span class="linenos">1162</span></a><span class="sd">                The updated DataFrame with rows containing negative salinity values removed.</span>
</span><span id="CTD.Utility-1163"><a href="#CTD.Utility-1163"><span class="linenos">1163</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1164"><a href="#CTD.Utility-1164"><span class="linenos">1164</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1165"><a href="#CTD.Utility-1165"><span class="linenos">1165</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1166"><a href="#CTD.Utility-1166"><span class="linenos">1166</span></a>            <span class="k">if</span> <span class="s1">&#39;salinity_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility-1167"><a href="#CTD.Utility-1167"><span class="linenos">1167</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility-1168"><a href="#CTD.Utility-1168"><span class="linenos">1168</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility-1169"><a href="#CTD.Utility-1169"><span class="linenos">1169</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1170"><a href="#CTD.Utility-1170"><span class="linenos">1170</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1171"><a href="#CTD.Utility-1171"><span class="linenos">1171</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1172"><a href="#CTD.Utility-1172"><span class="linenos">1172</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.Utility-1173"><a href="#CTD.Utility-1173"><span class="linenos">1173</span></a>
</span><span id="CTD.Utility-1174"><a href="#CTD.Utility-1174"><span class="linenos">1174</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1175"><a href="#CTD.Utility-1175"><span class="linenos">1175</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1176"><a href="#CTD.Utility-1176"><span class="linenos">1176</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;pressure_00&#39; column has negative values.</span>
</span><span id="CTD.Utility-1177"><a href="#CTD.Utility-1177"><span class="linenos">1177</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility-1178"><a href="#CTD.Utility-1178"><span class="linenos">1178</span></a>
</span><span id="CTD.Utility-1179"><a href="#CTD.Utility-1179"><span class="linenos">1179</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility-1180"><a href="#CTD.Utility-1180"><span class="linenos">1180</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility-1181"><a href="#CTD.Utility-1181"><span class="linenos">1181</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD.Utility-1182"><a href="#CTD.Utility-1182"><span class="linenos">1182</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility-1183"><a href="#CTD.Utility-1183"><span class="linenos">1183</span></a>
</span><span id="CTD.Utility-1184"><a href="#CTD.Utility-1184"><span class="linenos">1184</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility-1185"><a href="#CTD.Utility-1185"><span class="linenos">1185</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility-1186"><a href="#CTD.Utility-1186"><span class="linenos">1186</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility-1187"><a href="#CTD.Utility-1187"><span class="linenos">1187</span></a><span class="sd">                The updated DataFrame with rows containing negative pressure values removed.</span>
</span><span id="CTD.Utility-1188"><a href="#CTD.Utility-1188"><span class="linenos">1188</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1189"><a href="#CTD.Utility-1189"><span class="linenos">1189</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1190"><a href="#CTD.Utility-1190"><span class="linenos">1190</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1191"><a href="#CTD.Utility-1191"><span class="linenos">1191</span></a>            <span class="k">if</span> <span class="s1">&#39;pressure_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility-1192"><a href="#CTD.Utility-1192"><span class="linenos">1192</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility-1193"><a href="#CTD.Utility-1193"><span class="linenos">1193</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility-1194"><a href="#CTD.Utility-1194"><span class="linenos">1194</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1195"><a href="#CTD.Utility-1195"><span class="linenos">1195</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1196"><a href="#CTD.Utility-1196"><span class="linenos">1196</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1197"><a href="#CTD.Utility-1197"><span class="linenos">1197</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.Utility-1198"><a href="#CTD.Utility-1198"><span class="linenos">1198</span></a>
</span><span id="CTD.Utility-1199"><a href="#CTD.Utility-1199"><span class="linenos">1199</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_salinityabs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1200"><a href="#CTD.Utility-1200"><span class="linenos">1200</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1201"><a href="#CTD.Utility-1201"><span class="linenos">1201</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;salinityabs&#39; column has negative values.</span>
</span><span id="CTD.Utility-1202"><a href="#CTD.Utility-1202"><span class="linenos">1202</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility-1203"><a href="#CTD.Utility-1203"><span class="linenos">1203</span></a>
</span><span id="CTD.Utility-1204"><a href="#CTD.Utility-1204"><span class="linenos">1204</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility-1205"><a href="#CTD.Utility-1205"><span class="linenos">1205</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility-1206"><a href="#CTD.Utility-1206"><span class="linenos">1206</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD.Utility-1207"><a href="#CTD.Utility-1207"><span class="linenos">1207</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility-1208"><a href="#CTD.Utility-1208"><span class="linenos">1208</span></a>
</span><span id="CTD.Utility-1209"><a href="#CTD.Utility-1209"><span class="linenos">1209</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility-1210"><a href="#CTD.Utility-1210"><span class="linenos">1210</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility-1211"><a href="#CTD.Utility-1211"><span class="linenos">1211</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility-1212"><a href="#CTD.Utility-1212"><span class="linenos">1212</span></a><span class="sd">                The updated DataFrame with rows containing negative absolute salinity values removed.</span>
</span><span id="CTD.Utility-1213"><a href="#CTD.Utility-1213"><span class="linenos">1213</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1214"><a href="#CTD.Utility-1214"><span class="linenos">1214</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1215"><a href="#CTD.Utility-1215"><span class="linenos">1215</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1216"><a href="#CTD.Utility-1216"><span class="linenos">1216</span></a>            <span class="k">if</span> <span class="s1">&#39;salinityabs&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility-1217"><a href="#CTD.Utility-1217"><span class="linenos">1217</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinityabs&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility-1218"><a href="#CTD.Utility-1218"><span class="linenos">1218</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility-1219"><a href="#CTD.Utility-1219"><span class="linenos">1219</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1220"><a href="#CTD.Utility-1220"><span class="linenos">1220</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1221"><a href="#CTD.Utility-1221"><span class="linenos">1221</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1222"><a href="#CTD.Utility-1222"><span class="linenos">1222</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.Utility-1223"><a href="#CTD.Utility-1223"><span class="linenos">1223</span></a>
</span><span id="CTD.Utility-1224"><a href="#CTD.Utility-1224"><span class="linenos">1224</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1225"><a href="#CTD.Utility-1225"><span class="linenos">1225</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1226"><a href="#CTD.Utility-1226"><span class="linenos">1226</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;density&#39; column has negative values.</span>
</span><span id="CTD.Utility-1227"><a href="#CTD.Utility-1227"><span class="linenos">1227</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility-1228"><a href="#CTD.Utility-1228"><span class="linenos">1228</span></a>
</span><span id="CTD.Utility-1229"><a href="#CTD.Utility-1229"><span class="linenos">1229</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility-1230"><a href="#CTD.Utility-1230"><span class="linenos">1230</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility-1231"><a href="#CTD.Utility-1231"><span class="linenos">1231</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD.Utility-1232"><a href="#CTD.Utility-1232"><span class="linenos">1232</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility-1233"><a href="#CTD.Utility-1233"><span class="linenos">1233</span></a>
</span><span id="CTD.Utility-1234"><a href="#CTD.Utility-1234"><span class="linenos">1234</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility-1235"><a href="#CTD.Utility-1235"><span class="linenos">1235</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility-1236"><a href="#CTD.Utility-1236"><span class="linenos">1236</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility-1237"><a href="#CTD.Utility-1237"><span class="linenos">1237</span></a><span class="sd">                The updated DataFrame with rows containing negative density values removed.</span>
</span><span id="CTD.Utility-1238"><a href="#CTD.Utility-1238"><span class="linenos">1238</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1239"><a href="#CTD.Utility-1239"><span class="linenos">1239</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1240"><a href="#CTD.Utility-1240"><span class="linenos">1240</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1241"><a href="#CTD.Utility-1241"><span class="linenos">1241</span></a>            <span class="k">if</span> <span class="s1">&#39;density&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility-1242"><a href="#CTD.Utility-1242"><span class="linenos">1242</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility-1243"><a href="#CTD.Utility-1243"><span class="linenos">1243</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility-1244"><a href="#CTD.Utility-1244"><span class="linenos">1244</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1245"><a href="#CTD.Utility-1245"><span class="linenos">1245</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility-1246"><a href="#CTD.Utility-1246"><span class="linenos">1246</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1247"><a href="#CTD.Utility-1247"><span class="linenos">1247</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.Utility-1248"><a href="#CTD.Utility-1248"><span class="linenos">1248</span></a>
</span><span id="CTD.Utility-1249"><a href="#CTD.Utility-1249"><span class="linenos">1249</span></a>        <span class="nd">@staticmethod</span>
</span><span id="CTD.Utility-1250"><a href="#CTD.Utility-1250"><span class="linenos">1250</span></a>        <span class="k">def</span> <span class="nf">save_to_csv</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
</span><span id="CTD.Utility-1251"><a href="#CTD.Utility-1251"><span class="linenos">1251</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1252"><a href="#CTD.Utility-1252"><span class="linenos">1252</span></a><span class="sd">            Renames the columns of the CTD data table based on a predefined mapping and saves the</span>
</span><span id="CTD.Utility-1253"><a href="#CTD.Utility-1253"><span class="linenos">1253</span></a><span class="sd">            data to the specified CSV file. If the file already exists, the data is appended to it.</span>
</span><span id="CTD.Utility-1254"><a href="#CTD.Utility-1254"><span class="linenos">1254</span></a>
</span><span id="CTD.Utility-1255"><a href="#CTD.Utility-1255"><span class="linenos">1255</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility-1256"><a href="#CTD.Utility-1256"><span class="linenos">1256</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility-1257"><a href="#CTD.Utility-1257"><span class="linenos">1257</span></a><span class="sd">            input_df : DataFrame</span>
</span><span id="CTD.Utility-1258"><a href="#CTD.Utility-1258"><span class="linenos">1258</span></a><span class="sd">                The output CSV file path.</span>
</span><span id="CTD.Utility-1259"><a href="#CTD.Utility-1259"><span class="linenos">1259</span></a><span class="sd">            output_file : str</span>
</span><span id="CTD.Utility-1260"><a href="#CTD.Utility-1260"><span class="linenos">1260</span></a><span class="sd">                The output CSV file path.</span>
</span><span id="CTD.Utility-1261"><a href="#CTD.Utility-1261"><span class="linenos">1261</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1262"><a href="#CTD.Utility-1262"><span class="linenos">1262</span></a>            <span class="n">rsk_labels</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CTD.Utility-1263"><a href="#CTD.Utility-1263"><span class="linenos">1263</span></a>                <span class="s2">&quot;temperature_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Temperature_(°C)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1264"><a href="#CTD.Utility-1264"><span class="linenos">1264</span></a>                <span class="s2">&quot;pressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Pressure_(dbar)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1265"><a href="#CTD.Utility-1265"><span class="linenos">1265</span></a>                <span class="s2">&quot;chlorophyll_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Chlorophyll_a_(µg/l)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1266"><a href="#CTD.Utility-1266"><span class="linenos">1266</span></a>                <span class="s2">&quot;seapressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Sea Pressure_(dbar)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1267"><a href="#CTD.Utility-1267"><span class="linenos">1267</span></a>                <span class="s2">&quot;depth_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Depth_(m)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1268"><a href="#CTD.Utility-1268"><span class="linenos">1268</span></a>                <span class="s2">&quot;salinity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Salinity_(PSU)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1269"><a href="#CTD.Utility-1269"><span class="linenos">1269</span></a>                <span class="s2">&quot;speedofsound_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Speed of Sound_(m/s)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1270"><a href="#CTD.Utility-1270"><span class="linenos">1270</span></a>                <span class="s2">&quot;specificconductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Specific Conductivity_(µS/cm)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1271"><a href="#CTD.Utility-1271"><span class="linenos">1271</span></a>                <span class="s2">&quot;conductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Conductivity_(mS/cm)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1272"><a href="#CTD.Utility-1272"><span class="linenos">1272</span></a>                <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="s2">&quot;Density_(kg/m^3)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1273"><a href="#CTD.Utility-1273"><span class="linenos">1273</span></a>                <span class="s2">&quot;salinityabs&quot;</span><span class="p">:</span> <span class="s2">&quot;Absolute Salinity_(g/kg)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1274"><a href="#CTD.Utility-1274"><span class="linenos">1274</span></a>                <span class="s2">&quot;MLD_Zero&quot;</span><span class="p">:</span> <span class="s2">&quot;MLD Zero_(m)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1275"><a href="#CTD.Utility-1275"><span class="linenos">1275</span></a>                <span class="s2">&quot;MLD_Ten&quot;</span><span class="p">:</span> <span class="s2">&quot;MLD Ten_(m)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1276"><a href="#CTD.Utility-1276"><span class="linenos">1276</span></a>                <span class="s2">&quot;stratification&quot;</span><span class="p">:</span> <span class="s2">&quot;Stratification_(J/m^2)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1277"><a href="#CTD.Utility-1277"><span class="linenos">1277</span></a>                <span class="s2">&quot;mean_surface_density&quot;</span><span class="p">:</span> <span class="s2">&quot;Mean_Surface_Density_(kg/m^3)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1278"><a href="#CTD.Utility-1278"><span class="linenos">1278</span></a>                <span class="s2">&quot;surface_salinity&quot;</span><span class="p">:</span> <span class="s2">&quot;Surface_Salinity_(PSU)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1279"><a href="#CTD.Utility-1279"><span class="linenos">1279</span></a>                <span class="s2">&quot;surface_temperature&quot;</span><span class="p">:</span> <span class="s2">&quot;Surface_Temperature_(°C)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1280"><a href="#CTD.Utility-1280"><span class="linenos">1280</span></a>                <span class="s2">&quot;meltwater_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;Meltwater_Fraction_(%)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility-1281"><a href="#CTD.Utility-1281"><span class="linenos">1281</span></a>                <span class="s2">&quot;overturn&quot;</span><span class="p">:</span> <span class="s2">&quot;Overturn_(Δρ&lt;-0.05)&quot;</span>
</span><span id="CTD.Utility-1282"><a href="#CTD.Utility-1282"><span class="linenos">1282</span></a>            <span class="p">}</span>
</span><span id="CTD.Utility-1283"><a href="#CTD.Utility-1283"><span class="linenos">1283</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">input_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.Utility-1284"><a href="#CTD.Utility-1284"><span class="linenos">1284</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rsk_labels</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility-1285"><a href="#CTD.Utility-1285"><span class="linenos">1285</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility-1286"><a href="#CTD.Utility-1286"><span class="linenos">1286</span></a>            <span class="c1"># Handle CSV file reading and merging</span>
</span><span id="CTD.Utility-1287"><a href="#CTD.Utility-1287"><span class="linenos">1287</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CTD.Utility-1288"><a href="#CTD.Utility-1288"><span class="linenos">1288</span></a>                <span class="n">csv_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</span><span id="CTD.Utility-1289"><a href="#CTD.Utility-1289"><span class="linenos">1289</span></a>                <span class="n">csv_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility-1290"><a href="#CTD.Utility-1290"><span class="linenos">1290</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="CTD.Utility-1291"><a href="#CTD.Utility-1291"><span class="linenos">1291</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2"> does not exist. A new file will be created.&quot;</span><span class="p">)</span>
</span><span id="CTD.Utility-1292"><a href="#CTD.Utility-1292"><span class="linenos">1292</span></a>                <span class="n">csv_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="CTD.Utility-1293"><a href="#CTD.Utility-1293"><span class="linenos">1293</span></a>
</span><span id="CTD.Utility-1294"><a href="#CTD.Utility-1294"><span class="linenos">1294</span></a>            <span class="c1"># Merge the existing DataFrame with the new DataFrame</span>
</span><span id="CTD.Utility-1295"><a href="#CTD.Utility-1295"><span class="linenos">1295</span></a>            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">csv_df</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility-1296"><a href="#CTD.Utility-1296"><span class="linenos">1296</span></a>            <span class="c1"># Overwrite the original CSV file with the merged DataFrame</span>
</span><span id="CTD.Utility-1297"><a href="#CTD.Utility-1297"><span class="linenos">1297</span></a>            <span class="n">merged_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CTD.Utility-1298"><a href="#CTD.Utility-1298"><span class="linenos">1298</span></a>
</span><span id="CTD.Utility-1299"><a href="#CTD.Utility-1299"><span class="linenos">1299</span></a>        <span class="nd">@staticmethod</span>
</span><span id="CTD.Utility-1300"><a href="#CTD.Utility-1300"><span class="linenos">1300</span></a>        <span class="k">def</span> <span class="nf">extract_utc_cast_time</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">):</span>
</span><span id="CTD.Utility-1301"><a href="#CTD.Utility-1301"><span class="linenos">1301</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1302"><a href="#CTD.Utility-1302"><span class="linenos">1302</span></a><span class="sd">            Function to extract the UTC cast time from a castaway file and convert it to ISO 8601 format.</span>
</span><span id="CTD.Utility-1303"><a href="#CTD.Utility-1303"><span class="linenos">1303</span></a>
</span><span id="CTD.Utility-1304"><a href="#CTD.Utility-1304"><span class="linenos">1304</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility-1305"><a href="#CTD.Utility-1305"><span class="linenos">1305</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility-1306"><a href="#CTD.Utility-1306"><span class="linenos">1306</span></a><span class="sd">            ctdfilepath : str</span>
</span><span id="CTD.Utility-1307"><a href="#CTD.Utility-1307"><span class="linenos">1307</span></a><span class="sd">                The file path of the castaway file to extract the time from.</span>
</span><span id="CTD.Utility-1308"><a href="#CTD.Utility-1308"><span class="linenos">1308</span></a>
</span><span id="CTD.Utility-1309"><a href="#CTD.Utility-1309"><span class="linenos">1309</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility-1310"><a href="#CTD.Utility-1310"><span class="linenos">1310</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility-1311"><a href="#CTD.Utility-1311"><span class="linenos">1311</span></a><span class="sd">            str</span>
</span><span id="CTD.Utility-1312"><a href="#CTD.Utility-1312"><span class="linenos">1312</span></a><span class="sd">                Cast time (UTC) of the castaway file in ISO 8601 format.</span>
</span><span id="CTD.Utility-1313"><a href="#CTD.Utility-1313"><span class="linenos">1313</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1314"><a href="#CTD.Utility-1314"><span class="linenos">1314</span></a>            <span class="c1"># Initialize variable to store UTC cast time</span>
</span><span id="CTD.Utility-1315"><a href="#CTD.Utility-1315"><span class="linenos">1315</span></a>            <span class="n">cast_time_utc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1316"><a href="#CTD.Utility-1316"><span class="linenos">1316</span></a>            <span class="c1"># Open the file and read line by line</span>
</span><span id="CTD.Utility-1317"><a href="#CTD.Utility-1317"><span class="linenos">1317</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD.Utility-1318"><a href="#CTD.Utility-1318"><span class="linenos">1318</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD.Utility-1319"><a href="#CTD.Utility-1319"><span class="linenos">1319</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Cast time (UTC)&#39;</span><span class="p">):</span>
</span><span id="CTD.Utility-1320"><a href="#CTD.Utility-1320"><span class="linenos">1320</span></a>                        <span class="c1"># Extract the UTC cast time after the comma</span>
</span><span id="CTD.Utility-1321"><a href="#CTD.Utility-1321"><span class="linenos">1321</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="CTD.Utility-1322"><a href="#CTD.Utility-1322"><span class="linenos">1322</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD.Utility-1323"><a href="#CTD.Utility-1323"><span class="linenos">1323</span></a>                            <span class="n">cast_time_str</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Take only the datetime part</span>
</span><span id="CTD.Utility-1324"><a href="#CTD.Utility-1324"><span class="linenos">1324</span></a>                            <span class="c1"># Convert the datetime string to ISO format if possible</span>
</span><span id="CTD.Utility-1325"><a href="#CTD.Utility-1325"><span class="linenos">1325</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="CTD.Utility-1326"><a href="#CTD.Utility-1326"><span class="linenos">1326</span></a>                                <span class="n">cast_time_utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">cast_time_str</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="CTD.Utility-1327"><a href="#CTD.Utility-1327"><span class="linenos">1327</span></a>                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="CTD.Utility-1328"><a href="#CTD.Utility-1328"><span class="linenos">1328</span></a>                                <span class="c1"># Handle the case where date format does not match expected format</span>
</span><span id="CTD.Utility-1329"><a href="#CTD.Utility-1329"><span class="linenos">1329</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Date format does not match expected &#39;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#39;&quot;</span><span class="p">)</span>
</span><span id="CTD.Utility-1330"><a href="#CTD.Utility-1330"><span class="linenos">1330</span></a>                            <span class="k">break</span>  <span class="c1"># Stop reading once the timestamp is found</span>
</span><span id="CTD.Utility-1331"><a href="#CTD.Utility-1331"><span class="linenos">1331</span></a>
</span><span id="CTD.Utility-1332"><a href="#CTD.Utility-1332"><span class="linenos">1332</span></a>            <span class="k">return</span> <span class="n">cast_time_utc</span>
</span><span id="CTD.Utility-1333"><a href="#CTD.Utility-1333"><span class="linenos">1333</span></a>
</span><span id="CTD.Utility-1334"><a href="#CTD.Utility-1334"><span class="linenos">1334</span></a>        <span class="nd">@staticmethod</span>
</span><span id="CTD.Utility-1335"><a href="#CTD.Utility-1335"><span class="linenos">1335</span></a>        <span class="k">def</span> <span class="nf">extract_lat_long_castaway</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">):</span>
</span><span id="CTD.Utility-1336"><a href="#CTD.Utility-1336"><span class="linenos">1336</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1337"><a href="#CTD.Utility-1337"><span class="linenos">1337</span></a><span class="sd">            Function extract start lat/long from castaway file.</span>
</span><span id="CTD.Utility-1338"><a href="#CTD.Utility-1338"><span class="linenos">1338</span></a>
</span><span id="CTD.Utility-1339"><a href="#CTD.Utility-1339"><span class="linenos">1339</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility-1340"><a href="#CTD.Utility-1340"><span class="linenos">1340</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility-1341"><a href="#CTD.Utility-1341"><span class="linenos">1341</span></a><span class="sd">            ctdfilepath : str</span>
</span><span id="CTD.Utility-1342"><a href="#CTD.Utility-1342"><span class="linenos">1342</span></a><span class="sd">                Filepath to castaway ctd file.</span>
</span><span id="CTD.Utility-1343"><a href="#CTD.Utility-1343"><span class="linenos">1343</span></a>
</span><span id="CTD.Utility-1344"><a href="#CTD.Utility-1344"><span class="linenos">1344</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility-1345"><a href="#CTD.Utility-1345"><span class="linenos">1345</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility-1346"><a href="#CTD.Utility-1346"><span class="linenos">1346</span></a><span class="sd">            tuple</span>
</span><span id="CTD.Utility-1347"><a href="#CTD.Utility-1347"><span class="linenos">1347</span></a><span class="sd">                (latitude, longitude)</span>
</span><span id="CTD.Utility-1348"><a href="#CTD.Utility-1348"><span class="linenos">1348</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility-1349"><a href="#CTD.Utility-1349"><span class="linenos">1349</span></a>            <span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1350"><a href="#CTD.Utility-1350"><span class="linenos">1350</span></a>            <span class="n">longitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.Utility-1351"><a href="#CTD.Utility-1351"><span class="linenos">1351</span></a>            <span class="c1"># Open the file and read line by line</span>
</span><span id="CTD.Utility-1352"><a href="#CTD.Utility-1352"><span class="linenos">1352</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD.Utility-1353"><a href="#CTD.Utility-1353"><span class="linenos">1353</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD.Utility-1354"><a href="#CTD.Utility-1354"><span class="linenos">1354</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Start latitude&#39;</span><span class="p">):</span>
</span><span id="CTD.Utility-1355"><a href="#CTD.Utility-1355"><span class="linenos">1355</span></a>                        <span class="c1"># Assume the format is &#39;% description, latitude&#39;</span>
</span><span id="CTD.Utility-1356"><a href="#CTD.Utility-1356"><span class="linenos">1356</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="CTD.Utility-1357"><a href="#CTD.Utility-1357"><span class="linenos">1357</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD.Utility-1358"><a href="#CTD.Utility-1358"><span class="linenos">1358</span></a>                            <span class="n">latitude</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="CTD.Utility-1359"><a href="#CTD.Utility-1359"><span class="linenos">1359</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Start longitude&#39;</span><span class="p">):</span>
</span><span id="CTD.Utility-1360"><a href="#CTD.Utility-1360"><span class="linenos">1360</span></a>                        <span class="c1"># Assume the format is &#39;% description, longitude&#39;</span>
</span><span id="CTD.Utility-1361"><a href="#CTD.Utility-1361"><span class="linenos">1361</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="CTD.Utility-1362"><a href="#CTD.Utility-1362"><span class="linenos">1362</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD.Utility-1363"><a href="#CTD.Utility-1363"><span class="linenos">1363</span></a>                            <span class="n">longitude</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="CTD.Utility-1364"><a href="#CTD.Utility-1364"><span class="linenos">1364</span></a>
</span><span id="CTD.Utility-1365"><a href="#CTD.Utility-1365"><span class="linenos">1365</span></a>            <span class="k">return</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span>
</span></pre></div>


            <div class="docstring"><h6 id="utility">Utility</h6>

<p>Utility class for CTD data processing.</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>filename</strong> (str):
Filename of the RSK file.</li>
</ul>
</div>


                            <div id="CTD.Utility.__init__" class="classattr">
                                        <input id="CTD.Utility.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CTD.Utility</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">filename</span></span>)</span>

                <label class="view-source-button" for="CTD.Utility.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.__init__-1045"><a href="#CTD.Utility.__init__-1045"><span class="linenos">1045</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="CTD.Utility.__init__-1046"><a href="#CTD.Utility.__init__-1046"><span class="linenos">1046</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.__init__-1047"><a href="#CTD.Utility.__init__-1047"><span class="linenos">1047</span></a><span class="sd">            Initialize a new Utility object.</span>
</span><span id="CTD.Utility.__init__-1048"><a href="#CTD.Utility.__init__-1048"><span class="linenos">1048</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility.__init__-1049"><a href="#CTD.Utility.__init__-1049"><span class="linenos">1049</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility.__init__-1050"><a href="#CTD.Utility.__init__-1050"><span class="linenos">1050</span></a><span class="sd">            filename : str</span>
</span><span id="CTD.Utility.__init__-1051"><a href="#CTD.Utility.__init__-1051"><span class="linenos">1051</span></a><span class="sd">                The filename of the RSK file.</span>
</span><span id="CTD.Utility.__init__-1052"><a href="#CTD.Utility.__init__-1052"><span class="linenos">1052</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.__init__-1053"><a href="#CTD.Utility.__init__-1053"><span class="linenos">1053</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a new Utility object.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filename</strong> (str):
The filename of the RSK file.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.Utility.no_values_in_object" class="classattr">
                                        <input id="CTD.Utility.no_values_in_object-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">no_values_in_object</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">object_to_check</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.Utility.no_values_in_object-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.no_values_in_object"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.no_values_in_object-1055"><a href="#CTD.Utility.no_values_in_object-1055"><span class="linenos">1055</span></a>        <span class="k">def</span> <span class="nf">no_values_in_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_to_check</span><span class="p">):</span>
</span><span id="CTD.Utility.no_values_in_object-1056"><a href="#CTD.Utility.no_values_in_object-1056"><span class="linenos">1056</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.no_values_in_object-1057"><a href="#CTD.Utility.no_values_in_object-1057"><span class="linenos">1057</span></a><span class="sd">            Checks if the given object is None, empty, or has a length greater than 0.</span>
</span><span id="CTD.Utility.no_values_in_object-1058"><a href="#CTD.Utility.no_values_in_object-1058"><span class="linenos">1058</span></a><span class="sd">            Returns True if the object has no values, False otherwise.</span>
</span><span id="CTD.Utility.no_values_in_object-1059"><a href="#CTD.Utility.no_values_in_object-1059"><span class="linenos">1059</span></a>
</span><span id="CTD.Utility.no_values_in_object-1060"><a href="#CTD.Utility.no_values_in_object-1060"><span class="linenos">1060</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility.no_values_in_object-1061"><a href="#CTD.Utility.no_values_in_object-1061"><span class="linenos">1061</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility.no_values_in_object-1062"><a href="#CTD.Utility.no_values_in_object-1062"><span class="linenos">1062</span></a><span class="sd">            object_to_check : object</span>
</span><span id="CTD.Utility.no_values_in_object-1063"><a href="#CTD.Utility.no_values_in_object-1063"><span class="linenos">1063</span></a><span class="sd">                The object to check for values.</span>
</span><span id="CTD.Utility.no_values_in_object-1064"><a href="#CTD.Utility.no_values_in_object-1064"><span class="linenos">1064</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility.no_values_in_object-1065"><a href="#CTD.Utility.no_values_in_object-1065"><span class="linenos">1065</span></a><span class="sd">            --------</span>
</span><span id="CTD.Utility.no_values_in_object-1066"><a href="#CTD.Utility.no_values_in_object-1066"><span class="linenos">1066</span></a><span class="sd">            bool</span>
</span><span id="CTD.Utility.no_values_in_object-1067"><a href="#CTD.Utility.no_values_in_object-1067"><span class="linenos">1067</span></a><span class="sd">                True if the object has no values, False otherwise.</span>
</span><span id="CTD.Utility.no_values_in_object-1068"><a href="#CTD.Utility.no_values_in_object-1068"><span class="linenos">1068</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.no_values_in_object-1069"><a href="#CTD.Utility.no_values_in_object-1069"><span class="linenos">1069</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">object_to_check</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span id="CTD.Utility.no_values_in_object-1070"><a href="#CTD.Utility.no_values_in_object-1070"><span class="linenos">1070</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="CTD.Utility.no_values_in_object-1071"><a href="#CTD.Utility.no_values_in_object-1071"><span class="linenos">1071</span></a>            <span class="k">if</span> <span class="n">object_to_check</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CTD.Utility.no_values_in_object-1072"><a href="#CTD.Utility.no_values_in_object-1072"><span class="linenos">1072</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="CTD.Utility.no_values_in_object-1073"><a href="#CTD.Utility.no_values_in_object-1073"><span class="linenos">1073</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_to_check</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CTD.Utility.no_values_in_object-1074"><a href="#CTD.Utility.no_values_in_object-1074"><span class="linenos">1074</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Checks if the given object is None, empty, or has a length greater than 0.
Returns True if the object has no values, False otherwise.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>object_to_check</strong> (object):
The object to check for values.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>bool</strong>: True if the object has no values, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.Utility.remove_sample_timezone_indicator" class="classattr">
                                        <input id="CTD.Utility.remove_sample_timezone_indicator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_sample_timezone_indicator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.Utility.remove_sample_timezone_indicator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.remove_sample_timezone_indicator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.remove_sample_timezone_indicator-1076"><a href="#CTD.Utility.remove_sample_timezone_indicator-1076"><span class="linenos">1076</span></a>        <span class="k">def</span> <span class="nf">remove_sample_timezone_indicator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1077"><a href="#CTD.Utility.remove_sample_timezone_indicator-1077"><span class="linenos">1077</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1078"><a href="#CTD.Utility.remove_sample_timezone_indicator-1078"><span class="linenos">1078</span></a><span class="sd">            Removes the timezone indicator (e.g., &#39;+00:00&#39;) from the &#39;timestamp&#39; column of the</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1079"><a href="#CTD.Utility.remove_sample_timezone_indicator-1079"><span class="linenos">1079</span></a><span class="sd">            given DataFrame. Returns the updated DataFrame.</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1080"><a href="#CTD.Utility.remove_sample_timezone_indicator-1080"><span class="linenos">1080</span></a>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1081"><a href="#CTD.Utility.remove_sample_timezone_indicator-1081"><span class="linenos">1081</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1082"><a href="#CTD.Utility.remove_sample_timezone_indicator-1082"><span class="linenos">1082</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1083"><a href="#CTD.Utility.remove_sample_timezone_indicator-1083"><span class="linenos">1083</span></a><span class="sd">            df : DataFrame</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1084"><a href="#CTD.Utility.remove_sample_timezone_indicator-1084"><span class="linenos">1084</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1085"><a href="#CTD.Utility.remove_sample_timezone_indicator-1085"><span class="linenos">1085</span></a>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1086"><a href="#CTD.Utility.remove_sample_timezone_indicator-1086"><span class="linenos">1086</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1087"><a href="#CTD.Utility.remove_sample_timezone_indicator-1087"><span class="linenos">1087</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1088"><a href="#CTD.Utility.remove_sample_timezone_indicator-1088"><span class="linenos">1088</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1089"><a href="#CTD.Utility.remove_sample_timezone_indicator-1089"><span class="linenos">1089</span></a><span class="sd">                The updated DataFrame with the timezone indicator removed.</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1090"><a href="#CTD.Utility.remove_sample_timezone_indicator-1090"><span class="linenos">1090</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1091"><a href="#CTD.Utility.remove_sample_timezone_indicator-1091"><span class="linenos">1091</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1092"><a href="#CTD.Utility.remove_sample_timezone_indicator-1092"><span class="linenos">1092</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1093"><a href="#CTD.Utility.remove_sample_timezone_indicator-1093"><span class="linenos">1093</span></a>            <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1094"><a href="#CTD.Utility.remove_sample_timezone_indicator-1094"><span class="linenos">1094</span></a>                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1095"><a href="#CTD.Utility.remove_sample_timezone_indicator-1095"><span class="linenos">1095</span></a>                <span class="k">return</span> <span class="n">df</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1096"><a href="#CTD.Utility.remove_sample_timezone_indicator-1096"><span class="linenos">1096</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_sample_timezone_indicator-1097"><a href="#CTD.Utility.remove_sample_timezone_indicator-1097"><span class="linenos">1097</span></a>                <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Removes the timezone indicator (e.g., '+00:00') from the 'timestamp' column of the
given DataFrame. Returns the updated DataFrame.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (DataFrame):
The DataFrame to process.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame</strong>: The updated DataFrame with the timezone indicator removed.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.Utility.remove_rows_with_negative_depth" class="classattr">
                                        <input id="CTD.Utility.remove_rows_with_negative_depth-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_rows_with_negative_depth</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.Utility.remove_rows_with_negative_depth-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.remove_rows_with_negative_depth"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.remove_rows_with_negative_depth-1099"><a href="#CTD.Utility.remove_rows_with_negative_depth-1099"><span class="linenos">1099</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1100"><a href="#CTD.Utility.remove_rows_with_negative_depth-1100"><span class="linenos">1100</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1101"><a href="#CTD.Utility.remove_rows_with_negative_depth-1101"><span class="linenos">1101</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;depth_00&#39; column has negative values.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1102"><a href="#CTD.Utility.remove_rows_with_negative_depth-1102"><span class="linenos">1102</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1103"><a href="#CTD.Utility.remove_rows_with_negative_depth-1103"><span class="linenos">1103</span></a>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1104"><a href="#CTD.Utility.remove_rows_with_negative_depth-1104"><span class="linenos">1104</span></a><span class="sd">            Parameter</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1105"><a href="#CTD.Utility.remove_rows_with_negative_depth-1105"><span class="linenos">1105</span></a><span class="sd">            ---------</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1106"><a href="#CTD.Utility.remove_rows_with_negative_depth-1106"><span class="linenos">1106</span></a><span class="sd">            df : DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1107"><a href="#CTD.Utility.remove_rows_with_negative_depth-1107"><span class="linenos">1107</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1108"><a href="#CTD.Utility.remove_rows_with_negative_depth-1108"><span class="linenos">1108</span></a>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1109"><a href="#CTD.Utility.remove_rows_with_negative_depth-1109"><span class="linenos">1109</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1110"><a href="#CTD.Utility.remove_rows_with_negative_depth-1110"><span class="linenos">1110</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1111"><a href="#CTD.Utility.remove_rows_with_negative_depth-1111"><span class="linenos">1111</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1112"><a href="#CTD.Utility.remove_rows_with_negative_depth-1112"><span class="linenos">1112</span></a><span class="sd">                The updated DataFrame with rows containing negative depth values removed.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1113"><a href="#CTD.Utility.remove_rows_with_negative_depth-1113"><span class="linenos">1113</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1114"><a href="#CTD.Utility.remove_rows_with_negative_depth-1114"><span class="linenos">1114</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1115"><a href="#CTD.Utility.remove_rows_with_negative_depth-1115"><span class="linenos">1115</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1116"><a href="#CTD.Utility.remove_rows_with_negative_depth-1116"><span class="linenos">1116</span></a>            <span class="k">if</span> <span class="s1">&#39;depth_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1117"><a href="#CTD.Utility.remove_rows_with_negative_depth-1117"><span class="linenos">1117</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1118"><a href="#CTD.Utility.remove_rows_with_negative_depth-1118"><span class="linenos">1118</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1119"><a href="#CTD.Utility.remove_rows_with_negative_depth-1119"><span class="linenos">1119</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1120"><a href="#CTD.Utility.remove_rows_with_negative_depth-1120"><span class="linenos">1120</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1121"><a href="#CTD.Utility.remove_rows_with_negative_depth-1121"><span class="linenos">1121</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_depth-1122"><a href="#CTD.Utility.remove_rows_with_negative_depth-1122"><span class="linenos">1122</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Removes rows from the given DataFrame where the 'depth_00' column has negative values.
Returns the updated DataFrame.</p>

<h6 id="parameter">Parameter</h6>

<p>df : DataFrame
    The DataFrame to process.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame</strong>: The updated DataFrame with rows containing negative depth values removed.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.Utility.remove_rows_with_negative_salinity" class="classattr">
                                        <input id="CTD.Utility.remove_rows_with_negative_salinity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_rows_with_negative_salinity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.Utility.remove_rows_with_negative_salinity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.remove_rows_with_negative_salinity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.remove_rows_with_negative_salinity-1124"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1124"><span class="linenos">1124</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1125"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1125"><span class="linenos">1125</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1126"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1126"><span class="linenos">1126</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;salinity_00&#39; column has negative values.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1127"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1127"><span class="linenos">1127</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1128"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1128"><span class="linenos">1128</span></a>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1129"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1129"><span class="linenos">1129</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1130"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1130"><span class="linenos">1130</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1131"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1131"><span class="linenos">1131</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1132"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1132"><span class="linenos">1132</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1133"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1133"><span class="linenos">1133</span></a>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1134"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1134"><span class="linenos">1134</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1135"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1135"><span class="linenos">1135</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1136"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1136"><span class="linenos">1136</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1137"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1137"><span class="linenos">1137</span></a><span class="sd">                The updated DataFrame with rows containing negative salinity values removed.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1138"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1138"><span class="linenos">1138</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1139"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1139"><span class="linenos">1139</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1140"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1140"><span class="linenos">1140</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1141"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1141"><span class="linenos">1141</span></a>            <span class="k">if</span> <span class="s1">&#39;salinity_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1142"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1142"><span class="linenos">1142</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1143"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1143"><span class="linenos">1143</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1144"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1144"><span class="linenos">1144</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1145"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1145"><span class="linenos">1145</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1146"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1146"><span class="linenos">1146</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinity-1147"><a href="#CTD.Utility.remove_rows_with_negative_salinity-1147"><span class="linenos">1147</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Removes rows from the given DataFrame where the 'salinity_00' column has negative values.
Returns the updated DataFrame.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (DataFrame):
The DataFrame to process.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame</strong>: The updated DataFrame with rows containing negative salinity values removed.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.Utility.remove_rows_with_invalid_salinity" class="classattr">
                                        <input id="CTD.Utility.remove_rows_with_invalid_salinity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_rows_with_invalid_salinity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.Utility.remove_rows_with_invalid_salinity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.remove_rows_with_invalid_salinity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1149"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1149"><span class="linenos">1149</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_invalid_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1150"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1150"><span class="linenos">1150</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1151"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1151"><span class="linenos">1151</span></a><span class="sd">            Removes rows from the given DataFrame where the practical salinity column has values &lt; 10.</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1152"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1152"><span class="linenos">1152</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1153"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1153"><span class="linenos">1153</span></a>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1154"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1154"><span class="linenos">1154</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1155"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1155"><span class="linenos">1155</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1156"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1156"><span class="linenos">1156</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1157"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1157"><span class="linenos">1157</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1158"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1158"><span class="linenos">1158</span></a>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1159"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1159"><span class="linenos">1159</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1160"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1160"><span class="linenos">1160</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1161"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1161"><span class="linenos">1161</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1162"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1162"><span class="linenos">1162</span></a><span class="sd">                The updated DataFrame with rows containing negative salinity values removed.</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1163"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1163"><span class="linenos">1163</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1164"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1164"><span class="linenos">1164</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1165"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1165"><span class="linenos">1165</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1166"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1166"><span class="linenos">1166</span></a>            <span class="k">if</span> <span class="s1">&#39;salinity_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1167"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1167"><span class="linenos">1167</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1168"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1168"><span class="linenos">1168</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1169"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1169"><span class="linenos">1169</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1170"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1170"><span class="linenos">1170</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1171"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1171"><span class="linenos">1171</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_invalid_salinity-1172"><a href="#CTD.Utility.remove_rows_with_invalid_salinity-1172"><span class="linenos">1172</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Removes rows from the given DataFrame where the practical salinity column has values &lt; 10.
Returns the updated DataFrame.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (DataFrame):
The DataFrame to process.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame</strong>: The updated DataFrame with rows containing negative salinity values removed.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.Utility.remove_rows_with_negative_pressure" class="classattr">
                                        <input id="CTD.Utility.remove_rows_with_negative_pressure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_rows_with_negative_pressure</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.Utility.remove_rows_with_negative_pressure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.remove_rows_with_negative_pressure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.remove_rows_with_negative_pressure-1174"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1174"><span class="linenos">1174</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1175"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1175"><span class="linenos">1175</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1176"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1176"><span class="linenos">1176</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;pressure_00&#39; column has negative values.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1177"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1177"><span class="linenos">1177</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1178"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1178"><span class="linenos">1178</span></a>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1179"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1179"><span class="linenos">1179</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1180"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1180"><span class="linenos">1180</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1181"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1181"><span class="linenos">1181</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1182"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1182"><span class="linenos">1182</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1183"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1183"><span class="linenos">1183</span></a>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1184"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1184"><span class="linenos">1184</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1185"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1185"><span class="linenos">1185</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1186"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1186"><span class="linenos">1186</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1187"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1187"><span class="linenos">1187</span></a><span class="sd">                The updated DataFrame with rows containing negative pressure values removed.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1188"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1188"><span class="linenos">1188</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1189"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1189"><span class="linenos">1189</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1190"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1190"><span class="linenos">1190</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1191"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1191"><span class="linenos">1191</span></a>            <span class="k">if</span> <span class="s1">&#39;pressure_00&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1192"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1192"><span class="linenos">1192</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1193"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1193"><span class="linenos">1193</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1194"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1194"><span class="linenos">1194</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1195"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1195"><span class="linenos">1195</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1196"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1196"><span class="linenos">1196</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_pressure-1197"><a href="#CTD.Utility.remove_rows_with_negative_pressure-1197"><span class="linenos">1197</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Removes rows from the given DataFrame where the 'pressure_00' column has negative values.
Returns the updated DataFrame.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (DataFrame):
The DataFrame to process.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame</strong>: The updated DataFrame with rows containing negative pressure values removed.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.Utility.remove_rows_with_negative_salinityabs" class="classattr">
                                        <input id="CTD.Utility.remove_rows_with_negative_salinityabs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_rows_with_negative_salinityabs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.Utility.remove_rows_with_negative_salinityabs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.remove_rows_with_negative_salinityabs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1199"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1199"><span class="linenos">1199</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_salinityabs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1200"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1200"><span class="linenos">1200</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1201"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1201"><span class="linenos">1201</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;salinityabs&#39; column has negative values.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1202"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1202"><span class="linenos">1202</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1203"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1203"><span class="linenos">1203</span></a>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1204"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1204"><span class="linenos">1204</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1205"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1205"><span class="linenos">1205</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1206"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1206"><span class="linenos">1206</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1207"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1207"><span class="linenos">1207</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1208"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1208"><span class="linenos">1208</span></a>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1209"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1209"><span class="linenos">1209</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1210"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1210"><span class="linenos">1210</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1211"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1211"><span class="linenos">1211</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1212"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1212"><span class="linenos">1212</span></a><span class="sd">                The updated DataFrame with rows containing negative absolute salinity values removed.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1213"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1213"><span class="linenos">1213</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1214"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1214"><span class="linenos">1214</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1215"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1215"><span class="linenos">1215</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1216"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1216"><span class="linenos">1216</span></a>            <span class="k">if</span> <span class="s1">&#39;salinityabs&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1217"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1217"><span class="linenos">1217</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinityabs&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1218"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1218"><span class="linenos">1218</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1219"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1219"><span class="linenos">1219</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1220"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1220"><span class="linenos">1220</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1221"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1221"><span class="linenos">1221</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_salinityabs-1222"><a href="#CTD.Utility.remove_rows_with_negative_salinityabs-1222"><span class="linenos">1222</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Removes rows from the given DataFrame where the 'salinityabs' column has negative values.
Returns the updated DataFrame.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (DataFrame):
The DataFrame to process.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame</strong>: The updated DataFrame with rows containing negative absolute salinity values removed.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.Utility.remove_rows_with_negative_density" class="classattr">
                                        <input id="CTD.Utility.remove_rows_with_negative_density-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_rows_with_negative_density</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.Utility.remove_rows_with_negative_density-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.remove_rows_with_negative_density"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.remove_rows_with_negative_density-1224"><a href="#CTD.Utility.remove_rows_with_negative_density-1224"><span class="linenos">1224</span></a>        <span class="k">def</span> <span class="nf">remove_rows_with_negative_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1225"><a href="#CTD.Utility.remove_rows_with_negative_density-1225"><span class="linenos">1225</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1226"><a href="#CTD.Utility.remove_rows_with_negative_density-1226"><span class="linenos">1226</span></a><span class="sd">            Removes rows from the given DataFrame where the &#39;density&#39; column has negative values.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1227"><a href="#CTD.Utility.remove_rows_with_negative_density-1227"><span class="linenos">1227</span></a><span class="sd">            Returns the updated DataFrame.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1228"><a href="#CTD.Utility.remove_rows_with_negative_density-1228"><span class="linenos">1228</span></a>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1229"><a href="#CTD.Utility.remove_rows_with_negative_density-1229"><span class="linenos">1229</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1230"><a href="#CTD.Utility.remove_rows_with_negative_density-1230"><span class="linenos">1230</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1231"><a href="#CTD.Utility.remove_rows_with_negative_density-1231"><span class="linenos">1231</span></a><span class="sd">            df: DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1232"><a href="#CTD.Utility.remove_rows_with_negative_density-1232"><span class="linenos">1232</span></a><span class="sd">                The DataFrame to process.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1233"><a href="#CTD.Utility.remove_rows_with_negative_density-1233"><span class="linenos">1233</span></a>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1234"><a href="#CTD.Utility.remove_rows_with_negative_density-1234"><span class="linenos">1234</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1235"><a href="#CTD.Utility.remove_rows_with_negative_density-1235"><span class="linenos">1235</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1236"><a href="#CTD.Utility.remove_rows_with_negative_density-1236"><span class="linenos">1236</span></a><span class="sd">            DataFrame</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1237"><a href="#CTD.Utility.remove_rows_with_negative_density-1237"><span class="linenos">1237</span></a><span class="sd">                The updated DataFrame with rows containing negative density values removed.</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1238"><a href="#CTD.Utility.remove_rows_with_negative_density-1238"><span class="linenos">1238</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1239"><a href="#CTD.Utility.remove_rows_with_negative_density-1239"><span class="linenos">1239</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1240"><a href="#CTD.Utility.remove_rows_with_negative_density-1240"><span class="linenos">1240</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1241"><a href="#CTD.Utility.remove_rows_with_negative_density-1241"><span class="linenos">1241</span></a>            <span class="k">if</span> <span class="s1">&#39;density&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1242"><a href="#CTD.Utility.remove_rows_with_negative_density-1242"><span class="linenos">1242</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1243"><a href="#CTD.Utility.remove_rows_with_negative_density-1243"><span class="linenos">1243</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1244"><a href="#CTD.Utility.remove_rows_with_negative_density-1244"><span class="linenos">1244</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1245"><a href="#CTD.Utility.remove_rows_with_negative_density-1245"><span class="linenos">1245</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_values_in_object</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1246"><a href="#CTD.Utility.remove_rows_with_negative_density-1246"><span class="linenos">1246</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="CTD.Utility.remove_rows_with_negative_density-1247"><a href="#CTD.Utility.remove_rows_with_negative_density-1247"><span class="linenos">1247</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Removes rows from the given DataFrame where the 'density' column has negative values.
Returns the updated DataFrame.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (DataFrame):
The DataFrame to process.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame</strong>: The updated DataFrame with rows containing negative density values removed.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.Utility.save_to_csv" class="classattr">
                                        <input id="CTD.Utility.save_to_csv-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">save_to_csv</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">input_df</span>, </span><span class="param"><span class="n">output_file</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.Utility.save_to_csv-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.save_to_csv"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.save_to_csv-1249"><a href="#CTD.Utility.save_to_csv-1249"><span class="linenos">1249</span></a>        <span class="nd">@staticmethod</span>
</span><span id="CTD.Utility.save_to_csv-1250"><a href="#CTD.Utility.save_to_csv-1250"><span class="linenos">1250</span></a>        <span class="k">def</span> <span class="nf">save_to_csv</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
</span><span id="CTD.Utility.save_to_csv-1251"><a href="#CTD.Utility.save_to_csv-1251"><span class="linenos">1251</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.save_to_csv-1252"><a href="#CTD.Utility.save_to_csv-1252"><span class="linenos">1252</span></a><span class="sd">            Renames the columns of the CTD data table based on a predefined mapping and saves the</span>
</span><span id="CTD.Utility.save_to_csv-1253"><a href="#CTD.Utility.save_to_csv-1253"><span class="linenos">1253</span></a><span class="sd">            data to the specified CSV file. If the file already exists, the data is appended to it.</span>
</span><span id="CTD.Utility.save_to_csv-1254"><a href="#CTD.Utility.save_to_csv-1254"><span class="linenos">1254</span></a>
</span><span id="CTD.Utility.save_to_csv-1255"><a href="#CTD.Utility.save_to_csv-1255"><span class="linenos">1255</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility.save_to_csv-1256"><a href="#CTD.Utility.save_to_csv-1256"><span class="linenos">1256</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility.save_to_csv-1257"><a href="#CTD.Utility.save_to_csv-1257"><span class="linenos">1257</span></a><span class="sd">            input_df : DataFrame</span>
</span><span id="CTD.Utility.save_to_csv-1258"><a href="#CTD.Utility.save_to_csv-1258"><span class="linenos">1258</span></a><span class="sd">                The output CSV file path.</span>
</span><span id="CTD.Utility.save_to_csv-1259"><a href="#CTD.Utility.save_to_csv-1259"><span class="linenos">1259</span></a><span class="sd">            output_file : str</span>
</span><span id="CTD.Utility.save_to_csv-1260"><a href="#CTD.Utility.save_to_csv-1260"><span class="linenos">1260</span></a><span class="sd">                The output CSV file path.</span>
</span><span id="CTD.Utility.save_to_csv-1261"><a href="#CTD.Utility.save_to_csv-1261"><span class="linenos">1261</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.save_to_csv-1262"><a href="#CTD.Utility.save_to_csv-1262"><span class="linenos">1262</span></a>            <span class="n">rsk_labels</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CTD.Utility.save_to_csv-1263"><a href="#CTD.Utility.save_to_csv-1263"><span class="linenos">1263</span></a>                <span class="s2">&quot;temperature_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Temperature_(°C)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1264"><a href="#CTD.Utility.save_to_csv-1264"><span class="linenos">1264</span></a>                <span class="s2">&quot;pressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Pressure_(dbar)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1265"><a href="#CTD.Utility.save_to_csv-1265"><span class="linenos">1265</span></a>                <span class="s2">&quot;chlorophyll_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Chlorophyll_a_(µg/l)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1266"><a href="#CTD.Utility.save_to_csv-1266"><span class="linenos">1266</span></a>                <span class="s2">&quot;seapressure_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Sea Pressure_(dbar)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1267"><a href="#CTD.Utility.save_to_csv-1267"><span class="linenos">1267</span></a>                <span class="s2">&quot;depth_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Depth_(m)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1268"><a href="#CTD.Utility.save_to_csv-1268"><span class="linenos">1268</span></a>                <span class="s2">&quot;salinity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Salinity_(PSU)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1269"><a href="#CTD.Utility.save_to_csv-1269"><span class="linenos">1269</span></a>                <span class="s2">&quot;speedofsound_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Speed of Sound_(m/s)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1270"><a href="#CTD.Utility.save_to_csv-1270"><span class="linenos">1270</span></a>                <span class="s2">&quot;specificconductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Specific Conductivity_(µS/cm)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1271"><a href="#CTD.Utility.save_to_csv-1271"><span class="linenos">1271</span></a>                <span class="s2">&quot;conductivity_00&quot;</span><span class="p">:</span> <span class="s2">&quot;Conductivity_(mS/cm)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1272"><a href="#CTD.Utility.save_to_csv-1272"><span class="linenos">1272</span></a>                <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="s2">&quot;Density_(kg/m^3)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1273"><a href="#CTD.Utility.save_to_csv-1273"><span class="linenos">1273</span></a>                <span class="s2">&quot;salinityabs&quot;</span><span class="p">:</span> <span class="s2">&quot;Absolute Salinity_(g/kg)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1274"><a href="#CTD.Utility.save_to_csv-1274"><span class="linenos">1274</span></a>                <span class="s2">&quot;MLD_Zero&quot;</span><span class="p">:</span> <span class="s2">&quot;MLD Zero_(m)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1275"><a href="#CTD.Utility.save_to_csv-1275"><span class="linenos">1275</span></a>                <span class="s2">&quot;MLD_Ten&quot;</span><span class="p">:</span> <span class="s2">&quot;MLD Ten_(m)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1276"><a href="#CTD.Utility.save_to_csv-1276"><span class="linenos">1276</span></a>                <span class="s2">&quot;stratification&quot;</span><span class="p">:</span> <span class="s2">&quot;Stratification_(J/m^2)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1277"><a href="#CTD.Utility.save_to_csv-1277"><span class="linenos">1277</span></a>                <span class="s2">&quot;mean_surface_density&quot;</span><span class="p">:</span> <span class="s2">&quot;Mean_Surface_Density_(kg/m^3)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1278"><a href="#CTD.Utility.save_to_csv-1278"><span class="linenos">1278</span></a>                <span class="s2">&quot;surface_salinity&quot;</span><span class="p">:</span> <span class="s2">&quot;Surface_Salinity_(PSU)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1279"><a href="#CTD.Utility.save_to_csv-1279"><span class="linenos">1279</span></a>                <span class="s2">&quot;surface_temperature&quot;</span><span class="p">:</span> <span class="s2">&quot;Surface_Temperature_(°C)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1280"><a href="#CTD.Utility.save_to_csv-1280"><span class="linenos">1280</span></a>                <span class="s2">&quot;meltwater_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;Meltwater_Fraction_(%)&quot;</span><span class="p">,</span>
</span><span id="CTD.Utility.save_to_csv-1281"><a href="#CTD.Utility.save_to_csv-1281"><span class="linenos">1281</span></a>                <span class="s2">&quot;overturn&quot;</span><span class="p">:</span> <span class="s2">&quot;Overturn_(Δρ&lt;-0.05)&quot;</span>
</span><span id="CTD.Utility.save_to_csv-1282"><a href="#CTD.Utility.save_to_csv-1282"><span class="linenos">1282</span></a>            <span class="p">}</span>
</span><span id="CTD.Utility.save_to_csv-1283"><a href="#CTD.Utility.save_to_csv-1283"><span class="linenos">1283</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">input_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CTD.Utility.save_to_csv-1284"><a href="#CTD.Utility.save_to_csv-1284"><span class="linenos">1284</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rsk_labels</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility.save_to_csv-1285"><a href="#CTD.Utility.save_to_csv-1285"><span class="linenos">1285</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility.save_to_csv-1286"><a href="#CTD.Utility.save_to_csv-1286"><span class="linenos">1286</span></a>            <span class="c1"># Handle CSV file reading and merging</span>
</span><span id="CTD.Utility.save_to_csv-1287"><a href="#CTD.Utility.save_to_csv-1287"><span class="linenos">1287</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="CTD.Utility.save_to_csv-1288"><a href="#CTD.Utility.save_to_csv-1288"><span class="linenos">1288</span></a>                <span class="n">csv_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</span><span id="CTD.Utility.save_to_csv-1289"><a href="#CTD.Utility.save_to_csv-1289"><span class="linenos">1289</span></a>                <span class="n">csv_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility.save_to_csv-1290"><a href="#CTD.Utility.save_to_csv-1290"><span class="linenos">1290</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="CTD.Utility.save_to_csv-1291"><a href="#CTD.Utility.save_to_csv-1291"><span class="linenos">1291</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2"> does not exist. A new file will be created.&quot;</span><span class="p">)</span>
</span><span id="CTD.Utility.save_to_csv-1292"><a href="#CTD.Utility.save_to_csv-1292"><span class="linenos">1292</span></a>                <span class="n">csv_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="CTD.Utility.save_to_csv-1293"><a href="#CTD.Utility.save_to_csv-1293"><span class="linenos">1293</span></a>
</span><span id="CTD.Utility.save_to_csv-1294"><a href="#CTD.Utility.save_to_csv-1294"><span class="linenos">1294</span></a>            <span class="c1"># Merge the existing DataFrame with the new DataFrame</span>
</span><span id="CTD.Utility.save_to_csv-1295"><a href="#CTD.Utility.save_to_csv-1295"><span class="linenos">1295</span></a>            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">csv_df</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CTD.Utility.save_to_csv-1296"><a href="#CTD.Utility.save_to_csv-1296"><span class="linenos">1296</span></a>            <span class="c1"># Overwrite the original CSV file with the merged DataFrame</span>
</span><span id="CTD.Utility.save_to_csv-1297"><a href="#CTD.Utility.save_to_csv-1297"><span class="linenos">1297</span></a>            <span class="n">merged_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Renames the columns of the CTD data table based on a predefined mapping and saves the
data to the specified CSV file. If the file already exists, the data is appended to it.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>input_df</strong> (DataFrame):
The output CSV file path.</li>
<li><strong>output_file</strong> (str):
The output CSV file path.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.Utility.extract_utc_cast_time" class="classattr">
                                        <input id="CTD.Utility.extract_utc_cast_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">extract_utc_cast_time</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">ctdfilepath</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.Utility.extract_utc_cast_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.extract_utc_cast_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.extract_utc_cast_time-1299"><a href="#CTD.Utility.extract_utc_cast_time-1299"><span class="linenos">1299</span></a>        <span class="nd">@staticmethod</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1300"><a href="#CTD.Utility.extract_utc_cast_time-1300"><span class="linenos">1300</span></a>        <span class="k">def</span> <span class="nf">extract_utc_cast_time</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">):</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1301"><a href="#CTD.Utility.extract_utc_cast_time-1301"><span class="linenos">1301</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1302"><a href="#CTD.Utility.extract_utc_cast_time-1302"><span class="linenos">1302</span></a><span class="sd">            Function to extract the UTC cast time from a castaway file and convert it to ISO 8601 format.</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1303"><a href="#CTD.Utility.extract_utc_cast_time-1303"><span class="linenos">1303</span></a>
</span><span id="CTD.Utility.extract_utc_cast_time-1304"><a href="#CTD.Utility.extract_utc_cast_time-1304"><span class="linenos">1304</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1305"><a href="#CTD.Utility.extract_utc_cast_time-1305"><span class="linenos">1305</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1306"><a href="#CTD.Utility.extract_utc_cast_time-1306"><span class="linenos">1306</span></a><span class="sd">            ctdfilepath : str</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1307"><a href="#CTD.Utility.extract_utc_cast_time-1307"><span class="linenos">1307</span></a><span class="sd">                The file path of the castaway file to extract the time from.</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1308"><a href="#CTD.Utility.extract_utc_cast_time-1308"><span class="linenos">1308</span></a>
</span><span id="CTD.Utility.extract_utc_cast_time-1309"><a href="#CTD.Utility.extract_utc_cast_time-1309"><span class="linenos">1309</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1310"><a href="#CTD.Utility.extract_utc_cast_time-1310"><span class="linenos">1310</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1311"><a href="#CTD.Utility.extract_utc_cast_time-1311"><span class="linenos">1311</span></a><span class="sd">            str</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1312"><a href="#CTD.Utility.extract_utc_cast_time-1312"><span class="linenos">1312</span></a><span class="sd">                Cast time (UTC) of the castaway file in ISO 8601 format.</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1313"><a href="#CTD.Utility.extract_utc_cast_time-1313"><span class="linenos">1313</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1314"><a href="#CTD.Utility.extract_utc_cast_time-1314"><span class="linenos">1314</span></a>            <span class="c1"># Initialize variable to store UTC cast time</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1315"><a href="#CTD.Utility.extract_utc_cast_time-1315"><span class="linenos">1315</span></a>            <span class="n">cast_time_utc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1316"><a href="#CTD.Utility.extract_utc_cast_time-1316"><span class="linenos">1316</span></a>            <span class="c1"># Open the file and read line by line</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1317"><a href="#CTD.Utility.extract_utc_cast_time-1317"><span class="linenos">1317</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1318"><a href="#CTD.Utility.extract_utc_cast_time-1318"><span class="linenos">1318</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1319"><a href="#CTD.Utility.extract_utc_cast_time-1319"><span class="linenos">1319</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Cast time (UTC)&#39;</span><span class="p">):</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1320"><a href="#CTD.Utility.extract_utc_cast_time-1320"><span class="linenos">1320</span></a>                        <span class="c1"># Extract the UTC cast time after the comma</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1321"><a href="#CTD.Utility.extract_utc_cast_time-1321"><span class="linenos">1321</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1322"><a href="#CTD.Utility.extract_utc_cast_time-1322"><span class="linenos">1322</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1323"><a href="#CTD.Utility.extract_utc_cast_time-1323"><span class="linenos">1323</span></a>                            <span class="n">cast_time_str</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Take only the datetime part</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1324"><a href="#CTD.Utility.extract_utc_cast_time-1324"><span class="linenos">1324</span></a>                            <span class="c1"># Convert the datetime string to ISO format if possible</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1325"><a href="#CTD.Utility.extract_utc_cast_time-1325"><span class="linenos">1325</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1326"><a href="#CTD.Utility.extract_utc_cast_time-1326"><span class="linenos">1326</span></a>                                <span class="n">cast_time_utc</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">cast_time_str</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1327"><a href="#CTD.Utility.extract_utc_cast_time-1327"><span class="linenos">1327</span></a>                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1328"><a href="#CTD.Utility.extract_utc_cast_time-1328"><span class="linenos">1328</span></a>                                <span class="c1"># Handle the case where date format does not match expected format</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1329"><a href="#CTD.Utility.extract_utc_cast_time-1329"><span class="linenos">1329</span></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Date format does not match expected &#39;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#39;&quot;</span><span class="p">)</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1330"><a href="#CTD.Utility.extract_utc_cast_time-1330"><span class="linenos">1330</span></a>                            <span class="k">break</span>  <span class="c1"># Stop reading once the timestamp is found</span>
</span><span id="CTD.Utility.extract_utc_cast_time-1331"><a href="#CTD.Utility.extract_utc_cast_time-1331"><span class="linenos">1331</span></a>
</span><span id="CTD.Utility.extract_utc_cast_time-1332"><a href="#CTD.Utility.extract_utc_cast_time-1332"><span class="linenos">1332</span></a>            <span class="k">return</span> <span class="n">cast_time_utc</span>
</span></pre></div>


            <div class="docstring"><p>Function to extract the UTC cast time from a castaway file and convert it to ISO 8601 format.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ctdfilepath</strong> (str):
The file path of the castaway file to extract the time from.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>str</strong>: Cast time (UTC) of the castaway file in ISO 8601 format.</li>
</ul>
</div>


                            </div>
                            <div id="CTD.Utility.extract_lat_long_castaway" class="classattr">
                                        <input id="CTD.Utility.extract_lat_long_castaway-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">extract_lat_long_castaway</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">ctdfilepath</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CTD.Utility.extract_lat_long_castaway-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTD.Utility.extract_lat_long_castaway"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTD.Utility.extract_lat_long_castaway-1334"><a href="#CTD.Utility.extract_lat_long_castaway-1334"><span class="linenos">1334</span></a>        <span class="nd">@staticmethod</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1335"><a href="#CTD.Utility.extract_lat_long_castaway-1335"><span class="linenos">1335</span></a>        <span class="k">def</span> <span class="nf">extract_lat_long_castaway</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">):</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1336"><a href="#CTD.Utility.extract_lat_long_castaway-1336"><span class="linenos">1336</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1337"><a href="#CTD.Utility.extract_lat_long_castaway-1337"><span class="linenos">1337</span></a><span class="sd">            Function extract start lat/long from castaway file.</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1338"><a href="#CTD.Utility.extract_lat_long_castaway-1338"><span class="linenos">1338</span></a>
</span><span id="CTD.Utility.extract_lat_long_castaway-1339"><a href="#CTD.Utility.extract_lat_long_castaway-1339"><span class="linenos">1339</span></a><span class="sd">            Parameters</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1340"><a href="#CTD.Utility.extract_lat_long_castaway-1340"><span class="linenos">1340</span></a><span class="sd">            ----------</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1341"><a href="#CTD.Utility.extract_lat_long_castaway-1341"><span class="linenos">1341</span></a><span class="sd">            ctdfilepath : str</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1342"><a href="#CTD.Utility.extract_lat_long_castaway-1342"><span class="linenos">1342</span></a><span class="sd">                Filepath to castaway ctd file.</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1343"><a href="#CTD.Utility.extract_lat_long_castaway-1343"><span class="linenos">1343</span></a>
</span><span id="CTD.Utility.extract_lat_long_castaway-1344"><a href="#CTD.Utility.extract_lat_long_castaway-1344"><span class="linenos">1344</span></a><span class="sd">            Returns</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1345"><a href="#CTD.Utility.extract_lat_long_castaway-1345"><span class="linenos">1345</span></a><span class="sd">            -------</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1346"><a href="#CTD.Utility.extract_lat_long_castaway-1346"><span class="linenos">1346</span></a><span class="sd">            tuple</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1347"><a href="#CTD.Utility.extract_lat_long_castaway-1347"><span class="linenos">1347</span></a><span class="sd">                (latitude, longitude)</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1348"><a href="#CTD.Utility.extract_lat_long_castaway-1348"><span class="linenos">1348</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1349"><a href="#CTD.Utility.extract_lat_long_castaway-1349"><span class="linenos">1349</span></a>            <span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1350"><a href="#CTD.Utility.extract_lat_long_castaway-1350"><span class="linenos">1350</span></a>            <span class="n">longitude</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1351"><a href="#CTD.Utility.extract_lat_long_castaway-1351"><span class="linenos">1351</span></a>            <span class="c1"># Open the file and read line by line</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1352"><a href="#CTD.Utility.extract_lat_long_castaway-1352"><span class="linenos">1352</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ctdfilepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1353"><a href="#CTD.Utility.extract_lat_long_castaway-1353"><span class="linenos">1353</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1354"><a href="#CTD.Utility.extract_lat_long_castaway-1354"><span class="linenos">1354</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Start latitude&#39;</span><span class="p">):</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1355"><a href="#CTD.Utility.extract_lat_long_castaway-1355"><span class="linenos">1355</span></a>                        <span class="c1"># Assume the format is &#39;% description, latitude&#39;</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1356"><a href="#CTD.Utility.extract_lat_long_castaway-1356"><span class="linenos">1356</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1357"><a href="#CTD.Utility.extract_lat_long_castaway-1357"><span class="linenos">1357</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1358"><a href="#CTD.Utility.extract_lat_long_castaway-1358"><span class="linenos">1358</span></a>                            <span class="n">latitude</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1359"><a href="#CTD.Utility.extract_lat_long_castaway-1359"><span class="linenos">1359</span></a>                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;% Start longitude&#39;</span><span class="p">):</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1360"><a href="#CTD.Utility.extract_lat_long_castaway-1360"><span class="linenos">1360</span></a>                        <span class="c1"># Assume the format is &#39;% description, longitude&#39;</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1361"><a href="#CTD.Utility.extract_lat_long_castaway-1361"><span class="linenos">1361</span></a>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1362"><a href="#CTD.Utility.extract_lat_long_castaway-1362"><span class="linenos">1362</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1363"><a href="#CTD.Utility.extract_lat_long_castaway-1363"><span class="linenos">1363</span></a>                            <span class="n">longitude</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="CTD.Utility.extract_lat_long_castaway-1364"><a href="#CTD.Utility.extract_lat_long_castaway-1364"><span class="linenos">1364</span></a>
</span><span id="CTD.Utility.extract_lat_long_castaway-1365"><a href="#CTD.Utility.extract_lat_long_castaway-1365"><span class="linenos">1365</span></a>            <span class="k">return</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span>
</span></pre></div>


            <div class="docstring"><p>Function extract start lat/long from castaway file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ctdfilepath</strong> (str):
Filepath to castaway ctd file.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: (latitude, longitude)</li>
</ul>
</div>


                            </div>
                </section>
                <section id="Calculate">
                            <input id="Calculate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Calculate</span>:

                <label class="view-source-button" for="Calculate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Calculate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Calculate-1368"><a href="#Calculate-1368"><span class="linenos">1368</span></a><span class="k">class</span> <span class="nc">Calculate</span><span class="p">:</span>
</span><span id="Calculate-1369"><a href="#Calculate-1369"><span class="linenos">1369</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate-1370"><a href="#Calculate-1370"><span class="linenos">1370</span></a><span class="sd">    Calculate</span>
</span><span id="Calculate-1371"><a href="#Calculate-1371"><span class="linenos">1371</span></a><span class="sd">    ----------</span>
</span><span id="Calculate-1372"><a href="#Calculate-1372"><span class="linenos">1372</span></a>
</span><span id="Calculate-1373"><a href="#Calculate-1373"><span class="linenos">1373</span></a><span class="sd">    Class for CTD data calculations.</span>
</span><span id="Calculate-1374"><a href="#Calculate-1374"><span class="linenos">1374</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Calculate-1375"><a href="#Calculate-1375"><span class="linenos">1375</span></a>
</span><span id="Calculate-1376"><a href="#Calculate-1376"><span class="linenos">1376</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate-1377"><a href="#Calculate-1377"><span class="linenos">1377</span></a>    <span class="k">def</span> <span class="nf">gsw_infunnel</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">CT</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span><span id="Calculate-1378"><a href="#Calculate-1378"><span class="linenos">1378</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate-1379"><a href="#Calculate-1379"><span class="linenos">1379</span></a><span class="sd">        Check if the given Absolute Salinity (SA), Conservative Temperature (CT),</span>
</span><span id="Calculate-1380"><a href="#Calculate-1380"><span class="linenos">1380</span></a><span class="sd">        and pressure (p) are within the &quot;oceanographic funnel&quot; for the TEOS-10 75-term equation.</span>
</span><span id="Calculate-1381"><a href="#Calculate-1381"><span class="linenos">1381</span></a>
</span><span id="Calculate-1382"><a href="#Calculate-1382"><span class="linenos">1382</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate-1383"><a href="#Calculate-1383"><span class="linenos">1383</span></a><span class="sd">        ----------</span>
</span><span id="Calculate-1384"><a href="#Calculate-1384"><span class="linenos">1384</span></a><span class="sd">        SA : Series</span>
</span><span id="Calculate-1385"><a href="#Calculate-1385"><span class="linenos">1385</span></a><span class="sd">            Absolute Salinity in g/kg.</span>
</span><span id="Calculate-1386"><a href="#Calculate-1386"><span class="linenos">1386</span></a><span class="sd">        CT : Series</span>
</span><span id="Calculate-1387"><a href="#Calculate-1387"><span class="linenos">1387</span></a><span class="sd">            Conservative Temperature in degrees Celsius.</span>
</span><span id="Calculate-1388"><a href="#Calculate-1388"><span class="linenos">1388</span></a><span class="sd">        p : Series</span>
</span><span id="Calculate-1389"><a href="#Calculate-1389"><span class="linenos">1389</span></a><span class="sd">            Sea pressure in dbar (absolute pressure minus 10.1325 dbar).</span>
</span><span id="Calculate-1390"><a href="#Calculate-1390"><span class="linenos">1390</span></a>
</span><span id="Calculate-1391"><a href="#Calculate-1391"><span class="linenos">1391</span></a><span class="sd">        Returns</span>
</span><span id="Calculate-1392"><a href="#Calculate-1392"><span class="linenos">1392</span></a><span class="sd">        -------</span>
</span><span id="Calculate-1393"><a href="#Calculate-1393"><span class="linenos">1393</span></a><span class="sd">        Series of bool</span>
</span><span id="Calculate-1394"><a href="#Calculate-1394"><span class="linenos">1394</span></a><span class="sd">            A boolean array where True indicates the values are inside the &quot;oceanographic funnel&quot;.</span>
</span><span id="Calculate-1395"><a href="#Calculate-1395"><span class="linenos">1395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate-1396"><a href="#Calculate-1396"><span class="linenos">1396</span></a>        <span class="c1"># Ensure all inputs are Series and aligned</span>
</span><span id="Calculate-1397"><a href="#Calculate-1397"><span class="linenos">1397</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">CT</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="Calculate-1398"><a href="#Calculate-1398"><span class="linenos">1398</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">p</span><span class="p">))):</span>
</span><span id="Calculate-1399"><a href="#Calculate-1399"><span class="linenos">1399</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;SA, CT, and p must be pandas Series or p a scalar&quot;</span><span class="p">)</span>
</span><span id="Calculate-1400"><a href="#Calculate-1400"><span class="linenos">1400</span></a>
</span><span id="Calculate-1401"><a href="#Calculate-1401"><span class="linenos">1401</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">CT</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="ow">and</span> <span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="Calculate-1402"><a href="#Calculate-1402"><span class="linenos">1402</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Indices of SA, CT, and p must be aligned&quot;</span><span class="p">)</span>
</span><span id="Calculate-1403"><a href="#Calculate-1403"><span class="linenos">1403</span></a>
</span><span id="Calculate-1404"><a href="#Calculate-1404"><span class="linenos">1404</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
</span><span id="Calculate-1405"><a href="#Calculate-1405"><span class="linenos">1405</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="Calculate-1406"><a href="#Calculate-1406"><span class="linenos">1406</span></a>
</span><span id="Calculate-1407"><a href="#Calculate-1407"><span class="linenos">1407</span></a>        <span class="c1"># Define the funnel conditions</span>
</span><span id="Calculate-1408"><a href="#Calculate-1408"><span class="linenos">1408</span></a>        <span class="n">CT_freezing_p</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">CT_freezing</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Calculate-1409"><a href="#Calculate-1409"><span class="linenos">1409</span></a>        <span class="n">CT_freezing_500</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">CT_freezing</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Calculate-1410"><a href="#Calculate-1410"><span class="linenos">1410</span></a>
</span><span id="Calculate-1411"><a href="#Calculate-1411"><span class="linenos">1411</span></a>        <span class="n">in_funnel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># Default all to True</span>
</span><span id="Calculate-1412"><a href="#Calculate-1412"><span class="linenos">1412</span></a>        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Calculate-1413"><a href="#Calculate-1413"><span class="linenos">1413</span></a>                <span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">8000</span><span class="p">)</span> <span class="o">|</span>
</span><span id="Calculate-1414"><a href="#Calculate-1414"><span class="linenos">1414</span></a>                <span class="p">(</span><span class="n">SA</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&gt;</span> <span class="mi">42</span><span class="p">)</span> <span class="o">|</span>
</span><span id="Calculate-1415"><a href="#Calculate-1415"><span class="linenos">1415</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&lt;</span> <span class="n">CT_freezing_p</span><span class="p">))</span> <span class="o">|</span>
</span><span id="Calculate-1416"><a href="#Calculate-1416"><span class="linenos">1416</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&lt;</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">5e-3</span> <span class="o">-</span> <span class="mf">2.5</span><span class="p">))</span> <span class="o">|</span>
</span><span id="Calculate-1417"><a href="#Calculate-1417"><span class="linenos">1417</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">31.66666666666667</span> <span class="o">-</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">3.333333333333334e-3</span><span class="p">)))</span> <span class="o">|</span>
</span><span id="Calculate-1418"><a href="#Calculate-1418"><span class="linenos">1418</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&lt;</span> <span class="n">CT_freezing_500</span><span class="p">))</span> <span class="o">|</span>
</span><span id="Calculate-1419"><a href="#Calculate-1419"><span class="linenos">1419</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">))</span> <span class="o">|</span>
</span><span id="Calculate-1420"><a href="#Calculate-1420"><span class="linenos">1420</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">))</span> <span class="o">|</span>
</span><span id="Calculate-1421"><a href="#Calculate-1421"><span class="linenos">1421</span></a>                <span class="n">SA</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">|</span> <span class="n">CT</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
</span><span id="Calculate-1422"><a href="#Calculate-1422"><span class="linenos">1422</span></a>        <span class="p">)</span>
</span><span id="Calculate-1423"><a href="#Calculate-1423"><span class="linenos">1423</span></a>        <span class="n">in_funnel</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Calculate-1424"><a href="#Calculate-1424"><span class="linenos">1424</span></a>
</span><span id="Calculate-1425"><a href="#Calculate-1425"><span class="linenos">1425</span></a>        <span class="k">return</span> <span class="n">in_funnel</span>
</span><span id="Calculate-1426"><a href="#Calculate-1426"><span class="linenos">1426</span></a>
</span><span id="Calculate-1427"><a href="#Calculate-1427"><span class="linenos">1427</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate-1428"><a href="#Calculate-1428"><span class="linenos">1428</span></a>    <span class="k">def</span> <span class="nf">calculate_and_drop_salinity_spikes</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="Calculate-1429"><a href="#Calculate-1429"><span class="linenos">1429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate-1430"><a href="#Calculate-1430"><span class="linenos">1430</span></a><span class="sd">        Calculates and removes salinity spikes from the CTD data based on predefined thresholds for acceptable</span>
</span><span id="Calculate-1431"><a href="#Calculate-1431"><span class="linenos">1431</span></a><span class="sd">        changes in salinity with depth.</span>
</span><span id="Calculate-1432"><a href="#Calculate-1432"><span class="linenos">1432</span></a>
</span><span id="Calculate-1433"><a href="#Calculate-1433"><span class="linenos">1433</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate-1434"><a href="#Calculate-1434"><span class="linenos">1434</span></a><span class="sd">        ----------</span>
</span><span id="Calculate-1435"><a href="#Calculate-1435"><span class="linenos">1435</span></a><span class="sd">        df : DataFrame</span>
</span><span id="Calculate-1436"><a href="#Calculate-1436"><span class="linenos">1436</span></a><span class="sd">            DataFrame containing depth and salinity data</span>
</span><span id="Calculate-1437"><a href="#Calculate-1437"><span class="linenos">1437</span></a>
</span><span id="Calculate-1438"><a href="#Calculate-1438"><span class="linenos">1438</span></a><span class="sd">        Returns</span>
</span><span id="Calculate-1439"><a href="#Calculate-1439"><span class="linenos">1439</span></a><span class="sd">        -------</span>
</span><span id="Calculate-1440"><a href="#Calculate-1440"><span class="linenos">1440</span></a><span class="sd">        DataFrame</span>
</span><span id="Calculate-1441"><a href="#Calculate-1441"><span class="linenos">1441</span></a><span class="sd">            DataFrame after removing salinity spikes</span>
</span><span id="Calculate-1442"><a href="#Calculate-1442"><span class="linenos">1442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate-1443"><a href="#Calculate-1443"><span class="linenos">1443</span></a>        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Calculate-1444"><a href="#Calculate-1444"><span class="linenos">1444</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Calculate-1445"><a href="#Calculate-1445"><span class="linenos">1445</span></a>
</span><span id="Calculate-1446"><a href="#Calculate-1446"><span class="linenos">1446</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate-1447"><a href="#Calculate-1447"><span class="linenos">1447</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate-1448"><a href="#Calculate-1448"><span class="linenos">1448</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">,</span> <span class="s1">&#39;salinity_00&#39;</span><span class="p">])</span>
</span><span id="Calculate-1449"><a href="#Calculate-1449"><span class="linenos">1449</span></a>
</span><span id="Calculate-1450"><a href="#Calculate-1450"><span class="linenos">1450</span></a>        <span class="n">min_depth</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Calculate-1451"><a href="#Calculate-1451"><span class="linenos">1451</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Calculate-1452"><a href="#Calculate-1452"><span class="linenos">1452</span></a>        <span class="k">if</span> <span class="n">min_depth</span> <span class="o">==</span> <span class="n">max_depth</span><span class="p">:</span>
</span><span id="Calculate-1453"><a href="#Calculate-1453"><span class="linenos">1453</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Insufficient depth range to calculate.&quot;</span><span class="p">)</span>
</span><span id="Calculate-1454"><a href="#Calculate-1454"><span class="linenos">1454</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="Calculate-1455"><a href="#Calculate-1455"><span class="linenos">1455</span></a>
</span><span id="Calculate-1456"><a href="#Calculate-1456"><span class="linenos">1456</span></a>        <span class="n">acceptable_delta_salinity_per_depth</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Calculate-1457"><a href="#Calculate-1457"><span class="linenos">1457</span></a>            <span class="p">(</span><span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">),</span>
</span><span id="Calculate-1458"><a href="#Calculate-1458"><span class="linenos">1458</span></a>            <span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
</span><span id="Calculate-1459"><a href="#Calculate-1459"><span class="linenos">1459</span></a>            <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
</span><span id="Calculate-1460"><a href="#Calculate-1460"><span class="linenos">1460</span></a>            <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="Calculate-1461"><a href="#Calculate-1461"><span class="linenos">1461</span></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Calculate-1462"><a href="#Calculate-1462"><span class="linenos">1462</span></a>
</span><span id="Calculate-1463"><a href="#Calculate-1463"><span class="linenos">1463</span></a>        <span class="p">]</span>
</span><span id="Calculate-1464"><a href="#Calculate-1464"><span class="linenos">1464</span></a>
</span><span id="Calculate-1465"><a href="#Calculate-1465"><span class="linenos">1465</span></a>        <span class="k">for</span> <span class="n">acceptable_delta</span><span class="p">,</span> <span class="n">depth_range</span> <span class="ow">in</span> <span class="n">acceptable_delta_salinity_per_depth</span><span class="p">:</span>
</span><span id="Calculate-1466"><a href="#Calculate-1466"><span class="linenos">1466</span></a>            <span class="n">num_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_depth</span> <span class="o">-</span> <span class="n">min_depth</span><span class="p">)</span> <span class="o">/</span> <span class="n">depth_range</span><span class="p">)</span>
</span><span id="Calculate-1467"><a href="#Calculate-1467"><span class="linenos">1467</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_points</span><span class="p">)</span>
</span><span id="Calculate-1468"><a href="#Calculate-1468"><span class="linenos">1468</span></a>            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="p">)</span>
</span><span id="Calculate-1469"><a href="#Calculate-1469"><span class="linenos">1469</span></a>
</span><span id="Calculate-1470"><a href="#Calculate-1470"><span class="linenos">1470</span></a>            <span class="c1"># Group by indices and filter</span>
</span><span id="Calculate-1471"><a href="#Calculate-1471"><span class="linenos">1471</span></a>            <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
</span><span id="Calculate-1472"><a href="#Calculate-1472"><span class="linenos">1472</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">acceptable_delta</span><span class="p">)</span>
</span><span id="Calculate-1473"><a href="#Calculate-1473"><span class="linenos">1473</span></a>
</span><span id="Calculate-1474"><a href="#Calculate-1474"><span class="linenos">1474</span></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="Calculate-1475"><a href="#Calculate-1475"><span class="linenos">1475</span></a>
</span><span id="Calculate-1476"><a href="#Calculate-1476"><span class="linenos">1476</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate-1477"><a href="#Calculate-1477"><span class="linenos">1477</span></a>    <span class="k">def</span> <span class="nf">calculate_overturns</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">):</span>
</span><span id="Calculate-1478"><a href="#Calculate-1478"><span class="linenos">1478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate-1479"><a href="#Calculate-1479"><span class="linenos">1479</span></a><span class="sd">        Calculates density overturns in the CTD data where denser water lies above lighter water with density</span>
</span><span id="Calculate-1480"><a href="#Calculate-1480"><span class="linenos">1480</span></a><span class="sd">        difference of at least 0.05 kg/m³, which may indicate mixing or other dynamic processes.</span>
</span><span id="Calculate-1481"><a href="#Calculate-1481"><span class="linenos">1481</span></a>
</span><span id="Calculate-1482"><a href="#Calculate-1482"><span class="linenos">1482</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate-1483"><a href="#Calculate-1483"><span class="linenos">1483</span></a><span class="sd">        ----------</span>
</span><span id="Calculate-1484"><a href="#Calculate-1484"><span class="linenos">1484</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="Calculate-1485"><a href="#Calculate-1485"><span class="linenos">1485</span></a><span class="sd">            DataFrame containing depth, density, and timestamp data</span>
</span><span id="Calculate-1486"><a href="#Calculate-1486"><span class="linenos">1486</span></a>
</span><span id="Calculate-1487"><a href="#Calculate-1487"><span class="linenos">1487</span></a><span class="sd">        Returns</span>
</span><span id="Calculate-1488"><a href="#Calculate-1488"><span class="linenos">1488</span></a><span class="sd">        -------</span>
</span><span id="Calculate-1489"><a href="#Calculate-1489"><span class="linenos">1489</span></a><span class="sd">        DataFrame</span>
</span><span id="Calculate-1490"><a href="#Calculate-1490"><span class="linenos">1490</span></a><span class="sd">            DataFrame with identified density overturns</span>
</span><span id="Calculate-1491"><a href="#Calculate-1491"><span class="linenos">1491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate-1492"><a href="#Calculate-1492"><span class="linenos">1492</span></a>        <span class="c1"># Sort DataFrame by depth in ascending order</span>
</span><span id="Calculate-1493"><a href="#Calculate-1493"><span class="linenos">1493</span></a>        <span class="n">ctd_array</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;depth_00&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1494"><a href="#Calculate-1494"><span class="linenos">1494</span></a>        <span class="c1"># Calculate density change and identify overturns</span>
</span><span id="Calculate-1495"><a href="#Calculate-1495"><span class="linenos">1495</span></a>        <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;density_change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span>
</span><span id="Calculate-1496"><a href="#Calculate-1496"><span class="linenos">1496</span></a>            <span class="s1">&#39;density&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>  <span class="c1"># Difference in density between consecutive measurements</span>
</span><span id="Calculate-1497"><a href="#Calculate-1497"><span class="linenos">1497</span></a>        <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;density_change&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.05</span>
</span><span id="Calculate-1498"><a href="#Calculate-1498"><span class="linenos">1498</span></a>        <span class="n">ctd_array</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1499"><a href="#Calculate-1499"><span class="linenos">1499</span></a>        <span class="k">if</span> <span class="s1">&#39;density_change&#39;</span> <span class="ow">in</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Calculate-1500"><a href="#Calculate-1500"><span class="linenos">1500</span></a>            <span class="n">ctd_array</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;density_change&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Calculate-1501"><a href="#Calculate-1501"><span class="linenos">1501</span></a>        <span class="k">return</span> <span class="n">ctd_array</span>
</span><span id="Calculate-1502"><a href="#Calculate-1502"><span class="linenos">1502</span></a>
</span><span id="Calculate-1503"><a href="#Calculate-1503"><span class="linenos">1503</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate-1504"><a href="#Calculate-1504"><span class="linenos">1504</span></a>    <span class="k">def</span> <span class="nf">calculate_surface_salinity_and_meltwater</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">12.0</span><span class="p">):</span>
</span><span id="Calculate-1505"><a href="#Calculate-1505"><span class="linenos">1505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate-1506"><a href="#Calculate-1506"><span class="linenos">1506</span></a><span class="sd">        Calculates the surface salinity and meltwater fraction of a CTD profile.</span>
</span><span id="Calculate-1507"><a href="#Calculate-1507"><span class="linenos">1507</span></a><span class="sd">        Reports the mean salinity of the first 2 meters of the profile by finding the minimum salinity, and reports</span>
</span><span id="Calculate-1508"><a href="#Calculate-1508"><span class="linenos">1508</span></a><span class="sd">        meltwater fraction as given by (-0.021406 * surface_salinity + 0.740392) * 100.</span>
</span><span id="Calculate-1509"><a href="#Calculate-1509"><span class="linenos">1509</span></a>
</span><span id="Calculate-1510"><a href="#Calculate-1510"><span class="linenos">1510</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate-1511"><a href="#Calculate-1511"><span class="linenos">1511</span></a><span class="sd">        ----------</span>
</span><span id="Calculate-1512"><a href="#Calculate-1512"><span class="linenos">1512</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="Calculate-1513"><a href="#Calculate-1513"><span class="linenos">1513</span></a><span class="sd">            DataFrame containing salinity and depth data.</span>
</span><span id="Calculate-1514"><a href="#Calculate-1514"><span class="linenos">1514</span></a><span class="sd">        start : float</span>
</span><span id="Calculate-1515"><a href="#Calculate-1515"><span class="linenos">1515</span></a><span class="sd">            Minimum pressure of the surface, defaults to 10.0.</span>
</span><span id="Calculate-1516"><a href="#Calculate-1516"><span class="linenos">1516</span></a><span class="sd">        end : float</span>
</span><span id="Calculate-1517"><a href="#Calculate-1517"><span class="linenos">1517</span></a><span class="sd">            Maximum pressure of the surface, defaults to 12.0.</span>
</span><span id="Calculate-1518"><a href="#Calculate-1518"><span class="linenos">1518</span></a>
</span><span id="Calculate-1519"><a href="#Calculate-1519"><span class="linenos">1519</span></a><span class="sd">        Returns</span>
</span><span id="Calculate-1520"><a href="#Calculate-1520"><span class="linenos">1520</span></a><span class="sd">        -------</span>
</span><span id="Calculate-1521"><a href="#Calculate-1521"><span class="linenos">1521</span></a><span class="sd">        tuple</span>
</span><span id="Calculate-1522"><a href="#Calculate-1522"><span class="linenos">1522</span></a><span class="sd">            Returns a tuple of (surface salinity, meltwater fraction).</span>
</span><span id="Calculate-1523"><a href="#Calculate-1523"><span class="linenos">1523</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate-1524"><a href="#Calculate-1524"><span class="linenos">1524</span></a>        <span class="c1"># Filtering data within the specified pressure range</span>
</span><span id="Calculate-1525"><a href="#Calculate-1525"><span class="linenos">1525</span></a>        <span class="n">surface_data</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)]</span>
</span><span id="Calculate-1526"><a href="#Calculate-1526"><span class="linenos">1526</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">surface_data</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Calculate-1527"><a href="#Calculate-1527"><span class="linenos">1527</span></a>        <span class="n">mwf</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.021406</span> <span class="o">*</span> <span class="n">surface_salinity</span> <span class="o">+</span> <span class="mf">0.740392</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="Calculate-1528"><a href="#Calculate-1528"><span class="linenos">1528</span></a>
</span><span id="Calculate-1529"><a href="#Calculate-1529"><span class="linenos">1529</span></a>        <span class="k">return</span> <span class="n">surface_salinity</span><span class="p">,</span> <span class="n">mwf</span>
</span><span id="Calculate-1530"><a href="#Calculate-1530"><span class="linenos">1530</span></a>
</span><span id="Calculate-1531"><a href="#Calculate-1531"><span class="linenos">1531</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate-1532"><a href="#Calculate-1532"><span class="linenos">1532</span></a>    <span class="k">def</span> <span class="nf">calculate_surface_temperature</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">12.0</span><span class="p">):</span>
</span><span id="Calculate-1533"><a href="#Calculate-1533"><span class="linenos">1533</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate-1534"><a href="#Calculate-1534"><span class="linenos">1534</span></a><span class="sd">        Calculates the surface temperature of a CTD profile. Reports the mean temperature of the first 2 meters</span>
</span><span id="Calculate-1535"><a href="#Calculate-1535"><span class="linenos">1535</span></a><span class="sd">        of the profile.</span>
</span><span id="Calculate-1536"><a href="#Calculate-1536"><span class="linenos">1536</span></a>
</span><span id="Calculate-1537"><a href="#Calculate-1537"><span class="linenos">1537</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate-1538"><a href="#Calculate-1538"><span class="linenos">1538</span></a><span class="sd">        ----------</span>
</span><span id="Calculate-1539"><a href="#Calculate-1539"><span class="linenos">1539</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="Calculate-1540"><a href="#Calculate-1540"><span class="linenos">1540</span></a><span class="sd">            DataFrame containing temperature and depth data.</span>
</span><span id="Calculate-1541"><a href="#Calculate-1541"><span class="linenos">1541</span></a><span class="sd">        start : float</span>
</span><span id="Calculate-1542"><a href="#Calculate-1542"><span class="linenos">1542</span></a><span class="sd">            Minimum pressure of the surface, defaults to 10.0.</span>
</span><span id="Calculate-1543"><a href="#Calculate-1543"><span class="linenos">1543</span></a><span class="sd">        end : float</span>
</span><span id="Calculate-1544"><a href="#Calculate-1544"><span class="linenos">1544</span></a><span class="sd">            Maximum pressure of the surface, defaults to 12.0.</span>
</span><span id="Calculate-1545"><a href="#Calculate-1545"><span class="linenos">1545</span></a><span class="sd">        Returns</span>
</span><span id="Calculate-1546"><a href="#Calculate-1546"><span class="linenos">1546</span></a><span class="sd">        -------</span>
</span><span id="Calculate-1547"><a href="#Calculate-1547"><span class="linenos">1547</span></a><span class="sd">        float</span>
</span><span id="Calculate-1548"><a href="#Calculate-1548"><span class="linenos">1548</span></a><span class="sd">            Returns the mean surface temperature.</span>
</span><span id="Calculate-1549"><a href="#Calculate-1549"><span class="linenos">1549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate-1550"><a href="#Calculate-1550"><span class="linenos">1550</span></a>        <span class="c1"># Filtering data within the specified pressure range</span>
</span><span id="Calculate-1551"><a href="#Calculate-1551"><span class="linenos">1551</span></a>        <span class="n">surface_data</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)]</span>
</span><span id="Calculate-1552"><a href="#Calculate-1552"><span class="linenos">1552</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">surface_data</span><span class="p">[</span><span class="s1">&#39;temperature_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Calculate-1553"><a href="#Calculate-1553"><span class="linenos">1553</span></a>
</span><span id="Calculate-1554"><a href="#Calculate-1554"><span class="linenos">1554</span></a>        <span class="k">return</span> <span class="n">surface_temperature</span>
</span><span id="Calculate-1555"><a href="#Calculate-1555"><span class="linenos">1555</span></a>
</span><span id="Calculate-1556"><a href="#Calculate-1556"><span class="linenos">1556</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate-1557"><a href="#Calculate-1557"><span class="linenos">1557</span></a>    <span class="k">def</span> <span class="nf">calculate_absolute_density</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">):</span>
</span><span id="Calculate-1558"><a href="#Calculate-1558"><span class="linenos">1558</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate-1559"><a href="#Calculate-1559"><span class="linenos">1559</span></a><span class="sd">        Calculates absolute density from the CTD data using the TEOS-10 equations,</span>
</span><span id="Calculate-1560"><a href="#Calculate-1560"><span class="linenos">1560</span></a><span class="sd">        ensuring all data points are within the valid oceanographic funnel.</span>
</span><span id="Calculate-1561"><a href="#Calculate-1561"><span class="linenos">1561</span></a>
</span><span id="Calculate-1562"><a href="#Calculate-1562"><span class="linenos">1562</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate-1563"><a href="#Calculate-1563"><span class="linenos">1563</span></a><span class="sd">        ----------</span>
</span><span id="Calculate-1564"><a href="#Calculate-1564"><span class="linenos">1564</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="Calculate-1565"><a href="#Calculate-1565"><span class="linenos">1565</span></a><span class="sd">            DataFrame containing salinity, temperature, and pressure data</span>
</span><span id="Calculate-1566"><a href="#Calculate-1566"><span class="linenos">1566</span></a>
</span><span id="Calculate-1567"><a href="#Calculate-1567"><span class="linenos">1567</span></a><span class="sd">        Returns</span>
</span><span id="Calculate-1568"><a href="#Calculate-1568"><span class="linenos">1568</span></a><span class="sd">        -------</span>
</span><span id="Calculate-1569"><a href="#Calculate-1569"><span class="linenos">1569</span></a><span class="sd">        Series</span>
</span><span id="Calculate-1570"><a href="#Calculate-1570"><span class="linenos">1570</span></a><span class="sd">            Series with calculated absolute density</span>
</span><span id="Calculate-1571"><a href="#Calculate-1571"><span class="linenos">1571</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate-1572"><a href="#Calculate-1572"><span class="linenos">1572</span></a>        <span class="n">sa</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;salinityabs&#39;</span><span class="p">]</span>
</span><span id="Calculate-1573"><a href="#Calculate-1573"><span class="linenos">1573</span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;temperature_00&#39;</span><span class="p">]</span>
</span><span id="Calculate-1574"><a href="#Calculate-1574"><span class="linenos">1574</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;seapressure_00&#39;</span><span class="p">]</span>
</span><span id="Calculate-1575"><a href="#Calculate-1575"><span class="linenos">1575</span></a>        <span class="n">ct</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">CT_from_t</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span><span id="Calculate-1576"><a href="#Calculate-1576"><span class="linenos">1576</span></a>        <span class="k">if</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">gsw_infunnel</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
</span><span id="Calculate-1577"><a href="#Calculate-1577"><span class="linenos">1577</span></a>            <span class="k">return</span> <span class="n">gsw</span><span class="o">.</span><span class="n">density</span><span class="o">.</span><span class="n">rho_t_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span><span id="Calculate-1578"><a href="#Calculate-1578"><span class="linenos">1578</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Calculate-1579"><a href="#Calculate-1579"><span class="linenos">1579</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Sample not in funnel, could not calculate density.&quot;</span><span class="p">)</span>
</span><span id="Calculate-1580"><a href="#Calculate-1580"><span class="linenos">1580</span></a>
</span><span id="Calculate-1581"><a href="#Calculate-1581"><span class="linenos">1581</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate-1582"><a href="#Calculate-1582"><span class="linenos">1582</span></a>    <span class="k">def</span> <span class="nf">calculate_absolute_salinity</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">):</span>
</span><span id="Calculate-1583"><a href="#Calculate-1583"><span class="linenos">1583</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate-1584"><a href="#Calculate-1584"><span class="linenos">1584</span></a><span class="sd">        Calculates absolute salinity from practical salinity, pressure,</span>
</span><span id="Calculate-1585"><a href="#Calculate-1585"><span class="linenos">1585</span></a><span class="sd">        and geographical coordinates using the TEOS-10 salinity conversion formulas.</span>
</span><span id="Calculate-1586"><a href="#Calculate-1586"><span class="linenos">1586</span></a>
</span><span id="Calculate-1587"><a href="#Calculate-1587"><span class="linenos">1587</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate-1588"><a href="#Calculate-1588"><span class="linenos">1588</span></a><span class="sd">        ----------</span>
</span><span id="Calculate-1589"><a href="#Calculate-1589"><span class="linenos">1589</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="Calculate-1590"><a href="#Calculate-1590"><span class="linenos">1590</span></a><span class="sd">            DataFrame containing practical salinity, pressure, longitude, and latitude data</span>
</span><span id="Calculate-1591"><a href="#Calculate-1591"><span class="linenos">1591</span></a>
</span><span id="Calculate-1592"><a href="#Calculate-1592"><span class="linenos">1592</span></a><span class="sd">        Returns</span>
</span><span id="Calculate-1593"><a href="#Calculate-1593"><span class="linenos">1593</span></a><span class="sd">        -------</span>
</span><span id="Calculate-1594"><a href="#Calculate-1594"><span class="linenos">1594</span></a><span class="sd">        Series</span>
</span><span id="Calculate-1595"><a href="#Calculate-1595"><span class="linenos">1595</span></a><span class="sd">            Series with calculated absolute salinity</span>
</span><span id="Calculate-1596"><a href="#Calculate-1596"><span class="linenos">1596</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate-1597"><a href="#Calculate-1597"><span class="linenos">1597</span></a>        <span class="n">sp</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1598"><a href="#Calculate-1598"><span class="linenos">1598</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;seapressure_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1599"><a href="#Calculate-1599"><span class="linenos">1599</span></a>        <span class="n">lon</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1600"><a href="#Calculate-1600"><span class="linenos">1600</span></a>        <span class="n">lat</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1601"><a href="#Calculate-1601"><span class="linenos">1601</span></a>        <span class="k">return</span> <span class="n">gsw</span><span class="o">.</span><span class="n">conversions</span><span class="o">.</span><span class="n">SA_from_SP</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
</span><span id="Calculate-1602"><a href="#Calculate-1602"><span class="linenos">1602</span></a>
</span><span id="Calculate-1603"><a href="#Calculate-1603"><span class="linenos">1603</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate-1604"><a href="#Calculate-1604"><span class="linenos">1604</span></a>    <span class="k">def</span> <span class="nf">calculate_mld</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="n">reference_depth</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.15</span><span class="p">):</span>
</span><span id="Calculate-1605"><a href="#Calculate-1605"><span class="linenos">1605</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate-1606"><a href="#Calculate-1606"><span class="linenos">1606</span></a><span class="sd">        Calculates the mixed layer depth (MLD) using the density threshold method.</span>
</span><span id="Calculate-1607"><a href="#Calculate-1607"><span class="linenos">1607</span></a><span class="sd">        MLD is the depth at which the density exceeds the reference density</span>
</span><span id="Calculate-1608"><a href="#Calculate-1608"><span class="linenos">1608</span></a><span class="sd">        by a predefined amount delta, which defaults to (0.03 kg/m³).</span>
</span><span id="Calculate-1609"><a href="#Calculate-1609"><span class="linenos">1609</span></a>
</span><span id="Calculate-1610"><a href="#Calculate-1610"><span class="linenos">1610</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate-1611"><a href="#Calculate-1611"><span class="linenos">1611</span></a><span class="sd">        ----------</span>
</span><span id="Calculate-1612"><a href="#Calculate-1612"><span class="linenos">1612</span></a><span class="sd">        densities : Series</span>
</span><span id="Calculate-1613"><a href="#Calculate-1613"><span class="linenos">1613</span></a><span class="sd">            Series of densities</span>
</span><span id="Calculate-1614"><a href="#Calculate-1614"><span class="linenos">1614</span></a><span class="sd">        depths : Series</span>
</span><span id="Calculate-1615"><a href="#Calculate-1615"><span class="linenos">1615</span></a><span class="sd">            Series of depths corresponding to densities</span>
</span><span id="Calculate-1616"><a href="#Calculate-1616"><span class="linenos">1616</span></a><span class="sd">        reference_depth : float</span>
</span><span id="Calculate-1617"><a href="#Calculate-1617"><span class="linenos">1617</span></a><span class="sd">            The depth at which to anchor the reference density</span>
</span><span id="Calculate-1618"><a href="#Calculate-1618"><span class="linenos">1618</span></a><span class="sd">        delta : float, optional</span>
</span><span id="Calculate-1619"><a href="#Calculate-1619"><span class="linenos">1619</span></a><span class="sd">            The difference in density which would indicate the MLD, defaults to 0.1 kg/m³.</span>
</span><span id="Calculate-1620"><a href="#Calculate-1620"><span class="linenos">1620</span></a>
</span><span id="Calculate-1621"><a href="#Calculate-1621"><span class="linenos">1621</span></a><span class="sd">        Returns</span>
</span><span id="Calculate-1622"><a href="#Calculate-1622"><span class="linenos">1622</span></a><span class="sd">        -------</span>
</span><span id="Calculate-1623"><a href="#Calculate-1623"><span class="linenos">1623</span></a><span class="sd">        tuple</span>
</span><span id="Calculate-1624"><a href="#Calculate-1624"><span class="linenos">1624</span></a><span class="sd">            A tuple containing the calculated MLD and the reference depth used to calculate MLD.</span>
</span><span id="Calculate-1625"><a href="#Calculate-1625"><span class="linenos">1625</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate-1626"><a href="#Calculate-1626"><span class="linenos">1626</span></a>        <span class="c1"># Convert to numeric and ensure no NaNs remain</span>
</span><span id="Calculate-1627"><a href="#Calculate-1627"><span class="linenos">1627</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate-1628"><a href="#Calculate-1628"><span class="linenos">1628</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate-1629"><a href="#Calculate-1629"><span class="linenos">1629</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1630"><a href="#Calculate-1630"><span class="linenos">1630</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1631"><a href="#Calculate-1631"><span class="linenos">1631</span></a>        <span class="n">reference_depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">reference_depth</span><span class="p">)</span>
</span><span id="Calculate-1632"><a href="#Calculate-1632"><span class="linenos">1632</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">depths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Calculate-1633"><a href="#Calculate-1633"><span class="linenos">1633</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Calculate-1634"><a href="#Calculate-1634"><span class="linenos">1634</span></a>        <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">densities</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Calculate-1635"><a href="#Calculate-1635"><span class="linenos">1635</span></a>        <span class="n">sorted_depths</span><span class="p">,</span> <span class="n">sorted_densities</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sorted_data</span><span class="p">)</span>
</span><span id="Calculate-1636"><a href="#Calculate-1636"><span class="linenos">1636</span></a>        <span class="c1"># Determine reference density</span>
</span><span id="Calculate-1637"><a href="#Calculate-1637"><span class="linenos">1637</span></a>        <span class="n">reference_density</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Calculate-1638"><a href="#Calculate-1638"><span class="linenos">1638</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_depths</span><span class="p">):</span>
</span><span id="Calculate-1639"><a href="#Calculate-1639"><span class="linenos">1639</span></a>            <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">reference_depth</span><span class="p">:</span>
</span><span id="Calculate-1640"><a href="#Calculate-1640"><span class="linenos">1640</span></a>                <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="n">reference_depth</span><span class="p">:</span>
</span><span id="Calculate-1641"><a href="#Calculate-1641"><span class="linenos">1641</span></a>                    <span class="n">reference_density</span> <span class="o">=</span> <span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Calculate-1642"><a href="#Calculate-1642"><span class="linenos">1642</span></a>                    <span class="n">reference_depth</span> <span class="o">=</span> <span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Calculate-1643"><a href="#Calculate-1643"><span class="linenos">1643</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Calculate-1644"><a href="#Calculate-1644"><span class="linenos">1644</span></a>                    <span class="c1"># Linear interpolation</span>
</span><span id="Calculate-1645"><a href="#Calculate-1645"><span class="linenos">1645</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Calculate-1646"><a href="#Calculate-1646"><span class="linenos">1646</span></a>                        <span class="n">reference_density</span> <span class="o">=</span> <span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="Calculate-1647"><a href="#Calculate-1647"><span class="linenos">1647</span></a>                                <span class="p">(</span><span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="Calculate-1648"><a href="#Calculate-1648"><span class="linenos">1648</span></a>                                <span class="p">(</span><span class="n">reference_depth</span> <span class="o">-</span> <span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span>
</span><span id="Calculate-1649"><a href="#Calculate-1649"><span class="linenos">1649</span></a>                                <span class="p">(</span><span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])))</span>
</span><span id="Calculate-1650"><a href="#Calculate-1650"><span class="linenos">1650</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Calculate-1651"><a href="#Calculate-1651"><span class="linenos">1651</span></a>                        <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Calculate-1652"><a href="#Calculate-1652"><span class="linenos">1652</span></a>                                       <span class="sa">f</span><span class="s2">&quot;Insufficient depth range to calculate MLD. &quot;</span>
</span><span id="Calculate-1653"><a href="#Calculate-1653"><span class="linenos">1653</span></a>                                       <span class="sa">f</span><span class="s2">&quot;Maximum sample depth is &quot;</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">depths</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">, minimum is </span><span class="si">{</span><span class="n">depths</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Calculate-1654"><a href="#Calculate-1654"><span class="linenos">1654</span></a>                <span class="k">break</span>
</span><span id="Calculate-1655"><a href="#Calculate-1655"><span class="linenos">1655</span></a>        <span class="k">if</span> <span class="n">reference_density</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Calculate-1656"><a href="#Calculate-1656"><span class="linenos">1656</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Calculate-1657"><a href="#Calculate-1657"><span class="linenos">1657</span></a>        <span class="c1"># Find the depth where density exceeds the reference density by more than 0.05 kg/m³</span>
</span><span id="Calculate-1658"><a href="#Calculate-1658"><span class="linenos">1658</span></a>        <span class="k">for</span> <span class="n">depth</span><span class="p">,</span> <span class="n">density</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sorted_depths</span><span class="p">,</span> <span class="n">sorted_densities</span><span class="p">):</span>
</span><span id="Calculate-1659"><a href="#Calculate-1659"><span class="linenos">1659</span></a>            <span class="k">if</span> <span class="n">density</span> <span class="o">&gt;</span> <span class="n">reference_density</span> <span class="o">+</span> <span class="n">delta</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">reference_depth</span><span class="p">:</span>
</span><span id="Calculate-1660"><a href="#Calculate-1660"><span class="linenos">1660</span></a>                <span class="k">return</span> <span class="n">depth</span><span class="p">,</span> <span class="n">reference_depth</span>
</span><span id="Calculate-1661"><a href="#Calculate-1661"><span class="linenos">1661</span></a>        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># If no depth meets the criterion</span>
</span><span id="Calculate-1662"><a href="#Calculate-1662"><span class="linenos">1662</span></a>
</span><span id="Calculate-1663"><a href="#Calculate-1663"><span class="linenos">1663</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate-1664"><a href="#Calculate-1664"><span class="linenos">1664</span></a>    <span class="k">def</span> <span class="nf">calculate_mld_loess</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="n">reference_depth</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.15</span><span class="p">):</span>
</span><span id="Calculate-1665"><a href="#Calculate-1665"><span class="linenos">1665</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate-1666"><a href="#Calculate-1666"><span class="linenos">1666</span></a><span class="sd">        Calculates the mixed layer depth (MLD) using LOESS smoothing to first smooth the density profile and</span>
</span><span id="Calculate-1667"><a href="#Calculate-1667"><span class="linenos">1667</span></a><span class="sd">        then determine the depth where the smoothed density exceeds the reference density</span>
</span><span id="Calculate-1668"><a href="#Calculate-1668"><span class="linenos">1668</span></a><span class="sd">        by a predefined amount which defaults to 0.03 kg/m³.</span>
</span><span id="Calculate-1669"><a href="#Calculate-1669"><span class="linenos">1669</span></a>
</span><span id="Calculate-1670"><a href="#Calculate-1670"><span class="linenos">1670</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate-1671"><a href="#Calculate-1671"><span class="linenos">1671</span></a><span class="sd">        ----------</span>
</span><span id="Calculate-1672"><a href="#Calculate-1672"><span class="linenos">1672</span></a><span class="sd">        densities : Series</span>
</span><span id="Calculate-1673"><a href="#Calculate-1673"><span class="linenos">1673</span></a><span class="sd">            Series of densities</span>
</span><span id="Calculate-1674"><a href="#Calculate-1674"><span class="linenos">1674</span></a><span class="sd">        depths : Series</span>
</span><span id="Calculate-1675"><a href="#Calculate-1675"><span class="linenos">1675</span></a><span class="sd">            Series of depths corresponding to densities</span>
</span><span id="Calculate-1676"><a href="#Calculate-1676"><span class="linenos">1676</span></a><span class="sd">        reference_depth :</span>
</span><span id="Calculate-1677"><a href="#Calculate-1677"><span class="linenos">1677</span></a><span class="sd">            The depth at which to anchor the reference density</span>
</span><span id="Calculate-1678"><a href="#Calculate-1678"><span class="linenos">1678</span></a><span class="sd">        delta : float, optional</span>
</span><span id="Calculate-1679"><a href="#Calculate-1679"><span class="linenos">1679</span></a><span class="sd">            The difference in density which would indicate the MLD, defaults to 0.03 kg/m.</span>
</span><span id="Calculate-1680"><a href="#Calculate-1680"><span class="linenos">1680</span></a>
</span><span id="Calculate-1681"><a href="#Calculate-1681"><span class="linenos">1681</span></a><span class="sd">        Returns</span>
</span><span id="Calculate-1682"><a href="#Calculate-1682"><span class="linenos">1682</span></a><span class="sd">        -------</span>
</span><span id="Calculate-1683"><a href="#Calculate-1683"><span class="linenos">1683</span></a><span class="sd">        tuple</span>
</span><span id="Calculate-1684"><a href="#Calculate-1684"><span class="linenos">1684</span></a><span class="sd">            A tuple containing the calculated MLD and the reference depth used to calculate MLD.</span>
</span><span id="Calculate-1685"><a href="#Calculate-1685"><span class="linenos">1685</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate-1686"><a href="#Calculate-1686"><span class="linenos">1686</span></a>        <span class="c1"># Ensure input is pandas Series and drop NA values</span>
</span><span id="Calculate-1687"><a href="#Calculate-1687"><span class="linenos">1687</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
</span><span id="Calculate-1688"><a href="#Calculate-1688"><span class="linenos">1688</span></a>            <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1689"><a href="#Calculate-1689"><span class="linenos">1689</span></a>            <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1690"><a href="#Calculate-1690"><span class="linenos">1690</span></a>
</span><span id="Calculate-1691"><a href="#Calculate-1691"><span class="linenos">1691</span></a>        <span class="c1"># Convert to numeric and ensure no NaNs remain</span>
</span><span id="Calculate-1692"><a href="#Calculate-1692"><span class="linenos">1692</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate-1693"><a href="#Calculate-1693"><span class="linenos">1693</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate-1694"><a href="#Calculate-1694"><span class="linenos">1694</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1695"><a href="#Calculate-1695"><span class="linenos">1695</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1696"><a href="#Calculate-1696"><span class="linenos">1696</span></a>        <span class="k">if</span> <span class="n">densities</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">depths</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Calculate-1697"><a href="#Calculate-1697"><span class="linenos">1697</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="Calculate-1698"><a href="#Calculate-1698"><span class="linenos">1698</span></a>
</span><span id="Calculate-1699"><a href="#Calculate-1699"><span class="linenos">1699</span></a>        <span class="c1"># Convert pandas Series to numpy arrays for NumPy operations</span>
</span><span id="Calculate-1700"><a href="#Calculate-1700"><span class="linenos">1700</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="Calculate-1701"><a href="#Calculate-1701"><span class="linenos">1701</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="Calculate-1702"><a href="#Calculate-1702"><span class="linenos">1702</span></a>
</span><span id="Calculate-1703"><a href="#Calculate-1703"><span class="linenos">1703</span></a>        <span class="c1"># Remove duplicates by averaging densities at the same depth</span>
</span><span id="Calculate-1704"><a href="#Calculate-1704"><span class="linenos">1704</span></a>        <span class="n">unique_depths</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate-1705"><a href="#Calculate-1705"><span class="linenos">1705</span></a>        <span class="n">average_densities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">unique_depths</span><span class="p">)</span>
</span><span id="Calculate-1706"><a href="#Calculate-1706"><span class="linenos">1706</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">average_densities</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>
</span><span id="Calculate-1707"><a href="#Calculate-1707"><span class="linenos">1707</span></a>        <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">unique_depths</span><span class="p">)</span>
</span><span id="Calculate-1708"><a href="#Calculate-1708"><span class="linenos">1708</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Calculate-1709"><a href="#Calculate-1709"><span class="linenos">1709</span></a>        <span class="n">average_densities</span> <span class="o">/=</span> <span class="n">counts</span>
</span><span id="Calculate-1710"><a href="#Calculate-1710"><span class="linenos">1710</span></a>
</span><span id="Calculate-1711"><a href="#Calculate-1711"><span class="linenos">1711</span></a>        <span class="c1"># Apply LOESS smoothing</span>
</span><span id="Calculate-1712"><a href="#Calculate-1712"><span class="linenos">1712</span></a>        <span class="n">lowess</span> <span class="o">=</span> <span class="n">statsmodels</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">nonparametric</span><span class="o">.</span><span class="n">lowess</span>
</span><span id="Calculate-1713"><a href="#Calculate-1713"><span class="linenos">1713</span></a>        <span class="n">smoothed</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">average_densities</span><span class="p">,</span> <span class="n">unique_depths</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="Calculate-1714"><a href="#Calculate-1714"><span class="linenos">1714</span></a>        <span class="n">smoothed_depths</span><span class="p">,</span> <span class="n">smoothed_densities</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">smoothed</span><span class="p">)</span>
</span><span id="Calculate-1715"><a href="#Calculate-1715"><span class="linenos">1715</span></a>        <span class="n">reference_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">reference_depth</span><span class="p">,</span> <span class="n">smoothed_depths</span><span class="p">,</span> <span class="n">smoothed_densities</span><span class="p">)</span>
</span><span id="Calculate-1716"><a href="#Calculate-1716"><span class="linenos">1716</span></a>
</span><span id="Calculate-1717"><a href="#Calculate-1717"><span class="linenos">1717</span></a>        <span class="c1"># Find the depth where density exceeds the reference density by more than 0.05 kg/m³</span>
</span><span id="Calculate-1718"><a href="#Calculate-1718"><span class="linenos">1718</span></a>        <span class="n">exceeding_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">smoothed_densities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">reference_density</span> <span class="o">+</span> <span class="n">delta</span>
</span><span id="Calculate-1719"><a href="#Calculate-1719"><span class="linenos">1719</span></a>                                     <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">smoothed_densities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">reference_depth</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Calculate-1720"><a href="#Calculate-1720"><span class="linenos">1720</span></a>        <span class="k">if</span> <span class="n">exceeding_indices</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Calculate-1721"><a href="#Calculate-1721"><span class="linenos">1721</span></a>            <span class="n">mld_depth</span> <span class="o">=</span> <span class="n">smoothed_depths</span><span class="p">[</span><span class="n">exceeding_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Calculate-1722"><a href="#Calculate-1722"><span class="linenos">1722</span></a>            <span class="k">return</span> <span class="n">mld_depth</span><span class="p">,</span> <span class="n">reference_depth</span>
</span><span id="Calculate-1723"><a href="#Calculate-1723"><span class="linenos">1723</span></a>
</span><span id="Calculate-1724"><a href="#Calculate-1724"><span class="linenos">1724</span></a>        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># If no depth meets the criterion</span>
</span><span id="Calculate-1725"><a href="#Calculate-1725"><span class="linenos">1725</span></a>
</span><span id="Calculate-1726"><a href="#Calculate-1726"><span class="linenos">1726</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate-1727"><a href="#Calculate-1727"><span class="linenos">1727</span></a>    <span class="k">def</span> <span class="nf">calculate_mean_surface_density</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">range_</span><span class="p">):</span>
</span><span id="Calculate-1728"><a href="#Calculate-1728"><span class="linenos">1728</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate-1729"><a href="#Calculate-1729"><span class="linenos">1729</span></a><span class="sd">        Calculates the mean surface density from the CTD data, for a specified range or the entire dataset if the range is larger.</span>
</span><span id="Calculate-1730"><a href="#Calculate-1730"><span class="linenos">1730</span></a>
</span><span id="Calculate-1731"><a href="#Calculate-1731"><span class="linenos">1731</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate-1732"><a href="#Calculate-1732"><span class="linenos">1732</span></a><span class="sd">        ----------</span>
</span><span id="Calculate-1733"><a href="#Calculate-1733"><span class="linenos">1733</span></a><span class="sd">        df : DataFrame</span>
</span><span id="Calculate-1734"><a href="#Calculate-1734"><span class="linenos">1734</span></a><span class="sd">            DataFrame containing density data.</span>
</span><span id="Calculate-1735"><a href="#Calculate-1735"><span class="linenos">1735</span></a><span class="sd">        range_ : tuple or int</span>
</span><span id="Calculate-1736"><a href="#Calculate-1736"><span class="linenos">1736</span></a><span class="sd">            Tuple indicating the (start, end) indices for the range of rows to be included in the calculation,</span>
</span><span id="Calculate-1737"><a href="#Calculate-1737"><span class="linenos">1737</span></a><span class="sd">            or an integer indicating the number of rows from the start.</span>
</span><span id="Calculate-1738"><a href="#Calculate-1738"><span class="linenos">1738</span></a>
</span><span id="Calculate-1739"><a href="#Calculate-1739"><span class="linenos">1739</span></a><span class="sd">        Returns</span>
</span><span id="Calculate-1740"><a href="#Calculate-1740"><span class="linenos">1740</span></a><span class="sd">        -------</span>
</span><span id="Calculate-1741"><a href="#Calculate-1741"><span class="linenos">1741</span></a><span class="sd">        float, None</span>
</span><span id="Calculate-1742"><a href="#Calculate-1742"><span class="linenos">1742</span></a><span class="sd">            Mean density value of the specified sample or None if unable to calculate.</span>
</span><span id="Calculate-1743"><a href="#Calculate-1743"><span class="linenos">1743</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate-1744"><a href="#Calculate-1744"><span class="linenos">1744</span></a>        <span class="n">min_depth</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Calculate-1745"><a href="#Calculate-1745"><span class="linenos">1745</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Calculate-1746"><a href="#Calculate-1746"><span class="linenos">1746</span></a>
</span><span id="Calculate-1747"><a href="#Calculate-1747"><span class="linenos">1747</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="Calculate-1748"><a href="#Calculate-1748"><span class="linenos">1748</span></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">range_</span>
</span><span id="Calculate-1749"><a href="#Calculate-1749"><span class="linenos">1749</span></a>
</span><span id="Calculate-1750"><a href="#Calculate-1750"><span class="linenos">1750</span></a>            <span class="c1"># Adjust &#39;start&#39; to ensure it is within the valid range</span>
</span><span id="Calculate-1751"><a href="#Calculate-1751"><span class="linenos">1751</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">min_depth</span><span class="p">)</span>
</span><span id="Calculate-1752"><a href="#Calculate-1752"><span class="linenos">1752</span></a>
</span><span id="Calculate-1753"><a href="#Calculate-1753"><span class="linenos">1753</span></a>            <span class="c1"># Adjust &#39;end&#39; to ensure it does not exceed the maximum depth value</span>
</span><span id="Calculate-1754"><a href="#Calculate-1754"><span class="linenos">1754</span></a>            <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="Calculate-1755"><a href="#Calculate-1755"><span class="linenos">1755</span></a>
</span><span id="Calculate-1756"><a href="#Calculate-1756"><span class="linenos">1756</span></a>            <span class="c1"># Ensure start is less than end</span>
</span><span id="Calculate-1757"><a href="#Calculate-1757"><span class="linenos">1757</span></a>            <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
</span><span id="Calculate-1758"><a href="#Calculate-1758"><span class="linenos">1758</span></a>                <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Calculate-1759"><a href="#Calculate-1759"><span class="linenos">1759</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Calculate-1760"><a href="#Calculate-1760"><span class="linenos">1760</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Calculate-1761"><a href="#Calculate-1761"><span class="linenos">1761</span></a>
</span><span id="Calculate-1762"><a href="#Calculate-1762"><span class="linenos">1762</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Calculate-1763"><a href="#Calculate-1763"><span class="linenos">1763</span></a>            <span class="c1"># Use &#39;range_&#39; as the number of rows from the start, adjust if it exceeds the DataFrame length</span>
</span><span id="Calculate-1764"><a href="#Calculate-1764"><span class="linenos">1764</span></a>            <span class="n">range_</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">range_</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</span><span id="Calculate-1765"><a href="#Calculate-1765"><span class="linenos">1765</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">range_</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Calculate-1766"><a href="#Calculate-1766"><span class="linenos">1766</span></a>
</span><span id="Calculate-1767"><a href="#Calculate-1767"><span class="linenos">1767</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Calculate-1768"><a href="#Calculate-1768"><span class="linenos">1768</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid range type. Must be tuple or int.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="calculate">Calculate</h6>

<p>Class for CTD data calculations.</p>
</div>


                            <div id="Calculate.gsw_infunnel" class="classattr">
                                        <input id="Calculate.gsw_infunnel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">gsw_infunnel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">SA</span>, </span><span class="param"><span class="n">CT</span>, </span><span class="param"><span class="n">p</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Calculate.gsw_infunnel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Calculate.gsw_infunnel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Calculate.gsw_infunnel-1376"><a href="#Calculate.gsw_infunnel-1376"><span class="linenos">1376</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate.gsw_infunnel-1377"><a href="#Calculate.gsw_infunnel-1377"><span class="linenos">1377</span></a>    <span class="k">def</span> <span class="nf">gsw_infunnel</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">CT</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span><span id="Calculate.gsw_infunnel-1378"><a href="#Calculate.gsw_infunnel-1378"><span class="linenos">1378</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate.gsw_infunnel-1379"><a href="#Calculate.gsw_infunnel-1379"><span class="linenos">1379</span></a><span class="sd">        Check if the given Absolute Salinity (SA), Conservative Temperature (CT),</span>
</span><span id="Calculate.gsw_infunnel-1380"><a href="#Calculate.gsw_infunnel-1380"><span class="linenos">1380</span></a><span class="sd">        and pressure (p) are within the &quot;oceanographic funnel&quot; for the TEOS-10 75-term equation.</span>
</span><span id="Calculate.gsw_infunnel-1381"><a href="#Calculate.gsw_infunnel-1381"><span class="linenos">1381</span></a>
</span><span id="Calculate.gsw_infunnel-1382"><a href="#Calculate.gsw_infunnel-1382"><span class="linenos">1382</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate.gsw_infunnel-1383"><a href="#Calculate.gsw_infunnel-1383"><span class="linenos">1383</span></a><span class="sd">        ----------</span>
</span><span id="Calculate.gsw_infunnel-1384"><a href="#Calculate.gsw_infunnel-1384"><span class="linenos">1384</span></a><span class="sd">        SA : Series</span>
</span><span id="Calculate.gsw_infunnel-1385"><a href="#Calculate.gsw_infunnel-1385"><span class="linenos">1385</span></a><span class="sd">            Absolute Salinity in g/kg.</span>
</span><span id="Calculate.gsw_infunnel-1386"><a href="#Calculate.gsw_infunnel-1386"><span class="linenos">1386</span></a><span class="sd">        CT : Series</span>
</span><span id="Calculate.gsw_infunnel-1387"><a href="#Calculate.gsw_infunnel-1387"><span class="linenos">1387</span></a><span class="sd">            Conservative Temperature in degrees Celsius.</span>
</span><span id="Calculate.gsw_infunnel-1388"><a href="#Calculate.gsw_infunnel-1388"><span class="linenos">1388</span></a><span class="sd">        p : Series</span>
</span><span id="Calculate.gsw_infunnel-1389"><a href="#Calculate.gsw_infunnel-1389"><span class="linenos">1389</span></a><span class="sd">            Sea pressure in dbar (absolute pressure minus 10.1325 dbar).</span>
</span><span id="Calculate.gsw_infunnel-1390"><a href="#Calculate.gsw_infunnel-1390"><span class="linenos">1390</span></a>
</span><span id="Calculate.gsw_infunnel-1391"><a href="#Calculate.gsw_infunnel-1391"><span class="linenos">1391</span></a><span class="sd">        Returns</span>
</span><span id="Calculate.gsw_infunnel-1392"><a href="#Calculate.gsw_infunnel-1392"><span class="linenos">1392</span></a><span class="sd">        -------</span>
</span><span id="Calculate.gsw_infunnel-1393"><a href="#Calculate.gsw_infunnel-1393"><span class="linenos">1393</span></a><span class="sd">        Series of bool</span>
</span><span id="Calculate.gsw_infunnel-1394"><a href="#Calculate.gsw_infunnel-1394"><span class="linenos">1394</span></a><span class="sd">            A boolean array where True indicates the values are inside the &quot;oceanographic funnel&quot;.</span>
</span><span id="Calculate.gsw_infunnel-1395"><a href="#Calculate.gsw_infunnel-1395"><span class="linenos">1395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate.gsw_infunnel-1396"><a href="#Calculate.gsw_infunnel-1396"><span class="linenos">1396</span></a>        <span class="c1"># Ensure all inputs are Series and aligned</span>
</span><span id="Calculate.gsw_infunnel-1397"><a href="#Calculate.gsw_infunnel-1397"><span class="linenos">1397</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">CT</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="Calculate.gsw_infunnel-1398"><a href="#Calculate.gsw_infunnel-1398"><span class="linenos">1398</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">p</span><span class="p">))):</span>
</span><span id="Calculate.gsw_infunnel-1399"><a href="#Calculate.gsw_infunnel-1399"><span class="linenos">1399</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;SA, CT, and p must be pandas Series or p a scalar&quot;</span><span class="p">)</span>
</span><span id="Calculate.gsw_infunnel-1400"><a href="#Calculate.gsw_infunnel-1400"><span class="linenos">1400</span></a>
</span><span id="Calculate.gsw_infunnel-1401"><a href="#Calculate.gsw_infunnel-1401"><span class="linenos">1401</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">CT</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="ow">and</span> <span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="Calculate.gsw_infunnel-1402"><a href="#Calculate.gsw_infunnel-1402"><span class="linenos">1402</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Indices of SA, CT, and p must be aligned&quot;</span><span class="p">)</span>
</span><span id="Calculate.gsw_infunnel-1403"><a href="#Calculate.gsw_infunnel-1403"><span class="linenos">1403</span></a>
</span><span id="Calculate.gsw_infunnel-1404"><a href="#Calculate.gsw_infunnel-1404"><span class="linenos">1404</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
</span><span id="Calculate.gsw_infunnel-1405"><a href="#Calculate.gsw_infunnel-1405"><span class="linenos">1405</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="Calculate.gsw_infunnel-1406"><a href="#Calculate.gsw_infunnel-1406"><span class="linenos">1406</span></a>
</span><span id="Calculate.gsw_infunnel-1407"><a href="#Calculate.gsw_infunnel-1407"><span class="linenos">1407</span></a>        <span class="c1"># Define the funnel conditions</span>
</span><span id="Calculate.gsw_infunnel-1408"><a href="#Calculate.gsw_infunnel-1408"><span class="linenos">1408</span></a>        <span class="n">CT_freezing_p</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">CT_freezing</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Calculate.gsw_infunnel-1409"><a href="#Calculate.gsw_infunnel-1409"><span class="linenos">1409</span></a>        <span class="n">CT_freezing_500</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">CT_freezing</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Calculate.gsw_infunnel-1410"><a href="#Calculate.gsw_infunnel-1410"><span class="linenos">1410</span></a>
</span><span id="Calculate.gsw_infunnel-1411"><a href="#Calculate.gsw_infunnel-1411"><span class="linenos">1411</span></a>        <span class="n">in_funnel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">SA</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># Default all to True</span>
</span><span id="Calculate.gsw_infunnel-1412"><a href="#Calculate.gsw_infunnel-1412"><span class="linenos">1412</span></a>        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Calculate.gsw_infunnel-1413"><a href="#Calculate.gsw_infunnel-1413"><span class="linenos">1413</span></a>                <span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">8000</span><span class="p">)</span> <span class="o">|</span>
</span><span id="Calculate.gsw_infunnel-1414"><a href="#Calculate.gsw_infunnel-1414"><span class="linenos">1414</span></a>                <span class="p">(</span><span class="n">SA</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&gt;</span> <span class="mi">42</span><span class="p">)</span> <span class="o">|</span>
</span><span id="Calculate.gsw_infunnel-1415"><a href="#Calculate.gsw_infunnel-1415"><span class="linenos">1415</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&lt;</span> <span class="n">CT_freezing_p</span><span class="p">))</span> <span class="o">|</span>
</span><span id="Calculate.gsw_infunnel-1416"><a href="#Calculate.gsw_infunnel-1416"><span class="linenos">1416</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&lt;</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">5e-3</span> <span class="o">-</span> <span class="mf">2.5</span><span class="p">))</span> <span class="o">|</span>
</span><span id="Calculate.gsw_infunnel-1417"><a href="#Calculate.gsw_infunnel-1417"><span class="linenos">1417</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">31.66666666666667</span> <span class="o">-</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">3.333333333333334e-3</span><span class="p">)))</span> <span class="o">|</span>
</span><span id="Calculate.gsw_infunnel-1418"><a href="#Calculate.gsw_infunnel-1418"><span class="linenos">1418</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&lt;</span> <span class="n">CT_freezing_500</span><span class="p">))</span> <span class="o">|</span>
</span><span id="Calculate.gsw_infunnel-1419"><a href="#Calculate.gsw_infunnel-1419"><span class="linenos">1419</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">))</span> <span class="o">|</span>
</span><span id="Calculate.gsw_infunnel-1420"><a href="#Calculate.gsw_infunnel-1420"><span class="linenos">1420</span></a>                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">6500</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">))</span> <span class="o">|</span>
</span><span id="Calculate.gsw_infunnel-1421"><a href="#Calculate.gsw_infunnel-1421"><span class="linenos">1421</span></a>                <span class="n">SA</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">|</span> <span class="n">CT</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
</span><span id="Calculate.gsw_infunnel-1422"><a href="#Calculate.gsw_infunnel-1422"><span class="linenos">1422</span></a>        <span class="p">)</span>
</span><span id="Calculate.gsw_infunnel-1423"><a href="#Calculate.gsw_infunnel-1423"><span class="linenos">1423</span></a>        <span class="n">in_funnel</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Calculate.gsw_infunnel-1424"><a href="#Calculate.gsw_infunnel-1424"><span class="linenos">1424</span></a>
</span><span id="Calculate.gsw_infunnel-1425"><a href="#Calculate.gsw_infunnel-1425"><span class="linenos">1425</span></a>        <span class="k">return</span> <span class="n">in_funnel</span>
</span></pre></div>


            <div class="docstring"><p>Check if the given Absolute Salinity (SA), Conservative Temperature (CT),
and pressure (p) are within the "oceanographic funnel" for the TEOS-10 75-term equation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>SA</strong> (Series):
Absolute Salinity in g/kg.</li>
<li><strong>CT</strong> (Series):
Conservative Temperature in degrees Celsius.</li>
<li><strong>p</strong> (Series):
Sea pressure in dbar (absolute pressure minus 10.1325 dbar).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Series of bool</strong>: A boolean array where True indicates the values are inside the "oceanographic funnel".</li>
</ul>
</div>


                            </div>
                            <div id="Calculate.calculate_and_drop_salinity_spikes" class="classattr">
                                        <input id="Calculate.calculate_and_drop_salinity_spikes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">calculate_and_drop_salinity_spikes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Calculate.calculate_and_drop_salinity_spikes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Calculate.calculate_and_drop_salinity_spikes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Calculate.calculate_and_drop_salinity_spikes-1427"><a href="#Calculate.calculate_and_drop_salinity_spikes-1427"><span class="linenos">1427</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1428"><a href="#Calculate.calculate_and_drop_salinity_spikes-1428"><span class="linenos">1428</span></a>    <span class="k">def</span> <span class="nf">calculate_and_drop_salinity_spikes</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1429"><a href="#Calculate.calculate_and_drop_salinity_spikes-1429"><span class="linenos">1429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1430"><a href="#Calculate.calculate_and_drop_salinity_spikes-1430"><span class="linenos">1430</span></a><span class="sd">        Calculates and removes salinity spikes from the CTD data based on predefined thresholds for acceptable</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1431"><a href="#Calculate.calculate_and_drop_salinity_spikes-1431"><span class="linenos">1431</span></a><span class="sd">        changes in salinity with depth.</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1432"><a href="#Calculate.calculate_and_drop_salinity_spikes-1432"><span class="linenos">1432</span></a>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1433"><a href="#Calculate.calculate_and_drop_salinity_spikes-1433"><span class="linenos">1433</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1434"><a href="#Calculate.calculate_and_drop_salinity_spikes-1434"><span class="linenos">1434</span></a><span class="sd">        ----------</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1435"><a href="#Calculate.calculate_and_drop_salinity_spikes-1435"><span class="linenos">1435</span></a><span class="sd">        df : DataFrame</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1436"><a href="#Calculate.calculate_and_drop_salinity_spikes-1436"><span class="linenos">1436</span></a><span class="sd">            DataFrame containing depth and salinity data</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1437"><a href="#Calculate.calculate_and_drop_salinity_spikes-1437"><span class="linenos">1437</span></a>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1438"><a href="#Calculate.calculate_and_drop_salinity_spikes-1438"><span class="linenos">1438</span></a><span class="sd">        Returns</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1439"><a href="#Calculate.calculate_and_drop_salinity_spikes-1439"><span class="linenos">1439</span></a><span class="sd">        -------</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1440"><a href="#Calculate.calculate_and_drop_salinity_spikes-1440"><span class="linenos">1440</span></a><span class="sd">        DataFrame</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1441"><a href="#Calculate.calculate_and_drop_salinity_spikes-1441"><span class="linenos">1441</span></a><span class="sd">            DataFrame after removing salinity spikes</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1442"><a href="#Calculate.calculate_and_drop_salinity_spikes-1442"><span class="linenos">1442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1443"><a href="#Calculate.calculate_and_drop_salinity_spikes-1443"><span class="linenos">1443</span></a>        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1444"><a href="#Calculate.calculate_and_drop_salinity_spikes-1444"><span class="linenos">1444</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1445"><a href="#Calculate.calculate_and_drop_salinity_spikes-1445"><span class="linenos">1445</span></a>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1446"><a href="#Calculate.calculate_and_drop_salinity_spikes-1446"><span class="linenos">1446</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1447"><a href="#Calculate.calculate_and_drop_salinity_spikes-1447"><span class="linenos">1447</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1448"><a href="#Calculate.calculate_and_drop_salinity_spikes-1448"><span class="linenos">1448</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">,</span> <span class="s1">&#39;salinity_00&#39;</span><span class="p">])</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1449"><a href="#Calculate.calculate_and_drop_salinity_spikes-1449"><span class="linenos">1449</span></a>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1450"><a href="#Calculate.calculate_and_drop_salinity_spikes-1450"><span class="linenos">1450</span></a>        <span class="n">min_depth</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1451"><a href="#Calculate.calculate_and_drop_salinity_spikes-1451"><span class="linenos">1451</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1452"><a href="#Calculate.calculate_and_drop_salinity_spikes-1452"><span class="linenos">1452</span></a>        <span class="k">if</span> <span class="n">min_depth</span> <span class="o">==</span> <span class="n">max_depth</span><span class="p">:</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1453"><a href="#Calculate.calculate_and_drop_salinity_spikes-1453"><span class="linenos">1453</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Insufficient depth range to calculate.&quot;</span><span class="p">)</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1454"><a href="#Calculate.calculate_and_drop_salinity_spikes-1454"><span class="linenos">1454</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1455"><a href="#Calculate.calculate_and_drop_salinity_spikes-1455"><span class="linenos">1455</span></a>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1456"><a href="#Calculate.calculate_and_drop_salinity_spikes-1456"><span class="linenos">1456</span></a>        <span class="n">acceptable_delta_salinity_per_depth</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1457"><a href="#Calculate.calculate_and_drop_salinity_spikes-1457"><span class="linenos">1457</span></a>            <span class="p">(</span><span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">),</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1458"><a href="#Calculate.calculate_and_drop_salinity_spikes-1458"><span class="linenos">1458</span></a>            <span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1459"><a href="#Calculate.calculate_and_drop_salinity_spikes-1459"><span class="linenos">1459</span></a>            <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1460"><a href="#Calculate.calculate_and_drop_salinity_spikes-1460"><span class="linenos">1460</span></a>            <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1461"><a href="#Calculate.calculate_and_drop_salinity_spikes-1461"><span class="linenos">1461</span></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1462"><a href="#Calculate.calculate_and_drop_salinity_spikes-1462"><span class="linenos">1462</span></a>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1463"><a href="#Calculate.calculate_and_drop_salinity_spikes-1463"><span class="linenos">1463</span></a>        <span class="p">]</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1464"><a href="#Calculate.calculate_and_drop_salinity_spikes-1464"><span class="linenos">1464</span></a>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1465"><a href="#Calculate.calculate_and_drop_salinity_spikes-1465"><span class="linenos">1465</span></a>        <span class="k">for</span> <span class="n">acceptable_delta</span><span class="p">,</span> <span class="n">depth_range</span> <span class="ow">in</span> <span class="n">acceptable_delta_salinity_per_depth</span><span class="p">:</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1466"><a href="#Calculate.calculate_and_drop_salinity_spikes-1466"><span class="linenos">1466</span></a>            <span class="n">num_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_depth</span> <span class="o">-</span> <span class="n">min_depth</span><span class="p">)</span> <span class="o">/</span> <span class="n">depth_range</span><span class="p">)</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1467"><a href="#Calculate.calculate_and_drop_salinity_spikes-1467"><span class="linenos">1467</span></a>            <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_points</span><span class="p">)</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1468"><a href="#Calculate.calculate_and_drop_salinity_spikes-1468"><span class="linenos">1468</span></a>            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;depth_00&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="p">)</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1469"><a href="#Calculate.calculate_and_drop_salinity_spikes-1469"><span class="linenos">1469</span></a>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1470"><a href="#Calculate.calculate_and_drop_salinity_spikes-1470"><span class="linenos">1470</span></a>            <span class="c1"># Group by indices and filter</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1471"><a href="#Calculate.calculate_and_drop_salinity_spikes-1471"><span class="linenos">1471</span></a>            <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1472"><a href="#Calculate.calculate_and_drop_salinity_spikes-1472"><span class="linenos">1472</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">acceptable_delta</span><span class="p">)</span>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1473"><a href="#Calculate.calculate_and_drop_salinity_spikes-1473"><span class="linenos">1473</span></a>
</span><span id="Calculate.calculate_and_drop_salinity_spikes-1474"><a href="#Calculate.calculate_and_drop_salinity_spikes-1474"><span class="linenos">1474</span></a>        <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Calculates and removes salinity spikes from the CTD data based on predefined thresholds for acceptable
changes in salinity with depth.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (DataFrame):
DataFrame containing depth and salinity data</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame</strong>: DataFrame after removing salinity spikes</li>
</ul>
</div>


                            </div>
                            <div id="Calculate.calculate_overturns" class="classattr">
                                        <input id="Calculate.calculate_overturns-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">calculate_overturns</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">ctd_array</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Calculate.calculate_overturns-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Calculate.calculate_overturns"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Calculate.calculate_overturns-1476"><a href="#Calculate.calculate_overturns-1476"><span class="linenos">1476</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate.calculate_overturns-1477"><a href="#Calculate.calculate_overturns-1477"><span class="linenos">1477</span></a>    <span class="k">def</span> <span class="nf">calculate_overturns</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">):</span>
</span><span id="Calculate.calculate_overturns-1478"><a href="#Calculate.calculate_overturns-1478"><span class="linenos">1478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_overturns-1479"><a href="#Calculate.calculate_overturns-1479"><span class="linenos">1479</span></a><span class="sd">        Calculates density overturns in the CTD data where denser water lies above lighter water with density</span>
</span><span id="Calculate.calculate_overturns-1480"><a href="#Calculate.calculate_overturns-1480"><span class="linenos">1480</span></a><span class="sd">        difference of at least 0.05 kg/m³, which may indicate mixing or other dynamic processes.</span>
</span><span id="Calculate.calculate_overturns-1481"><a href="#Calculate.calculate_overturns-1481"><span class="linenos">1481</span></a>
</span><span id="Calculate.calculate_overturns-1482"><a href="#Calculate.calculate_overturns-1482"><span class="linenos">1482</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate.calculate_overturns-1483"><a href="#Calculate.calculate_overturns-1483"><span class="linenos">1483</span></a><span class="sd">        ----------</span>
</span><span id="Calculate.calculate_overturns-1484"><a href="#Calculate.calculate_overturns-1484"><span class="linenos">1484</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="Calculate.calculate_overturns-1485"><a href="#Calculate.calculate_overturns-1485"><span class="linenos">1485</span></a><span class="sd">            DataFrame containing depth, density, and timestamp data</span>
</span><span id="Calculate.calculate_overturns-1486"><a href="#Calculate.calculate_overturns-1486"><span class="linenos">1486</span></a>
</span><span id="Calculate.calculate_overturns-1487"><a href="#Calculate.calculate_overturns-1487"><span class="linenos">1487</span></a><span class="sd">        Returns</span>
</span><span id="Calculate.calculate_overturns-1488"><a href="#Calculate.calculate_overturns-1488"><span class="linenos">1488</span></a><span class="sd">        -------</span>
</span><span id="Calculate.calculate_overturns-1489"><a href="#Calculate.calculate_overturns-1489"><span class="linenos">1489</span></a><span class="sd">        DataFrame</span>
</span><span id="Calculate.calculate_overturns-1490"><a href="#Calculate.calculate_overturns-1490"><span class="linenos">1490</span></a><span class="sd">            DataFrame with identified density overturns</span>
</span><span id="Calculate.calculate_overturns-1491"><a href="#Calculate.calculate_overturns-1491"><span class="linenos">1491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_overturns-1492"><a href="#Calculate.calculate_overturns-1492"><span class="linenos">1492</span></a>        <span class="c1"># Sort DataFrame by depth in ascending order</span>
</span><span id="Calculate.calculate_overturns-1493"><a href="#Calculate.calculate_overturns-1493"><span class="linenos">1493</span></a>        <span class="n">ctd_array</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;depth_00&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_overturns-1494"><a href="#Calculate.calculate_overturns-1494"><span class="linenos">1494</span></a>        <span class="c1"># Calculate density change and identify overturns</span>
</span><span id="Calculate.calculate_overturns-1495"><a href="#Calculate.calculate_overturns-1495"><span class="linenos">1495</span></a>        <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;density_change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span>
</span><span id="Calculate.calculate_overturns-1496"><a href="#Calculate.calculate_overturns-1496"><span class="linenos">1496</span></a>            <span class="s1">&#39;density&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>  <span class="c1"># Difference in density between consecutive measurements</span>
</span><span id="Calculate.calculate_overturns-1497"><a href="#Calculate.calculate_overturns-1497"><span class="linenos">1497</span></a>        <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;overturn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;density_change&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.05</span>
</span><span id="Calculate.calculate_overturns-1498"><a href="#Calculate.calculate_overturns-1498"><span class="linenos">1498</span></a>        <span class="n">ctd_array</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_overturns-1499"><a href="#Calculate.calculate_overturns-1499"><span class="linenos">1499</span></a>        <span class="k">if</span> <span class="s1">&#39;density_change&#39;</span> <span class="ow">in</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Calculate.calculate_overturns-1500"><a href="#Calculate.calculate_overturns-1500"><span class="linenos">1500</span></a>            <span class="n">ctd_array</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;density_change&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Calculate.calculate_overturns-1501"><a href="#Calculate.calculate_overturns-1501"><span class="linenos">1501</span></a>        <span class="k">return</span> <span class="n">ctd_array</span>
</span></pre></div>


            <div class="docstring"><p>Calculates density overturns in the CTD data where denser water lies above lighter water with density
difference of at least 0.05 kg/m³, which may indicate mixing or other dynamic processes.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ctd_array</strong> (DataFrame):
DataFrame containing depth, density, and timestamp data</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame</strong>: DataFrame with identified density overturns</li>
</ul>
</div>


                            </div>
                            <div id="Calculate.calculate_surface_salinity_and_meltwater" class="classattr">
                                        <input id="Calculate.calculate_surface_salinity_and_meltwater-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">calculate_surface_salinity_and_meltwater</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">ctd_array</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mf">10.0</span>, </span><span class="param"><span class="n">end</span><span class="o">=</span><span class="mf">12.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Calculate.calculate_surface_salinity_and_meltwater-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Calculate.calculate_surface_salinity_and_meltwater"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Calculate.calculate_surface_salinity_and_meltwater-1503"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1503"><span class="linenos">1503</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1504"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1504"><span class="linenos">1504</span></a>    <span class="k">def</span> <span class="nf">calculate_surface_salinity_and_meltwater</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">12.0</span><span class="p">):</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1505"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1505"><span class="linenos">1505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1506"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1506"><span class="linenos">1506</span></a><span class="sd">        Calculates the surface salinity and meltwater fraction of a CTD profile.</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1507"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1507"><span class="linenos">1507</span></a><span class="sd">        Reports the mean salinity of the first 2 meters of the profile by finding the minimum salinity, and reports</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1508"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1508"><span class="linenos">1508</span></a><span class="sd">        meltwater fraction as given by (-0.021406 * surface_salinity + 0.740392) * 100.</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1509"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1509"><span class="linenos">1509</span></a>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1510"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1510"><span class="linenos">1510</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1511"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1511"><span class="linenos">1511</span></a><span class="sd">        ----------</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1512"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1512"><span class="linenos">1512</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1513"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1513"><span class="linenos">1513</span></a><span class="sd">            DataFrame containing salinity and depth data.</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1514"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1514"><span class="linenos">1514</span></a><span class="sd">        start : float</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1515"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1515"><span class="linenos">1515</span></a><span class="sd">            Minimum pressure of the surface, defaults to 10.0.</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1516"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1516"><span class="linenos">1516</span></a><span class="sd">        end : float</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1517"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1517"><span class="linenos">1517</span></a><span class="sd">            Maximum pressure of the surface, defaults to 12.0.</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1518"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1518"><span class="linenos">1518</span></a>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1519"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1519"><span class="linenos">1519</span></a><span class="sd">        Returns</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1520"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1520"><span class="linenos">1520</span></a><span class="sd">        -------</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1521"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1521"><span class="linenos">1521</span></a><span class="sd">        tuple</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1522"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1522"><span class="linenos">1522</span></a><span class="sd">            Returns a tuple of (surface salinity, meltwater fraction).</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1523"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1523"><span class="linenos">1523</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1524"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1524"><span class="linenos">1524</span></a>        <span class="c1"># Filtering data within the specified pressure range</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1525"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1525"><span class="linenos">1525</span></a>        <span class="n">surface_data</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)]</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1526"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1526"><span class="linenos">1526</span></a>        <span class="n">surface_salinity</span> <span class="o">=</span> <span class="n">surface_data</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1527"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1527"><span class="linenos">1527</span></a>        <span class="n">mwf</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.021406</span> <span class="o">*</span> <span class="n">surface_salinity</span> <span class="o">+</span> <span class="mf">0.740392</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1528"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1528"><span class="linenos">1528</span></a>
</span><span id="Calculate.calculate_surface_salinity_and_meltwater-1529"><a href="#Calculate.calculate_surface_salinity_and_meltwater-1529"><span class="linenos">1529</span></a>        <span class="k">return</span> <span class="n">surface_salinity</span><span class="p">,</span> <span class="n">mwf</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the surface salinity and meltwater fraction of a CTD profile.
Reports the mean salinity of the first 2 meters of the profile by finding the minimum salinity, and reports
meltwater fraction as given by (-0.021406 * surface_salinity + 0.740392) * 100.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ctd_array</strong> (DataFrame):
DataFrame containing salinity and depth data.</li>
<li><strong>start</strong> (float):
Minimum pressure of the surface, defaults to 10.0.</li>
<li><strong>end</strong> (float):
Maximum pressure of the surface, defaults to 12.0.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: Returns a tuple of (surface salinity, meltwater fraction).</li>
</ul>
</div>


                            </div>
                            <div id="Calculate.calculate_surface_temperature" class="classattr">
                                        <input id="Calculate.calculate_surface_temperature-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">calculate_surface_temperature</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">ctd_array</span>, </span><span class="param"><span class="n">start</span><span class="o">=</span><span class="mf">10.0</span>, </span><span class="param"><span class="n">end</span><span class="o">=</span><span class="mf">12.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Calculate.calculate_surface_temperature-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Calculate.calculate_surface_temperature"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Calculate.calculate_surface_temperature-1531"><a href="#Calculate.calculate_surface_temperature-1531"><span class="linenos">1531</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate.calculate_surface_temperature-1532"><a href="#Calculate.calculate_surface_temperature-1532"><span class="linenos">1532</span></a>    <span class="k">def</span> <span class="nf">calculate_surface_temperature</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">12.0</span><span class="p">):</span>
</span><span id="Calculate.calculate_surface_temperature-1533"><a href="#Calculate.calculate_surface_temperature-1533"><span class="linenos">1533</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_surface_temperature-1534"><a href="#Calculate.calculate_surface_temperature-1534"><span class="linenos">1534</span></a><span class="sd">        Calculates the surface temperature of a CTD profile. Reports the mean temperature of the first 2 meters</span>
</span><span id="Calculate.calculate_surface_temperature-1535"><a href="#Calculate.calculate_surface_temperature-1535"><span class="linenos">1535</span></a><span class="sd">        of the profile.</span>
</span><span id="Calculate.calculate_surface_temperature-1536"><a href="#Calculate.calculate_surface_temperature-1536"><span class="linenos">1536</span></a>
</span><span id="Calculate.calculate_surface_temperature-1537"><a href="#Calculate.calculate_surface_temperature-1537"><span class="linenos">1537</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate.calculate_surface_temperature-1538"><a href="#Calculate.calculate_surface_temperature-1538"><span class="linenos">1538</span></a><span class="sd">        ----------</span>
</span><span id="Calculate.calculate_surface_temperature-1539"><a href="#Calculate.calculate_surface_temperature-1539"><span class="linenos">1539</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="Calculate.calculate_surface_temperature-1540"><a href="#Calculate.calculate_surface_temperature-1540"><span class="linenos">1540</span></a><span class="sd">            DataFrame containing temperature and depth data.</span>
</span><span id="Calculate.calculate_surface_temperature-1541"><a href="#Calculate.calculate_surface_temperature-1541"><span class="linenos">1541</span></a><span class="sd">        start : float</span>
</span><span id="Calculate.calculate_surface_temperature-1542"><a href="#Calculate.calculate_surface_temperature-1542"><span class="linenos">1542</span></a><span class="sd">            Minimum pressure of the surface, defaults to 10.0.</span>
</span><span id="Calculate.calculate_surface_temperature-1543"><a href="#Calculate.calculate_surface_temperature-1543"><span class="linenos">1543</span></a><span class="sd">        end : float</span>
</span><span id="Calculate.calculate_surface_temperature-1544"><a href="#Calculate.calculate_surface_temperature-1544"><span class="linenos">1544</span></a><span class="sd">            Maximum pressure of the surface, defaults to 12.0.</span>
</span><span id="Calculate.calculate_surface_temperature-1545"><a href="#Calculate.calculate_surface_temperature-1545"><span class="linenos">1545</span></a><span class="sd">        Returns</span>
</span><span id="Calculate.calculate_surface_temperature-1546"><a href="#Calculate.calculate_surface_temperature-1546"><span class="linenos">1546</span></a><span class="sd">        -------</span>
</span><span id="Calculate.calculate_surface_temperature-1547"><a href="#Calculate.calculate_surface_temperature-1547"><span class="linenos">1547</span></a><span class="sd">        float</span>
</span><span id="Calculate.calculate_surface_temperature-1548"><a href="#Calculate.calculate_surface_temperature-1548"><span class="linenos">1548</span></a><span class="sd">            Returns the mean surface temperature.</span>
</span><span id="Calculate.calculate_surface_temperature-1549"><a href="#Calculate.calculate_surface_temperature-1549"><span class="linenos">1549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_surface_temperature-1550"><a href="#Calculate.calculate_surface_temperature-1550"><span class="linenos">1550</span></a>        <span class="c1"># Filtering data within the specified pressure range</span>
</span><span id="Calculate.calculate_surface_temperature-1551"><a href="#Calculate.calculate_surface_temperature-1551"><span class="linenos">1551</span></a>        <span class="n">surface_data</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;pressure_00&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)]</span>
</span><span id="Calculate.calculate_surface_temperature-1552"><a href="#Calculate.calculate_surface_temperature-1552"><span class="linenos">1552</span></a>        <span class="n">surface_temperature</span> <span class="o">=</span> <span class="n">surface_data</span><span class="p">[</span><span class="s1">&#39;temperature_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Calculate.calculate_surface_temperature-1553"><a href="#Calculate.calculate_surface_temperature-1553"><span class="linenos">1553</span></a>
</span><span id="Calculate.calculate_surface_temperature-1554"><a href="#Calculate.calculate_surface_temperature-1554"><span class="linenos">1554</span></a>        <span class="k">return</span> <span class="n">surface_temperature</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the surface temperature of a CTD profile. Reports the mean temperature of the first 2 meters
of the profile.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ctd_array</strong> (DataFrame):
DataFrame containing temperature and depth data.</li>
<li><strong>start</strong> (float):
Minimum pressure of the surface, defaults to 10.0.</li>
<li><strong>end</strong> (float):
Maximum pressure of the surface, defaults to 12.0.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: Returns the mean surface temperature.</li>
</ul>
</div>


                            </div>
                            <div id="Calculate.calculate_absolute_density" class="classattr">
                                        <input id="Calculate.calculate_absolute_density-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">calculate_absolute_density</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">ctd_array</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Calculate.calculate_absolute_density-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Calculate.calculate_absolute_density"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Calculate.calculate_absolute_density-1556"><a href="#Calculate.calculate_absolute_density-1556"><span class="linenos">1556</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate.calculate_absolute_density-1557"><a href="#Calculate.calculate_absolute_density-1557"><span class="linenos">1557</span></a>    <span class="k">def</span> <span class="nf">calculate_absolute_density</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">):</span>
</span><span id="Calculate.calculate_absolute_density-1558"><a href="#Calculate.calculate_absolute_density-1558"><span class="linenos">1558</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_absolute_density-1559"><a href="#Calculate.calculate_absolute_density-1559"><span class="linenos">1559</span></a><span class="sd">        Calculates absolute density from the CTD data using the TEOS-10 equations,</span>
</span><span id="Calculate.calculate_absolute_density-1560"><a href="#Calculate.calculate_absolute_density-1560"><span class="linenos">1560</span></a><span class="sd">        ensuring all data points are within the valid oceanographic funnel.</span>
</span><span id="Calculate.calculate_absolute_density-1561"><a href="#Calculate.calculate_absolute_density-1561"><span class="linenos">1561</span></a>
</span><span id="Calculate.calculate_absolute_density-1562"><a href="#Calculate.calculate_absolute_density-1562"><span class="linenos">1562</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate.calculate_absolute_density-1563"><a href="#Calculate.calculate_absolute_density-1563"><span class="linenos">1563</span></a><span class="sd">        ----------</span>
</span><span id="Calculate.calculate_absolute_density-1564"><a href="#Calculate.calculate_absolute_density-1564"><span class="linenos">1564</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="Calculate.calculate_absolute_density-1565"><a href="#Calculate.calculate_absolute_density-1565"><span class="linenos">1565</span></a><span class="sd">            DataFrame containing salinity, temperature, and pressure data</span>
</span><span id="Calculate.calculate_absolute_density-1566"><a href="#Calculate.calculate_absolute_density-1566"><span class="linenos">1566</span></a>
</span><span id="Calculate.calculate_absolute_density-1567"><a href="#Calculate.calculate_absolute_density-1567"><span class="linenos">1567</span></a><span class="sd">        Returns</span>
</span><span id="Calculate.calculate_absolute_density-1568"><a href="#Calculate.calculate_absolute_density-1568"><span class="linenos">1568</span></a><span class="sd">        -------</span>
</span><span id="Calculate.calculate_absolute_density-1569"><a href="#Calculate.calculate_absolute_density-1569"><span class="linenos">1569</span></a><span class="sd">        Series</span>
</span><span id="Calculate.calculate_absolute_density-1570"><a href="#Calculate.calculate_absolute_density-1570"><span class="linenos">1570</span></a><span class="sd">            Series with calculated absolute density</span>
</span><span id="Calculate.calculate_absolute_density-1571"><a href="#Calculate.calculate_absolute_density-1571"><span class="linenos">1571</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_absolute_density-1572"><a href="#Calculate.calculate_absolute_density-1572"><span class="linenos">1572</span></a>        <span class="n">sa</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;salinityabs&#39;</span><span class="p">]</span>
</span><span id="Calculate.calculate_absolute_density-1573"><a href="#Calculate.calculate_absolute_density-1573"><span class="linenos">1573</span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;temperature_00&#39;</span><span class="p">]</span>
</span><span id="Calculate.calculate_absolute_density-1574"><a href="#Calculate.calculate_absolute_density-1574"><span class="linenos">1574</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;seapressure_00&#39;</span><span class="p">]</span>
</span><span id="Calculate.calculate_absolute_density-1575"><a href="#Calculate.calculate_absolute_density-1575"><span class="linenos">1575</span></a>        <span class="n">ct</span> <span class="o">=</span> <span class="n">gsw</span><span class="o">.</span><span class="n">CT_from_t</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span><span id="Calculate.calculate_absolute_density-1576"><a href="#Calculate.calculate_absolute_density-1576"><span class="linenos">1576</span></a>        <span class="k">if</span> <span class="n">Calculate</span><span class="o">.</span><span class="n">gsw_infunnel</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
</span><span id="Calculate.calculate_absolute_density-1577"><a href="#Calculate.calculate_absolute_density-1577"><span class="linenos">1577</span></a>            <span class="k">return</span> <span class="n">gsw</span><span class="o">.</span><span class="n">density</span><span class="o">.</span><span class="n">rho_t_exact</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span><span id="Calculate.calculate_absolute_density-1578"><a href="#Calculate.calculate_absolute_density-1578"><span class="linenos">1578</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Calculate.calculate_absolute_density-1579"><a href="#Calculate.calculate_absolute_density-1579"><span class="linenos">1579</span></a>            <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Sample not in funnel, could not calculate density.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates absolute density from the CTD data using the TEOS-10 equations,
ensuring all data points are within the valid oceanographic funnel.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ctd_array</strong> (DataFrame):
DataFrame containing salinity, temperature, and pressure data</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Series</strong>: Series with calculated absolute density</li>
</ul>
</div>


                            </div>
                            <div id="Calculate.calculate_absolute_salinity" class="classattr">
                                        <input id="Calculate.calculate_absolute_salinity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">calculate_absolute_salinity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">ctd_array</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Calculate.calculate_absolute_salinity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Calculate.calculate_absolute_salinity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Calculate.calculate_absolute_salinity-1581"><a href="#Calculate.calculate_absolute_salinity-1581"><span class="linenos">1581</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate.calculate_absolute_salinity-1582"><a href="#Calculate.calculate_absolute_salinity-1582"><span class="linenos">1582</span></a>    <span class="k">def</span> <span class="nf">calculate_absolute_salinity</span><span class="p">(</span><span class="n">ctd_array</span><span class="p">):</span>
</span><span id="Calculate.calculate_absolute_salinity-1583"><a href="#Calculate.calculate_absolute_salinity-1583"><span class="linenos">1583</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_absolute_salinity-1584"><a href="#Calculate.calculate_absolute_salinity-1584"><span class="linenos">1584</span></a><span class="sd">        Calculates absolute salinity from practical salinity, pressure,</span>
</span><span id="Calculate.calculate_absolute_salinity-1585"><a href="#Calculate.calculate_absolute_salinity-1585"><span class="linenos">1585</span></a><span class="sd">        and geographical coordinates using the TEOS-10 salinity conversion formulas.</span>
</span><span id="Calculate.calculate_absolute_salinity-1586"><a href="#Calculate.calculate_absolute_salinity-1586"><span class="linenos">1586</span></a>
</span><span id="Calculate.calculate_absolute_salinity-1587"><a href="#Calculate.calculate_absolute_salinity-1587"><span class="linenos">1587</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate.calculate_absolute_salinity-1588"><a href="#Calculate.calculate_absolute_salinity-1588"><span class="linenos">1588</span></a><span class="sd">        ----------</span>
</span><span id="Calculate.calculate_absolute_salinity-1589"><a href="#Calculate.calculate_absolute_salinity-1589"><span class="linenos">1589</span></a><span class="sd">        ctd_array : DataFrame</span>
</span><span id="Calculate.calculate_absolute_salinity-1590"><a href="#Calculate.calculate_absolute_salinity-1590"><span class="linenos">1590</span></a><span class="sd">            DataFrame containing practical salinity, pressure, longitude, and latitude data</span>
</span><span id="Calculate.calculate_absolute_salinity-1591"><a href="#Calculate.calculate_absolute_salinity-1591"><span class="linenos">1591</span></a>
</span><span id="Calculate.calculate_absolute_salinity-1592"><a href="#Calculate.calculate_absolute_salinity-1592"><span class="linenos">1592</span></a><span class="sd">        Returns</span>
</span><span id="Calculate.calculate_absolute_salinity-1593"><a href="#Calculate.calculate_absolute_salinity-1593"><span class="linenos">1593</span></a><span class="sd">        -------</span>
</span><span id="Calculate.calculate_absolute_salinity-1594"><a href="#Calculate.calculate_absolute_salinity-1594"><span class="linenos">1594</span></a><span class="sd">        Series</span>
</span><span id="Calculate.calculate_absolute_salinity-1595"><a href="#Calculate.calculate_absolute_salinity-1595"><span class="linenos">1595</span></a><span class="sd">            Series with calculated absolute salinity</span>
</span><span id="Calculate.calculate_absolute_salinity-1596"><a href="#Calculate.calculate_absolute_salinity-1596"><span class="linenos">1596</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_absolute_salinity-1597"><a href="#Calculate.calculate_absolute_salinity-1597"><span class="linenos">1597</span></a>        <span class="n">sp</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;salinity_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_absolute_salinity-1598"><a href="#Calculate.calculate_absolute_salinity-1598"><span class="linenos">1598</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;seapressure_00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_absolute_salinity-1599"><a href="#Calculate.calculate_absolute_salinity-1599"><span class="linenos">1599</span></a>        <span class="n">lon</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_absolute_salinity-1600"><a href="#Calculate.calculate_absolute_salinity-1600"><span class="linenos">1600</span></a>        <span class="n">lat</span> <span class="o">=</span> <span class="n">ctd_array</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_absolute_salinity-1601"><a href="#Calculate.calculate_absolute_salinity-1601"><span class="linenos">1601</span></a>        <span class="k">return</span> <span class="n">gsw</span><span class="o">.</span><span class="n">conversions</span><span class="o">.</span><span class="n">SA_from_SP</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates absolute salinity from practical salinity, pressure,
and geographical coordinates using the TEOS-10 salinity conversion formulas.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ctd_array</strong> (DataFrame):
DataFrame containing practical salinity, pressure, longitude, and latitude data</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Series</strong>: Series with calculated absolute salinity</li>
</ul>
</div>


                            </div>
                            <div id="Calculate.calculate_mld" class="classattr">
                                        <input id="Calculate.calculate_mld-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">calculate_mld</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">densities</span>, </span><span class="param"><span class="n">depths</span>, </span><span class="param"><span class="n">reference_depth</span>, </span><span class="param"><span class="n">delta</span><span class="o">=</span><span class="mf">0.15</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Calculate.calculate_mld-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Calculate.calculate_mld"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Calculate.calculate_mld-1603"><a href="#Calculate.calculate_mld-1603"><span class="linenos">1603</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate.calculate_mld-1604"><a href="#Calculate.calculate_mld-1604"><span class="linenos">1604</span></a>    <span class="k">def</span> <span class="nf">calculate_mld</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="n">reference_depth</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.15</span><span class="p">):</span>
</span><span id="Calculate.calculate_mld-1605"><a href="#Calculate.calculate_mld-1605"><span class="linenos">1605</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_mld-1606"><a href="#Calculate.calculate_mld-1606"><span class="linenos">1606</span></a><span class="sd">        Calculates the mixed layer depth (MLD) using the density threshold method.</span>
</span><span id="Calculate.calculate_mld-1607"><a href="#Calculate.calculate_mld-1607"><span class="linenos">1607</span></a><span class="sd">        MLD is the depth at which the density exceeds the reference density</span>
</span><span id="Calculate.calculate_mld-1608"><a href="#Calculate.calculate_mld-1608"><span class="linenos">1608</span></a><span class="sd">        by a predefined amount delta, which defaults to (0.03 kg/m³).</span>
</span><span id="Calculate.calculate_mld-1609"><a href="#Calculate.calculate_mld-1609"><span class="linenos">1609</span></a>
</span><span id="Calculate.calculate_mld-1610"><a href="#Calculate.calculate_mld-1610"><span class="linenos">1610</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate.calculate_mld-1611"><a href="#Calculate.calculate_mld-1611"><span class="linenos">1611</span></a><span class="sd">        ----------</span>
</span><span id="Calculate.calculate_mld-1612"><a href="#Calculate.calculate_mld-1612"><span class="linenos">1612</span></a><span class="sd">        densities : Series</span>
</span><span id="Calculate.calculate_mld-1613"><a href="#Calculate.calculate_mld-1613"><span class="linenos">1613</span></a><span class="sd">            Series of densities</span>
</span><span id="Calculate.calculate_mld-1614"><a href="#Calculate.calculate_mld-1614"><span class="linenos">1614</span></a><span class="sd">        depths : Series</span>
</span><span id="Calculate.calculate_mld-1615"><a href="#Calculate.calculate_mld-1615"><span class="linenos">1615</span></a><span class="sd">            Series of depths corresponding to densities</span>
</span><span id="Calculate.calculate_mld-1616"><a href="#Calculate.calculate_mld-1616"><span class="linenos">1616</span></a><span class="sd">        reference_depth : float</span>
</span><span id="Calculate.calculate_mld-1617"><a href="#Calculate.calculate_mld-1617"><span class="linenos">1617</span></a><span class="sd">            The depth at which to anchor the reference density</span>
</span><span id="Calculate.calculate_mld-1618"><a href="#Calculate.calculate_mld-1618"><span class="linenos">1618</span></a><span class="sd">        delta : float, optional</span>
</span><span id="Calculate.calculate_mld-1619"><a href="#Calculate.calculate_mld-1619"><span class="linenos">1619</span></a><span class="sd">            The difference in density which would indicate the MLD, defaults to 0.1 kg/m³.</span>
</span><span id="Calculate.calculate_mld-1620"><a href="#Calculate.calculate_mld-1620"><span class="linenos">1620</span></a>
</span><span id="Calculate.calculate_mld-1621"><a href="#Calculate.calculate_mld-1621"><span class="linenos">1621</span></a><span class="sd">        Returns</span>
</span><span id="Calculate.calculate_mld-1622"><a href="#Calculate.calculate_mld-1622"><span class="linenos">1622</span></a><span class="sd">        -------</span>
</span><span id="Calculate.calculate_mld-1623"><a href="#Calculate.calculate_mld-1623"><span class="linenos">1623</span></a><span class="sd">        tuple</span>
</span><span id="Calculate.calculate_mld-1624"><a href="#Calculate.calculate_mld-1624"><span class="linenos">1624</span></a><span class="sd">            A tuple containing the calculated MLD and the reference depth used to calculate MLD.</span>
</span><span id="Calculate.calculate_mld-1625"><a href="#Calculate.calculate_mld-1625"><span class="linenos">1625</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_mld-1626"><a href="#Calculate.calculate_mld-1626"><span class="linenos">1626</span></a>        <span class="c1"># Convert to numeric and ensure no NaNs remain</span>
</span><span id="Calculate.calculate_mld-1627"><a href="#Calculate.calculate_mld-1627"><span class="linenos">1627</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld-1628"><a href="#Calculate.calculate_mld-1628"><span class="linenos">1628</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld-1629"><a href="#Calculate.calculate_mld-1629"><span class="linenos">1629</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld-1630"><a href="#Calculate.calculate_mld-1630"><span class="linenos">1630</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld-1631"><a href="#Calculate.calculate_mld-1631"><span class="linenos">1631</span></a>        <span class="n">reference_depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">reference_depth</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld-1632"><a href="#Calculate.calculate_mld-1632"><span class="linenos">1632</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">depths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Calculate.calculate_mld-1633"><a href="#Calculate.calculate_mld-1633"><span class="linenos">1633</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Calculate.calculate_mld-1634"><a href="#Calculate.calculate_mld-1634"><span class="linenos">1634</span></a>        <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">densities</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Calculate.calculate_mld-1635"><a href="#Calculate.calculate_mld-1635"><span class="linenos">1635</span></a>        <span class="n">sorted_depths</span><span class="p">,</span> <span class="n">sorted_densities</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sorted_data</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld-1636"><a href="#Calculate.calculate_mld-1636"><span class="linenos">1636</span></a>        <span class="c1"># Determine reference density</span>
</span><span id="Calculate.calculate_mld-1637"><a href="#Calculate.calculate_mld-1637"><span class="linenos">1637</span></a>        <span class="n">reference_density</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Calculate.calculate_mld-1638"><a href="#Calculate.calculate_mld-1638"><span class="linenos">1638</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_depths</span><span class="p">):</span>
</span><span id="Calculate.calculate_mld-1639"><a href="#Calculate.calculate_mld-1639"><span class="linenos">1639</span></a>            <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">reference_depth</span><span class="p">:</span>
</span><span id="Calculate.calculate_mld-1640"><a href="#Calculate.calculate_mld-1640"><span class="linenos">1640</span></a>                <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="n">reference_depth</span><span class="p">:</span>
</span><span id="Calculate.calculate_mld-1641"><a href="#Calculate.calculate_mld-1641"><span class="linenos">1641</span></a>                    <span class="n">reference_density</span> <span class="o">=</span> <span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Calculate.calculate_mld-1642"><a href="#Calculate.calculate_mld-1642"><span class="linenos">1642</span></a>                    <span class="n">reference_depth</span> <span class="o">=</span> <span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Calculate.calculate_mld-1643"><a href="#Calculate.calculate_mld-1643"><span class="linenos">1643</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Calculate.calculate_mld-1644"><a href="#Calculate.calculate_mld-1644"><span class="linenos">1644</span></a>                    <span class="c1"># Linear interpolation</span>
</span><span id="Calculate.calculate_mld-1645"><a href="#Calculate.calculate_mld-1645"><span class="linenos">1645</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Calculate.calculate_mld-1646"><a href="#Calculate.calculate_mld-1646"><span class="linenos">1646</span></a>                        <span class="n">reference_density</span> <span class="o">=</span> <span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="Calculate.calculate_mld-1647"><a href="#Calculate.calculate_mld-1647"><span class="linenos">1647</span></a>                                <span class="p">(</span><span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">sorted_densities</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="Calculate.calculate_mld-1648"><a href="#Calculate.calculate_mld-1648"><span class="linenos">1648</span></a>                                <span class="p">(</span><span class="n">reference_depth</span> <span class="o">-</span> <span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span>
</span><span id="Calculate.calculate_mld-1649"><a href="#Calculate.calculate_mld-1649"><span class="linenos">1649</span></a>                                <span class="p">(</span><span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">sorted_depths</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])))</span>
</span><span id="Calculate.calculate_mld-1650"><a href="#Calculate.calculate_mld-1650"><span class="linenos">1650</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Calculate.calculate_mld-1651"><a href="#Calculate.calculate_mld-1651"><span class="linenos">1651</span></a>                        <span class="k">raise</span> <span class="n">CTDError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Calculate.calculate_mld-1652"><a href="#Calculate.calculate_mld-1652"><span class="linenos">1652</span></a>                                       <span class="sa">f</span><span class="s2">&quot;Insufficient depth range to calculate MLD. &quot;</span>
</span><span id="Calculate.calculate_mld-1653"><a href="#Calculate.calculate_mld-1653"><span class="linenos">1653</span></a>                                       <span class="sa">f</span><span class="s2">&quot;Maximum sample depth is &quot;</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">depths</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">, minimum is </span><span class="si">{</span><span class="n">depths</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld-1654"><a href="#Calculate.calculate_mld-1654"><span class="linenos">1654</span></a>                <span class="k">break</span>
</span><span id="Calculate.calculate_mld-1655"><a href="#Calculate.calculate_mld-1655"><span class="linenos">1655</span></a>        <span class="k">if</span> <span class="n">reference_density</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Calculate.calculate_mld-1656"><a href="#Calculate.calculate_mld-1656"><span class="linenos">1656</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Calculate.calculate_mld-1657"><a href="#Calculate.calculate_mld-1657"><span class="linenos">1657</span></a>        <span class="c1"># Find the depth where density exceeds the reference density by more than 0.05 kg/m³</span>
</span><span id="Calculate.calculate_mld-1658"><a href="#Calculate.calculate_mld-1658"><span class="linenos">1658</span></a>        <span class="k">for</span> <span class="n">depth</span><span class="p">,</span> <span class="n">density</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sorted_depths</span><span class="p">,</span> <span class="n">sorted_densities</span><span class="p">):</span>
</span><span id="Calculate.calculate_mld-1659"><a href="#Calculate.calculate_mld-1659"><span class="linenos">1659</span></a>            <span class="k">if</span> <span class="n">density</span> <span class="o">&gt;</span> <span class="n">reference_density</span> <span class="o">+</span> <span class="n">delta</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">reference_depth</span><span class="p">:</span>
</span><span id="Calculate.calculate_mld-1660"><a href="#Calculate.calculate_mld-1660"><span class="linenos">1660</span></a>                <span class="k">return</span> <span class="n">depth</span><span class="p">,</span> <span class="n">reference_depth</span>
</span><span id="Calculate.calculate_mld-1661"><a href="#Calculate.calculate_mld-1661"><span class="linenos">1661</span></a>        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># If no depth meets the criterion</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the mixed layer depth (MLD) using the density threshold method.
MLD is the depth at which the density exceeds the reference density
by a predefined amount delta, which defaults to (0.03 kg/m³).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>densities</strong> (Series):
Series of densities</li>
<li><strong>depths</strong> (Series):
Series of depths corresponding to densities</li>
<li><strong>reference_depth</strong> (float):
The depth at which to anchor the reference density</li>
<li><strong>delta</strong> (float, optional):
The difference in density which would indicate the MLD, defaults to 0.1 kg/m³.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: A tuple containing the calculated MLD and the reference depth used to calculate MLD.</li>
</ul>
</div>


                            </div>
                            <div id="Calculate.calculate_mld_loess" class="classattr">
                                        <input id="Calculate.calculate_mld_loess-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">calculate_mld_loess</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">densities</span>, </span><span class="param"><span class="n">depths</span>, </span><span class="param"><span class="n">reference_depth</span>, </span><span class="param"><span class="n">delta</span><span class="o">=</span><span class="mf">0.15</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Calculate.calculate_mld_loess-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Calculate.calculate_mld_loess"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Calculate.calculate_mld_loess-1663"><a href="#Calculate.calculate_mld_loess-1663"><span class="linenos">1663</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate.calculate_mld_loess-1664"><a href="#Calculate.calculate_mld_loess-1664"><span class="linenos">1664</span></a>    <span class="k">def</span> <span class="nf">calculate_mld_loess</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="n">reference_depth</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.15</span><span class="p">):</span>
</span><span id="Calculate.calculate_mld_loess-1665"><a href="#Calculate.calculate_mld_loess-1665"><span class="linenos">1665</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_mld_loess-1666"><a href="#Calculate.calculate_mld_loess-1666"><span class="linenos">1666</span></a><span class="sd">        Calculates the mixed layer depth (MLD) using LOESS smoothing to first smooth the density profile and</span>
</span><span id="Calculate.calculate_mld_loess-1667"><a href="#Calculate.calculate_mld_loess-1667"><span class="linenos">1667</span></a><span class="sd">        then determine the depth where the smoothed density exceeds the reference density</span>
</span><span id="Calculate.calculate_mld_loess-1668"><a href="#Calculate.calculate_mld_loess-1668"><span class="linenos">1668</span></a><span class="sd">        by a predefined amount which defaults to 0.03 kg/m³.</span>
</span><span id="Calculate.calculate_mld_loess-1669"><a href="#Calculate.calculate_mld_loess-1669"><span class="linenos">1669</span></a>
</span><span id="Calculate.calculate_mld_loess-1670"><a href="#Calculate.calculate_mld_loess-1670"><span class="linenos">1670</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate.calculate_mld_loess-1671"><a href="#Calculate.calculate_mld_loess-1671"><span class="linenos">1671</span></a><span class="sd">        ----------</span>
</span><span id="Calculate.calculate_mld_loess-1672"><a href="#Calculate.calculate_mld_loess-1672"><span class="linenos">1672</span></a><span class="sd">        densities : Series</span>
</span><span id="Calculate.calculate_mld_loess-1673"><a href="#Calculate.calculate_mld_loess-1673"><span class="linenos">1673</span></a><span class="sd">            Series of densities</span>
</span><span id="Calculate.calculate_mld_loess-1674"><a href="#Calculate.calculate_mld_loess-1674"><span class="linenos">1674</span></a><span class="sd">        depths : Series</span>
</span><span id="Calculate.calculate_mld_loess-1675"><a href="#Calculate.calculate_mld_loess-1675"><span class="linenos">1675</span></a><span class="sd">            Series of depths corresponding to densities</span>
</span><span id="Calculate.calculate_mld_loess-1676"><a href="#Calculate.calculate_mld_loess-1676"><span class="linenos">1676</span></a><span class="sd">        reference_depth :</span>
</span><span id="Calculate.calculate_mld_loess-1677"><a href="#Calculate.calculate_mld_loess-1677"><span class="linenos">1677</span></a><span class="sd">            The depth at which to anchor the reference density</span>
</span><span id="Calculate.calculate_mld_loess-1678"><a href="#Calculate.calculate_mld_loess-1678"><span class="linenos">1678</span></a><span class="sd">        delta : float, optional</span>
</span><span id="Calculate.calculate_mld_loess-1679"><a href="#Calculate.calculate_mld_loess-1679"><span class="linenos">1679</span></a><span class="sd">            The difference in density which would indicate the MLD, defaults to 0.03 kg/m.</span>
</span><span id="Calculate.calculate_mld_loess-1680"><a href="#Calculate.calculate_mld_loess-1680"><span class="linenos">1680</span></a>
</span><span id="Calculate.calculate_mld_loess-1681"><a href="#Calculate.calculate_mld_loess-1681"><span class="linenos">1681</span></a><span class="sd">        Returns</span>
</span><span id="Calculate.calculate_mld_loess-1682"><a href="#Calculate.calculate_mld_loess-1682"><span class="linenos">1682</span></a><span class="sd">        -------</span>
</span><span id="Calculate.calculate_mld_loess-1683"><a href="#Calculate.calculate_mld_loess-1683"><span class="linenos">1683</span></a><span class="sd">        tuple</span>
</span><span id="Calculate.calculate_mld_loess-1684"><a href="#Calculate.calculate_mld_loess-1684"><span class="linenos">1684</span></a><span class="sd">            A tuple containing the calculated MLD and the reference depth used to calculate MLD.</span>
</span><span id="Calculate.calculate_mld_loess-1685"><a href="#Calculate.calculate_mld_loess-1685"><span class="linenos">1685</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_mld_loess-1686"><a href="#Calculate.calculate_mld_loess-1686"><span class="linenos">1686</span></a>        <span class="c1"># Ensure input is pandas Series and drop NA values</span>
</span><span id="Calculate.calculate_mld_loess-1687"><a href="#Calculate.calculate_mld_loess-1687"><span class="linenos">1687</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
</span><span id="Calculate.calculate_mld_loess-1688"><a href="#Calculate.calculate_mld_loess-1688"><span class="linenos">1688</span></a>            <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1689"><a href="#Calculate.calculate_mld_loess-1689"><span class="linenos">1689</span></a>            <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1690"><a href="#Calculate.calculate_mld_loess-1690"><span class="linenos">1690</span></a>
</span><span id="Calculate.calculate_mld_loess-1691"><a href="#Calculate.calculate_mld_loess-1691"><span class="linenos">1691</span></a>        <span class="c1"># Convert to numeric and ensure no NaNs remain</span>
</span><span id="Calculate.calculate_mld_loess-1692"><a href="#Calculate.calculate_mld_loess-1692"><span class="linenos">1692</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1693"><a href="#Calculate.calculate_mld_loess-1693"><span class="linenos">1693</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1694"><a href="#Calculate.calculate_mld_loess-1694"><span class="linenos">1694</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1695"><a href="#Calculate.calculate_mld_loess-1695"><span class="linenos">1695</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1696"><a href="#Calculate.calculate_mld_loess-1696"><span class="linenos">1696</span></a>        <span class="k">if</span> <span class="n">densities</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">depths</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="Calculate.calculate_mld_loess-1697"><a href="#Calculate.calculate_mld_loess-1697"><span class="linenos">1697</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="Calculate.calculate_mld_loess-1698"><a href="#Calculate.calculate_mld_loess-1698"><span class="linenos">1698</span></a>
</span><span id="Calculate.calculate_mld_loess-1699"><a href="#Calculate.calculate_mld_loess-1699"><span class="linenos">1699</span></a>        <span class="c1"># Convert pandas Series to numpy arrays for NumPy operations</span>
</span><span id="Calculate.calculate_mld_loess-1700"><a href="#Calculate.calculate_mld_loess-1700"><span class="linenos">1700</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="Calculate.calculate_mld_loess-1701"><a href="#Calculate.calculate_mld_loess-1701"><span class="linenos">1701</span></a>        <span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="Calculate.calculate_mld_loess-1702"><a href="#Calculate.calculate_mld_loess-1702"><span class="linenos">1702</span></a>
</span><span id="Calculate.calculate_mld_loess-1703"><a href="#Calculate.calculate_mld_loess-1703"><span class="linenos">1703</span></a>        <span class="c1"># Remove duplicates by averaging densities at the same depth</span>
</span><span id="Calculate.calculate_mld_loess-1704"><a href="#Calculate.calculate_mld_loess-1704"><span class="linenos">1704</span></a>        <span class="n">unique_depths</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1705"><a href="#Calculate.calculate_mld_loess-1705"><span class="linenos">1705</span></a>        <span class="n">average_densities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">unique_depths</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1706"><a href="#Calculate.calculate_mld_loess-1706"><span class="linenos">1706</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">average_densities</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1707"><a href="#Calculate.calculate_mld_loess-1707"><span class="linenos">1707</span></a>        <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">unique_depths</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1708"><a href="#Calculate.calculate_mld_loess-1708"><span class="linenos">1708</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1709"><a href="#Calculate.calculate_mld_loess-1709"><span class="linenos">1709</span></a>        <span class="n">average_densities</span> <span class="o">/=</span> <span class="n">counts</span>
</span><span id="Calculate.calculate_mld_loess-1710"><a href="#Calculate.calculate_mld_loess-1710"><span class="linenos">1710</span></a>
</span><span id="Calculate.calculate_mld_loess-1711"><a href="#Calculate.calculate_mld_loess-1711"><span class="linenos">1711</span></a>        <span class="c1"># Apply LOESS smoothing</span>
</span><span id="Calculate.calculate_mld_loess-1712"><a href="#Calculate.calculate_mld_loess-1712"><span class="linenos">1712</span></a>        <span class="n">lowess</span> <span class="o">=</span> <span class="n">statsmodels</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">nonparametric</span><span class="o">.</span><span class="n">lowess</span>
</span><span id="Calculate.calculate_mld_loess-1713"><a href="#Calculate.calculate_mld_loess-1713"><span class="linenos">1713</span></a>        <span class="n">smoothed</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">average_densities</span><span class="p">,</span> <span class="n">unique_depths</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1714"><a href="#Calculate.calculate_mld_loess-1714"><span class="linenos">1714</span></a>        <span class="n">smoothed_depths</span><span class="p">,</span> <span class="n">smoothed_densities</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">smoothed</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1715"><a href="#Calculate.calculate_mld_loess-1715"><span class="linenos">1715</span></a>        <span class="n">reference_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">reference_depth</span><span class="p">,</span> <span class="n">smoothed_depths</span><span class="p">,</span> <span class="n">smoothed_densities</span><span class="p">)</span>
</span><span id="Calculate.calculate_mld_loess-1716"><a href="#Calculate.calculate_mld_loess-1716"><span class="linenos">1716</span></a>
</span><span id="Calculate.calculate_mld_loess-1717"><a href="#Calculate.calculate_mld_loess-1717"><span class="linenos">1717</span></a>        <span class="c1"># Find the depth where density exceeds the reference density by more than 0.05 kg/m³</span>
</span><span id="Calculate.calculate_mld_loess-1718"><a href="#Calculate.calculate_mld_loess-1718"><span class="linenos">1718</span></a>        <span class="n">exceeding_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">smoothed_densities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">reference_density</span> <span class="o">+</span> <span class="n">delta</span>
</span><span id="Calculate.calculate_mld_loess-1719"><a href="#Calculate.calculate_mld_loess-1719"><span class="linenos">1719</span></a>                                     <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">smoothed_densities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">reference_depth</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Calculate.calculate_mld_loess-1720"><a href="#Calculate.calculate_mld_loess-1720"><span class="linenos">1720</span></a>        <span class="k">if</span> <span class="n">exceeding_indices</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Calculate.calculate_mld_loess-1721"><a href="#Calculate.calculate_mld_loess-1721"><span class="linenos">1721</span></a>            <span class="n">mld_depth</span> <span class="o">=</span> <span class="n">smoothed_depths</span><span class="p">[</span><span class="n">exceeding_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Calculate.calculate_mld_loess-1722"><a href="#Calculate.calculate_mld_loess-1722"><span class="linenos">1722</span></a>            <span class="k">return</span> <span class="n">mld_depth</span><span class="p">,</span> <span class="n">reference_depth</span>
</span><span id="Calculate.calculate_mld_loess-1723"><a href="#Calculate.calculate_mld_loess-1723"><span class="linenos">1723</span></a>
</span><span id="Calculate.calculate_mld_loess-1724"><a href="#Calculate.calculate_mld_loess-1724"><span class="linenos">1724</span></a>        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># If no depth meets the criterion</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the mixed layer depth (MLD) using LOESS smoothing to first smooth the density profile and
then determine the depth where the smoothed density exceeds the reference density
by a predefined amount which defaults to 0.03 kg/m³.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>densities</strong> (Series):
Series of densities</li>
<li><strong>depths</strong> (Series):
Series of depths corresponding to densities</li>
<li><strong>reference_depth :</strong>: The depth at which to anchor the reference density</li>
<li><strong>delta</strong> (float, optional):
The difference in density which would indicate the MLD, defaults to 0.03 kg/m.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: A tuple containing the calculated MLD and the reference depth used to calculate MLD.</li>
</ul>
</div>


                            </div>
                            <div id="Calculate.calculate_mean_surface_density" class="classattr">
                                        <input id="Calculate.calculate_mean_surface_density-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">calculate_mean_surface_density</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">range_</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Calculate.calculate_mean_surface_density-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Calculate.calculate_mean_surface_density"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Calculate.calculate_mean_surface_density-1726"><a href="#Calculate.calculate_mean_surface_density-1726"><span class="linenos">1726</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Calculate.calculate_mean_surface_density-1727"><a href="#Calculate.calculate_mean_surface_density-1727"><span class="linenos">1727</span></a>    <span class="k">def</span> <span class="nf">calculate_mean_surface_density</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">range_</span><span class="p">):</span>
</span><span id="Calculate.calculate_mean_surface_density-1728"><a href="#Calculate.calculate_mean_surface_density-1728"><span class="linenos">1728</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_mean_surface_density-1729"><a href="#Calculate.calculate_mean_surface_density-1729"><span class="linenos">1729</span></a><span class="sd">        Calculates the mean surface density from the CTD data, for a specified range or the entire dataset if the range is larger.</span>
</span><span id="Calculate.calculate_mean_surface_density-1730"><a href="#Calculate.calculate_mean_surface_density-1730"><span class="linenos">1730</span></a>
</span><span id="Calculate.calculate_mean_surface_density-1731"><a href="#Calculate.calculate_mean_surface_density-1731"><span class="linenos">1731</span></a><span class="sd">        Parameters</span>
</span><span id="Calculate.calculate_mean_surface_density-1732"><a href="#Calculate.calculate_mean_surface_density-1732"><span class="linenos">1732</span></a><span class="sd">        ----------</span>
</span><span id="Calculate.calculate_mean_surface_density-1733"><a href="#Calculate.calculate_mean_surface_density-1733"><span class="linenos">1733</span></a><span class="sd">        df : DataFrame</span>
</span><span id="Calculate.calculate_mean_surface_density-1734"><a href="#Calculate.calculate_mean_surface_density-1734"><span class="linenos">1734</span></a><span class="sd">            DataFrame containing density data.</span>
</span><span id="Calculate.calculate_mean_surface_density-1735"><a href="#Calculate.calculate_mean_surface_density-1735"><span class="linenos">1735</span></a><span class="sd">        range_ : tuple or int</span>
</span><span id="Calculate.calculate_mean_surface_density-1736"><a href="#Calculate.calculate_mean_surface_density-1736"><span class="linenos">1736</span></a><span class="sd">            Tuple indicating the (start, end) indices for the range of rows to be included in the calculation,</span>
</span><span id="Calculate.calculate_mean_surface_density-1737"><a href="#Calculate.calculate_mean_surface_density-1737"><span class="linenos">1737</span></a><span class="sd">            or an integer indicating the number of rows from the start.</span>
</span><span id="Calculate.calculate_mean_surface_density-1738"><a href="#Calculate.calculate_mean_surface_density-1738"><span class="linenos">1738</span></a>
</span><span id="Calculate.calculate_mean_surface_density-1739"><a href="#Calculate.calculate_mean_surface_density-1739"><span class="linenos">1739</span></a><span class="sd">        Returns</span>
</span><span id="Calculate.calculate_mean_surface_density-1740"><a href="#Calculate.calculate_mean_surface_density-1740"><span class="linenos">1740</span></a><span class="sd">        -------</span>
</span><span id="Calculate.calculate_mean_surface_density-1741"><a href="#Calculate.calculate_mean_surface_density-1741"><span class="linenos">1741</span></a><span class="sd">        float, None</span>
</span><span id="Calculate.calculate_mean_surface_density-1742"><a href="#Calculate.calculate_mean_surface_density-1742"><span class="linenos">1742</span></a><span class="sd">            Mean density value of the specified sample or None if unable to calculate.</span>
</span><span id="Calculate.calculate_mean_surface_density-1743"><a href="#Calculate.calculate_mean_surface_density-1743"><span class="linenos">1743</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Calculate.calculate_mean_surface_density-1744"><a href="#Calculate.calculate_mean_surface_density-1744"><span class="linenos">1744</span></a>        <span class="n">min_depth</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Calculate.calculate_mean_surface_density-1745"><a href="#Calculate.calculate_mean_surface_density-1745"><span class="linenos">1745</span></a>        <span class="n">max_depth</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Calculate.calculate_mean_surface_density-1746"><a href="#Calculate.calculate_mean_surface_density-1746"><span class="linenos">1746</span></a>
</span><span id="Calculate.calculate_mean_surface_density-1747"><a href="#Calculate.calculate_mean_surface_density-1747"><span class="linenos">1747</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="Calculate.calculate_mean_surface_density-1748"><a href="#Calculate.calculate_mean_surface_density-1748"><span class="linenos">1748</span></a>            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">range_</span>
</span><span id="Calculate.calculate_mean_surface_density-1749"><a href="#Calculate.calculate_mean_surface_density-1749"><span class="linenos">1749</span></a>
</span><span id="Calculate.calculate_mean_surface_density-1750"><a href="#Calculate.calculate_mean_surface_density-1750"><span class="linenos">1750</span></a>            <span class="c1"># Adjust &#39;start&#39; to ensure it is within the valid range</span>
</span><span id="Calculate.calculate_mean_surface_density-1751"><a href="#Calculate.calculate_mean_surface_density-1751"><span class="linenos">1751</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">min_depth</span><span class="p">)</span>
</span><span id="Calculate.calculate_mean_surface_density-1752"><a href="#Calculate.calculate_mean_surface_density-1752"><span class="linenos">1752</span></a>
</span><span id="Calculate.calculate_mean_surface_density-1753"><a href="#Calculate.calculate_mean_surface_density-1753"><span class="linenos">1753</span></a>            <span class="c1"># Adjust &#39;end&#39; to ensure it does not exceed the maximum depth value</span>
</span><span id="Calculate.calculate_mean_surface_density-1754"><a href="#Calculate.calculate_mean_surface_density-1754"><span class="linenos">1754</span></a>            <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="Calculate.calculate_mean_surface_density-1755"><a href="#Calculate.calculate_mean_surface_density-1755"><span class="linenos">1755</span></a>
</span><span id="Calculate.calculate_mean_surface_density-1756"><a href="#Calculate.calculate_mean_surface_density-1756"><span class="linenos">1756</span></a>            <span class="c1"># Ensure start is less than end</span>
</span><span id="Calculate.calculate_mean_surface_density-1757"><a href="#Calculate.calculate_mean_surface_density-1757"><span class="linenos">1757</span></a>            <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
</span><span id="Calculate.calculate_mean_surface_density-1758"><a href="#Calculate.calculate_mean_surface_density-1758"><span class="linenos">1758</span></a>                <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Calculate.calculate_mean_surface_density-1759"><a href="#Calculate.calculate_mean_surface_density-1759"><span class="linenos">1759</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Calculate.calculate_mean_surface_density-1760"><a href="#Calculate.calculate_mean_surface_density-1760"><span class="linenos">1760</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Calculate.calculate_mean_surface_density-1761"><a href="#Calculate.calculate_mean_surface_density-1761"><span class="linenos">1761</span></a>
</span><span id="Calculate.calculate_mean_surface_density-1762"><a href="#Calculate.calculate_mean_surface_density-1762"><span class="linenos">1762</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Calculate.calculate_mean_surface_density-1763"><a href="#Calculate.calculate_mean_surface_density-1763"><span class="linenos">1763</span></a>            <span class="c1"># Use &#39;range_&#39; as the number of rows from the start, adjust if it exceeds the DataFrame length</span>
</span><span id="Calculate.calculate_mean_surface_density-1764"><a href="#Calculate.calculate_mean_surface_density-1764"><span class="linenos">1764</span></a>            <span class="n">range_</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">range_</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</span><span id="Calculate.calculate_mean_surface_density-1765"><a href="#Calculate.calculate_mean_surface_density-1765"><span class="linenos">1765</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">range_</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Calculate.calculate_mean_surface_density-1766"><a href="#Calculate.calculate_mean_surface_density-1766"><span class="linenos">1766</span></a>
</span><span id="Calculate.calculate_mean_surface_density-1767"><a href="#Calculate.calculate_mean_surface_density-1767"><span class="linenos">1767</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Calculate.calculate_mean_surface_density-1768"><a href="#Calculate.calculate_mean_surface_density-1768"><span class="linenos">1768</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid range type. Must be tuple or int.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the mean surface density from the CTD data, for a specified range or the entire dataset if the range is larger.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (DataFrame):
DataFrame containing density data.</li>
<li><strong>range_</strong> (tuple or int):
Tuple indicating the (start, end) indices for the range of rows to be included in the calculation,
or an integer indicating the number of rows from the start.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float, None</strong>: Mean density value of the specified sample or None if unable to calculate.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="CTDError">
                            <input id="CTDError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CTDError</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="CTDError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CTDError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CTDError-1771"><a href="#CTDError-1771"><span class="linenos">1771</span></a><span class="k">class</span> <span class="nc">CTDError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="CTDError-1772"><a href="#CTDError-1772"><span class="linenos">1772</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CTDError-1773"><a href="#CTDError-1773"><span class="linenos">1773</span></a><span class="sd">    Exception raised for CTD related errors.</span>
</span><span id="CTDError-1774"><a href="#CTDError-1774"><span class="linenos">1774</span></a>
</span><span id="CTDError-1775"><a href="#CTDError-1775"><span class="linenos">1775</span></a><span class="sd">    Parameters</span>
</span><span id="CTDError-1776"><a href="#CTDError-1776"><span class="linenos">1776</span></a><span class="sd">    ----------</span>
</span><span id="CTDError-1777"><a href="#CTDError-1777"><span class="linenos">1777</span></a><span class="sd">    filename: input dataset which caused the error</span>
</span><span id="CTDError-1778"><a href="#CTDError-1778"><span class="linenos">1778</span></a><span class="sd">    message: message -- explanation of the error</span>
</span><span id="CTDError-1779"><a href="#CTDError-1779"><span class="linenos">1779</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CTDError-1780"><a href="#CTDError-1780"><span class="linenos">1780</span></a>
</span><span id="CTDError-1781"><a href="#CTDError-1781"><span class="linenos">1781</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot; Unknown, check to make sure your mastersheet is in your current directory.&quot;</span><span class="p">):</span>
</span><span id="CTDError-1782"><a href="#CTDError-1782"><span class="linenos">1782</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="CTDError-1783"><a href="#CTDError-1783"><span class="linenos">1783</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="CTDError-1784"><a href="#CTDError-1784"><span class="linenos">1784</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CTDError-1785"><a href="#CTDError-1785"><span class="linenos">1785</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Exception raised for CTD related errors.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>filename</strong> (input dataset which caused the error):</p></li>
<li><p><strong>message</strong> (message -- explanation of the error):</p></li>
</ul>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.BaseException</dt>
                                <dd id="CTDError.with_traceback" class="function">with_traceback</dd>
                <dd id="CTDError.add_note" class="function">add_note</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
</body>
</html>